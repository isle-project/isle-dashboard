"use strict";(self.webpackChunkisle_dashboard=self.webpackChunkisle_dashboard||[]).push([[6399],{83214:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{Uw:function(){return saveLessonMetricsInjector},Wn:function(){return createMetricInjector},_H:function(){return deleteMetricInjector},h0:function(){return getCompletionComponents},hU:function(){return getCompletionTags},q:function(){return updateMetricInjector},sA:function(){return computeCompletionsInjector}});var axios__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(9669),axios__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(axios__WEBPACK_IMPORTED_MODULE_0__),constants_server__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(94204),actions_notification__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(16120),constants_action_types_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(84499),__async=(__this,__arguments,generator)=>new Promise((resolve,reject)=>{var fulfilled=value=>{try{step(generator.next(value))}catch(e){reject(e)}},rejected=value=>{try{step(generator.throw(value))}catch(e){reject(e)}},step=x=>x.done?resolve(x.value):Promise.resolve(x.value).then(fulfilled,rejected);step((generator=generator.apply(__this,__arguments)).next())});const DEFAULT_TAGS=["_default_tag"],getCompletionTags=(dispatch,lessonIDs)=>__async(void 0,null,function*(){try{const res=yield axios__WEBPACK_IMPORTED_MODULE_0___default().post(`${constants_server__WEBPACK_IMPORTED_MODULE_1__.ZP}/completion_tags`,{lessons:lessonIDs});dispatch({type:constants_action_types_js__WEBPACK_IMPORTED_MODULE_2__.ZI,payload:{completionTags:res.data}})}catch(err){dispatch({type:constants_action_types_js__WEBPACK_IMPORTED_MODULE_2__.ZI,payload:{completionTags:DEFAULT_TAGS}})}}),getCompletionTagsInjector=dispatch=>lessonIDs=>__async(void 0,null,function*(){yield getCompletionTags(dispatch,lessonIDs)}),getCompletionComponents=(dispatch,lessonIds)=>__async(void 0,null,function*(){try{const res=yield axios__WEBPACK_IMPORTED_MODULE_0___default().post(`${constants_server__WEBPACK_IMPORTED_MODULE_1__.ZP}/completion_components`,{lessons:lessonIds});dispatch({type:constants_action_types_js__WEBPACK_IMPORTED_MODULE_2__.t3,payload:{componentsByLesson:res.data}})}catch(err){console.error("Error getting completion components: ",err);const componentsByLesson={};lessonIds.forEach(lessonID=>{componentsByLesson[lessonID]=[]}),dispatch({type:constants_action_types_js__WEBPACK_IMPORTED_MODULE_2__.t3,payload:{componentsByLesson}})}}),getCompletionLessonRefs=(_0,_1)=>__async(void 0,[_0,_1],function*(dispatch,{entities,target}){try{const res=yield axios.post(`${server}/completion_refs`,{entities,target});dispatch({type:GET_COMPLETION_LESSON_REFS,payload:{completionRefs:res.data}})}catch(err){return addErrorNotification(dispatch,err)}}),getCompletionLessonRefsInjector=dispatch=>_0=>__async(void 0,[_0],function*({entities,target}){yield getCompletionLessonRefs(dispatch,{entities,target})}),computeCompletions=(_0,_1)=>__async(void 0,[_0,_1],function*(dispatch,{metric,ids,users,policyOptions}){try{const res=yield axios__WEBPACK_IMPORTED_MODULE_0___default().post(`${constants_server__WEBPACK_IMPORTED_MODULE_1__.ZP}/compute_completions`,{metric,ids,users,policyOptions});dispatch({type:constants_action_types_js__WEBPACK_IMPORTED_MODULE_2__.kp,payload:res.data}),(0,actions_notification__WEBPACK_IMPORTED_MODULE_3__.wN)(dispatch,{message:res.data.message,level:"success"})}catch(err){return(0,actions_notification__WEBPACK_IMPORTED_MODULE_3__.EG)(dispatch,err)}}),computeCompletionsInjector=dispatch=>_0=>__async(void 0,[_0],function*({metric,ids,users,policyOptions}){return yield computeCompletions(dispatch,{metric,ids,users,policyOptions})}),createMetric=(_0,_1)=>__async(void 0,[_0,_1],function*(dispatch,{name,rule,coverage,level,id,ref}){try{const res=yield axios__WEBPACK_IMPORTED_MODULE_0___default().post(`${constants_server__WEBPACK_IMPORTED_MODULE_1__.ZP}/create_metric`,{name,rule,coverage,level,id,ref});console.log(res.data),dispatch({type:constants_action_types_js__WEBPACK_IMPORTED_MODULE_2__.JQ,payload:{metric:res.data.metric,level,id}})}catch(err){return(0,actions_notification__WEBPACK_IMPORTED_MODULE_3__.EG)(dispatch,err)}}),createMetricInjector=dispatch=>metric=>__async(void 0,null,function*(){yield createMetric(dispatch,metric)}),updateMetric=(dispatch,body)=>__async(void 0,null,function*(){try{const res=yield axios__WEBPACK_IMPORTED_MODULE_0___default().post(`${constants_server__WEBPACK_IMPORTED_MODULE_1__.ZP}/update_metric`,body);console.log(res.data),dispatch({type:constants_action_types_js__WEBPACK_IMPORTED_MODULE_2__.JS,payload:{metric:body,level:body.level,id:body.id}})}catch(err){return(0,actions_notification__WEBPACK_IMPORTED_MODULE_3__.EG)(dispatch,err)}}),updateMetricInjector=dispatch=>metric=>__async(void 0,null,function*(){yield updateMetric(dispatch,metric)}),deleteMetric=(_0,_1)=>__async(void 0,[_0,_1],function*(dispatch,{name,level,id}){try{yield axios__WEBPACK_IMPORTED_MODULE_0___default().post(`${constants_server__WEBPACK_IMPORTED_MODULE_1__.ZP}/delete_metric`,{name,level,id}),dispatch({type:constants_action_types_js__WEBPACK_IMPORTED_MODULE_2__.sy,payload:{name,level,id}})}catch(err){return(0,actions_notification__WEBPACK_IMPORTED_MODULE_3__.EG)(dispatch,err)}}),deleteMetricInjector=dispatch=>_0=>__async(void 0,[_0],function*({name,level,id}){return yield deleteMetric(dispatch,{name,level,id})}),saveLessonMetrics=(dispatch,body)=>__async(void 0,null,function*(){try{const res=yield axios__WEBPACK_IMPORTED_MODULE_0___default().post(`${constants_server__WEBPACK_IMPORTED_MODULE_1__.ZP}/save_lesson_metrics`,body);return console.log("SAVE LESSON METRICS",res.data),dispatch({type:constants_action_types_js__WEBPACK_IMPORTED_MODULE_2__.ee,payload:res.data}),res}catch(err){return(0,actions_notification__WEBPACK_IMPORTED_MODULE_3__.EG)(dispatch,err)}}),saveLessonMetricsInjector=dispatch=>body=>__async(void 0,null,function*(){return yield saveLessonMetrics(dispatch,body)})},23218:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{Ib:function(){return changedNamespace},J3:function(){return updateCurrentNamespaceInjector},Ll:function(){return createNamespaceInjector},Tm:function(){return adjustProgressInjector},Vw:function(){return setLessonOrderInjector},hA:function(){return getAllNamespacesInjector},kC:function(){return deleteCurrentNamespaceInjector},qw:function(){return getNamespaceActionsInjector}});var axios__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(9669),axios__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(axios__WEBPACK_IMPORTED_MODULE_0__),querystring__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(17673),i18next__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(41631),utils_file_saver_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(19446),constants_server__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(94204),actions_notification__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(16120),actions_cohort__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(72371),constants_action_types_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(84499),__async=(__this,__arguments,generator)=>new Promise((resolve,reject)=>{var fulfilled=value=>{try{step(generator.next(value))}catch(e){reject(e)}},rejected=value=>{try{step(generator.throw(value))}catch(e){reject(e)}},step=x=>x.done?resolve(x.value):Promise.resolve(x.value).then(fulfilled,rejected);step((generator=generator.apply(__this,__arguments)).next())});function appendCreatedNamespace(namespace){return{type:constants_action_types_js__WEBPACK_IMPORTED_MODULE_6__.$8,payload:{namespace}}}function changedNamespace({title,owners,announcements=[],cohorts=[],description,enableTicketing,_id,completions}){return{type:constants_action_types_js__WEBPACK_IMPORTED_MODULE_6__.WF,payload:{title,announcements,cohorts,description,enableTicketing,owners,completions,_id}}}function deletedCurrentNamespace(id){return{type:constants_action_types_js__WEBPACK_IMPORTED_MODULE_6__.ke,payload:{id}}}function updateStudentProgress({email,lessonID,progress,cohort}){return{type:constants_action_types_js__WEBPACK_IMPORTED_MODULE_6__.LX,payload:{email,lessonID,progress,cohort}}}function updatedOwnedNamespace({title,owners,description,enableTicketing,_id}){return{type:constants_action_types_js__WEBPACK_IMPORTED_MODULE_6__.Rg,payload:{title,description,owners,enableTicketing,_id}}}const createNamespace=(_0,_1)=>__async(void 0,[_0,_1],function*(dispatch,{title,description,owners,props}){try{const res=yield axios__WEBPACK_IMPORTED_MODULE_0___default().post(constants_server__WEBPACK_IMPORTED_MODULE_4__.ZP+"/create_namespace",{title,description,owners});if(!res.data.successful)return(0,actions_notification__WEBPACK_IMPORTED_MODULE_7__.EG)(dispatch,new Error(res.data.message));const namespace=res.data.namespace;props.onNamespace(namespace),dispatch(appendCreatedNamespace(namespace)),window.location.replace("/dashboard/lessons"),(0,actions_notification__WEBPACK_IMPORTED_MODULE_7__.wN)(dispatch,{message:res.data.message,level:res.data.successful?"success":"error"})}catch(err){(0,actions_notification__WEBPACK_IMPORTED_MODULE_7__.EG)(dispatch,err)}}),createNamespaceInjector=dispatch=>_0=>__async(void 0,[_0],function*({title,description,owners,props}){yield createNamespace(dispatch,{title,description,owners,props})}),deleteCurrentNamespace=(dispatch,id)=>__async(void 0,null,function*(){try{const res=yield axios__WEBPACK_IMPORTED_MODULE_0___default().post(constants_server__WEBPACK_IMPORTED_MODULE_4__.ZP+"/delete_namespace",{id});window.location.replace("/dashboard/lessons"),dispatch(deletedCurrentNamespace(id)),(0,actions_notification__WEBPACK_IMPORTED_MODULE_7__.wN)(dispatch,{message:res.data.message,level:"success"})}catch(err){return(0,actions_notification__WEBPACK_IMPORTED_MODULE_7__.EG)(dispatch,err)}}),deleteCurrentNamespaceInjector=dispatch=>id=>__async(void 0,null,function*(){yield deleteCurrentNamespace(dispatch,id)}),updateCurrentNamespace=(dispatch,ns)=>__async(void 0,null,function*(){try{const res=yield axios__WEBPACK_IMPORTED_MODULE_0___default().post(constants_server__WEBPACK_IMPORTED_MODULE_4__.ZP+"/update_namespace",{ns});dispatch(changedNamespace(res.data.namespace)),dispatch(updatedOwnedNamespace(res.data.namespace)),(0,actions_notification__WEBPACK_IMPORTED_MODULE_7__.wN)(dispatch,{message:res.data.message,level:"success"}),(0,actions_cohort__WEBPACK_IMPORTED_MODULE_5__.k$)(dispatch,{namespaceID:ns._id})}catch(err){(0,actions_notification__WEBPACK_IMPORTED_MODULE_7__.EG)(dispatch,err)}}),updateCurrentNamespaceInjector=dispatch=>(id,ns)=>__async(void 0,null,function*(){yield updateCurrentNamespace(dispatch,id,ns)}),getNamespaceActions=(_0,_1)=>__async(void 0,[_0,_1],function*(dispatch,{namespaceID,namespaceTitle}){try{const res=yield axios__WEBPACK_IMPORTED_MODULE_0___default().get(constants_server__WEBPACK_IMPORTED_MODULE_4__.ZP+"/get_namespace_actions?"+querystring__WEBPACK_IMPORTED_MODULE_1__.stringify({namespaceID})),blob=new Blob([res.data],{type:"application/json"}),name=`actions_${namespaceTitle}.json`;(0,utils_file_saver_js__WEBPACK_IMPORTED_MODULE_3__.Z)(blob,name)}catch(err){(0,actions_notification__WEBPACK_IMPORTED_MODULE_7__.EG)(dispatch,err)}}),getNamespaceActionsInjector=dispatch=>_0=>__async(void 0,[_0],function*({namespaceID,namespaceTitle}){yield getNamespaceActions(dispatch,{namespaceID,namespaceTitle})}),adjustProgress=(_0,_1)=>__async(void 0,[_0,_1],function*(dispatch,{email,lessonID,namespaceID,progress,cohort}){const res=yield axios__WEBPACK_IMPORTED_MODULE_0___default().post(constants_server__WEBPACK_IMPORTED_MODULE_4__.ZP+"/user_adjust_progress",{email,lessonID,namespaceID,progress});(0,actions_notification__WEBPACK_IMPORTED_MODULE_7__.wN)(dispatch,{title:i18next__WEBPACK_IMPORTED_MODULE_2__.ZP.t("common:updated"),message:res.data.message,level:"success"}),dispatch(updateStudentProgress({email,lessonID,progress,cohort}))}),adjustProgressInjector=dispatch=>_0=>__async(void 0,[_0],function*({email,lessonID,namespaceID,progress,cohort}){yield adjustProgress(dispatch,{email,lessonID,namespaceID,progress,cohort})}),getAllNamespaces=dispatch=>__async(void 0,null,function*(){try{const res=yield axios__WEBPACK_IMPORTED_MODULE_0___default().get(constants_server__WEBPACK_IMPORTED_MODULE_4__.ZP+"/get_all_namespaces");dispatch({type:constants_action_types_js__WEBPACK_IMPORTED_MODULE_6__.XM,payload:{namespaces:res.data.namespaces}})}catch(err){return(0,actions_notification__WEBPACK_IMPORTED_MODULE_7__.EG)(dispatch,err)}}),getAllNamespacesInjector=dispatch=>()=>__async(void 0,null,function*(){yield getAllNamespaces(dispatch)}),setLessonOrder=(_0,_1)=>__async(void 0,[_0,_1],function*(dispatch,{lessons,id}){try{yield axios__WEBPACK_IMPORTED_MODULE_0___default().post(constants_server__WEBPACK_IMPORTED_MODULE_4__.ZP+"/set_lesson_order",{lessons,id})}catch(err){return(0,actions_notification__WEBPACK_IMPORTED_MODULE_7__.EG)(dispatch,err)}}),setLessonOrderInjector=dispatch=>_0=>__async(void 0,[_0],function*({lessons,id}){yield setLessonOrder(dispatch,{lessons,id})})},77530:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{Z:function(){return compute_modal}});var react=__webpack_require__(67294),prop_types=__webpack_require__(45697),prop_types_default=__webpack_require__.n(prop_types),commonjs=__webpack_require__(81468),entry=__webpack_require__(15141),OverlayTrigger=__webpack_require__(99201),OverlayTrigger_default=__webpack_require__.n(OverlayTrigger),Popover=__webpack_require__(44981),Popover_default=__webpack_require__.n(Popover),__defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp.call(b,prop)&&__defNormalProp(a,prop,b[prop]);if(__getOwnPropSymbols)for(var prop of __getOwnPropSymbols(b))__propIsEnum.call(b,prop)&&__defNormalProp(a,prop,b[prop]);return a},__spreadProps=(a,b)=>__defProps(a,__getOwnPropDescs(b)),help_icon=props=>{const overlayRef=react.useRef(null);return react.createElement("div",{className:"help-panel",role:"button",tabIndex:0,onKeyDown:e=>overlayRef.current&&(e.which===13||e.which===32)&&overlayRef.current.click(e)},react.createElement(OverlayTrigger_default(),{placement:"right",trigger:["click"],rootClose:!0,delay:{show:250,hide:0},overlay:ps=>react.createElement(Popover_default(),__spreadProps(__spreadValues({},ps),{className:"help-text"}),react.createElement(Popover_default().Body,null,props.children))},react.createElement("span",{className:"mr-1",tabIndex:"0",role:"button",ref:overlayRef},"info")))},Container=__webpack_require__(70448),Container_default=__webpack_require__.n(Container),Modal=__webpack_require__(89194),Modal_default=__webpack_require__.n(Modal),Button=__webpack_require__(89876),Button_default=__webpack_require__.n(Button),Form=__webpack_require__(17383),Form_default=__webpack_require__.n(Form),Row=__webpack_require__(28269),Row_default=__webpack_require__.n(Row),Col=__webpack_require__(1266),react_select_cjs_prod=__webpack_require__(87583),lib=__webpack_require__(76266),lib_default=__webpack_require__.n(lib),use_previous=__webpack_require__(12162),compute_modal_defProp=Object.defineProperty,compute_modal_defProps=Object.defineProperties,compute_modal_getOwnPropDescs=Object.getOwnPropertyDescriptors,compute_modal_getOwnPropSymbols=Object.getOwnPropertySymbols,compute_modal_hasOwnProp=Object.prototype.hasOwnProperty,compute_modal_propIsEnum=Object.prototype.propertyIsEnumerable,compute_modal_defNormalProp=(obj,key,value)=>key in obj?compute_modal_defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,compute_modal_spreadValues=(a,b)=>{for(var prop in b||(b={}))compute_modal_hasOwnProp.call(b,prop)&&compute_modal_defNormalProp(a,prop,b[prop]);if(compute_modal_getOwnPropSymbols)for(var prop of compute_modal_getOwnPropSymbols(b))compute_modal_propIsEnum.call(b,prop)&&compute_modal_defNormalProp(a,prop,b[prop]);return a},compute_modal_spreadProps=(a,b)=>compute_modal_defProps(a,compute_modal_getOwnPropDescs(b));const MULTIPLES_POLICIES=[{value:"last",label:"Last submitted value"},{value:"first",label:"First submitted value"},{value:"pass-through",label:"All submitted values"},{value:"max",label:"Best submitted value"}];function createTagWeights(tags,existingWeights={}){if(!tags)return{_default_tag:1};const weights={};return tags.forEach(tag=>{var _a;weights[tag]=(_a=existingWeights==null?void 0:existingWeights[tag])!=null?_a:1}),weights}const memberSelection=member=>({value:member.id,label:`${member.firstName} ${member.lastName} (${member.email})`});function TagWeightInput({value,t,onChange}){const tags=Object.keys(value),handleChange=(0,react.useCallback)(event=>{const weight=Number(event.target.value),tag=event.target.getAttribute("data-tag"),newWeights=compute_modal_spreadValues({},value);newWeights[tag]=weight,onChange(newWeights)},[value,onChange]),inputs=new Array(tags.length);for(let i=0;i<tags.length;i++){const tag=tags[i],weight=value[tag];inputs[i]=react.createElement(Form_default().Group,{className:"mb-1",as:Row_default(),key:`tag-${i}`},react.createElement(Form_default().Label,{column:!0,sm:3},tag==="_default_tag"?t("default"):tag),react.createElement(Col.default,{sm:9},react.createElement(Form_default().Control,{type:"number",value:weight,onChange:handleChange,placeholder:1,"data-tag":tag,min:0})))}return inputs}function ComputeModal({cohorts,metric,entity,level,show,tags,onHide,computeCompletions,onCompute}){console.log("Array of metrics with the same name:",metric);const{t}=(0,commonjs.$G)(),metricName=lib_default()(metric)?metric[0].name:metric.name,[formValues,setFormValues]=(0,react.useState)({users:[],activeCohorts:{},policyOptions:{tagWeights:createTagWeights(tags,{}),multiples:MULTIPLES_POLICIES[0]}}),FORM_STORAGE_KEY=`ISLE?level=${level}&metric=${metricName}`;(0,react.useEffect)(()=>{var _a;let oldFormValues=localStorage.getItem(FORM_STORAGE_KEY);oldFormValues&&(oldFormValues=JSON.parse(oldFormValues),(_a=oldFormValues.policyOptions)!=null&&_a.timeFilter&&(oldFormValues.policyOptions.timeFilter=oldFormValues.policyOptions.timeFilter.map(x=>new Date(x))),setFormValues(oldFormValues))},[FORM_STORAGE_KEY]);const oldTags=(0,use_previous.Z)(tags||[]);(0,react.useEffect)(()=>{if(tags&&oldTags&&tags.length!==oldTags.length){const newFormValues=compute_modal_spreadValues({},formValues);newFormValues.policyOptions.tagWeights=createTagWeights(tags,formValues.policyOptions.tagWeights),setFormValues(newFormValues)}},[tags,oldTags,formValues]);const onTimeChange=(0,react.useCallback)(dates=>{const newFormValues=compute_modal_spreadValues({},formValues);dates?newFormValues.policyOptions.timeFilter=dates:delete newFormValues.policyOptions.timeFilter,setFormValues(newFormValues)},[formValues]),handleMultiplesPolicyChange=(0,react.useCallback)(multiples=>{const newFormValues=compute_modal_spreadValues({},formValues);newFormValues.policyOptions.multiples=multiples,setFormValues(newFormValues)},[formValues]),handleTagWeightsChange=(0,react.useCallback)(tagWeights=>{const newFormValues=compute_modal_spreadValues({},formValues);newFormValues.policyOptions.tagWeights=tagWeights,setFormValues(newFormValues)},[formValues]),handleCompute=(0,react.useCallback)(()=>{const policyOptions=compute_modal_spreadProps(compute_modal_spreadValues({},formValues.policyOptions),{multiples:formValues.policyOptions.multiples.value});formValues.policyOptions.timeFilter&&(policyOptions.timeFilter=formValues.policyOptions.timeFilter.map(x=>x.getTime())),localStorage.setItem(FORM_STORAGE_KEY,JSON.stringify(formValues));const body={ids:lib_default()(entity)?entity.map(x=>x._id):[entity._id],users:formValues.users.map(x=>x.value),metric,policyOptions};computeCompletions(body).then(onCompute)},[metric,entity,formValues,FORM_STORAGE_KEY,computeCompletions,onCompute]),users=cohorts.reduce((userList,cohort)=>{const members=cohort.members.map(member=>memberSelection(member));return userList.concat(members)},[]),selectOptions=[{value:{category:"all",members:users},label:t("All users")},...cohorts.length>1?cohorts.map(cohort=>({value:{category:"cohort",id:cohort._id,members:cohort.members},label:"Cohort "+cohort.title})):[]].concat(users),userSelectStyles={option:(styles,{data})=>data.value.category==="cohort"&&formValues.activeCohorts[data.value.id]?compute_modal_spreadProps(compute_modal_spreadValues({},styles),{":before":{content:'"\u2713 "'}}):styles},handleUserSelectChange=(0,react.useCallback)(value=>{if(!value){setFormValues(compute_modal_spreadProps(compute_modal_spreadValues({},formValues),{users:[]}));return}if(value.some(x=>x.value.category==="all")){setFormValues(compute_modal_spreadProps(compute_modal_spreadValues({},formValues),{users,activeCohorts:{}}));return}const selectedUsersSet=new Set,removeIds=new Set,newValue=[],newActiveCohorts=Object.assign({},formValues.activeCohorts);for(let i=0;i<value.length;i++)if(value[i].value.category==="cohort")if(formValues.activeCohorts[value[i].value.id])newActiveCohorts[value[i].value.id]=!1,value[i].value.members.forEach(member=>{removeIds.add(member.id)});else{newActiveCohorts[value[i].value.id]=!0;for(let j=0;j<value[i].value.members.length;++j)if(!selectedUsersSet.has(value[i].value.members[j].id)){const member=value[i].value.members[j];newValue.push(memberSelection(member)),selectedUsersSet.add(member.id)}}else selectedUsersSet.has(value[i].value)||(newValue.push(value[i]),selectedUsersSet.add(value[i].value));setFormValues(compute_modal_spreadProps(compute_modal_spreadValues({},formValues),{users:newValue.filter(x=>!removeIds.has(x.value)),activeCohorts:newActiveCohorts}))},[formValues,users]);return react.createElement(Modal_default(),{size:"lg",show,onHide},react.createElement(Modal_default().Header,{closeButton:!0},react.createElement(Modal_default().Title,{as:"h3"},`${t("calculate-scores-for")} ${metricName}`," ")),react.createElement(Modal_default().Body,null,react.createElement(Container_default(),null,react.createElement(Form_default().Group,{className:"mb-2",as:Row_default(),controlId:"multiplesPolicy"},react.createElement(Form_default().Label,{column:!0,sm:3},t("multiples-policy")),react.createElement(Col.default,{sm:8},react.createElement(react_select_cjs_prod.ZP,{value:formValues.policyOptions.multiples,options:MULTIPLES_POLICIES,onChange:handleMultiplesPolicyChange})),react.createElement(Col.default,{sm:1},react.createElement(help_icon,null,react.createElement("p",null,t("multiples-policy-description"))))),react.createElement(Form_default().Group,{className:"mb-2",as:Row_default(),controlId:"timeFilter"},react.createElement(Form_default().Label,{column:!0,sm:3},t("time-filter")),react.createElement(Col.default,{sm:8},react.createElement(entry.Z,{onChange:onTimeChange,value:formValues.policyOptions.timeFilter})),react.createElement(Col.default,{sm:1},react.createElement(help_icon,null,react.createElement("p",null,t("time-filter-description"))))),react.createElement(Form_default().Group,{className:"mb-2",as:Row_default(),controlId:"users"},react.createElement(Form_default().Label,{column:!0,sm:3},t("users")),react.createElement(Col.default,{sm:8},react.createElement(react_select_cjs_prod.ZP,{value:formValues.users,isMulti:!0,options:selectOptions,onChange:handleUserSelectChange,hideSelectedOptions:!0,styles:userSelectStyles})),react.createElement(Col.default,{sm:1},react.createElement(help_icon,null,react.createElement("p",null,t("users-description"))))),react.createElement(Form_default().Group,{className:"mb-2",as:Row_default(),controlId:"users"},react.createElement(Form_default().Label,{column:!0,sm:3},t("tag-weights")),react.createElement(Col.default,{sm:8},react.createElement(TagWeightInput,{value:formValues.policyOptions.tagWeights,onChange:handleTagWeightsChange,t})),react.createElement(Col.default,{sm:1},react.createElement(help_icon,null,react.createElement("p",null,t("tag-weights-description"))))))),react.createElement(Modal_default().Footer,null,react.createElement(Button_default(),{onClick:onHide},t("common:cancel")),react.createElement(Button_default(),{variant:"success",onClick:handleCompute,disabled:formValues.users.length===0},t("common:calculate"))))}ComputeModal.propTypes={cohorts:prop_types_default().array.isRequired,computeCompletions:prop_types_default().func.isRequired,entity:prop_types_default().oneOfType([prop_types_default().arrayOf(prop_types_default().object),prop_types_default().object]).isRequired,level:prop_types_default().string.isRequired,metric:prop_types_default().oneOfType([prop_types_default().arrayOf(prop_types_default().object),prop_types_default().object]).isRequired,onCompute:prop_types_default().func.isRequired,onHide:prop_types_default().func.isRequired,show:prop_types_default().bool.isRequired,tags:prop_types_default().array},ComputeModal.defaultProps={tags:null};var compute_modal=ComputeModal},88608:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(67294),prop_types__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(45697),prop_types__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_3__),react_i18next__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(81468),react_bootstrap_Button__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(89876),react_bootstrap_Button__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(react_bootstrap_Button__WEBPACK_IMPORTED_MODULE_2__),react_bootstrap_Modal__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(89194),react_bootstrap_Modal__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(react_bootstrap_Modal__WEBPACK_IMPORTED_MODULE_1__);const ConfirmModal=props=>react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_bootstrap_Modal__WEBPACK_IMPORTED_MODULE_1___default(),{show:props.show,onHide:props.close},react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_bootstrap_Modal__WEBPACK_IMPORTED_MODULE_1___default().Header,null,react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_bootstrap_Modal__WEBPACK_IMPORTED_MODULE_1___default().Title,{as:"h3"},props.title)),react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_bootstrap_Modal__WEBPACK_IMPORTED_MODULE_1___default().Body,null,props.message),react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_bootstrap_Modal__WEBPACK_IMPORTED_MODULE_1___default().Footer,null,react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_bootstrap_Button__WEBPACK_IMPORTED_MODULE_2___default(),{onClick:props.close},props.t("cancel")),react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_bootstrap_Button__WEBPACK_IMPORTED_MODULE_2___default(),{variant:"danger",onClick:props.onConfirm},props.t("confirm"))));ConfirmModal.propTypes={close:prop_types__WEBPACK_IMPORTED_MODULE_3___default().func,message:prop_types__WEBPACK_IMPORTED_MODULE_3___default().node,onConfirm:prop_types__WEBPACK_IMPORTED_MODULE_3___default().func,show:prop_types__WEBPACK_IMPORTED_MODULE_3___default().bool,title:prop_types__WEBPACK_IMPORTED_MODULE_3___default().string},ConfirmModal.defaultProps={close(){},message:"",onConfirm(){},show:!1,title:""},__webpack_exports__.Z=(0,react_i18next__WEBPACK_IMPORTED_MODULE_4__.Zh)(["common"])(ConfirmModal)},19446:function(__unused_webpack_module,__webpack_exports__){const RE_AUTO_BOM=/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i;function click(node){const event=new MouseEvent("click");node.dispatchEvent(event)}function throwOutside(ex){setImmediate(function(){throw ex},0)}function autoBOM(blob){return RE_AUTO_BOM.test(blob.type)?new Blob([String.fromCharCode(65279),blob],{type:blob.type}):blob}function dispatch(filesaver,eventTypes,event){eventTypes=[].concat(eventTypes);let i=eventTypes.length;for(;i--;){let listener=filesaver["on"+eventTypes[i]];if(typeof listener=="function")try{listener.call(filesaver,event||filesaver)}catch(ex){throwOutside(ex)}}}function saveFactory(view){if(typeof view=="undefined"||typeof navigator!="undefined"&&/MSIE [1-9]\./.test(navigator.userAgent))return;const doc=view.document;function getURL(){return view.URL||view.webkitURL||view}function revoke(file){function revoker(){typeof file=="string"?getURL().revokeObjectURL(file):file.remove()}setTimeout(revoker,4e4)}const saveLink=doc.createElementNS("http://www.w3.org/1999/xhtml","a"),canUseSaveLink="download"in saveLink,isSafari=/constructor/i.test(view.HTMLElement)||view.safari,isChromeIOS=/CriOS\/[\d]+/.test(navigator.userAgent),setImmediate2=view.setImmediate||view.setTimeout,forceSavableType="application/octet-stream";function FileSaver(blob,name,noAutoBOM){noAutoBOM||(blob=autoBOM(blob));const self2=this,force=blob.type===forceSavableType;let objectURL;function dispatchAll(){dispatch(self2,"writestart progress write writeend".split(" "))}function fsError(){if((isChromeIOS||force&&isSafari)&&view.FileReader){const reader=new FileReader;reader.onloadend=function(){let url=isChromeIOS?reader.result:reader.result.replace(/^data:[^;]*;/,"data:attachment/file;");view.open(url,"_blank")||(view.location.href=url),url=void 0,self2.readyState=self2.DONE,dispatchAll()},reader.readAsDataURL(blob),self2.readyState=self2.INIT;return}objectURL||(objectURL=getURL().createObjectURL(blob)),force?view.location.href=objectURL:view.open(objectURL,"_blank")||(view.location.href=objectURL),self2.readyState=self2.DONE,dispatchAll(),revoke(objectURL)}if(self2.readyState=self2.INIT,canUseSaveLink){objectURL=getURL().createObjectURL(blob),setImmediate2(function(){saveLink.href=objectURL,saveLink.download=name,click(saveLink),dispatchAll(),revoke(objectURL),self2.readyState=self2.DONE},0);return}fsError()}const proto=FileSaver.prototype;function saveAs2(blob,name,noAutoBOM){return new FileSaver(blob,name||blob.name||"download",noAutoBOM)}return typeof navigator!="undefined"&&navigator.msSaveOrOpenBlob?function(blob,name,noAutoBOM){return name=name||blob.name||"download",noAutoBOM||(blob=autoBOM(blob)),navigator.msSaveOrOpenBlob(blob,name)}:(proto.abort=function(){},proto.readyState=proto.INIT=0,proto.WRITING=1,proto.DONE=2,proto.error=null,proto.onwritestart=null,proto.onprogress=null,proto.onwrite=null,proto.onabort=null,proto.onerror=null,proto.onwriteend=null,saveAs2)}const saveAs=saveFactory(typeof self!="undefined"&&self||typeof window!="undefined"&&window||(void 0).content);__webpack_exports__.Z=saveAs}}]);

//# sourceMappingURL=6399.0161d58b.chunk.js.map