"use strict";(self.webpackChunkisle_dashboard=self.webpackChunkisle_dashboard||[]).push([[3488],{36378:function(module,__unused_webpack_exports,__webpack_require__){var xlogy=__webpack_require__(9577);module.exports=xlogy},9577:function(module,__unused_webpack_exports,__webpack_require__){var isnan=__webpack_require__(64529),ln=__webpack_require__(68252);function xlogy(x,y){return x===0&&!isnan(y)?0:x*ln(y)}module.exports=xlogy},44838:function(module,__unused_webpack_exports,__webpack_require__){var constantFunction=__webpack_require__(89472),isnan=__webpack_require__(64529);function factory(p){if(isnan(p)||p<0||p>1)return constantFunction(NaN);return pmf;function pmf(x){return isnan(x)?NaN:x===0?1-p:x===1?p:0}}module.exports=factory},53927:function(module,__unused_webpack_exports,__webpack_require__){var setReadOnly=__webpack_require__(93127),pmf=__webpack_require__(89599),factory=__webpack_require__(44838);setReadOnly(pmf,"factory",factory),module.exports=pmf},89599:function(module,__unused_webpack_exports,__webpack_require__){var isnan=__webpack_require__(64529);function pmf(x,p){return isnan(x)||isnan(p)||p<0||p>1?NaN:x===0?1-p:x===1?p:0}module.exports=pmf},84887:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:function(){return main}});var react=__webpack_require__(45254),prop_types=__webpack_require__(45697),prop_types_default=__webpack_require__.n(prop_types),commonjs=__webpack_require__(81468),Alert=__webpack_require__(24032),Alert_default=__webpack_require__.n(Alert),ButtonGroup=__webpack_require__(28281),ButtonGroup_default=__webpack_require__.n(ButtonGroup),InputGroup=__webpack_require__(81039),InputGroup_default=__webpack_require__.n(InputGroup),FormControl=__webpack_require__(70090),FormControl_default=__webpack_require__.n(FormControl),Button=__webpack_require__(30276),Button_default=__webpack_require__.n(Button),lib=__webpack_require__(76266),lib_default=__webpack_require__.n(lib),abs_lib=__webpack_require__(28549),abs_lib_default=__webpack_require__.n(abs_lib),cdf_lib=__webpack_require__(75506),cdf_lib_default=__webpack_require__.n(cdf_lib),roundn_lib=__webpack_require__(60004),roundn_lib_default=__webpack_require__.n(roundn_lib),tooltip=__webpack_require__(77287),table=__webpack_require__(63393),tex=__webpack_require__(26054),subtract=__webpack_require__(93040),prop_check=__webpack_require__(25048),factor_variable=__webpack_require__(93199),contains_lib=__webpack_require__(61635),contains_lib_default=__webpack_require__.n(contains_lib),array_lib=__webpack_require__(40083),array_lib_default=__webpack_require__.n(array_lib),extract_categories_from_values=__webpack_require__(99375),is_non_missing_number=__webpack_require__(35865),is_missing=__webpack_require__(45250);function designMatrixMissing(x,y,data,quantitative,intercept,success){const predictors=[],hash={};for(let j=0;j<x.length;j++){const values=data[x[j]];if(contains_lib_default()(quantitative,x[j]))predictors.push(x[j]);else{const categories=(0,extract_categories_from_values.Z)(values,x[j]);for(let k=intercept?1:0;k<categories.length;k++)predictors.push(`${x[j]}_${categories[k]}`);hash[x[j]]=categories}}let buffer=[];const yvalues=[];for(let i=0;i<data[x[0]].length;i++){let missing=!1;const row=[];intercept&&row.push(1);for(let j=0;j<x.length;j++){const values=data[x[j]];if(contains_lib_default()(quantitative,x[j]))(0,is_non_missing_number.Z)(values[i])?row.push(values[i]):missing=!0;else{const val=values[i];if((0,is_missing.Z)(val))missing=!0;else{const categories=hash[x[j]];for(let k=intercept?1:0;k<categories.length;k++)row.push(val===categories[k]?1:0)}}}missing||(buffer=buffer.concat(row),yvalues.push(data[y][i]===success?1:0))}const nobs=yvalues.length;return{matrix:array_lib_default()(buffer,{shape:[nobs,predictors.length+1]}),predictors,yvalues,nobs}}var design_matrix_missing=designMatrixMissing;function designMatrix(x,y,data,quantitative,intercept,success){const predictors=[],hash={},nobs=data[x[0]].length;for(let j=0;j<x.length;j++){const values=data[x[j]];if(contains_lib_default()(quantitative,x[j]))predictors.push(x[j]);else{const categories=(0,extract_categories_from_values.Z)(values,x[j]);for(let k=intercept?1:0;k<categories.length;k++)predictors.push(`${x[j]}_${categories[k]}`);hash[x[j]]=categories}}const buffer=new Float64Array(nobs*(predictors.length+1));for(let i=0;i<nobs;i++){intercept&&(buffer[(predictors.length+1)*i]=1);let colIndex=0;for(let j=0;j<x.length;j++){const values=data[x[j]];if(contains_lib_default()(quantitative,x[j]))colIndex+=1,buffer[(predictors.length+1)*i+colIndex]=values[i];else{const categories=hash[x[j]],val=values[i];for(let k=intercept?1:0;k<categories.length;k++)colIndex+=1,buffer[(predictors.length+1)*i+colIndex]=val===categories[k]?1:0}}}const matrix2=array_lib_default()(buffer,{shape:[nobs,predictors.length+1]}),yvalues=data[y].map(v=>v===success?1:0);return{matrix:matrix2,predictors,yvalues,nobs}}var design_matrix=designMatrix,matrix=__webpack_require__(78406),ln_lib=__webpack_require__(68252),ln_lib_default=__webpack_require__.n(ln_lib),pow_lib=__webpack_require__(66015),pow_lib_default=__webpack_require__.n(pow_lib),exp_lib=__webpack_require__(66286),exp_lib_default=__webpack_require__.n(exp_lib),xlogy_lib=__webpack_require__(36378),xlogy_lib_default=__webpack_require__.n(xlogy_lib),eps_lib=__webpack_require__(9627),eps_lib_default=__webpack_require__.n(eps_lib),pmf_lib=__webpack_require__(53927),pmf_lib_default=__webpack_require__.n(pmf_lib),sqrt_lib=__webpack_require__(26680),sqrt_lib_default=__webpack_require__.n(sqrt_lib),mmult=__webpack_require__(97193),transpose=__webpack_require__(88837),sum=__webpack_require__(82479);function multiplyMatrices(A,B){const[m,n]=A.shape,p=B.shape[1],result=matrix.Matrix.zeros(m,p),Bcolj=new Float64Array(n);for(let j=0;j<p;j++){for(let k=0;k<n;k++)Bcolj[k]=B.get(k,j);for(let i=0;i<m;i++){let s=0;for(let k=0;k<n;k++)s+=A.get(i,k)*Bcolj[k];result.set(i,j,s)}}return result}var multiply_matrices=multiplyMatrices;function colMult(A,b){const[m,n]=A.shape,result=array_lib_default()(new Float64Array(m*n),{shape:[m,n]});for(let i=0;i<m;i++)for(let j=0;j<n;j++)result.set(i,j,A.get(i,j)*b[i]);return result}var col_mult=colMult;function multiply(x,y){const len=x.length,out=new Array(len);for(let i=0;i<len;i++)out[i]=x[i]*y[i];return out}var logistic_regression_multiply=multiply;const MAX_IT=25,EPSILON=1e-8,variance=mu=>{const out=new Float64Array(mu.length);for(let i=0;i<mu.length;i++)out[i]=mu[i]*(1-mu[i]);return out},logitLink=mu=>{const n=mu.length,out=new Float64Array(n);for(let i=0;i<n;i++)out[i]=ln_lib_default()(mu[i]/(1-mu[i]));return out},logitLinkInv=eta=>{const n=eta.length,out=new Float64Array(n);for(let i=0;i<n;i++){const etai=eta[i];if(abs_lib_default()(etai)>30)out[i]=eps_lib_default();else{const x=exp_lib_default()(etai);out[i]=x/(1+x)}}return out},logitMuEta=eta=>{const n=eta.length,out=new Float64Array(n);for(let i=0;i<n;i++){const val=eta[i];abs_lib_default()(val)>30?out[i]=eps_lib_default():out[i]=exp_lib_default()(val)/pow_lib_default()(1+exp_lib_default()(val),2)}return out},aic=(y,mu,numParameters)=>{let logLik=0;for(let i=0;i<y.length;i++)logLik+=ln_lib_default()(pmf_lib_default()(y[i],mu[i]));return-2*logLik+2*numParameters},devResids=(y,mu,wt)=>{const n=y.length,out=new Float64Array(n);for(let i=0;i<n;i++){const mui=mu[i],yi=y[i];out[i]=2*wt[i]*(xlogy_lib_default()(yi,yi/mui)+xlogy_lib_default()(1-yi,(1-yi)/(1-mui)))}return out},calcW=(weights,gprime,varg)=>{const out=new Float64Array(weights.length);for(let i=0;i<weights.length;i++)out[i]=weights[i]*(gprime[i]*gprime[i]/varg[i]);return out},calcZ=(eta,y,mu,gprime)=>{const out=new Float64Array(y.length);for(let i=0;i<y.length;i++)out[i]=eta[i]+(y[i]-mu[i])/gprime[i];return out};function sigmoid(x){const result=new Float64Array(x.length);for(let i=0;i<x.length;i++)result[i]=1/(1+exp_lib_default()(-x[i]));return result}function stdErrors(matrix2,yhat){const w=new Float64Array(yhat.length);for(let i=0;i<w.length;i++)w[i]=yhat[i]*(1-yhat[i]);const[nrow,ncol]=matrix2.shape,errs=new Float64Array(ncol);for(let j=0;j<errs.length;j++){let sum2=0;for(let i=0;i<nrow;i++)sum2+=pow_lib_default()(matrix2.get(i,j),2)*w[i];errs[j]=sqrt_lib_default()(1/sum2)}return errs}function irls(X,y,nObs){const Xt=(0,transpose.Z)(X),weights=new Array(nObs).fill(1),mustart=new Float64Array(weights.length);for(let i=0;i<nObs;i++)mustart[i]=(weights[i]*y[i]+.5)/(weights[i]+1);let eta=logitLink(mustart),mu=logitLinkInv(eta),devOld=(0,sum.Z)(devResids(y,mu,weights)),beta,j,converged=!1;for(j=0;j<MAX_IT;j++){const varg=variance(mu),gprime=logitMuEta(eta),z=calcZ(eta,y,mu,gprime),w=calcW(weights,gprime,varg),wz=logistic_regression_multiply(w,z),Xw=col_mult(X,w),A=multiply_matrices(Xt,Xw),b=(0,mmult.Z)(Xt,wz);beta=(0,matrix.solve)(A,matrix.Matrix.columnVector(b)),eta=(0,mmult.Z)(X,beta.to1DArray()),mu=logitLinkInv(eta);const dev=(0,sum.Z)(devResids(y,mu,weights));if(abs_lib_default()(dev-devOld)/(.1+abs_lib_default()(dev))<EPSILON){converged=!0;break}devOld=dev}const coefficients=beta.to1DArray(),predict=X2=>{const finalData=(0,mmult.Z)(X2,coefficients);return sigmoid(finalData)},fitted=predict(X,coefficients);return{aic:aic(y,logitLinkInv(eta),coefficients.length),stdErrors:stdErrors(X,fitted),fitted,coefficients,iterations:j,converged,predict}}var logistic_regression=irls,__defProp=Object.defineProperty,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp.call(b,prop)&&__defNormalProp(a,prop,b[prop]);if(__getOwnPropSymbols)for(var prop of __getOwnPropSymbols(b))__propIsEnum.call(b,prop)&&__defNormalProp(a,prop,b[prop]);return a},__publicField=(obj,key,value)=>(__defNormalProp(obj,typeof key!="symbol"?key+"":key,value),value);let COUNTER=0;const T="t",summaryTable=(x,intercept,result,t)=>react.createElement(table.Z,{bordered:!0,size:"sm"},react.createElement("thead",null,react.createElement("tr",null,react.createElement(tooltip.Z,{placement:"right",tooltip:t("name-of-predictor")},react.createElement("th",null,t("predictor"))),react.createElement(tooltip.Z,{placement:"right",tooltip:t("change-in-log")},react.createElement("th",null,t("coefficient"))),react.createElement(tooltip.Z,{placement:"left",tooltip:t("standard-deviation-coefficient")},react.createElement("th",null,t("std-error"))),react.createElement(tooltip.Z,{placement:"left",tooltip:react.createElement("span",null,t("test-statistic-coefficient-zero"),react.createElement(tex.Z,{displayMode:!0,raw:"t = \\tfrac{\\text{Coefficient}}{\\text{Std. Error}}"}))},react.createElement("th",null,T)),react.createElement(tooltip.Z,{placement:"left",tooltip:react.createElement("span",null,t("p-value-coefficient-zero"),react.createElement(tex.Z,{displayMode:!0,raw:"2 \\Phi( |t| )"}))},react.createElement("th",null,t("p-value"))))),react.createElement("tbody",null,intercept?react.createElement("tr",null,react.createElement("th",null,t("intercept")),react.createElement("td",null,result.coefficients[0].toFixed(6)),react.createElement("td",null,result.stdErrors[0].toFixed(4)),react.createElement("td",null,(result.coefficients[0]/result.stdErrors[0]).toFixed(4)),react.createElement("td",null,(2*cdf_lib_default()(-abs_lib_default()(result.coefficients[0]/result.stdErrors[0]),0,1)).toFixed(4))):null,x.map((name,idx)=>{idx=idx+Number(intercept);const tStat=result.coefficients[idx]/result.stdErrors[idx],pVal=2*cdf_lib_default()(-abs_lib_default()(tStat),0,1);return react.createElement("tr",{key:idx},react.createElement("th",null,name),react.createElement("td",null,result.coefficients[idx].toFixed(6)),react.createElement("td",null,result.stdErrors[idx].toFixed(4)),react.createElement("td",null,tStat.toFixed(4)),react.createElement("td",null,pVal.toFixed(4)))}))),fitModel=({y,success,x,intercept,omitMissing,data,quantitative})=>{try{lib_default()(x)||(x=[x]);const dMatrix=omitMissing?design_matrix_missing:design_matrix,{matrix:matrix2,predictors,yvalues,nobs}=dMatrix(x,y,data,quantitative,intercept,success);return{result:logistic_regression(matrix2,yvalues,nobs),predictors}}catch(_){return{}}};class LogisticRegression extends react.Component{constructor(props){super(props),__publicField(this,"handlePredict",()=>{let{x:x2,y:y2,quantitative:quantitative2,intercept:intercept2,success:success2}=this.props;lib_default()(x2)||(x2=[x2]);const predict=data2=>{const{matrix:matrix2,yvalues}=design_matrix(x2,y2,data2,quantitative2,intercept2,success2),probs=this.state.result.predict(matrix2),residuals=(0,subtract.Z)(probs,yvalues);return{yhat:probs.map(x22=>x22>this.state.probabilityThreshold),probs,residuals}};this.props.onPredict(predict,COUNTER)}),COUNTER+=1;let{y,success,x,intercept,omitMissing,data,quantitative}=props;const{result,predictors}=fitModel({y,success,x,intercept,omitMissing,data,quantitative});this.state=__spreadValues({probabilityThreshold:.5,result,predictors},props)}static getDerivedStateFromProps(nextProps,prevState){if(nextProps.data!==prevState.data||nextProps.quantitative!==prevState.quantitative||nextProps.x!==prevState.x||nextProps.y!==prevState.y||nextProps.success!==prevState.success||nextProps.omitMissing!==prevState.omitMissing){const{y,success,x,intercept,omitMissing,data,quantitative}=nextProps;return __spreadValues(__spreadValues({},fitModel({y,success,x,intercept,omitMissing,data,quantitative})),nextProps)}return null}render(){const{result}=this.state,{t}=this.props;return result?react.createElement("div",{style:{overflowX:"auto",width:"100%"}},react.createElement("span",{className:"title"},t("logistic-title",{y:this.props.y,counter:COUNTER})),summaryTable(this.state.predictors,this.props.intercept,result,this.props.t),react.createElement("i",null,result.converged?t("fisher-scoring-converged",{n:result.iterations}):t("fisher-scoring-not-converged",{n:result.iterations})),react.createElement("p",null,t("aic"),": ",roundn_lib_default()(result.aic,-3)),this.props.onPredict?react.createElement(ButtonGroup_default(),null,react.createElement(tooltip.Z,{tooltip:t("use-model-to-predict-tooltip-logistic")},react.createElement(Button_default(),{variant:"secondary",size:"sm",onClick:this.handlePredict},this.props.t("use-model-to-predict"))),react.createElement(InputGroup_default(),{size:"sm"},react.createElement(InputGroup_default().Text,null,t("threshold"),":"),react.createElement(FormControl_default(),{type:"number",min:0,max:1,defaultValue:.5,step:.01,onChange:event=>{this.setState({probabilityThreshold:event.target.value})}}))):null):react.createElement(Alert_default(),{variant:"danger"},t("missing-attributes"))}}LogisticRegression.defaultProps={omitMissing:!1,intercept:!0,onPredict:null},LogisticRegression.propTypes={data:prop_types_default().object.isRequired,y:prop_types_default().oneOfType([prop_types_default().string,prop_types_default().instanceOf(factor_variable.E)]).isRequired,success:prop_types_default().any.isRequired,x:prop_types_default().oneOfType([prop_types_default().arrayOf(prop_types_default().oneOfType([prop_types_default().string,prop_types_default().instanceOf(factor_variable.E)])),prop_types_default().string,prop_types_default().instanceOf(factor_variable.E)]).isRequired,quantitative:prop_types_default().arrayOf(prop_types_default().string).isRequired,omitMissing:prop_types_default().bool,intercept:prop_types_default().bool,onPredict:prop_types_default().func};var main=(0,commonjs.Zh)("models")((0,prop_check.W)(LogisticRegression))},97193:function(__unused_webpack_module,__webpack_exports__){function mmult(A,b){const n=A.shape[0],p=A.shape[1];let ret=new Float64Array(n);for(let i=0;i<n;i++){let sum=0;for(let j=0;j<p;j++)sum+=A.get(i,j)*b[j];ret[i]=sum}return ret}__webpack_exports__.Z=mmult},88837:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){var _stdlib_ndarray_ctor__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(68365),_stdlib_ndarray_ctor__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_stdlib_ndarray_ctor__WEBPACK_IMPORTED_MODULE_0__);const transpose=X=>{const shape=[X.shape[1],X.shape[0]],strides=[X.strides[1],X.strides[0]],offset=X.offset,order=X.order;return _stdlib_ndarray_ctor__WEBPACK_IMPORTED_MODULE_0___default()("float64",X._buffer,shape,strides,offset,order)};__webpack_exports__.Z=transpose}}]);

//# sourceMappingURL=LogisticRegression.eccc7755.chunk.js.map