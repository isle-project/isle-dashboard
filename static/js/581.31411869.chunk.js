"use strict";(self.webpackChunkisle_dashboard=self.webpackChunkisle_dashboard||[]).push([[581],{50581:function(e,t,s){s.r(t);var a=s(38603),l=s(91532),r=s.n(l),n=s(2561),i=s.n(n),o=s(58651),c=s(12908),m=s(60805),d=s(79298),h=s(69977),p=s(12410),u=s(20328),E=s(30528),f=s(12630),y=s(66797),g=s(71191),v=s(19671),b=s(70658),Z=s.n(b),k=s(45014),w=s.n(k),S=s(32174),x=s.n(S),T=s(95349),A=s.n(T),D=s(35348),N=s(63022),P=s(17663),z=s(63163),B=s(76470),U=s(34668);function C(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function q(e){const t=[];if(!e)return t;for(let s=1;s<e.length;s++){const a=e[s]-e[s-1];t.push(a)}return t}function I(e){switch(e){case"left":return"right";case"right":return"left";case"up":return"down";case"down":return"up"}}const $=i()("isle-dashboard:admin"),R=[0,.9,.1,.8,.2,.7,.3],H={users:P.Z[0],namespaces:P.Z[1],lessons:P.Z[2],cohorts:P.Z[3],files:P.Z[4],events:P.Z[5],sessionData:P.Z[7],dailyActiveUsers:P.Z[8],weeklyActiveUsers:P.Z[9],monthlyActiveUsers:P.Z[10],tickets:P.Z[11],closedTickets:P.Z[12],openTickets:P.Z[13]},O={users:"nUsers",namespaces:"nNamespaces",lessons:"nLessons",cohorts:"nCohorts",files:"nFiles",events:"nEvents",sessionData:"nSessionData",tickets:"nTickets",openTickets:"nOpenTickets",closedTickets:"nClosedTickets",dailyActiveUsers:"dailyActiveUsers",weeklyActiveUsers:"weeklyActiveUsers",monthlyActiveUsers:"monthlyActiveUsers"},_={users:!1,namespaces:!1,lessons:!1,cohorts:!1,files:!1,events:!1,sessionData:!1,dailyActiveUsers:!1,weeklyActiveUsers:!1,monthlyActiveUsers:!1,tickets:!1,openTickets:!1,closedTickets:!1},F=["sendDataToCloud","zoom2d","pan2d","select2d","zoomIn2d","zoomOut2d","autoScale2d","resetScale2d","hoverClosestCartesian","hoverCompareCartesian","toggleHover","toggleSpikelines","resetViews"];class j extends a.Component{constructor(e){super(e),C(this,"hideExplorer",(()=>{this.setState({dataExplorer:"hidden"})})),C(this,"handleFilterChange",(e=>{const t=A()(e.target.value),s=[];for(let a=0;a<this.props.statistics.actionTypes.length;a++){const e=this.props.statistics.actionTypes[a];if(e){(e._id.type||"").includes(t)&&s.push(e)}}this.setState({filteredActionTypes:s})})),C(this,"renderExplorer",(()=>{let e;switch(this.state.dataExplorer){case"action-types":e=a.createElement(U.Z,{title:this.props.t("explorer-action-types-title"),data:{...this.state.historicalActionTypes,time:this.props.historicalStatistics.map((e=>e.createdAt))},categorical:["time"],close:this.hideExplorer});break;case"overview-statistics":e=a.createElement(U.Z,{title:this.props.t("explorer-overview-stats-title"),data:(0,B.Z)(this.props.historicalStatistics),categorical:["createdAt"],close:this.hideExplorer})}return e})),this.state={displayInPlot:{..._,users:!0},revision:0,filteredActionTypes:e.statistics.actionTypes,historicalActionTypes:null,useDifferencing:!1,dataExplorer:"hidden"}}componentDidMount(){this.props.getOverviewStatistics();const e=this.props.historicalStatistics[this.props.historicalStatistics.length-1];if(e&&e.updatedAt){const t=new Date(e.updatedAt),s=t.getFullYear(),a=t.getMonth(),l=t.getDate();$(`Latest data from ${a}/${l}/${s}...`);const r=new Date,n=r.getFullYear(),i=r.getMonth(),o=r.getDate();$(`Current date is ${i}/${o}/${n}`),(n>s||i>a||o>l)&&($("Request historical data from server..."),this.props.getHistoricalOverviewStats())}else $("Retrieve overview data..."),this.props.getHistoricalOverviewStats();this.props.historicalStatistics&&this.extractHistoricalActionTypes()}componentDidUpdate(e){this.props.statistics.actionTypes!==e.statistics.actionTypes&&this.setState({filteredActionTypes:this.props.statistics.actionTypes}),this.props.historicalStatistics.length!==e.historicalStatistics.length&&this.extractHistoricalActionTypes()}extractHistoricalActionTypes(){$("Extract and format action types for time series display...");const e=x()(this.props.historicalStatistics,"actionTypes"),t={};for(let s=0;s<e.length;s++)if(e[s])for(let a=0;a<e[s].length;a++){const l=e[s][a],r=l._id.type;t[r]||(t[r]=[]),t[r][s]=l.count}this.setState({historicalActionTypes:t})}renderTimeSeries(){let e="";const t=this.props.historicalStatistics,s=x()(t,"createdAt"),l=[s[0],s[s.length-1]],r={xaxis:{autorange:!0,range:l,rangeselector:{buttons:[{count:7,label:"1w",step:"day",stepmode:"backward"},{count:1,label:"1m",step:"month",stepmode:"backward"},{count:6,label:"6m",step:"month",stepmode:"backward"},{step:"all"}]},rangeslider:{range:l},type:"date",fixedrange:!0},legend:{orientation:"h"},margin:{l:10,r:15,b:30,t:30,pad:10}},n=w()(this.state.displayInPlot),i=[],o=[0,1];for(let a=0;a<n.length;a++){const l=n[a];if(!0===this.state.displayInPlot[l]){let n,c;e+=""===e?"":", ",e+=this.props.t("common:"+l),H[l]?(n=H[l],c=x()(t,O[l])):(n=P.Z[a%P.Z.length+7],c=this.state.historicalActionTypes[l]),this.state.useDifferencing&&(c=q(c));const m={type:this.state.useDifferencing?"bar":"scatter",mode:"line",name:this.props.t("common:"+l),x:s,y:c,marker:{color:n}};this.state.useDifferencing&&(m.offsetgroup=i.length);const d=i.length;d>0&&(m.yaxis=`y${d+1}`),i.push(m);const h={title:this.props.t("common:"+l),titlefont:{color:n},tickfont:{color:n},fixedrange:!0};i.length>1&&(h.overlaying="y"),i.length%2===0?(h.side="left",o[0]+=.1):(h.side="right",o[1]-=.1),h.position=R[i.length],0===d?r.yaxis=h:r[`yaxis${d+1}`]=h}}return r.xaxis.domain=o,r.title=`${this.state.useDifferencing?this.props.t("daily-changes-of"):this.props.t("time-series-of")}${e}`,0===i.length?a.createElement(d.Z,{style:{width:"100%",height:"73.7%"}},a.createElement("h3",{style:{textAlign:"center",marginTop:"12%"}},"Select a variable to be displayed...")):a.createElement(a.Fragment,null,a.createElement(v.Z,{revision:this.state.revision,data:i,config:{displayModeBar:"hover",displaylogo:!1,modeBarButtonsToRemove:F,modeBarButtonsToAdd:[{name:this.props.t("download-data"),icon:{width:857.1,height:1e3,path:"m214-7h429v214h-429v-214z m500 0h72v500q0 8-6 21t-11 20l-157 156q-5 6-19 12t-22 5v-232q0-22-15-38t-38-16h-322q-22 0-37 16t-16 38v232h-72v-714h72v232q0 22 16 38t37 16h465q22 0 38-16t15-38v-232z m-214 518v178q0 8-5 13t-13 5h-107q-7 0-13-5t-5-13v-178q0-8 5-13t13-5h107q7 0 13 5t5 13z m357-18v-518q0-22-15-38t-38-16h-750q-23 0-38 16t-16 38v750q0 22 16 38t38 16h517q23 0 50-12t42-26l156-157q16-15 27-42t11-49z",transform:"matrix(1 0 0 -1 0 850)"},click:t=>{const s=new Blob([JSON.stringify(t.data)],{type:"application/json"});(0,z.Z)(s,`stats_${e}.json`)}}]},layout:r,style:{width:"100%",height:"80%"},useResizeHandler:!0}),i.length>0?a.createElement(a.Fragment,null,a.createElement(f.Z,{onClick:()=>{this.setState({displayInPlot:{..._},revision:this.state.revision+1})},style:{marginLeft:"35%"}},this.props.t("common:reset")),a.createElement(f.Z,{onClick:()=>{this.setState({useDifferencing:!this.state.useDifferencing})},style:{marginLeft:"1%"}},this.state.useDifferencing?"Display Time Series":this.props.t("display-daily-changes"))):null)}renderDiskUsage(){if(!this.props.statistics.database)return null;let{fsUsedSize:e,fsTotalSize:t}=this.props.statistics.database;e/=1073741824,t/=1073741824;const s=Z()(e),l=Z()(t-e),{t:r}=this.props;return a.createElement(v.Z,{data:[{values:[s,l],labels:[`${r("used-space")}: ${s} GB`,`${r("free-space")}: ${l} GB`],type:"pie"}],config:{displayModeBar:!1,displaylogo:!1},layout:{plot_bgcolor:"rgba(0,0,0,0.0)",paper_bgcolor:"rgba(0,0,0,0.0)",xaxis:{fixedrange:!0},yaxis:{fixedrange:!0},autosize:!0,margin:{l:50,r:50,b:50,t:50}},useResizeHandler:!0,style:{width:"75%",height:"200px"}})}renderDatabaseStats(){const{t:e}=this.props;if(!this.props.statistics.database)return null;const{storageSize:t,dataSize:s,objects:l,avgObjSize:r}=this.props.statistics.database;return a.createElement(g.Z,{variant:"flush",style:{fontSize:"1em"}},a.createElement(g.Z.Item,{style:{padding:".5rem 0.8rem"}},e("physical-storage-size"),": ",t),a.createElement(g.Z.Item,{style:{padding:".5rem 0.8rem"}},e("reserved-storage-size"),": ",s),a.createElement(g.Z.Item,{style:{padding:".5rem 0.8rem"}},e("number-of-objects"),": ",l," "),a.createElement(g.Z.Item,{style:{padding:".5rem 0.8rem"}},e("average-object-size"),": ",Z()(r)))}renderDailyStatistics(){const{t:e}=this.props,{dailyActiveUsers:t,weeklyActiveUsers:s,monthlyActiveUsers:l,lastHourActiveUsers:r}=this.props.statistics;return a.createElement(g.Z,{variant:"flush",style:{fontSize:"1em"}},a.createElement(g.Z.Item,{style:{padding:".5rem 0.8rem"}},e("last-hour-active-users"),":",a.createElement("span",{style:{float:"right",marginRight:56}},r)),a.createElement(g.Z.Item,{style:{padding:".5rem 0.8rem"}},a.createElement("span",null,e("daily-active-users"),":"),a.createElement("span",{style:{float:"right"}},a.createElement("span",{style:{marginRight:24}},t),this.renderPlotButton("dailyActiveUsers","down"))),a.createElement(g.Z.Item,{style:{padding:".5rem 0.8rem"}},a.createElement("span",null,e("weekly-active-users"),":"),a.createElement("span",{style:{float:"right"}},a.createElement("span",{style:{marginRight:24}},s),this.renderPlotButton("weeklyActiveUsers","down"))),a.createElement(g.Z.Item,{style:{padding:".5rem 0.8rem"}},a.createElement("span",null,e("monthly-active-users"),":"),a.createElement("span",{style:{float:"right"}},a.createElement("span",{style:{marginRight:24}},l),this.renderPlotButton("monthlyActiveUsers","down"))))}renderActionTypes(){const e=this.state.filteredActionTypes;return e?a.createElement(a.Fragment,null,a.createElement("h2",null,this.props.t("common:actions"),a.createElement(c.Z,{placement:"right",overlay:a.createElement(h.Z,{id:"explorer-action-types-tooltip"},this.props.t("common:data-explorer"))},a.createElement(f.Z,{"aria-label":this.props.t("common:data-explorer"),onClick:()=>{this.setState({dataExplorer:"action-types"})},style:{marginLeft:12}},a.createElement("i",{className:"fas fa-chart-bar"}))),a.createElement(D.Z,{style:{position:"absolute",top:0,right:8,width:140,fontSize:"1.2rem"},placeholder:"Search...",onChange:this.handleFilterChange})),a.createElement("div",{className:"action-types-table-container"},a.createElement(y.Z,{striped:!0,hover:!0,className:"action-types-table",size:"sm"},a.createElement("thead",null,a.createElement("tr",null,a.createElement("th",null,this.props.t("common:visualize")),a.createElement("th",null,this.props.t("common:type")),a.createElement("th",null,this.props.t("common:count")))),a.createElement("tbody",null,e.map(((e,t)=>a.createElement("tr",{key:t},a.createElement("td",null,this.renderPlotButton(e._id.type,"right")),a.createElement("td",null,e._id.type),a.createElement("td",null,e.count)))))))):null}renderPlotButton(e,t="left",s){const l=()=>{const t={...this.state.displayInPlot};t[e]=!t[e],this.setState({displayInPlot:_},(()=>{this.setState({displayInPlot:t,revision:this.state.revision+1})}))};return this.state.displayInPlot[e]?a.createElement(f.Z,{"aria-label":this.props.t("hide-data",{name:e}),variant:"warning",size:"sm",onClick:l},a.createElement("i",{className:s||`fas fa-arrow-circle-${t}`})):a.createElement(f.Z,{"aria-label":this.props.t("show-data",{name:e}),variant:"secondary",size:"sm",onClick:l},a.createElement("i",{className:s||`fas fa-arrow-circle-${I(t)}`}))}render(){$("Rendering overview page...");const{nUsers:e,nNamespaces:t,nLessons:s,nCohorts:l,nSessionData:r,nFiles:n,nEvents:i,nTickets:o}=this.props.statistics,{t:d}=this.props,g=a.createElement(p.Z,{className:"admin-outer-container slide-in-right"},a.createElement(u.Z,{className:"first-row"},a.createElement(E.Z,{className:"column-border",sm:4,md:3},a.createElement("h2",null,this.props.t("overall"),a.createElement(c.Z,{placement:"right",overlay:a.createElement(h.Z,{id:"explorer-overview-tooltip"},d("common:data-explorer"))},a.createElement(f.Z,{"aria-label":d("common:data-explorer"),onClick:()=>{this.setState({dataExplorer:"overview-statistics"})},style:{marginLeft:12}},a.createElement("i",{className:"fas fa-chart-bar"}))),a.createElement("span",{className:"overview-server-name"},N.ZP)),a.createElement(y.Z,{striped:!0,hover:!0,className:"overview-table"},a.createElement("thead",null,a.createElement("tr",null,a.createElement("th",null,this.props.t("common:icon")),a.createElement("th",null,this.props.t("common:table")),a.createElement("th",null,this.props.t("common:count")),a.createElement("th",null,this.props.t("common:visualize")))),a.createElement("tbody",null,a.createElement("tr",null,a.createElement("td",null,a.createElement("i",{className:"fas fa-user",style:{color:H.users}})),a.createElement("td",null,d("admin:users")),a.createElement("td",null,e),a.createElement("td",null,this.renderPlotButton("users"))),a.createElement("tr",null,a.createElement("td",null,a.createElement("i",{className:"fas fa-school",style:{color:H.namespaces}})),a.createElement("td",null,d("common:courses")),a.createElement("td",null,t),a.createElement("td",null,this.renderPlotButton("namespaces"))),a.createElement("tr",null,a.createElement("td",null,a.createElement("i",{className:"fas fa-chalkboard",style:{color:H.lessons}})),a.createElement("td",null,d("common:lessons")),a.createElement("td",null,s),a.createElement("td",null,this.renderPlotButton("lessons"))),a.createElement("tr",null,a.createElement("td",null,a.createElement("i",{className:"fas fa-users",style:{color:H.cohorts}})),a.createElement("td",null,d("common:cohorts")),a.createElement("td",null,l),a.createElement("td",null,this.renderPlotButton("cohorts"))),a.createElement("tr",null,a.createElement("td",null,a.createElement("i",{className:"fas fa-file",style:{color:H.files}})),a.createElement("td",null,d("common:files")),a.createElement("td",null,n),a.createElement("td",null,this.renderPlotButton("files"))),a.createElement("tr",null,a.createElement("td",null,a.createElement("i",{className:"fas fa-clock",style:{color:H.events}})),a.createElement("td",null,d("common:events")),a.createElement("td",null,i),a.createElement("td",null,this.renderPlotButton("events"))),a.createElement("tr",null,a.createElement("td",null,a.createElement("i",{className:"fas fa-shoe-prints",style:{color:H.sessionData}})),a.createElement("td",null,d("common:sessionData")),a.createElement("td",null,r),a.createElement("td",null,this.renderPlotButton("sessionData"))),a.createElement("tr",null,a.createElement("td",null,a.createElement("i",{className:"fas fa-medkit",style:{color:H.tickets}})),a.createElement("td",null,d("common:tickets")),a.createElement("td",null,o),a.createElement("td",null,a.createElement(m.Z,null,this.renderPlotButton("tickets"),this.renderPlotButton("openTickets","left","fas fa-lock-open"),this.renderPlotButton("closedTickets","left","fas fa-lock"))))))),a.createElement(E.Z,{className:"column-border",sm:8,md:6},a.createElement("h2",null,this.props.t("over-time")),this.renderTimeSeries()),a.createElement(E.Z,{sm:12,md:3},this.renderActionTypes())),a.createElement(u.Z,{className:"second-row"},a.createElement(E.Z,{md:3,sm:4,className:"column-border"},a.createElement("h3",null,d("disk-usage")),this.renderDiskUsage()),a.createElement(E.Z,{md:6,sm:8,className:"column-border"},a.createElement("h3",null,d("database")),this.renderDatabaseStats()),a.createElement(E.Z,{md:3,sm:12},a.createElement("h3",null,this.props.t("daily-statistics")),this.renderDailyStatistics())));return"hidden"===this.state.dataExplorer?g:this.renderExplorer()}}j.propTypes={getHistoricalOverviewStats:r().func.isRequired,getOverviewStatistics:r().func.isRequired,historicalStatistics:r().array,statistics:r().object,t:r().func.isRequired},j.defaultProps={historicalStatistics:[],statistics:{}},t.default=(0,o.Z)(["admin","common"])(j)},35348:function(e,t,s){var a=s(38603),l=s(58651),r=s(56233),n=s(87078),i=s(55927),o=s(12630);t.Z=(0,l.Z)(["header_bar","common"])((e=>a.createElement(r.Z,{style:{width:"14vw",minWidth:"120px",float:"left",marginBottom:"4px",marginRight:"5px",...e.style}},a.createElement(i.Z,null,a.createElement(n.Z,{className:"header-bar-search",type:"text",placeholder:e.placeholder,value:e.value,onChange:e.onChange,"aria-label":e.t("search-field"),style:{height:"38px"}}),a.createElement(i.Z.Append,null,a.createElement(o.Z,{"aria-label":e.t("search-field-icon"),disabled:!0,variant:"secondary",style:{cursor:"auto"}},a.createElement("i",{className:"fa fa-search"})))))))},17663:function(e,t){t.Z=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#c49c94","#e377c2","#17becf","#aec7e8","#ffbb78","#ff9896","#98df8a","#7f7f7f","#c5b0d5","#f7b6d2","#bcbd22","#c7c7c7","#dbdb8d","#9edae5"]},34668:function(e,t,s){const a=(0,s(221).Z)((()=>Promise.all([s.e(8504),s.e(6351)]).then(s.bind(s,27248))));t.Z=a}}]);
//# sourceMappingURL=581.31411869.chunk.js.map