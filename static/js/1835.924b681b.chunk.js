"use strict";(self.webpackChunkisle_dashboard=self.webpackChunkisle_dashboard||[]).push([[1835],{88608:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(67294),prop_types__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(45697),prop_types__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_3__),react_i18next__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(81468),react_bootstrap_Button__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(89876),react_bootstrap_Button__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(react_bootstrap_Button__WEBPACK_IMPORTED_MODULE_2__),react_bootstrap_Modal__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(89194),react_bootstrap_Modal__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(react_bootstrap_Modal__WEBPACK_IMPORTED_MODULE_1__);const ConfirmModal=props=>react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_bootstrap_Modal__WEBPACK_IMPORTED_MODULE_1___default(),{show:props.show,onHide:props.close},react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_bootstrap_Modal__WEBPACK_IMPORTED_MODULE_1___default().Header,null,react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_bootstrap_Modal__WEBPACK_IMPORTED_MODULE_1___default().Title,{as:"h3"},props.title)),react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_bootstrap_Modal__WEBPACK_IMPORTED_MODULE_1___default().Body,null,props.message),react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_bootstrap_Modal__WEBPACK_IMPORTED_MODULE_1___default().Footer,null,react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_bootstrap_Button__WEBPACK_IMPORTED_MODULE_2___default(),{onClick:props.close},props.t("cancel")),react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_bootstrap_Button__WEBPACK_IMPORTED_MODULE_2___default(),{variant:"danger",onClick:props.onConfirm},props.t("confirm"))));ConfirmModal.propTypes={close:prop_types__WEBPACK_IMPORTED_MODULE_3___default().func,message:prop_types__WEBPACK_IMPORTED_MODULE_3___default().node,onConfirm:prop_types__WEBPACK_IMPORTED_MODULE_3___default().func,show:prop_types__WEBPACK_IMPORTED_MODULE_3___default().bool,title:prop_types__WEBPACK_IMPORTED_MODULE_3___default().string},ConfirmModal.defaultProps={close(){},message:"",onConfirm(){},show:!1,title:""},__webpack_exports__.Z=(0,react_i18next__WEBPACK_IMPORTED_MODULE_4__.Zh)(["common"])(ConfirmModal)},34085:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:function(){return visible_edit_namespace}});var react=__webpack_require__(67294),lib=__webpack_require__(37424),prop_types=__webpack_require__(45697),prop_types_default=__webpack_require__.n(prop_types),node_modules_axios=__webpack_require__(9669),axios_default=__webpack_require__.n(node_modules_axios),commonjs=__webpack_require__(81468),Tabs=__webpack_require__(29575),Tabs_default=__webpack_require__.n(Tabs),Tab=__webpack_require__(28350),Tab_default=__webpack_require__.n(Tab),Alert=__webpack_require__(93166),Alert_default=__webpack_require__.n(Alert),Badge=__webpack_require__(86100),Badge_default=__webpack_require__.n(Badge),Button=__webpack_require__(89876),Button_default=__webpack_require__.n(Button),ButtonGroup=__webpack_require__(63319),ButtonGroup_default=__webpack_require__.n(ButtonGroup),Card=__webpack_require__(51889),Card_default=__webpack_require__.n(Card),Container=__webpack_require__(70448),Container_default=__webpack_require__.n(Container),Col=__webpack_require__(1266),Row=__webpack_require__(28269),Row_default=__webpack_require__.n(Row),FormControl=__webpack_require__(26199),FormControl_default=__webpack_require__.n(FormControl),FormLabel=__webpack_require__(65903),FormLabel_default=__webpack_require__.n(FormLabel),FormGroup=__webpack_require__(34168),FormGroup_default=__webpack_require__.n(FormGroup),Form=__webpack_require__(17383),Form_default=__webpack_require__.n(Form),ListGroup=__webpack_require__(18350),ListGroup_default=__webpack_require__.n(ListGroup),ListGroupItem=__webpack_require__(36604),ListGroupItem_default=__webpack_require__.n(ListGroupItem),OverlayTrigger=__webpack_require__(99201),OverlayTrigger_default=__webpack_require__.n(OverlayTrigger),Tooltip=__webpack_require__(18868),Tooltip_default=__webpack_require__.n(Tooltip),is_array_lib=__webpack_require__(76266),is_array_lib_default=__webpack_require__.n(is_array_lib),trim_lib=__webpack_require__(87594),trim_lib_default=__webpack_require__.n(trim_lib),text_select=__webpack_require__(70264),Modal=__webpack_require__(89194),Modal_default=__webpack_require__.n(Modal);const MsgModal=({show,close,message,title})=>react.createElement(Modal_default(),{show,onHide:close},react.createElement(Modal_default().Header,{closeButton:!0},react.createElement(Modal_default().Title,null,title)),react.createElement(Modal_default().Body,null,message),react.createElement(Modal_default().Footer,null,react.createElement(Button_default(),{onClick:close},"Close")));MsgModal.propTypes={close:prop_types_default().func,message:prop_types_default().string,show:prop_types_default().bool,title:prop_types_default().string},MsgModal.defaultProps={close(){},message:"",show:!1,title:""};var message_modal=MsgModal,confirm_modal=__webpack_require__(88608),create_namespace=__webpack_require__(29724),lodash_debounce=__webpack_require__(91296),lodash_debounce_default=__webpack_require__.n(lodash_debounce),incrspace_lib=__webpack_require__(26658),incrspace_lib_default=__webpack_require__.n(incrspace_lib),constants_server=__webpack_require__(94204),entry=__webpack_require__(15141),Popover=__webpack_require__(44981),Popover_default=__webpack_require__.n(Popover),__defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp.call(b,prop)&&__defNormalProp(a,prop,b[prop]);if(__getOwnPropSymbols)for(var prop of __getOwnPropSymbols(b))__propIsEnum.call(b,prop)&&__defNormalProp(a,prop,b[prop]);return a},__spreadProps=(a,b)=>__defProps(a,__getOwnPropDescs(b)),help_icon=props=>{const overlayRef=react.useRef(null);return react.createElement("div",{className:"help-panel",role:"button",tabIndex:0,onKeyDown:e=>overlayRef.current&&(e.which===13||e.which===32)&&overlayRef.current.click(e)},react.createElement(OverlayTrigger_default(),{placement:"right",trigger:["click"],rootClose:!0,delay:{show:250,hide:0},overlay:ps=>react.createElement(Popover_default(),__spreadProps(__spreadValues({},ps),{className:"help-text"}),react.createElement(Popover_default().Body,null,props.children))},react.createElement("span",{className:"mr-1",tabIndex:"0",role:"button",ref:overlayRef},"info")))},react_select_cjs_prod=__webpack_require__(87583),use_previous=__webpack_require__(12162),compute_modal_defProp=Object.defineProperty,compute_modal_defProps=Object.defineProperties,compute_modal_getOwnPropDescs=Object.getOwnPropertyDescriptors,compute_modal_getOwnPropSymbols=Object.getOwnPropertySymbols,compute_modal_hasOwnProp=Object.prototype.hasOwnProperty,compute_modal_propIsEnum=Object.prototype.propertyIsEnumerable,compute_modal_defNormalProp=(obj,key,value)=>key in obj?compute_modal_defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,compute_modal_spreadValues=(a,b)=>{for(var prop in b||(b={}))compute_modal_hasOwnProp.call(b,prop)&&compute_modal_defNormalProp(a,prop,b[prop]);if(compute_modal_getOwnPropSymbols)for(var prop of compute_modal_getOwnPropSymbols(b))compute_modal_propIsEnum.call(b,prop)&&compute_modal_defNormalProp(a,prop,b[prop]);return a},compute_modal_spreadProps=(a,b)=>compute_modal_defProps(a,compute_modal_getOwnPropDescs(b));const MULTIPLES_POLICIES=[{value:"last",label:"Last submitted value"},{value:"first",label:"First submitted value"},{value:"pass-through",label:"All submitted values"},{value:"max",label:"Best submitted value"}];function createTagWeights(tags,existingWeights={}){if(!tags)return{_default_tag:1};const weights={};return tags.forEach(tag=>{var _a;weights[tag]=(_a=existingWeights==null?void 0:existingWeights[tag])!=null?_a:1}),weights}const memberSelection=member=>({value:member.id,label:`${member.firstName} ${member.lastName} (${member.email})`});function TagWeightInput({value,t,onChange}){const tags=Object.keys(value),handleChange=(0,react.useCallback)(event=>{const weight=Number(event.target.value),tag=event.target.getAttribute("data-tag"),newWeights=compute_modal_spreadValues({},value);newWeights[tag]=weight,onChange(newWeights)},[value,onChange]),inputs=new Array(tags.length);for(let i=0;i<tags.length;i++){const tag=tags[i],weight=value[tag];inputs[i]=react.createElement(Form_default().Group,{className:"mb-1",as:Row_default(),key:`tag-${i}`},react.createElement(Form_default().Label,{column:!0,sm:3},tag==="_default_tag"?t("default"):tag),react.createElement(Col.default,{sm:9},react.createElement(Form_default().Control,{type:"number",value:weight,onChange:handleChange,placeholder:1,"data-tag":tag,min:0})))}return inputs}function ComputeModal({cohorts,metric,entity,level,show,tags,onHide}){console.log(cohorts);const{t}=(0,commonjs.$G)(),[formValues,setFormValues]=(0,react.useState)({users:[],activeCohorts:{},policyOptions:{tagWeights:createTagWeights(tags,{}),multiples:MULTIPLES_POLICIES[0]}}),FORM_STORAGE_KEY=`ISLE?level=${level}&id=${entity._id}&metric=${metric.name}`;(0,react.useEffect)(()=>{let oldFormValues=localStorage.getItem(FORM_STORAGE_KEY);oldFormValues&&(oldFormValues=JSON.parse(oldFormValues),setFormValues(oldFormValues))},[FORM_STORAGE_KEY]);const oldTags=(0,use_previous.Z)(tags||[]);(0,react.useEffect)(()=>{if(tags&&oldTags&&tags.length!==oldTags.length){const newFormValues=compute_modal_spreadValues({},formValues);newFormValues.policyOptions.tagWeights=createTagWeights(tags,formValues.policyOptions.tagWeights),setFormValues(newFormValues)}},[tags,oldTags,formValues]);const onTimeChange=(0,react.useCallback)(dates=>{const newFormValues=compute_modal_spreadValues({},formValues);newFormValues.policyOptions.timeFilter=dates,setFormValues(newFormValues)},[formValues]),handleMultiplesPolicyChange=(0,react.useCallback)(multiples=>{const newFormValues=compute_modal_spreadValues({},formValues);newFormValues.policyOptions.multiples=multiples,setFormValues(newFormValues)},[formValues]),handleTagWeightsChange=(0,react.useCallback)(tagWeights=>{const newFormValues=compute_modal_spreadValues({},formValues);newFormValues.policyOptions.tagWeights=tagWeights,setFormValues(newFormValues)},[formValues]),onCalculate=(0,react.useCallback)(()=>{formValues.policyOptions.timeFilter&&(formValues.policyOptions.timeFilter=formValues.policyOptions.timeFilter.map(x=>x.getTime())),localStorage.setItem(FORM_STORAGE_KEY,JSON.stringify(formValues));const body={id:entity._id,users:formValues.users.map(x=>x.value),metric,policyOptions:compute_modal_spreadProps(compute_modal_spreadValues({},formValues.policyOptions),{multiples:formValues.policyOptions.multiples.value})};axios_default().post(constants_server.ZP+"/compute_completions",body).then(response=>{console.log(response)})},[metric,entity,formValues,FORM_STORAGE_KEY]),users=cohorts.reduce((userList,cohort2)=>{const members=cohort2.members.map(member=>memberSelection(member));return userList.concat(members)},[]),selectOptions=[{value:{category:"all",members:users},label:t("All users")},...cohorts.length>1?cohorts.map(cohort2=>({value:{category:"cohort",id:cohort2._id,members:cohort2.members},label:"Cohort "+cohort2.title})):[]].concat(users),userSelectStyles={option:(styles,{data})=>data.value.category==="cohort"&&formValues.activeCohorts[data.value.id]?compute_modal_spreadProps(compute_modal_spreadValues({},styles),{":before":{content:'"\u2713 "'}}):styles},handleUserSelectChange=(0,react.useCallback)(value=>{if(!value){setFormValues(compute_modal_spreadProps(compute_modal_spreadValues({},formValues),{users:[]}));return}if(value.some(x=>x.value.category==="all")){setFormValues(compute_modal_spreadProps(compute_modal_spreadValues({},formValues),{users,activeCohorts:{}}));return}const selectedUsersSet=new Set,removeIds=new Set,newValue=[],newActiveCohorts=Object.assign({},formValues.activeCohorts);for(let i=0;i<value.length;i++)if(value[i].value.category==="cohort")if(formValues.activeCohorts[value[i].value.id])newActiveCohorts[value[i].value.id]=!1,value[i].value.members.forEach(member=>{removeIds.add(member.id)});else{newActiveCohorts[value[i].value.id]=!0;for(let j=0;j<value[i].value.members.length;++j)if(!selectedUsersSet.has(value[i].value.members[j].id)){const member=value[i].value.members[j];newValue.push(memberSelection(member)),selectedUsersSet.add(member.id)}}else selectedUsersSet.has(value[i].value)||(newValue.push(value[i]),selectedUsersSet.add(value[i].value));setFormValues(compute_modal_spreadProps(compute_modal_spreadValues({},formValues),{users:newValue.filter(x=>!removeIds.has(x.value)),activeCohorts:newActiveCohorts}))},[formValues,users]);return react.createElement(Modal_default(),{size:"lg",show,onHide},react.createElement(Modal_default().Header,{closeButton:!0},react.createElement(Modal_default().Title,{as:"h3"},t("calculate-scores"))),react.createElement(Modal_default().Body,null,react.createElement(Container_default(),null,react.createElement(Form_default().Group,{className:"mb-2",as:Row_default(),controlId:"multiplesPolicy"},react.createElement(Form_default().Label,{column:!0,sm:3},t("multiples-policy")),react.createElement(Col.default,{sm:8},react.createElement(react_select_cjs_prod.ZP,{value:formValues.policyOptions.multiples,options:MULTIPLES_POLICIES,onChange:handleMultiplesPolicyChange})),react.createElement(Col.default,{sm:1},react.createElement(help_icon,null,react.createElement("p",null,t("multiples-policy-description"))))),react.createElement(Form_default().Group,{className:"mb-2",as:Row_default(),controlId:"timeFilter"},react.createElement(Form_default().Label,{column:!0,sm:3},t("time-filter")),react.createElement(Col.default,{sm:8},react.createElement(entry.Z,{onChange:onTimeChange,value:formValues.policyOptions.timeFilter})),react.createElement(Col.default,{sm:1},react.createElement(help_icon,null,react.createElement("p",null,t("time-filter-description"))))),react.createElement(Form_default().Group,{className:"mb-2",as:Row_default(),controlId:"users"},react.createElement(Form_default().Label,{column:!0,sm:3},t("users")),react.createElement(Col.default,{sm:8},react.createElement(react_select_cjs_prod.ZP,{value:formValues.users,isMulti:!0,options:selectOptions,onChange:handleUserSelectChange,hideSelectedOptions:!0,styles:userSelectStyles})),react.createElement(Col.default,{sm:1},react.createElement(help_icon,null,react.createElement("p",null,t("users-description"))))),react.createElement(Form_default().Group,{className:"mb-2",as:Row_default(),controlId:"users"},react.createElement(Form_default().Label,{column:!0,sm:3},t("tag-weights")),react.createElement(Col.default,{sm:8},react.createElement(TagWeightInput,{value:formValues.policyOptions.tagWeights,onChange:handleTagWeightsChange,t})),react.createElement(Col.default,{sm:1},react.createElement(help_icon,null,react.createElement("p",null,t("tag-weights-description"))))))),react.createElement(Modal_default().Footer,null,react.createElement(Button_default(),{onClick:onHide},t("common:cancel")),react.createElement(Button_default(),{variant:"success",onClick:onCalculate,disabled:formValues.users.length===0},t("common:calculate"))))}ComputeModal.propTypes={cohorts:prop_types_default().array.isRequired,entity:prop_types_default().object.isRequired,level:prop_types_default().string.isRequired,metric:prop_types_default().object.isRequired,onHide:prop_types_default().func.isRequired,show:prop_types_default().bool.isRequired,tags:prop_types_default().array},ComputeModal.defaultProps={tags:null};var compute_modal=ComputeModal,react_select_cjs=__webpack_require__(4665),values_lib=__webpack_require__(49984),values_lib_default=__webpack_require__.n(values_lib);const levelFieldMapping={program:"namespaces",namespace:"lessons",lesson:null,component:null};function predecessor(level){switch(level){case"lesson":return"component";case"namespace":return"lesson";case"program":return"namespace";case"global":return"program";case"component":default:return null}}const levelPredecessorMapping={global:"program",program:"namespace",namespace:"lesson",lesson:"component",component:null};var coverage_options_namespaceObject=JSON.parse('{"all":{"value":"all","label":"All"},"include":{"value":"include","label":"Include"},"exclude":{"value":"exclude","label":"Exclude"}}'),edit_metric_modal_defProp=Object.defineProperty,edit_metric_modal_defProps=Object.defineProperties,edit_metric_modal_getOwnPropDescs=Object.getOwnPropertyDescriptors,edit_metric_modal_getOwnPropSymbols=Object.getOwnPropertySymbols,edit_metric_modal_hasOwnProp=Object.prototype.hasOwnProperty,edit_metric_modal_propIsEnum=Object.prototype.propertyIsEnumerable,edit_metric_modal_defNormalProp=(obj,key,value)=>key in obj?edit_metric_modal_defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,edit_metric_modal_spreadValues=(a,b)=>{for(var prop in b||(b={}))edit_metric_modal_hasOwnProp.call(b,prop)&&edit_metric_modal_defNormalProp(a,prop,b[prop]);if(edit_metric_modal_getOwnPropSymbols)for(var prop of edit_metric_modal_getOwnPropSymbols(b))edit_metric_modal_propIsEnum.call(b,prop)&&edit_metric_modal_defNormalProp(a,prop,b[prop]);return a},edit_metric_modal_spreadProps=(a,b)=>edit_metric_modal_defProps(a,edit_metric_modal_getOwnPropDescs(b)),__objRest=(source,exclude)=>{var target={};for(var prop in source)edit_metric_modal_hasOwnProp.call(source,prop)&&exclude.indexOf(prop)<0&&(target[prop]=source[prop]);if(source!=null&&edit_metric_modal_getOwnPropSymbols)for(var prop of edit_metric_modal_getOwnPropSymbols(source))exclude.indexOf(prop)<0&&edit_metric_modal_propIsEnum.call(source,prop)&&(target[prop]=source[prop]);return target};function EditMetricModal({level,entity,show,onHide,allRules,refs,createNew,metric,onConfirm}){var _a;const{t}=(0,commonjs.$G)(),[name,setName]=(0,react.useState)((metric==null?void 0:metric.name)||""),[rule,setRule]=(0,react.useState)(metric!=null&&metric.rule?allRules[metric.rule[0]]:null),[ruleParameters,setRuleParameters]=(0,react.useState)(metric!=null&&metric.rule?metric.rule.slice(1):[]),[coverage,setCoverage]=(0,react.useState)(coverage_options_namespaceObject[((_a=metric==null?void 0:metric.coverage)==null?void 0:_a[0])||"all"]),[coverageEntities,setCoverageEntities]=(0,react.useState)([]),[selectedRef,setSelectedRef]=(0,react.useState)((metric==null?void 0:metric.ref)||null),subEntities=(0,react.useRef)([]);(0,react.useEffect)(()=>{if(level==="lesson")subEntities.current=[];else if(levelFieldMapping[level]){const entities=entity[levelFieldMapping[level]];if(console.log(entities),subEntities.current=entities.map(x=>({label:x.title,value:x})),metric&&metric.coverage){const ids=new Set(metric.coverage.slice(1));setCoverageEntities(subEntities.current.filter(x=>ids.has(x.value._id)))}}else subEntities.current=[]},[level,entity,metric]);const handleConfirm=()=>{onConfirm({name,rule:[rule.name].concat(ruleParameters),coverage:[coverage.value].concat(coverageEntities.map(x=>x.value._id)),level,id:entity._id,ref:selectedRef}),onHide()},handleEntityChange=value=>{console.log(value),setCoverageEntities(value)};console.log("Sub-entities:"),console.log(subEntities.current);const labelStyler=(styles,{data})=>!selectedRef||data.value.completions.some(x=>x.name===selectedRef)?styles:edit_metric_modal_spreadProps(edit_metric_modal_spreadValues({},styles),{opacity:.65}),subentitySelectorStyles={option:labelStyler,multiValueLabel:labelStyler};return react.createElement(Modal_default(),{size:"lg",show,onHide},react.createElement(Modal_default().Header,{closeButton:!0},react.createElement(Modal_default().Title,{as:"h3"},t(createNew?"create-completion-metric":"edit-completion-metric"))),react.createElement(Modal_default().Body,null,react.createElement("p",null,t(createNew?"create-completion-metric-description":"edit-completion-metric-description")),react.createElement(Form_default().Group,{className:"mb-2"},react.createElement(Form_default().Label,null,t("common:name")),react.createElement(Form_default().Control,{name:"metric-name",type:"text",placeholder:t("metric-name-placeholder"),onChange:event=>setName(event.target.value),value:name})),react.createElement(Form_default().Group,{className:"mb-2"},react.createElement(Form_default().Label,null,t("common:rule")),react.createElement(react_select_cjs_prod.ZP,{options:values_lib_default()(allRules).map(rule2=>({value:rule2,label:rule2.label})),onChange:option=>{const newRule=option.value;setRule(newRule),setRuleParameters(newRule.defaults)},value:rule?{value:rule,label:rule.label}:null})),rule&&rule.parameters.length>0?rule.parameters.map((parameter,idx)=>react.createElement(Form_default().Group,{key:`param-${idx}`,className:"mb-2"},react.createElement(Form_default().Label,null,parameter.name),react.createElement(Form_default().Control,{name:parameter.name,type:parameter.type,placeholder:t("enter-parameter-value"),onChange:event=>{const newParams=ruleParameters.slice();switch(parameter.type){case"number":newParams[idx]=parseFloat(event.target.value);break;case"string":newParams[idx]=event.target.value;break}setRuleParameters(newParams)},defaultValue:ruleParameters[idx]!==void 0?ruleParameters[idx]:rule.defaults[idx]}))):null,react.createElement(Form_default().Group,{className:"mb-2"},react.createElement(Form_default().Label,null,t("common:ref")),react.createElement(react_select_cjs.default,{isClearable:!0,options:refs.map(ref=>({value:ref,label:ref})),onChange:option=>{setSelectedRef(option?option.value:null)},defaultValue:selectedRef?{value:selectedRef,label:selectedRef}:null})),react.createElement(Form_default().Group,{className:"mb-2",as:Row_default()},react.createElement(Form_default().Label,null,t("common:coverage")),react.createElement(react_select_cjs_prod.ZP,{options:values_lib_default()(coverage_options_namespaceObject),onChange:option=>{setCoverage(option),option.value==="all"&&setCoverageEntities([])},value:coverage}),coverage.value==="include"||coverage.value==="exclude"?react.createElement(react_select_cjs_prod.ZP,{isMulti:!0,options:subEntities.current,onChange:handleEntityChange,value:coverageEntities,styles:subentitySelectorStyles,placeholder:"Select lessons...",components:{Placeholder:_b=>{var _c=_b,{children,isFocused}=_c,rest=__objRest(_c,["children","isFocused"]);return console.log(rest),react.createElement(react_select_cjs_prod.wx.Placeholder,edit_metric_modal_spreadValues({},rest),children," ",isFocused?"(opaque lessons have no metric for the selected ref)":"")}}}):null)),react.createElement(Modal_default().Footer,null,react.createElement(Button_default(),{onClick:onHide},t("common:cancel")),react.createElement(Button_default(),{variant:"success",onClick:handleConfirm,disabled:!rule||!name},t(createNew?"common:create":"common:save"))))}EditMetricModal.propTypes={allRules:prop_types_default().object.isRequired,createNew:prop_types_default().bool.isRequired,entity:prop_types_default().object.isRequired,level:prop_types_default().oneOf(["program","namespace","lesson","component"]).isRequired,metric:prop_types_default().object,onConfirm:prop_types_default().func.isRequired,onHide:prop_types_default().func.isRequired,refs:prop_types_default().array.isRequired,show:prop_types_default().bool.isRequired},EditMetricModal.defaultProps={metric:null};var edit_metric_modal=EditMetricModal,InputGroup=__webpack_require__(16644),InputGroup_default=__webpack_require__.n(InputGroup),object_hash=__webpack_require__(40705),object_hash_default=__webpack_require__.n(object_hash),shared_edit_lesson_metrics_modal_defProp=Object.defineProperty,shared_edit_lesson_metrics_modal_defProps=Object.defineProperties,shared_edit_lesson_metrics_modal_getOwnPropDescs=Object.getOwnPropertyDescriptors,shared_edit_lesson_metrics_modal_getOwnPropSymbols=Object.getOwnPropertySymbols,shared_edit_lesson_metrics_modal_hasOwnProp=Object.prototype.hasOwnProperty,shared_edit_lesson_metrics_modal_propIsEnum=Object.prototype.propertyIsEnumerable,shared_edit_lesson_metrics_modal_defNormalProp=(obj,key,value)=>key in obj?shared_edit_lesson_metrics_modal_defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,shared_edit_lesson_metrics_modal_spreadValues=(a,b)=>{for(var prop in b||(b={}))shared_edit_lesson_metrics_modal_hasOwnProp.call(b,prop)&&shared_edit_lesson_metrics_modal_defNormalProp(a,prop,b[prop]);if(shared_edit_lesson_metrics_modal_getOwnPropSymbols)for(var prop of shared_edit_lesson_metrics_modal_getOwnPropSymbols(b))shared_edit_lesson_metrics_modal_propIsEnum.call(b,prop)&&shared_edit_lesson_metrics_modal_defNormalProp(a,prop,b[prop]);return a},shared_edit_lesson_metrics_modal_spreadProps=(a,b)=>shared_edit_lesson_metrics_modal_defProps(a,shared_edit_lesson_metrics_modal_getOwnPropDescs(b));const COVERAGE_OPTIONS_ARRAY=values_lib_default()(coverage_options_namespaceObject),SELECT_STYLES={menuPortal:base=>shared_edit_lesson_metrics_modal_spreadProps(shared_edit_lesson_metrics_modal_spreadValues({},base),{zIndex:9999})};function convertRuleParameter(value,parameter){switch(parameter.type){case"number":return parseFloat(value);case"string":return value}}function selectOption(value){return{label:value,value}}function analyzeLessonMetrics(name,lessons){const lessonInfo=lessons.reduce((acc,lesson2)=>{const namedMetric=lesson2.completions.find(metric=>metric.name===name);return namedMetric&&(acc.active[lesson2._id]=namedMetric,acc.rules.add(JSON.stringify(namedMetric.rule)),acc.rule=namedMetric.rule,acc.refs.add(namedMetric.ref),acc.ref=namedMetric.ref),acc},{rules:new Set,refs:new Set,active:{},rule:null,ref:null},lessons);return lessonInfo.rules.size>0?{hasSharedRule:lessonInfo.rules.size===1,hasSharedRef:lessonInfo.refs.size===1,activeLessons:lessonInfo.active,rule:lessonInfo.rule,ref:lessonInfo.ref}:{activeLessons:{},hasSharedRule:!0,hasSharedRef:!0,rule:null,ref:null}}function availableLessonMetrics(lessons){const allMetrics=lessons.reduce((acc,lesson2)=>(lesson2.completions.forEach(metric=>{acc.add(metric.name)}),acc),new Set);return Array.from(allMetrics).sort().map(metric=>({value:metric,label:metric}))}function SharedEditLessonMetricsModal({name,preferredLesson,lessons,lessonRefs,lessonComponents,namespace:namespace2,allRules,show,onHide,onSave}){const[chosenName,setChosenName]=(0,react.useState)(name),[hasSharedRule,setHasSharedRule]=(0,react.useState)(!1),[sharedRule,setSharedRule]=(0,react.useState)(null),[sharedRuleParameters,setSharedRuleParameters]=(0,react.useState)([]),[hasSharedRef,setHasSharedRef]=(0,react.useState)(!1),[sharedRef,setSharedRef]=(0,react.useState)(null),[activeLessons,setActiveLessons]=(0,react.useState)({}),[selectedLessons,setSelectedLessons]=(0,react.useState)({}),[currentHash,setCurrentHash]=(0,react.useState)(null),availableMetrics=(0,react.useRef)(null),analyzedHash=(0,react.useRef)(null),analysisRef=(0,react.useRef)(null),incorporateAnalysis=(0,react.useCallback)(analysis=>{setHasSharedRule(analysis.hasSharedRule);let newSharedRule=null,newSharedRuleParameters=[];analysis.hasSharedRule&&analysis.rule&&analysis.rule[0]&&(newSharedRule=allRules[analysis.rule[0]],newSharedRuleParameters=analysis.rule.slice(1),setSharedRule(newSharedRule),setSharedRuleParameters(newSharedRuleParameters)),setHasSharedRef(analysis.hasSharedRef),analysis.hasSharedRef&&setSharedRef(analysis.ref);const obj={sharedRule:newSharedRule,sharedRuleParameters:newSharedRuleParameters,sharedRef:analysis.hasSharedRef?analysis.ref:null,activeLessons:analysis.activeLessons},newSelectedLessons={};console.log(obj);for(let i=0;i<lessons.length;i++){const lessonId=lessons[i]._id;obj.activeLessons[lessonId]?newSelectedLessons[lessonId]=!0:(newSelectedLessons[lessonId]=!1,obj.activeLessons[lessonId]={name:chosenName,rule:analysis.hasSharedRule?[obj.sharedRule.name,...obj.sharedRuleParameters]:null,ref:analysis.hasSharedRef?obj.sharedRef:null,coverage:["all"],level:"lesson"})}console.log("Analyzed HASHED OBJ: "),console.log(obj),analyzedHash.current=object_hash_default()(obj),console.log("Analyzed HASHED: "+analyzedHash.current),setCurrentHash(analyzedHash.current),setActiveLessons(obj.activeLessons),setSelectedLessons(newSelectedLessons)},[allRules,chosenName,lessons]);(0,react.useEffect)(()=>{availableMetrics.current=availableLessonMetrics(lessons)},[lessons]),(0,react.useEffect)(()=>{console.log("EFFECT..."),console.log(chosenName);const analysis=analyzeLessonMetrics(chosenName,lessons);console.log("ANALYSIS"),console.log(analysis),analysisRef.current=analysis,incorporateAnalysis(analysis)},[allRules,incorporateAnalysis,lessons,chosenName]),(0,react.useEffect)(()=>{const obj={sharedRule:hasSharedRule?sharedRule:null,sharedRuleParameters:hasSharedRule?sharedRuleParameters:[],sharedRef:hasSharedRef?sharedRef:null,activeLessons};console.log("CURRENT HASHED OBJ: "),console.log(obj),setCurrentHash(object_hash_default()(obj))},[sharedRule,sharedRef,sharedRuleParameters,activeLessons,hasSharedRef,hasSharedRule]);const handleSave=(0,react.useCallback)(()=>{const lessonMetrics=shared_edit_lesson_metrics_modal_spreadValues({},activeLessons);namespace2.lessons.forEach(lesson2=>{selectedLessons[lesson2._id]?lessonMetrics[lesson2._id]=shared_edit_lesson_metrics_modal_spreadValues(shared_edit_lesson_metrics_modal_spreadValues(shared_edit_lesson_metrics_modal_spreadValues({},lessonMetrics[lesson2._id]),hasSharedRef?{ref:sharedRef}:{}),hasSharedRule?{rule:[sharedRule.name,...sharedRuleParameters]}:{}):lessonMetrics[lesson2._id]=null});const body={namespaceID:namespace2._id,name:chosenName,lessonMetrics};onSave(body)},[activeLessons,chosenName,namespace2,hasSharedRef,sharedRef,hasSharedRule,selectedLessons,sharedRule,sharedRuleParameters,onSave]);function lessonActivator(){return{name:chosenName,rule:hasSharedRule?[sharedRule.name,...sharedRuleParameters]:null,ref:hasSharedRef?sharedRef:null,coverage:["all"],level:"lesson"}}const{t}=(0,commonjs.$G)(),lessonRefOptions=lessonRefs.map(ref=>({value:ref,label:ref})),allRulesOptions=values_lib_default()(allRules).map(rule=>({value:rule,label:rule.label})),sharedInputs=react.createElement(react.Fragment,null,react.createElement(Form_default().Group,{className:"mb-2",as:Row_default()},react.createElement(Col.default,{sm:4},react.createElement(Form_default().Check,{type:"checkbox",id:"shared-rule-checkbox",label:t("share-across-lessons"),onChange:event=>{setHasSharedRule(event.target.checked)},checked:hasSharedRule})),react.createElement(Form_default().Label,{column:!0,sm:2},t("common:rule")),react.createElement(Col.default,{sm:6},react.createElement(react_select_cjs_prod.ZP,{isDisabled:!hasSharedRule,options:allRulesOptions,onChange:option=>{const newRule=option.value;setSharedRule(newRule),setSharedRuleParameters(newRule.defaults)},value:sharedRule?{value:sharedRule,label:sharedRule.label}:null}))),hasSharedRule&&sharedRule&&sharedRule.parameters.length>0&&sharedRule.parameters.map((parameter,idx)=>react.createElement(Form_default().Group,{key:`param-${idx}`,className:"mb-2",as:Row_default()},react.createElement(Col.default,{sm:4}),react.createElement(Form_default().Label,{column:!0,sm:2},parameter.name),react.createElement(Col.default,{sm:6},react.createElement(Form_default().Control,{name:parameter.name,type:parameter.type,placeholder:t("enter-parameter-value"),onChange:event=>{const newParams=sharedRuleParameters.slice();newParams[idx]=convertRuleParameter(event.target.value,parameter),setSharedRuleParameters(newParams)},defaultValue:sharedRuleParameters[idx]!==void 0?sharedRuleParameters[idx]:sharedRule.defaults[idx]})))),react.createElement(Form_default().Group,{className:"mb-2",as:Row_default()},react.createElement(Col.default,{sm:4},react.createElement(Form_default().Check,{type:"checkbox",id:"shared-ref-checkbox",label:t("share-across-lessons"),onChange:event=>{setHasSharedRef(event.target.checked)},checked:hasSharedRef})),react.createElement(Form_default().Label,{column:!0,sm:2},t("common:ref")),react.createElement(Col.default,{sm:6},react.createElement(react_select_cjs.default,{isClearable:!0,isDisabled:!hasSharedRef,options:lessonRefOptions,onChange:option=>{setSharedRef(option?option.value:null)},value:sharedRef?{value:sharedRef,label:sharedRef}:null})))),lessonInputs=Array.from(lessons).sort(preferredLesson?(a,b)=>a.title===preferredLesson.title?-1:b.title===preferredLesson.title?1:a.title.localeCompare(b.title):(a,b)=>a.title.localeCompare(b.title)).map(x=>{const lessonIsActive=activeLessons[x._id]!==void 0;let defaultRuleParameters,defaultRule,defaultRef;if(lessonIsActive)if(hasSharedRef&&sharedRef?defaultRef={value:sharedRef,label:sharedRef}:defaultRef=activeLessons[x._id].ref?{value:activeLessons[x._id].ref,label:activeLessons[x._id].ref}:null,hasSharedRule&&sharedRule)defaultRule={value:sharedRule,label:sharedRule.label},defaultRuleParameters=sharedRuleParameters;else if(activeLessons[x._id].rule){const activeRule=allRules[activeLessons[x._id].rule[0]];defaultRule={value:activeRule,label:activeRule.label},defaultRuleParameters=activeLessons[x._id].rule.slice(1)}else defaultRule=null,defaultRuleParameters=[];const activeLesson=activeLessons[x._id],coverage=(activeLesson==null?void 0:activeLesson.coverage)||["all"],coverageQualifier=coverage[0],coverageEntities=coverage.slice(1).map(selectOption);return react.createElement(react.Fragment,null,react.createElement(Form_default().Check,{type:"switch",id:"custom-switch",label:x.title,key:x._id,onChange:event=>{const newSelected=shared_edit_lesson_metrics_modal_spreadValues({},selectedLessons);newSelected[x._id]=event.target.checked,setSelectedLessons(newSelected)},checked:lessonIsActive}),lessonIsActive&&react.createElement(react.Fragment,null,react.createElement(Form_default().Group,{className:"mb-2",as:Row_default()},react.createElement(Col.default,{sm:2}),react.createElement(Form_default().Label,{column:!0,sm:4},t("common:rule")),react.createElement(Col.default,{sm:6},react.createElement(react_select_cjs_prod.ZP,{options:allRulesOptions,isDisabled:hasSharedRule,onChange:option=>{const newActive=shared_edit_lesson_metrics_modal_spreadValues({},activeLessons);newActive[x._id].rule=[option.value.name,...option.value.defaults],setActiveLessons(newActive)},value:defaultRule,menuPortalTarget:document.body,menuPlacement:"auto",styles:SELECT_STYLES}))),defaultRuleParameters.length>0&&defaultRuleParameters.map((value,idx)=>{const parameter=allRules[defaultRule.value.name].parameters[idx];return react.createElement(Form_default().Group,{key:`${x._id}-param-${idx}`,className:"mb-2",as:Row_default()},react.createElement(Col.default,{sm:4}),react.createElement(Form_default().Label,{column:!0,sm:2},parameter.name),react.createElement(Col.default,{sm:6},react.createElement(Form_default().Control,{name:parameter.name,type:parameter.type,placeholder:t("enter-parameter-value"),disabled:hasSharedRule,onChange:event=>{const newActive=shared_edit_lesson_metrics_modal_spreadValues({},activeLessons);newActive[x._id].rule[idx+1]=convertRuleParameter(event.target.value,parameter),setActiveLessons(newActive)},value:defaultRuleParameters[idx]})))}),react.createElement(Form_default().Group,{className:"mb-2",as:Row_default()},react.createElement(Col.default,{sm:2}),react.createElement(Form_default().Label,{column:!0,sm:4},t("common:ref")),react.createElement(Col.default,{sm:6},react.createElement(react_select_cjs.default,{isClearable:!0,isDisabled:hasSharedRef,options:lessonRefOptions,onChange:option=>{const newActive=shared_edit_lesson_metrics_modal_spreadValues({},activeLessons);newActive[x._id].ref=option?option.value:null,setActiveLessons(newActive)},value:defaultRef,menuPortalTarget:document.body,menuPlacement:"auto",styles:SELECT_STYLES}))),react.createElement(Form_default().Group,{className:"mb-2",as:Row_default()},react.createElement(Col.default,{sm:2}),react.createElement(Form_default().Label,{column:!0,sm:4},t("common:coverage")),react.createElement(Col.default,{sm:6},react.createElement(react_select_cjs_prod.ZP,{options:COVERAGE_OPTIONS_ARRAY,onChange:option=>{const newActive=shared_edit_lesson_metrics_modal_spreadValues({},activeLessons);newActive[x._id].coverage[0]=option.value,setActiveLessons(newActive)},value:coverage_options_namespaceObject[coverageQualifier]}),coverageQualifier==="include"||coverageQualifier==="exclude"?react.createElement(react_select_cjs.default,{isMulti:!0,options:(lessonComponents[x._id]||[]).map(y=>{const label=y.componentType?`${y.component} (type ${y.componentType})`:y.component;return{value:y.component,label}}),onChange:option=>{const newActive=shared_edit_lesson_metrics_modal_spreadValues({},activeLessons);newActive[x._id].coverage=[coverageQualifier,...option.map(x2=>x2.value)],setActiveLessons(newActive)},value:coverageEntities,placeholder:"Select component identifiers..."}):null))))});console.log(currentHash),console.log(analyzedHash.current);const hasUnsavedChanges=currentHash!==analyzedHash.current;return react.createElement(Modal_default(),{size:"lg",show,onHide,dialogClassName:"modal-75w modal-80h"},react.createElement(Modal_default().Header,{closeButton:!hasUnsavedChanges},react.createElement(Modal_default().Title,{as:"h3"},`${t("lesson-metrics-for")} ${namespace2.title}`)),react.createElement(Modal_default().Body,null,react.createElement("p",null,t("lesson-metrics-description")),react.createElement(InputGroup_default(),{className:"mb-2"},react.createElement(InputGroup_default().Text,null,t("metric-name")),react.createElement(react_select_cjs.default,{name:"metric-name",placeholder:t("metric-name-placeholder"),onChange:value=>{value?setChosenName(value.value):(setChosenName(null),setSharedRule(null),setSharedRef(null))},value:chosenName?{value:chosenName,label:chosenName}:null,isClearable:!0,isDisabled:name||currentHash&&currentHash!==analyzedHash.current,options:availableMetrics.current})),chosenName?react.createElement(react.Fragment,null,sharedInputs,react.createElement(Form_default().Check,{type:"switch",id:"all-lessons-switch",label:react.createElement("h3",null,"All Lessons"),onChange:event=>{let newActive;event.target.checked?(newActive=shared_edit_lesson_metrics_modal_spreadValues({},activeLessons),lessons.forEach(lesson2=>{newActive[lesson2._id]||(newActive[lesson2._id]=lessonActivator())})):newActive={},setActiveLessons(newActive)}}),react.createElement("div",{style:{maxHeight:"75vh",minHeight:"50vh",border:"solid 1px darkgray",overflowY:"auto",padding:4,overflowX:"hidden"}},lessonInputs)):null),chosenName&&react.createElement(Modal_default().Footer,null,react.createElement(Button_default(),{onClick:onHide,disabled:hasUnsavedChanges},t("common:dismiss")),react.createElement(Button_default(),{variant:hasUnsavedChanges?"warning":"secondary",disabled:!hasUnsavedChanges,onClick:()=>{analysisRef.current&&incorporateAnalysis(analysisRef.current)}},t("discard-unsaved-changes")),react.createElement(Button_default(),{variant:"success",onClick:handleSave},t("common:save"))))}SharedEditLessonMetricsModal.propTypes={allRules:prop_types_default().array.isRequired,lessonComponents:prop_types_default().object,lessonRefs:prop_types_default().arrayOf(prop_types_default().string).isRequired,lessons:prop_types_default().array.isRequired,name:prop_types_default().string,namespace:prop_types_default().object.isRequired,onHide:prop_types_default().func.isRequired,onSave:prop_types_default().func.isRequired,preferredLesson:prop_types_default().object,show:prop_types_default().bool.isRequired},SharedEditLessonMetricsModal.defaultProps={name:null,lessonComponents:{},preferredLesson:null};var shared_edit_lesson_metrics_modal=SharedEditLessonMetricsModal;const COMPLETION_RULES={average:{name:"average",label:"Average",description:"Average value of the completions",parameters:[],defaults:[]},dropLowest:{name:"dropLowest",label:"Drop Lowest",description:"Average value after dropping the lowest value of the completions",parameters:[],defaults:[]},dropNLowest:{name:"dropNLowest",label:"Drop N Lowest",description:"Average value after dropping the lowest N values of the completions",parameters:[{name:"N",type:"number"}],defaults:[3]}};function CompletionsPage(props){const{t}=(0,commonjs.$G)("completions"),[selectedMetric,setSelectedMetric]=(0,react.useState)(null),[showComputeModal,setShowComputeModal]=(0,react.useState)(!1),[showDeleteModal,setShowDeleteModal]=(0,react.useState)(!1),[showCreateModal,setShowCreateModal]=(0,react.useState)(!1),[showEditModal,setShowEditModal]=(0,react.useState)(!1),[showLessonMetricsModal,setShowLessonMetricsModal]=(0,react.useState)(!1),[tags,setTags]=(0,react.useState)(null),[refs,setRefs]=(0,react.useState)(null),[lessonComponents,setLessonComponents]=(0,react.useState)({}),metrics=props.entity.completions;console.log(incrspace_lib_default()(0,metrics.length,1));const[order,setOrder]=(0,react.useState)(incrspace_lib_default()(0,metrics.length,1));(0,react.useEffect)(()=>{axios_default().post(`${constants_server.ZP}/completion_tags`).then(response=>{setTags(response.data)}).catch(err=>{console.log("Error fetching completion tags:",err),setTags(["quiz","homework","exam","_default_tag"])});const lessonIds=props.entity.lessons.map(lesson2=>lesson2._id);if(console.log("LESSON IDS"),console.log(lessonIds),axios_default().post(`${constants_server.ZP}/completion_components`,{lessons:lessonIds}).then(response=>{console.log("RECEIVED COMPONENT DATA"),setLessonComponents(response.data)}).catch(err=>{console.log("Error fetching completion components:",err)}),props.level==="lesson")setRefs(props.lessonRefs);else{const subentities=props.entity[levelFieldMapping[props.level]],completions2=new Set;subentities.forEach(subentity=>{subentity.completions.forEach(completion=>{completions2.add(completion.name)})}),setRefs(Array.from(completions2).sort())}},[props.entity,props.level,props.lessonRefs]);const handleDeleteMetric=()=>{const idx=metrics.findIndex(metric=>metric.name===selectedMetric.name),newOrder=order.filter(v=>v!==idx).map(x=>x>idx?x-1:x);setOrder(newOrder),props.deleteMetric({id:props.entity._id,level:props.level,name:selectedMetric.name}).then(response=>{setSelectedMetric(null),setShowDeleteModal(!1)}).catch(err=>{console.log("Error deleting metric:",err)})},transposeMetrics=(index,next)=>lodash_debounce_default()(()=>{const newOrder=[...order],i=newOrder[index];next?(newOrder[index]=newOrder[index+1],newOrder[index+1]=i):(newOrder[index]=newOrder[index-1],newOrder[index-1]=i),setOrder(newOrder),axios_default().post(`${constants_server.ZP}/metric_order`,{id:props.entity._id,level:props.level,index,next}).then(response=>{console.log(response)}).catch(err=>{console.log("Error updating metric order:",err)})},200);return console.log("ORDER: ",order),console.log("METRICS: ",metrics),react.createElement("div",{style:{margin:12}},react.createElement(ListGroup_default(),null,order.map((metricIndex,idx)=>{const metric=metrics[metricIndex];if(!metric)return null;const handleCompute=()=>{setSelectedMetric(metric),setShowComputeModal(!0)};return react.createElement(ListGroup_default().Item,{key:`${metricIndex}-${idx}`,className:"d-flex w-100 justify-content-start metric-list-item"},react.createElement("label",{className:"me-2"},metric.name),react.createElement("span",{style:{display:"inline-block",maxWidth:"calc(100% - 400px)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontStyle:"italic"}},metric.description),react.createElement("span",{className:"ms-auto"},react.createElement(OverlayTrigger_default(),{placement:"top",overlay:react.createElement(Tooltip_default(),{id:`tooltip-compute-${idx}`},t("compute-metric-tooltip"))},react.createElement(Button_default(),{variant:"secondary",size:"sm",className:"mx-2",onClick:handleCompute},t("common:compute"))),react.createElement(OverlayTrigger_default(),{placement:"top",overlay:react.createElement(Tooltip_default(),{id:`tooltip-edit-${idx}`},t("edit-metric-tooltip"))},react.createElement(Button_default(),{variant:"secondary",size:"sm",className:"mx-2",onClick:()=>{setSelectedMetric(metric),setShowEditModal(!0)}},t("common:edit"))),react.createElement(OverlayTrigger_default(),{placement:"top",overlay:react.createElement(Tooltip_default(),{id:`tooltip-delete-${idx}`},t("delete-metric-tooltip"))},react.createElement(Button_default(),{variant:"danger",size:"sm",className:"mx-2",onClick:()=>{setSelectedMetric(metric),setShowDeleteModal(!0)}},t("common:delete"))),react.createElement(Button_default(),{"aria-label":t("move-metric-down"),size:"sm",variant:"secondary",className:"mx-1",disabled:idx===metrics.length-1,onClick:transposeMetrics(idx,!0)},react.createElement("i",{className:"fas fa-chevron-down"})),react.createElement(Button_default(),{"aria-label":t("move-metric-up"),size:"sm",variant:"secondary",disabled:idx===0,onClick:transposeMetrics(idx,!1)},react.createElement("i",{className:"fas fa-chevron-up"}))))})),react.createElement(OverlayTrigger_default(),{placement:"bottom",overlay:react.createElement(Tooltip_default(),{id:"tooltip-create-metric"},t("create-metric-tooltip"))},react.createElement(Button_default(),{variant:"primary",style:{marginTop:12},onClick:()=>{setShowCreateModal(!0)}},t("create-completion-metric"))),react.createElement(OverlayTrigger_default(),{placement:"bottom",overlay:react.createElement(Tooltip_default(),{id:"tooltip-create-metric"},t("lesson-metrics-tooltip"))},react.createElement(Button_default(),{variant:"primary",style:{marginTop:12,marginLeft:6},onClick:()=>{setShowLessonMetricsModal(!0)}},t("lesson-metrics"))),selectedMetric?react.createElement(compute_modal,{key:`compute-modal-${selectedMetric.name}`,metric:selectedMetric,show:showComputeModal,onHide:()=>setShowComputeModal(!1),cohorts:props.cohorts,tags,entity:props.entity,level:props.level}):null,showCreateModal?react.createElement(edit_metric_modal,{key:"create-modal",show:showCreateModal,onHide:()=>setShowCreateModal(!1),allRules:COMPLETION_RULES,level:props.level,entity:props.entity,refs,createNew:!0,onConfirm:body=>{props.createMetric(body);const newOrder=order.slice();newOrder.push(order.length),setOrder(newOrder)}}):null,showDeleteModal?react.createElement(confirm_modal.Z,{title:t("delete-metric"),message:t("namespace:delete-metric-confirm"),close:()=>setShowDeleteModal(!1),show:showDeleteModal,onConfirm:handleDeleteMetric}):null,showEditModal?react.createElement(edit_metric_modal,{key:`edit-modal-${selectedMetric.name}`,show:showEditModal,onHide:()=>setShowEditModal(!1),allRules:COMPLETION_RULES,level:props.level,entity:props.entity,refs,createNew:!1,metric:selectedMetric,onConfirm:props.updateMetric}):null,showLessonMetricsModal?react.createElement(shared_edit_lesson_metrics_modal,{key:"lesson-metrics-modal",show:showLessonMetricsModal,onHide:()=>setShowLessonMetricsModal(!1),lessons:props.entity.lessons,allRules:COMPLETION_RULES,lessonRefs:props.lessonRefs,lessonComponents,namespace:props.entity,onSave:body=>{axios_default().post(`${constants_server.ZP}/save_lesson_metrics`,body).then(res=>{console.log("Response: ",res),setShowLessonMetricsModal(!1),props.updateLessonMetrics({lessons:res.data.lessons})}).catch(err=>{console.error(err)})}}):null)}CompletionsPage.propTypes={cohorts:prop_types_default().array.isRequired,createMetric:prop_types_default().func.isRequired,deleteMetric:prop_types_default().func.isRequired,entity:prop_types_default().object.isRequired,lessonRefs:prop_types_default().array.isRequired,level:prop_types_default().string.isRequired,updateLessonMetrics:prop_types_default().func,updateMetric:prop_types_default().func.isRequired},CompletionsPage.defaultProps={updateLessonMetrics:()=>{}};var completions=CompletionsPage,notification=__webpack_require__(16120),action_types=__webpack_require__(84499),__async=(__this,__arguments,generator)=>new Promise((resolve,reject)=>{var fulfilled=value=>{try{step(generator.next(value))}catch(e){reject(e)}},rejected=value=>{try{step(generator.throw(value))}catch(e){reject(e)}},step=x=>x.done?resolve(x.value):Promise.resolve(x.value).then(fulfilled,rejected);step((generator=generator.apply(__this,__arguments)).next())});const getCompletionTags=(dispatch,lessonIDs)=>__async(void 0,null,function*(){try{const res=yield axios.post(`${server}/completion_tags`,{lessons:lessonIDs});dispatch({type:GET_COMPLETION_TAGS,payload:{completionTags:res.data}})}catch(err){return addErrorNotification(dispatch,err)}}),getCompletionTagsInjector=dispatch=>lessonIDs=>__async(void 0,null,function*(){yield getCompletionTags(dispatch,lessonIDs)}),getCompletionLessonRefs=(_0,_1)=>__async(void 0,[_0,_1],function*(dispatch,{entities,target}){try{const res=yield axios.post(`${server}/completion_refs`,{entities,target});dispatch({type:GET_COMPLETION_LESSON_REFS,payload:{completionRefs:res.data}})}catch(err){return addErrorNotification(dispatch,err)}}),getCompletionLessonRefsInjector=dispatch=>_0=>__async(void 0,[_0],function*({entities,target}){yield getCompletionLessonRefs(dispatch,{entities,target})}),computeCompletions=(_0,_1)=>__async(void 0,[_0,_1],function*(dispatch,{metric,id,users,policyOptions}){try{yield axios.post(`${server}/compute_completions`,{metric,id,users,policyOptions}),dispatch({type:COMPUTED_COMPLETIONS})}catch(err){return addErrorNotification(dispatch,err)}}),computeCompletionsInjector=dispatch=>_0=>__async(void 0,[_0],function*({metric,id,users,policyOptions}){yield computeCompletions(dispatch,{metric,id,users,policyOptions})}),createMetric=(_0,_1)=>__async(void 0,[_0,_1],function*(dispatch,{name,rule,coverage,level,id,ref}){try{const res=yield axios_default().post(`${constants_server.ZP}/create_metric`,{name,rule,coverage,level,id,ref});console.log(res.data),dispatch({type:action_types.JQ,payload:{metric:res.data.metric,level,id}})}catch(err){return(0,notification.EG)(dispatch,err)}}),createMetricInjector=dispatch=>metric=>__async(void 0,null,function*(){yield createMetric(dispatch,metric)}),updateMetric=(dispatch,body)=>__async(void 0,null,function*(){try{const res=yield axios_default().post(`${constants_server.ZP}/update_metric`,body);console.log(res.data),dispatch({type:action_types.JS,payload:{metric:body,level:body.level,id:body.id}})}catch(err){return(0,notification.EG)(dispatch,err)}}),updateMetricInjector=dispatch=>metric=>__async(void 0,null,function*(){yield updateMetric(dispatch,metric)}),deleteMetric=(_0,_1)=>__async(void 0,[_0,_1],function*(dispatch,{name,level,id}){try{yield axios_default().post(`${constants_server.ZP}/delete_metric`,{name,level,id}),dispatch({type:action_types.sy,payload:{name,level,id}})}catch(err){return(0,notification.EG)(dispatch,err)}}),deleteMetricInjector=dispatch=>_0=>__async(void 0,[_0],function*({name,level,id}){return yield deleteMetric(dispatch,{name,level,id})});function mapStateToProps(state){return{user:state.user,namespace:state.namespace,cohorts:state.namespace.cohorts}}function mapDispatchToProps(dispatch){return{addNotification:(0,notification.pP)(dispatch),createMetric:createMetricInjector(dispatch),deleteMetric:deleteMetricInjector(dispatch),updateMetric:updateMetricInjector(dispatch)}}var visible_completions=(0,lib.connect)(mapStateToProps,mapDispatchToProps)(completions),check_url_path=__webpack_require__(48297),browser=__webpack_require__(11227),browser_default=__webpack_require__.n(browser),FormCheck=__webpack_require__(3692),FormCheck_default=__webpack_require__.n(FormCheck),react_dates=__webpack_require__(76141),moment=__webpack_require__(30381),moment_default=__webpack_require__.n(moment),is_email_address_lib=__webpack_require__(11738),is_email_address_lib_default=__webpack_require__.n(is_email_address_lib),_datepicker=__webpack_require__(71990),edit_cohort_modal_defProp=Object.defineProperty,edit_cohort_modal_defNormalProp=(obj,key,value)=>key in obj?edit_cohort_modal_defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__publicField=(obj,key,value)=>(edit_cohort_modal_defNormalProp(obj,typeof key!="symbol"?key+"":key,value),value);const debug=browser_default()("isle-dashboard:edit-cohort");function validateInputs({emails,title}){let invalid=!1;return emails.forEach(owner=>{is_email_address_lib_default()(owner)||(invalid=!0)}),invalid?!1:title.length>=4}class EditCohortModal extends react.Component{constructor(props){super(props),__publicField(this,"handleInputChange",event=>{const target=event.target,name=target.name;let value=target.value;this.setState({[name]:value},()=>{this.setState({disabled:!validateInputs({emails:this.state.members,title:this.state.title})})})}),__publicField(this,"handleUpdate",()=>{const updatedCohort={_id:this.props._id,emailFilter:this.state.emailFilter,startDate:this.state.startDate.startOf("day").toDate(),endDate:this.state.endDate.endOf("day").toDate(),members:this.state.members.join(","),title:this.state.title,private:this.state.private};this.props.onUpdate(updatedCohort),this.props.onHide()}),__publicField(this,"handleDelete",()=>{this.props.onDelete(this.props._id),this.closeDeleteModal(),this.props.onHide()}),__publicField(this,"closeDeleteModal",()=>{this.setState({showDeleteModal:!1})}),__publicField(this,"handleStudentChange",newValue=>{debug("Handle change of cohort members...");const members=is_array_lib_default()(newValue)?newValue.map(x=>x.value):[];this.setState({members,disabled:!validateInputs({emails:members,title:this.state.title})})}),this.state={disabled:!1,startDate:moment_default()(props.startDate),endDate:moment_default()(props.endDate),title:props.title,members:props.members.map(user=>user.email),showDeleteModal:!1,private:props.private,emailFilter:props.emailFilter}}render(){const{t}=this.props,content=react.createElement(Form_default(),{style:{padding:"10px"}},react.createElement(Row_default(),null,react.createElement(Col.default,{md:6},react.createElement(OverlayTrigger_default(),{placement:"right",overlay:react.createElement(Tooltip_default(),{id:"titleTooltip"},t("cohort-title-tooltip"))},react.createElement(FormGroup_default(),null,react.createElement(FormLabel_default(),null,t("common:title")),react.createElement(FormControl_default(),{name:"title",type:"text",value:this.state.title,onChange:this.handleInputChange})))),react.createElement(Col.default,{md:6},react.createElement(FormGroup_default(),null,react.createElement(FormLabel_default(),null,t("cohort-period")),react.createElement("br",null),react.createElement(react_dates.DateRangePicker,{startDateId:"panel_start_date_input",endDateId:"panel_end_date_input",startDate:this.state.startDate,endDate:this.state.endDate,onDatesChange:({startDate,endDate})=>this.setState({startDate,endDate}),focusedInput:this.state.focusedInput,onFocusChange:focusedInput=>this.setState({focusedInput})})))),react.createElement("hr",null),react.createElement(Row_default(),null,react.createElement(OverlayTrigger_default(),{placement:"right",overlay:react.createElement(Tooltip_default(),{id:"enrolledTooltip"},t("enrolled-tooltip"))},react.createElement(FormGroup_default(),{className:"cohort-modal-enrolled-group"},react.createElement(FormLabel_default(),null,t("enrolled-students")),react.createElement(text_select.Z,{placeholder:t("enter-emails"),defaultValue:this.state.members,onChange:this.handleStudentChange,styles:{control:()=>({width:"100%"})}})))),react.createElement("hr",null),react.createElement(Row_default(),null,react.createElement(OverlayTrigger_default(),{placement:"left",overlay:react.createElement(Tooltip_default(),{id:"preventTooltip"},t("prevent-tooltip"))},react.createElement(FormCheck_default(),{checked:this.state.private,onChange:event=>{this.setState({private:!this.state.private})},type:"checkbox",label:t("prevent-label")}))),react.createElement("hr",null),react.createElement(Row_default(),null,react.createElement(OverlayTrigger_default(),{placement:"right",overlay:react.createElement(Tooltip_default(),{id:"filterTooltip"},t("filter-tooltip"))},react.createElement(FormGroup_default(),null,react.createElement(FormLabel_default(),null,t("email-filter")),react.createElement(FormControl_default(),{style:{width:"25vw"},name:"emailFilter",type:"text",value:this.state.emailFilter,placeholder:t("filter-placeholder"),onChange:this.handleInputChange})))));return react.createElement(react.Fragment,null,react.createElement(Modal_default(),{size:"lg",show:this.props.show,onHide:this.props.onHide},react.createElement(Modal_default().Header,{closeButton:!0},react.createElement(Modal_default().Title,{as:"h3"},t("edit-cohort",{title:this.props.title}))),react.createElement(Modal_default().Body,null,content),react.createElement(Modal_default().Footer,null,react.createElement(ButtonGroup_default(),null,react.createElement(Button_default(),{onClick:()=>{this.setState({showDeleteModal:!0})},variant:"danger"},t("common:delete")),react.createElement(Button_default(),{onClick:this.props.onHide},t("common:cancel")),react.createElement(Button_default(),{variant:"success",disabled:this.state.disabled,onClick:this.handleUpdate},t("common:save"))))),react.createElement(confirm_modal.Z,{show:this.state.showDeleteModal,close:this.closeDeleteModal,message:t("delete-cohort"),title:`${t("delete")}?`,onConfirm:this.handleDelete}))}}EditCohortModal.propTypes={_id:prop_types_default().string.isRequired,emailFilter:prop_types_default().string.isRequired,endDate:prop_types_default().string,members:prop_types_default().array.isRequired,onDelete:prop_types_default().func,onHide:prop_types_default().func.isRequired,onUpdate:prop_types_default().func,private:prop_types_default().bool.isRequired,show:prop_types_default().bool.isRequired,startDate:prop_types_default().string.isRequired,t:prop_types_default().func.isRequired,title:prop_types_default().string.isRequired},EditCohortModal.defaultProps={endDate:null,onUpdate(){},onDelete(){}};var edit_cohort_modal=EditCohortModal;function create_cohort_modal_validateInputs(emails,title){let invalid=!1;return emails.forEach(owner=>{is_email_address_lib_default()(owner)||(invalid=!0)}),invalid?!1:title.length>=4}const CreateCohortModal=({close,onCreate,show,t})=>{const[title,setTitle]=(0,react.useState)(""),[emailFilter,setEmailFilter]=(0,react.useState)(""),[dates,setDates]=(0,react.useState)({start:moment_default()().startOf("day"),end:moment_default()().add(3,"months").endOf("day")}),[isPrivate,setIsPrivate]=(0,react.useState)(!1),[students,setStudents]=(0,react.useState)([]),[focusedInput,setFocusedInput]=(0,react.useState)(null),handleClose=()=>{close()},handleCreate=()=>{const cohort2={emailFilter,title,startDate:dates.start.startOf("day").toDate(),endDate:dates.end.endOf("day").toDate(),private:isPrivate,students:students.join(",")};onCreate(cohort2)},disabled=!create_cohort_modal_validateInputs(students,title),body=react.createElement(Form_default(),{style:{paddingLeft:20,paddingRight:20}},react.createElement(Row_default(),null,react.createElement(Col.default,{md:6},react.createElement(OverlayTrigger_default(),{placement:"right",overlay:react.createElement(Tooltip_default(),{id:"titleTooltip"},t("cohort-title-tooltip"))},react.createElement(FormGroup_default(),null,react.createElement(FormLabel_default(),null,t("common:title")),react.createElement(FormControl_default(),{name:"title",type:"text",placeholder:t("cohort-title-placeholder"),onChange:event=>setTitle(event.target.value)})))),react.createElement(Col.default,{md:6},react.createElement(FormGroup_default(),null,react.createElement(FormLabel_default(),null,t("cohort-period")),react.createElement(react_dates.DateRangePicker,{startDateId:"start_date_input",endDateId:"end_date_input",startDate:dates.start,endDate:dates.end,onDatesChange:({startDate,endDate})=>{setDates({start:startDate,end:endDate})},focusedInput,onFocusChange:setFocusedInput})))),react.createElement("hr",null),react.createElement(Row_default(),null,react.createElement(OverlayTrigger_default(),{placement:"right",overlay:react.createElement(Tooltip_default(),{id:"enrolledTooltip"},t("enrolled-tooltip"))},react.createElement(FormGroup_default(),{className:"cohort-modal-enrolled-group"},react.createElement(FormLabel_default(),null,t("enrolled-students")),react.createElement(text_select.Z,{placeholder:t("enter-emails"),onChange:newValue=>{const newStudents=is_array_lib_default()(newValue)?newValue.map(x=>x.value):[];setStudents(newStudents)},defaultValue:students,isClearable:!0,styles:{control:()=>({width:"100%"})}})))),react.createElement("hr",null),react.createElement(Row_default(),null,react.createElement(OverlayTrigger_default(),{placement:"left",overlay:react.createElement(Tooltip_default(),{id:"preventTooltip"},t("prevent-tooltip"))},react.createElement(FormCheck_default(),{checked:isPrivate,onChange:()=>{setIsPrivate(!isPrivate)},type:"checkbox",label:t("prevent-label")}))),react.createElement("hr",null),react.createElement(Row_default(),null,react.createElement(OverlayTrigger_default(),{placement:"right",overlay:react.createElement(Tooltip_default(),{id:"filterTooltip"},t("filter-tooltip"))},react.createElement(FormGroup_default(),null,react.createElement(FormLabel_default(),null,t("email-filter")),react.createElement(FormControl_default(),{style:{width:"25vw"},name:"emailFilter",type:"text",placeholder:t("filter-placeholder"),onChange:event=>setEmailFilter(event.target.value)})))));return react.createElement(Modal_default(),{size:"lg",show,onHide:handleClose},react.createElement(Modal_default().Header,{closeButton:!0},react.createElement(Modal_default().Title,{as:"h3"},t("create-new-cohort"))),react.createElement(Modal_default().Body,null,body),react.createElement(Modal_default().Footer,null,react.createElement(Button_default(),{onClick:handleClose},t("common:cancel")),react.createElement(Button_default(),{variant:"success",disabled,onClick:handleCreate},t("common:create"))))};CreateCohortModal.propTypes={close:prop_types_default().func,onCreate:prop_types_default().func,show:prop_types_default().bool,t:prop_types_default().func.isRequired},CreateCohortModal.defaultProps={close(){},onCreate(){},show:!1};var create_cohort_modal=CreateCohortModal,import_course_modal_async=(__this,__arguments,generator)=>new Promise((resolve,reject)=>{var fulfilled=value=>{try{step(generator.next(value))}catch(e){reject(e)}},rejected=value=>{try{step(generator.throw(value))}catch(e){reject(e)}},step=x=>x.done?resolve(x.value):Promise.resolve(x.value).then(fulfilled,rejected);step((generator=generator.apply(__this,__arguments)).next())});const ImportCourseModal=({namespaces,show,close,targetNamespace,copyNamespaceLessons,t})=>{const[selectedCourse,setSelectedCourse]=(0,react.useState)(null),handleSelection=obj=>{setSelectedCourse(obj.value)},handleImport=()=>import_course_modal_async(void 0,null,function*(){(yield copyNamespaceLessons({source:selectedCourse.title,target:targetNamespace.title}))instanceof Error||close()}),options=namespaces.map(x=>({label:x.title,value:x}));return react.createElement(Modal_default(),{size:"lg",show,onHide:close},react.createElement(Modal_default().Header,{closeButton:!0},react.createElement(Modal_default().Title,{as:"h3"},t("import-course"))),react.createElement(Modal_default().Body,null,react.createElement("p",null,t("import-course-description")),react.createElement(Form_default().Group,{controlId:"form-course-select"},react.createElement(Form_default().Label,null,t("select-namespace")),react.createElement(react_select_cjs_prod.ZP,{options,onChange:handleSelection}))),react.createElement(Modal_default().Footer,null,react.createElement(Button_default(),{onClick:close},t("common:cancel")),react.createElement(Button_default(),{variant:"success",disabled:!selectedCourse,onClick:handleImport},t("common:import"))))};ImportCourseModal.propTypes={close:prop_types_default().func.isRequired,copyNamespaceLessons:prop_types_default().func.isRequired,namespaces:prop_types_default().array,show:prop_types_default().bool,t:prop_types_default().func.isRequired,targetNamespace:prop_types_default().object.isRequired},ImportCourseModal.defaultProps={namespaces:[],show:!1};var import_course_modal=ImportCourseModal,edit_namespace_defProp=Object.defineProperty,edit_namespace_defProps=Object.defineProperties,edit_namespace_getOwnPropDescs=Object.getOwnPropertyDescriptors,edit_namespace_getOwnPropSymbols=Object.getOwnPropertySymbols,edit_namespace_hasOwnProp=Object.prototype.hasOwnProperty,edit_namespace_propIsEnum=Object.prototype.propertyIsEnumerable,edit_namespace_defNormalProp=(obj,key,value)=>key in obj?edit_namespace_defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,edit_namespace_spreadValues=(a,b)=>{for(var prop in b||(b={}))edit_namespace_hasOwnProp.call(b,prop)&&edit_namespace_defNormalProp(a,prop,b[prop]);if(edit_namespace_getOwnPropSymbols)for(var prop of edit_namespace_getOwnPropSymbols(b))edit_namespace_propIsEnum.call(b,prop)&&edit_namespace_defNormalProp(a,prop,b[prop]);return a},edit_namespace_spreadProps=(a,b)=>edit_namespace_defProps(a,edit_namespace_getOwnPropDescs(b)),edit_namespace_publicField=(obj,key,value)=>(edit_namespace_defNormalProp(obj,typeof key!="symbol"?key+"":key,value),value);class EditNamespace extends react.Component{constructor(props){super(props),edit_namespace_publicField(this,"handleInputChange",event=>{const target=event.target,name=target.name;let value=target.value;this.setState({[name]:value})}),edit_namespace_publicField(this,"handleUpdate",()=>{this.props.updateCurrentNamespace({_id:this.props.namespace._id,description:this.state.description,title:this.state.title,enableTicketing:this.state.enableTicketing,owners:this.state.owners})}),edit_namespace_publicField(this,"handleDelete",()=>{this.props.deleteCurrentNamespace(this.props.namespace._id,this.props.history)}),edit_namespace_publicField(this,"close",()=>{this.setState({showModal:!1})}),edit_namespace_publicField(this,"closeDeleteModal",()=>{this.setState({showDeleteModal:!1})}),edit_namespace_publicField(this,"closeCreateCohortModal",()=>{this.setState({showCreateCohortModal:!1})}),edit_namespace_publicField(this,"closeImportModal",()=>{this.setState({showImportModal:!1})}),edit_namespace_publicField(this,"createCohort",cohort2=>{cohort2.namespaceID=this.props.namespace._id,this.props.createCohort(cohort2,this.props.namespace._id),this.closeCreateCohortModal()}),edit_namespace_publicField(this,"deleteCohort",cohortID=>{this.props.deleteCohort(cohortID,this.props.namespace._id)}),edit_namespace_publicField(this,"updateCohort",cohort2=>{this.props.updateCohort(cohort2,this.props.namespace._id)}),edit_namespace_publicField(this,"handleOwnerChange",newValue=>{if(!newValue)return this.setState({owners:[]});const owners2=newValue.map(x=>trim_lib_default()(x.value));this.setState({owners:owners2})}),edit_namespace_publicField(this,"closeEditCohortModal",()=>{this.setState({selectedCohort:null,showEditCohortModal:!1})}),edit_namespace_publicField(this,"cohortModalFactory",idx=>()=>{this.setState({selectedCohort:this.props.cohorts[idx],showEditCohortModal:!0})});let{title,description,owners,enableTicketing}=this.props.namespace;is_array_lib_default()(owners)&&(owners=owners.map(owner=>owner.email)),this.state={title,description,owners,enableTicketing,showDeleteModal:!1,showImportModal:!1,showCreateCohortModal:!1,showEditCohortModal:!1,selectedCohort:null,lessonRefs:[]}}componentDidMount(){axios_default().post(`${constants_server.ZP}/completion_refs`,{target:"lesson",entities:this.props.namespace.lessons.map(x=>x._id)}).then(response=>{this.setState({lessonRefs:response.data})}).catch(err=>{console.log("Error fetching completion refs:",err)})}renderModals(){const{t}=this.props;return react.createElement(react.Fragment,null,react.createElement(message_modal,{show:this.state.showModal,close:this.close,message:this.state.message,successful:this.state.successful,title:t("update-course")}),react.createElement(confirm_modal.Z,{show:this.state.showDeleteModal,close:this.closeDeleteModal,message:t("delete-course"),title:`${t("delete")}?`,onConfirm:this.handleDelete}),this.state.showCreateCohortModal?react.createElement(create_cohort_modal,{show:this.state.showCreateCohortModal,close:this.closeCreateCohortModal,onCreate:this.createCohort,t:this.props.t}):null,this.state.showImportModal?react.createElement(import_course_modal,{show:this.state.showImportModal,close:this.closeImportModal,namespaces:this.props.user.ownedNamespaces,targetNamespace:this.props.namespace,copyNamespaceLessons:this.props.copyNamespaceLessons,t:this.props.t}):null,this.state.showEditCohortModal?react.createElement(edit_cohort_modal,edit_namespace_spreadProps(edit_namespace_spreadValues({show:this.state.showEditCohortModal},this.state.selectedCohort),{onDelete:this.deleteCohort,onHide:this.closeEditCohortModal,onUpdate:this.updateCohort,t:this.props.t})):null)}renderCohortList(){const{t}=this.props;return react.createElement(ListGroup_default(),null,this.props.cohorts.map((cohort2,idx)=>react.createElement(ListGroupItem_default(),{variant:"light",eventKey:idx,key:idx,style:{backgroundColor:"white"}},react.createElement("label",null,cohort2.title),react.createElement("span",{style:{marginLeft:5,color:"black"}},"(",t("no-students"),":"),react.createElement(Badge_default(),{bg:"primary"},cohort2.members.length),react.createElement("span",{style:{color:"black"}},")"),react.createElement(Button_default(),{size:"sm",onClick:this.cohortModalFactory(idx),style:{float:"right"}},t("common:edit")))))}render(){const{t}=this.props;if(!this.props.namespace._id)return react.createElement(Container_default(),{className:"edit-namespace-container"},react.createElement(Alert_default(),{variant:"danger"},t("common:no-course-selected")));const validTitle=(0,create_namespace.uq)(this.state.title),invalidTitleChars=(0,check_url_path.Z)(this.state.title),validDescription=(0,create_namespace.O5)(this.state.description),validOwners=(0,create_namespace.OT)(this.state.owners);return react.createElement(Container_default(),{className:"edit-namespace-container"},react.createElement(Row_default(),null,react.createElement(Col.default,{sm:9},react.createElement(Card_default(),null,react.createElement(Tabs_default(),{defaultActiveKey:"manage-cohorts"},react.createElement(Tab_default(),{eventKey:"manage-cohorts",title:react.createElement("h3",null,t("manage-cohorts")),style:{padding:12}},this.renderCohortList(),react.createElement(Button_default(),{size:"small",variant:"success",style:{marginTop:10,background:"#3c763d"},onClick:()=>{this.setState({showCreateCohortModal:!0})}},t("create-cohort"))),react.createElement(Tab_default(),{eventKey:"completions",title:react.createElement("h3",null,t("completions"))},react.createElement(visible_completions,{entity:this.props.namespace,level:"namespace",cohorts:this.props.cohorts,lessonRefs:this.state.lessonRefs})),react.createElement(Tab_default(),{eventKey:"edit-course",title:react.createElement("h3",null,t("edit-course")),style:{padding:12}},react.createElement(Form_default(),{style:{padding:"20px"},className:"d-grid gap-3"},react.createElement(OverlayTrigger_default(),{placement:"right",overlay:react.createElement(Tooltip_default(),{id:"ownerTooltip"},t("owner-tooltip"))},react.createElement(FormGroup_default(),null,react.createElement(FormLabel_default(),{htmlFor:"owners-text-select"},t("common:owners")),react.createElement(text_select.Z,{id:"owners-text-select",placeholder:t("enter-emails"),onChange:this.handleOwnerChange,defaultValue:this.state.owners,isInvalid:!(0,create_namespace.OT)(this.state.owners)}),react.createElement(FormControl_default().Feedback,{type:"invalid"},t("invalid-owners")))),react.createElement(OverlayTrigger_default(),{placement:"right",overlay:react.createElement(Tooltip_default(),{id:"courseTooltip"},t("accessible-at"),react.createElement("code",null,constants_server.ZP+"/<course>/<lesson>"))},react.createElement(FormGroup_default(),{controlId:"form-course"},react.createElement(FormLabel_default(),null,t("course-identifier")),react.createElement(FormControl_default(),{name:"title",type:"text",value:this.state.title,onChange:this.handleInputChange,isInvalid:!validTitle}),react.createElement(FormControl_default().Feedback,{type:"invalid"},invalidTitleChars?"Course identifier contains invalid character(s): "+invalidTitleChars[0]:"Course identifier must be at least three characters long and should not contain any spaces."))),react.createElement(OverlayTrigger_default(),{placement:"right",overlay:react.createElement(Tooltip_default(),{id:"titleTooltip"},t("title-tooltip"))},react.createElement(FormGroup_default(),{controlId:"form-description"},react.createElement(FormLabel_default(),null,t("title-description")),react.createElement(FormControl_default(),{name:"description",type:"text",value:this.state.description,onChange:this.handleInputChange,isInvalid:!validDescription}),react.createElement(FormControl_default().Feedback,{type:"invalid"},t("invalid-description")))),react.createElement(Form_default().Check,{"aria-label":t("enable-ticketing"),type:"checkbox",label:t("enable-ticketing"),defaultChecked:this.state.enableTicketing,onChange:event=>{this.setState({enableTicketing:event.target.checked})}})),react.createElement(Button_default(),{type:"submit",disabled:!validOwners||!validTitle||!validDescription,onClick:this.handleUpdate},t("common:update")),this.renderModals()),react.createElement(Tab_default(),{eventKey:"permissions",title:react.createElement("h3",null,t("permissions")),disabled:!0})))),react.createElement(Col.default,{sm:3},react.createElement(Card_default(),null,react.createElement(Card_default().Body,null,react.createElement(ButtonGroup_default(),{vertical:!0},react.createElement(Button_default(),{onClick:()=>{this.setState({showImportModal:!0})},variant:"outline-danger"},t("import-existing-course")),react.createElement(Button_default(),{onClick:()=>{this.setState({showDeleteModal:!0})},variant:"outline-danger"},t("delete-namespace"))))))))}}EditNamespace.propTypes={addNotification:prop_types_default().func.isRequired,cohorts:prop_types_default().array,copyNamespaceLessons:prop_types_default().func.isRequired,createCohort:prop_types_default().func.isRequired,deleteCohort:prop_types_default().func.isRequired,deleteCurrentNamespace:prop_types_default().func.isRequired,history:prop_types_default().object.isRequired,namespace:prop_types_default().object.isRequired,t:prop_types_default().func.isRequired,updateCohort:prop_types_default().func.isRequired,updateCurrentNamespace:prop_types_default().func.isRequired,user:prop_types_default().object.isRequired},EditNamespace.defaultProps={cohorts:[]};var edit_namespace=(0,commonjs.Zh)(["namespace","common"])(EditNamespace),cohort=__webpack_require__(72371),namespace=__webpack_require__(23218),lesson=__webpack_require__(36189);function visible_edit_namespace_mapStateToProps(state){return{user:state.user,namespace:state.namespace,cohorts:state.namespace.cohorts}}function visible_edit_namespace_mapDispatchToProps(dispatch){return{addNotification:(0,notification.pP)(dispatch),createCohort:(0,cohort.CA)(dispatch),deleteCohort:(0,cohort.p6)(dispatch),updateCohort:(0,cohort.nm)(dispatch),deleteCurrentNamespace:(0,namespace.kC)(dispatch),updateCurrentNamespace:(0,namespace.J3)(dispatch),copyNamespaceLessons:(0,lesson.Ao)(dispatch)}}var visible_edit_namespace=(0,lib.connect)(visible_edit_namespace_mapStateToProps,visible_edit_namespace_mapDispatchToProps)(edit_namespace)}}]);

//# sourceMappingURL=1835.924b681b.chunk.js.map