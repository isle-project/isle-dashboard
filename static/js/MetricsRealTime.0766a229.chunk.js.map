{"version":3,"sources":["../node_modules/@isle-project/components/metrics/realtime/main.js"],"names":["debug","logger","RealTimeMetrics","state","actions","this","_isMounted","session","context","props","for","unsubscribe","subscribe","type","action","MEMBER_ACTION","FOCUS_ELEMENT","LOSE_FOCUS_ELEMENT","idx","indexOf","id","slice","push","returnFullObject","value","setState","JSON","stringify","onData","onDatum","length","forceUpdate","Component","defaultProps","contextType","SessionContext"],"mappings":"qPAYMA,EAAQC,IAAQ,0BAahBC,E,0CACL,aAAe,IAAD,yBACb,gBACKC,MAAQ,CACZC,QAAS,IAHG,E,gDAOd,WAAqB,IAAD,OACnBC,KAAKC,YAAa,EAClB,IAAMC,EAAUF,KAAKG,QAChBD,IACJP,EAAO,sCAAsCK,KAAKI,MAAMC,KACxDL,KAAKM,YAAcJ,EAAQK,WAAW,SAAEC,EAAMC,GAC7C,GAAKD,IAASE,KAAgB,CAC7B,GAAKD,EAAOD,OAASG,MAAiBF,EAAOD,OAASI,KACrD,OAAO,KAER,IAAMC,EAAMC,IAAS,EAAKV,MAAMC,IAAKI,EAAOM,IAC5C,IAAc,IAATF,EAAa,CACjB,IAAId,EAAU,EAAKD,MAAMC,QAAQiB,QACjCjB,EAAQkB,KAAM,EAAKb,MAAMc,iBAAmBT,EAASA,EAAOU,OAC5D,EAAKC,SAAS,CACbrB,YACE,WACFJ,EAAO,gDAAkD0B,KAAKC,UAAW,EAAKxB,MAAMC,UACpF,EAAKK,MAAMmB,OAAQ,EAAKzB,MAAMC,QAASc,GACvC,EAAKT,MAAMoB,QAAS,EAAK1B,MAAMC,QAAS,EAAKD,MAAMC,QAAQ0B,OAAO,GAAKZ,OAIrE,EAAKZ,YACT,EAAKyB,oB,kCAMT,WACC1B,KAAKC,YAAa,EACbD,KAAKM,aAAcN,KAAKM,gB,oBAG9B,WACC,OACC,gC,GA7C2BqB,aAqD9B9B,EAAgB+B,aAAe,CAC9BL,OAD8B,aAE9BC,QAF8B,aAG9BN,kBAAkB,GAUnBrB,EAAgBgC,YAAcC,IAK9B","file":"static/js/MetricsRealTime.0766a229.chunk.js","sourcesContent":["// MODULES //\n\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport logger from 'debug';\nimport indexOf from '@stdlib/utils/index-of';\nimport SessionContext from '@isle-project/session/context.js';\nimport { FOCUS_ELEMENT, LOSE_FOCUS_ELEMENT, MEMBER_ACTION } from '@isle-project/constants/events.js';\n\n\n// VARIABLES //\n\nconst debug = logger( 'isle:real-time-metrics' );\n\n\n// MAIN //\n\n/**\n* Invisible component listening to incoming member actions and invoking a given callback.\n*\n* @property {string} for - ID of component whose actions should trigger callback(s)\n* @property {Function} onData - callback function called with an array of all actions when a new member action arrives\n* @property {Function} onDatum - callback function invoked with every individual incoming member action\n* @property {boolean} returnFullObject - controls whether to invoke the supplied callback(s) with the full action object or only its value\n*/\nclass RealTimeMetrics extends Component {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.state = {\n\t\t\tactions: []\n\t\t};\n\t}\n\n\tcomponentDidMount() {\n\t\tthis._isMounted = true;\n\t\tconst session = this.context;\n\t\tif ( session ) {\n\t\t\tdebug( 'Listening for all actions with id: '+this.props.for );\n\t\t\tthis.unsubscribe = session.subscribe( ( type, action ) => {\n\t\t\t\tif ( type === MEMBER_ACTION ) {\n\t\t\t\t\tif ( action.type === FOCUS_ELEMENT || action.type === LOSE_FOCUS_ELEMENT ) {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t\tconst idx = indexOf( this.props.for, action.id );\n\t\t\t\t\tif ( idx !== -1 ) {\n\t\t\t\t\t\tlet actions = this.state.actions.slice();\n\t\t\t\t\t\tactions.push( this.props.returnFullObject ? action : action.value );\n\t\t\t\t\t\tthis.setState({\n\t\t\t\t\t\t\tactions\n\t\t\t\t\t\t}, () => {\n\t\t\t\t\t\t\tdebug( 'A new value for the given IDs was submitted: ' + JSON.stringify( this.state.actions ) );\n\t\t\t\t\t\t\tthis.props.onData( this.state.actions, idx );\n\t\t\t\t\t\t\tthis.props.onDatum( this.state.actions[ this.state.actions.length-1 ], idx );\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif ( this._isMounted ) {\n\t\t\t\t\tthis.forceUpdate();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\tthis._isMounted = false;\n\t\tif ( this.unsubscribe ) this.unsubscribe();\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<div></div>\n\t\t);\n\t}\n}\n\n\n// PROPERTIES //\n\nRealTimeMetrics.defaultProps = {\n\tonData() {},\n\tonDatum() {},\n\treturnFullObject: false\n};\n\nRealTimeMetrics.propTypes = {\n\tfor: PropTypes.array.isRequired,\n\tonData: PropTypes.func,\n\tonDatum: PropTypes.func,\n\treturnFullObject: PropTypes.bool\n};\n\nRealTimeMetrics.contextType = SessionContext;\n\n\n// EXPORTS //\n\nexport default RealTimeMetrics;\n"],"sourceRoot":""}