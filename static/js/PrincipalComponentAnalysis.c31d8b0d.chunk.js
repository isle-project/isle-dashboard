"use strict";(self.webpackChunkisle_dashboard=self.webpackChunkisle_dashboard||[]).push([[6588],{75002:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(45254),prop_types__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(45697),prop_types__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_8__),react_bootstrap_Alert__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(24032),react_bootstrap_Alert__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(react_bootstrap_Alert__WEBPACK_IMPORTED_MODULE_7__),ml_pca__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(11708),react_i18next__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(81468),_isle_project_components_table__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(63393),_stdlib_array_incrspace__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(26658),_stdlib_array_incrspace__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_stdlib_array_incrspace__WEBPACK_IMPORTED_MODULE_3__),_isle_project_components_plotly__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(1846),_isle_project_utils_prop_check__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(25048),_isle_project_utils_is_non_missing_number__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(35865),__defProp=Object.defineProperty,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp.call(b,prop)&&__defNormalProp(a,prop,b[prop]);if(__getOwnPropSymbols)for(var prop of __getOwnPropSymbols(b))__propIsEnum.call(b,prop)&&__defNormalProp(a,prop,b[prop]);return a};const summaryTable=(stdev,variance,cumVariance,t)=>react__WEBPACK_IMPORTED_MODULE_0__.createElement(_isle_project_components_table__WEBPACK_IMPORTED_MODULE_2__.Z,{bordered:!0,size:"sm"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("thead",null,react__WEBPACK_IMPORTED_MODULE_0__.createElement("tr",null,react__WEBPACK_IMPORTED_MODULE_0__.createElement("th",null),react__WEBPACK_IMPORTED_MODULE_0__.createElement("th",null,t("standard-deviation")),react__WEBPACK_IMPORTED_MODULE_0__.createElement("th",null,t("proportion-of-variance")),react__WEBPACK_IMPORTED_MODULE_0__.createElement("th",null,t("cumulative-variance")))),react__WEBPACK_IMPORTED_MODULE_0__.createElement("tbody",null,stdev.map((val,id)=>react__WEBPACK_IMPORTED_MODULE_0__.createElement("tr",{key:id},react__WEBPACK_IMPORTED_MODULE_0__.createElement("th",null," ",`PC${id+1}`," "),react__WEBPACK_IMPORTED_MODULE_0__.createElement("td",null," ",val.toFixed(3)," "),react__WEBPACK_IMPORTED_MODULE_0__.createElement("td",null," ",variance[id].toFixed(3)," "),react__WEBPACK_IMPORTED_MODULE_0__.createElement("td",null," ",cumVariance[id].toFixed(3)," "))))),fitModel=({data,variables,scale,center,noComponents})=>{try{const matrix=[],n=data[variables[0]].length;for(let i=0;i<n;i++){const row=[];let missing=!1;for(let j=0;j<variables.length;j++){const val=data[variables[j]][i];if((0,_isle_project_utils_is_non_missing_number__WEBPACK_IMPORTED_MODULE_6__.Z)(val))row.push(val);else{missing=!0;break}}missing||matrix.push(row)}const pca=new ml_pca__WEBPACK_IMPORTED_MODULE_1__._(matrix,{center,scale}),components=pca.predict(matrix,{noComponents});return{pca,components}}catch(_){return{}}};class PrincipalComponentAnalysis extends react__WEBPACK_IMPORTED_MODULE_0__.Component{constructor(props){super(props);const{data,variables,scale,center,noComponents}=props,{pca,components}=fitModel({data,variables,scale,center,noComponents});this.state=__spreadValues({pca,components},props),pca&&props.onResult(this.state.pca,this.state.components)}static getDerivedStateFromProps(nextProps,prevState){if(nextProps.data!==prevState.data||nextProps.variables!==prevState.variables){const{data,variables,scale,center,noComponents}=nextProps,newState=__spreadValues(__spreadValues({},fitModel({data,variables,scale,center,noComponents})),nextProps);return newState.pca&&nextProps.onResult(newState.pca,newState.components),newState}return null}render(){const{pca}=this.state,{t}=this.props;if(!pca)return react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_bootstrap_Alert__WEBPACK_IMPORTED_MODULE_7___default(),{variant:"danger"},t("missing-attributes"));const stdev=pca.getStandardDeviations(),variance=pca.getExplainedVariance(),cumVariance=pca.getCumulativeVariance(),trace={x:_stdlib_array_incrspace__WEBPACK_IMPORTED_MODULE_3___default()(0,variance.length,1),y:variance,type:"scatter",name:t("proportion-of-variance")};return react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{style:{overflowX:"auto",width:"100%"}},react__WEBPACK_IMPORTED_MODULE_0__.createElement("span",{className:"title"},t("pca-summary")),summaryTable(stdev,variance,cumVariance,t),react__WEBPACK_IMPORTED_MODULE_0__.createElement(_isle_project_components_plotly__WEBPACK_IMPORTED_MODULE_4__.Z,{editable:!0,data:[trace],layout:{xaxis:{title:t("principal-component")},yaxis:{title:t("explained-proportion")}}}))}}PrincipalComponentAnalysis.defaultProps={center:!0,scale:!1,noComponents:0,onResult(){}},PrincipalComponentAnalysis.propTypes={data:prop_types__WEBPACK_IMPORTED_MODULE_8___default().object.isRequired,variables:prop_types__WEBPACK_IMPORTED_MODULE_8___default().arrayOf(prop_types__WEBPACK_IMPORTED_MODULE_8___default().string).isRequired,center:prop_types__WEBPACK_IMPORTED_MODULE_8___default().bool,scale:prop_types__WEBPACK_IMPORTED_MODULE_8___default().bool,noComponents:prop_types__WEBPACK_IMPORTED_MODULE_8___default().number,onResult:prop_types__WEBPACK_IMPORTED_MODULE_8___default().func},__webpack_exports__.default=(0,react_i18next__WEBPACK_IMPORTED_MODULE_9__.Zh)("models")((0,_isle_project_utils_prop_check__WEBPACK_IMPORTED_MODULE_5__.W)(PrincipalComponentAnalysis))},11708:function(__unused_webpack_module,exports,__webpack_require__){var __webpack_unused_export__;__webpack_unused_export__={value:!0};var mlMatrix=__webpack_require__(78406);class PCA{constructor(dataset,options={}){if(dataset===!0){const model=options;this.center=model.center,this.scale=model.scale,this.means=model.means,this.stdevs=model.stdevs,this.U=mlMatrix.Matrix.checkMatrix(model.U),this.S=model.S,this.R=model.R,this.excludedFeatures=model.excludedFeatures||[];return}dataset=new mlMatrix.Matrix(dataset);const{isCovarianceMatrix=!1,method="SVD",nCompNIPALS=2,center=!0,scale=!1,ignoreZeroVariance=!1}=options;if(this.center=center,this.scale=scale,this.means=null,this.stdevs=null,this.excludedFeatures=[],isCovarianceMatrix){this._computeFromCovarianceMatrix(dataset);return}switch(this._adjust(dataset,ignoreZeroVariance),method){case"covarianceMatrix":{const covarianceMatrix=new mlMatrix.MatrixTransposeView(dataset).mmul(dataset).div(dataset.rows-1);this._computeFromCovarianceMatrix(covarianceMatrix);break}case"NIPALS":{this._computeWithNIPALS(dataset,nCompNIPALS);break}case"SVD":{const svd=new mlMatrix.SVD(dataset,{computeLeftSingularVectors:!1,computeRightSingularVectors:!0,autoTranspose:!0});this.U=svd.rightSingularVectors;const singularValues=svd.diagonal,eigenvalues=[];for(const singularValue of singularValues)eigenvalues.push(singularValue*singularValue/(dataset.rows-1));this.S=eigenvalues;break}default:throw new Error(`unknown method: ${method}`)}}static load(model){if(typeof model.name!="string")throw new TypeError("model must have a name property");if(model.name!=="PCA")throw new RangeError(`invalid model: ${model.name}`);return new PCA(!0,model)}predict(dataset,options={}){const{nComponents=this.U.columns}=options;if(dataset=new mlMatrix.Matrix(dataset),this.center&&(dataset.subRowVector(this.means),this.scale)){for(let i of this.excludedFeatures)dataset.removeColumn(i);dataset.divRowVector(this.stdevs)}let predictions=dataset.mmul(this.U);return predictions.subMatrix(0,predictions.rows-1,0,nComponents-1)}invert(dataset){dataset=mlMatrix.Matrix.checkMatrix(dataset);let inverse=dataset.mmul(this.U.transpose());return this.center&&(this.scale&&inverse.mulRowVector(this.stdevs),inverse.addRowVector(this.means)),inverse}getExplainedVariance(){let sum=0;for(const s of this.S)sum+=s;return this.S.map(value=>value/sum)}getCumulativeVariance(){let explained=this.getExplainedVariance();for(let i=1;i<explained.length;i++)explained[i]+=explained[i-1];return explained}getEigenvectors(){return this.U}getEigenvalues(){return this.S}getStandardDeviations(){return this.S.map(x=>Math.sqrt(x))}getLoadings(){return this.U.transpose()}toJSON(){return{name:"PCA",center:this.center,scale:this.scale,means:this.means,stdevs:this.stdevs,U:this.U,S:this.S,excludedFeatures:this.excludedFeatures}}_adjust(dataset,ignoreZeroVariance){if(this.center){const mean=dataset.mean("column"),stdevs=this.scale?dataset.standardDeviation("column",{mean}):null;if(this.means=mean,dataset.subRowVector(mean),this.scale){for(let i=0;i<stdevs.length;i++)if(stdevs[i]===0)if(ignoreZeroVariance)dataset.removeColumn(i),stdevs.splice(i,1),this.excludedFeatures.push(i),i--;else throw new RangeError(`Cannot scale the dataset (standard deviation is zero at index ${i}`);this.stdevs=stdevs,dataset.divRowVector(stdevs)}}}_computeFromCovarianceMatrix(dataset){const evd=new mlMatrix.EVD(dataset,{assumeSymmetric:!0});this.U=evd.eigenvectorMatrix,this.U.flipRows(),this.S=evd.realEigenvalues,this.S.reverse()}_computeWithNIPALS(dataset,nCompNIPALS){this.U=new mlMatrix.Matrix(nCompNIPALS,dataset.columns),this.S=[];let x=dataset;for(let i=0;i<nCompNIPALS;i++){let dc=new mlMatrix.NIPALS(x);this.U.setRow(i,dc.w.transpose()),this.S.push(Math.pow(dc.s.get(0,0),2)),x=dc.xResidual}this.U=this.U.transpose()}}exports._=PCA}}]);

//# sourceMappingURL=PrincipalComponentAnalysis.c31d8b0d.chunk.js.map