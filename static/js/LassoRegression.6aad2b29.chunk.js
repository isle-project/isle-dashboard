"use strict";(self.webpackChunkisle_dashboard=self.webpackChunkisle_dashboard||[]).push([[5474],{97343:function(module,__unused_webpack_exports,__webpack_require__){var isArrayArray=__webpack_require__(10558);module.exports=isArrayArray},10558:function(module,__unused_webpack_exports,__webpack_require__){var arrayfun=__webpack_require__(38478),isArray=__webpack_require__(76266),isArrayArray=arrayfun(isArray);module.exports=isArrayArray},71330:function(module,__unused_webpack_exports,__webpack_require__){var setNonEnumerableProperty=__webpack_require__(850);module.exports=setNonEnumerableProperty},850:function(module,__unused_webpack_exports,__webpack_require__){var defineProperty=__webpack_require__(85288);function setNonEnumerableProperty(obj,prop,value){defineProperty(obj,prop,{configurable:!0,enumerable:!1,writable:!0,value})}module.exports=setNonEnumerableProperty},1969:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:function(){return main}});var react=__webpack_require__(45254),prop_types=__webpack_require__(45697),prop_types_default=__webpack_require__.n(prop_types),commonjs=__webpack_require__(81468),Alert=__webpack_require__(24032),Alert_default=__webpack_require__.n(Alert),lib=__webpack_require__(61635),lib_default=__webpack_require__.n(lib),is_number_lib=__webpack_require__(91317),is_number_lib_default=__webpack_require__.n(is_number_lib),Button=__webpack_require__(30276),Button_default=__webpack_require__.n(Button),tooltip=__webpack_require__(77287),table=__webpack_require__(63393),is_array_like_lib=__webpack_require__(33283),is_array_like_lib_default=__webpack_require__.n(is_array_like_lib);function multiply(arr,x){const isArr=is_array_like_lib_default()(x);if(!is_array_like_lib_default()(arr))throw new TypeError("invalid input argument. Must provide an array. Value: `"+arr+"`.");if(!isArr&&!(0,is_number_lib.isPrimitive)(x))throw new TypeError("invalid input argument. Second argument must either be an array or number primitive. Value: `"+x+"`.");const len=arr.length,out=new Array(len);if(isArr){if(len!==x.length)throw new Error("invalid input argument. Array to be multiplied must have a length equal to that of the input array.");for(let i=0;i<len;i++)out[i]=arr[i]*x[i]}else for(let i=0;i<len;i++)out[i]=arr[i]*x;return out}var utils_multiply=multiply,mean=__webpack_require__(73306),stdev=__webpack_require__(43073),define_nonenumerable_property_lib=__webpack_require__(71330),define_nonenumerable_property_lib_default=__webpack_require__.n(define_nonenumerable_property_lib);function zScore(x,demean=!0,scale=!0){const avg=(0,mean.Z)(x),sd=(0,stdev.Z)(x),len=x.length,out=new Array(len);if(demean)if(scale)for(let i=0;i<len;i++)out[i]=(x[i]-avg)/sd;else for(let i=0;i<len;i++)out[i]=x[i]-avg;else if(scale)for(let i=0;i<len;i++)out[i]=x[i]/sd;else out=x.slice();return define_nonenumerable_property_lib_default()(out,"mu",avg),define_nonenumerable_property_lib_default()(out,"sigma",sd),out}var zscore=zScore,prop_check=__webpack_require__(25048),factor_variable=__webpack_require__(93199),is_array_lib=__webpack_require__(76266),is_array_lib_default=__webpack_require__.n(is_array_lib),count_by_lib=__webpack_require__(85821),count_by_lib_default=__webpack_require__.n(count_by_lib),identity_function_lib=__webpack_require__(52724),identity_function_lib_default=__webpack_require__.n(identity_function_lib),keys_lib=__webpack_require__(25351),keys_lib_default=__webpack_require__.n(keys_lib),sqrt_lib=__webpack_require__(26680),sqrt_lib_default=__webpack_require__.n(sqrt_lib);function designMatrix(x,data,quantitative,intercept){is_array_lib_default()(x)||(x=[x]);const matrix=[],predictors=[],hash={},standardized={},categoricalStats={},nobs=data[x[0]].length;for(let j=0;j<x.length;j++)if(lib_default()(quantitative,x[j])){const values=zscore(data[x[j]]);standardized[x[j]]=values,predictors.push(x[j])}else{const values=data[x[j]],counts=count_by_lib_default()(values,identity_function_lib_default()),categories=x[j].categories||keys_lib_default()(counts);for(let k=intercept?1:0;k<categories.length;k++){const label=`${x[j]}_${categories[k]}`;predictors.push(label);const p=counts[categories[k]]/nobs;categoricalStats[label]={mu:p,sigma:sqrt_lib_default()(p*(1-p))}}hash[x[j]]=categories}for(let i=0;i<nobs;i++){const row=[];intercept&&row.push(1);for(let j=0;j<x.length;j++)if(lib_default()(quantitative,x[j])){const values=standardized[x[j]];row.push(values[i])}else{const values=data[x[j]],categories=hash[x[j]],val=values[i];for(let k=intercept?1:0;k<categories.length;k++){const{mu,sigma}=categoricalStats[`${x[j]}_${categories[k]}`];row.push(val===categories[k]?(1-mu)/sigma:-mu/sigma)}}matrix.push(row)}return{matrix,predictors,categoricalStats,standardized}}var design_matrix=designMatrix,browser=__webpack_require__(14946),browser_default=__webpack_require__.n(browser),incrspace_lib=__webpack_require__(26658),incrspace_lib_default=__webpack_require__.n(incrspace_lib),signum_lib=__webpack_require__(52650),signum_lib_default=__webpack_require__.n(signum_lib),is_array_array_lib=__webpack_require__(97343),is_array_array_lib_default=__webpack_require__.n(is_array_array_lib),is_matrix_like_lib=__webpack_require__(71840),is_matrix_like_lib_default=__webpack_require__.n(is_matrix_like_lib),ctor_lib=__webpack_require__(68365),ctor_lib_default=__webpack_require__.n(ctor_lib),array_lib=__webpack_require__(40083),array_lib_default=__webpack_require__.n(array_lib),abs_lib=__webpack_require__(28549),abs_lib_default=__webpack_require__.n(abs_lib),mmult=__webpack_require__(97193),transpose=__webpack_require__(88837),subtract=__webpack_require__(93040);function divide(arr,x,opts){const isArr=is_array_like_lib_default()(x);if(!is_array_like_lib_default()(arr))throw new TypeError("invalid input argument. Must provide an array. Value: `"+arr+"`.");if(!isArr&&!(0,is_number_lib.isPrimitive)(x))throw new TypeError("invalid input argument. Second argument must either be an array or number primitive. Value: `"+x+"`.");const len=arr.length,out=new Array(len);if(isArr){if(len!==x.length)throw new Error("invalid input argument. Array to be divided must have a length equal to that of the input array.");for(let i=0;i<len;i++)out[i]=arr[i]/x[i]}else for(let i=0;i<len;i++)out[i]=arr[i]/x;return out}var utils_divide=divide;function dotm(x,y,j){let ret=0;const nRows=x.shape[0];for(let i=0;i<nRows;i++){const xVal=x.get(i,j),yVal=y.get(i,j);xVal!==0&&yVal!==0&&(ret+=xVal*yVal)}return ret}var lasso_regression_dotm=dotm;function dotv(x,y){const len=x.length;let sum=0;for(let i=0;i<len;i++)sum+=x[i]*y[i];return sum}var lasso_regression_dotv=dotv;function softThresholding(x,t){return x>t?x-t:x<-t?x+t:0}var soft_thresholding=softThresholding;const debug=browser_default()("isle:lasso"),PRECISION=1e-9,mget=(x,j)=>{const out=new Float64Array(x.shape[0]);for(let i=0;i<out.length;i++)out[i]=x.get(i,j);return out};function LassoFit(y,x,lambda){this.y=y,this.x=x,this.lambda=lambda,this.N=x.shape[0],this.p=x.shape[1],this.beta=new Float64Array(this.p),this.betast=new Float64Array(this.p),this.active=incrspace_lib_default()(0,this.beta.length,1),this.nonactive=[],this.presid=ctor_lib_default()("float64",new Float64Array(x._buffer.length),x.shape,x.strides,x.offset,x.order),this.init=()=>{this.iteration=0,this.iterate()},this.init()}LassoFit.prototype.testKKT=function(){const beta=this.beta,N=this.N,x=this.x,y=this.y,ymxb=(0,subtract.Z)(y,(0,mmult.Z)(x,beta)),G=utils_divide((0,mmult.Z)((0,transpose.Z)(x),ymxb),N);for(let i=0;i<beta.length;i++)if(beta[i]===0){if(abs_lib_default()(G[i])>this.lambda+PRECISION)return!1}else if(beta[i]>0&&G[i]-this.lambda*signum_lib_default()(beta[i])>PRECISION)return!1;return!0},LassoFit.prototype.testActiveSet=function(){let changed=!1;const{residuals}=this.predict(this.x);for(let j=0;j<this.nonactive.length;j++){const jVal=this.nonactive[j],xj=mget(this.x,jVal);abs_lib_default()(lasso_regression_dotv(xj,residuals))/this.N>this.lambda&&(this.active.push(jVal),this.nonactive.splice(j,1),changed=!0)}return debug("Active set changes..."),changed},LassoFit.prototype.iterate=function(){const N=this.N,p=this.p,x=this.x,y=this.y;if(this.iteration+=1,this.iteration>1e4)return;let converged=!0;for(let j=0;j<this.active.length;j++){const jVal=this.active[j];for(let i=0;i<N;i++){const rval=y[i];for(let k=0;k<p;k++)rval-=jVal!==k?x.get(i,k)*this.beta[k]:0;this.presid.set(i,jVal,rval)}this.betast[jVal]=1/N*lasso_regression_dotm(x,this.presid,jVal);const betaOld=this.beta[jVal],betaNew=soft_thresholding(this.betast[jVal],this.lambda);abs_lib_default()(betaNew-betaOld)>PRECISION&&(converged=!1),this.beta[jVal]=betaNew}for(let j=this.active.length-1;j>=0;j--){const jVal=this.active[j];abs_lib_default()(this.beta[jVal])<PRECISION&&(this.active.splice(j,1),this.nonactive.push(jVal))}converged===!1?this.iterate():this.testActiveSet()&&this.iterate()},LassoFit.prototype.predict=function(x){return is_array_array_lib_default()(x)&&(x=array_lib_default()(x)),(0,mmult.Z)(x,this.beta)};function lasso(x,y,lambda){if(!is_number_lib_default())throw new TypeError("invalid input argument. The third argument must be a number primitive. Value: `"+lambda+"`");if(!is_array_like_lib_default()(y))throw new TypeError("invalid input argument. The second argument must be array-like. Value: `"+y+"`");if(is_array_array_lib_default()(x))x=array_lib_default()(x);else if(!is_matrix_like_lib_default()(x)){const msg="invalid input argument. The first argument must be a matrix or an array-of-arrays. Value: `"+x+"`";throw new TypeError(msg)}return new LassoFit(y,x,lambda)}var lasso_regression_lasso=lasso,__defProp=Object.defineProperty,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp.call(b,prop)&&__defNormalProp(a,prop,b[prop]);if(__getOwnPropSymbols)for(var prop of __getOwnPropSymbols(b))__propIsEnum.call(b,prop)&&__defNormalProp(a,prop,b[prop]);return a},__publicField=(obj,key,value)=>(__defNormalProp(obj,typeof key!="symbol"?key+"":key,value),value);let COUNTER=0;const summaryTable=(x,intercept,result,t)=>react.createElement(table.Z,{bordered:!0,size:"sm"},react.createElement("thead",null,react.createElement("tr",null,react.createElement("th",null,t("predictor")),react.createElement("th",null,t("coefficient")))),react.createElement("tbody",null,intercept?react.createElement("tr",null,react.createElement("th",null,t("intercept")),react.createElement("td",null,result.beta[0].toFixed(6))):null,x.map((name,idx)=>react.createElement("tr",{key:idx},react.createElement("th",null,name),react.createElement("td",null,result.beta[idx+Number(intercept)].toFixed(6)))))),fitModel=({x,y,lambda,data,quantitative,intercept})=>{try{let yvalues=data[y];yvalues=zscore(yvalues,!1,!0);const{matrix,predictors,categoricalStats,standardized}=design_matrix(x,data,quantitative,intercept),result=new lasso_regression_lasso(matrix,yvalues,lambda);if(intercept){let coefSum=0;for(let i=1;i<result.beta.length;i++){const pred=predictors[i-1];lib_default()(quantitative,pred)?(result.beta[i]*=yvalues.sigma/standardized[pred].sigma,coefSum+=result.beta[i]*standardized[pred].mu):(result.beta[i]*=yvalues.sigma/categoricalStats[pred].sigma,coefSum+=result.beta[i]*categoricalStats[pred].mu)}result.beta[0]=yvalues.mu-coefSum}else for(let i=0;i<result.beta.length;i++){const pred=predictors[i];lib_default()(quantitative,pred)?result.beta[i]*=yvalues.sigma/standardized[pred].sigma:result.beta[i]*=yvalues.sigma/categoricalStats[pred].sigma}return{predictors,result,yvalues}}catch(_){return{}}};class LassoRegression extends react.Component{constructor(props){super(props),__publicField(this,"handlePredict",()=>{const predict=data2=>{const{matrix}=design_matrix(this.props.x,data2,this.props.quantitative,this.props.intercept);let fitted=this.state.result.predict(matrix);fitted=utils_multiply(fitted,this.state.yvalues.sigma);const residuals=new Array(fitted.length);for(let i=0;i<fitted.length;i++)residuals[i]=data2[this.props.y][i]-fitted[i];return{fitted,residuals}};this.props.onPredict(predict,COUNTER)}),COUNTER+=1;const{x,y,lambda,data,quantitative,intercept}=props;this.state=__spreadValues(__spreadValues({},fitModel({x,y,lambda,data,quantitative,intercept})),props)}static getDerivedStateFromProps(nextProps,prevState){if(nextProps.data!==prevState.data||nextProps.quantitative!==prevState.quantitative||nextProps.x!==prevState.x||nextProps.y!==prevState.y||nextProps.intercept!==prevState.intercept||nextProps.lambda!==prevState.lambda){const{x,y,lambda,data,quantitative,intercept}=nextProps;return __spreadValues(__spreadValues({},fitModel({x,y,lambda,data,quantitative,intercept})),nextProps)}return null}render(){const{y,intercept,lambda,onPredict,t}=this.props,{result,predictors}=this.state;return result?(0,is_number_lib.isPrimitive)(lambda)?react.createElement("div",{style:{overflowX:"auto",width:"100%"}},react.createElement("span",{className:"title"},t("lasso-title",{y,lambda:lambda.toFixed(4),counter:COUNTER})),summaryTable(predictors,intercept,result,t),react.createElement("p",null,result.testKKT()?t("kkt-satisfied"):t("kkt-not-satisfied")),onPredict?react.createElement(tooltip.Z,{tooltip:t("use-model-to-predict-tooltip")},react.createElement(Button_default(),{variant:"secondary",size:"sm",onClick:this.handlePredict},this.props.t("use-model-to-predict"))):null):react.createElement(Alert_default(),{variant:"danger"},t("lambda-not-number")):react.createElement(Alert_default(),{variant:"danger"},t("missing-attributes"))}}LassoRegression.defaultProps={lambda:.001,intercept:!0,onPredict(){}},LassoRegression.propTypes={data:prop_types_default().object.isRequired,y:prop_types_default().string.isRequired,x:prop_types_default().oneOfType([prop_types_default().arrayOf(prop_types_default().oneOfType([prop_types_default().string,prop_types_default().instanceOf(factor_variable.E)])),prop_types_default().string,prop_types_default().instanceOf(factor_variable.E)]).isRequired,quantitative:prop_types_default().arrayOf(prop_types_default().string).isRequired,lambda:prop_types_default().number,intercept:prop_types_default().bool,onPredict:prop_types_default().func};var main=(0,commonjs.Zh)("models")((0,prop_check.W)(LassoRegression))},97193:function(__unused_webpack_module,__webpack_exports__){function mmult(A,b){const n=A.shape[0],p=A.shape[1];let ret=new Float64Array(n);for(let i=0;i<n;i++){let sum=0;for(let j=0;j<p;j++)sum+=A.get(i,j)*b[j];ret[i]=sum}return ret}__webpack_exports__.Z=mmult},88837:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){var _stdlib_ndarray_ctor__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(68365),_stdlib_ndarray_ctor__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_stdlib_ndarray_ctor__WEBPACK_IMPORTED_MODULE_0__);const transpose=X=>{const shape=[X.shape[1],X.shape[0]],strides=[X.strides[1],X.strides[0]],offset=X.offset,order=X.order;return _stdlib_ndarray_ctor__WEBPACK_IMPORTED_MODULE_0___default()("float64",X._buffer,shape,strides,offset,order)};__webpack_exports__.Z=transpose}}]);

//# sourceMappingURL=LassoRegression.6aad2b29.chunk.js.map