"use strict";(self.webpackChunkisle_dashboard=self.webpackChunkisle_dashboard||[]).push([[3215],{93968:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(45254),prop_types__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__(45697),prop_types__WEBPACK_IMPORTED_MODULE_23___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_23__),react_i18next__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__(81468),ml_regression_multivariate_linear__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(74654),ml_regression_multivariate_linear__WEBPACK_IMPORTED_MODULE_20___default=__webpack_require__.n(ml_regression_multivariate_linear__WEBPACK_IMPORTED_MODULE_20__),react_bootstrap_Alert__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(24032),react_bootstrap_Alert__WEBPACK_IMPORTED_MODULE_21___default=__webpack_require__.n(react_bootstrap_Alert__WEBPACK_IMPORTED_MODULE_21__),react_bootstrap_Button__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__(30276),react_bootstrap_Button__WEBPACK_IMPORTED_MODULE_22___default=__webpack_require__.n(react_bootstrap_Button__WEBPACK_IMPORTED_MODULE_22__),_stdlib_math_base_special_pow__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(66015),_stdlib_math_base_special_pow__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_stdlib_math_base_special_pow__WEBPACK_IMPORTED_MODULE_1__),_stdlib_math_base_special_round__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(55809),_stdlib_math_base_special_round__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_stdlib_math_base_special_round__WEBPACK_IMPORTED_MODULE_2__),_stdlib_stats_base_dists_f_cdf__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(86158),_stdlib_stats_base_dists_f_cdf__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_stdlib_stats_base_dists_f_cdf__WEBPACK_IMPORTED_MODULE_3__),_stdlib_assert_contains__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(61635),_stdlib_assert_contains__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_stdlib_assert_contains__WEBPACK_IMPORTED_MODULE_4__),_stdlib_assert_is_array__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(76266),_stdlib_assert_is_array__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_stdlib_assert_is_array__WEBPACK_IMPORTED_MODULE_5__),_stdlib_math_base_special_abs__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(28549),_stdlib_math_base_special_abs__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(_stdlib_math_base_special_abs__WEBPACK_IMPORTED_MODULE_6__),_stdlib_stats_base_dists_t_cdf__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(4683),_stdlib_stats_base_dists_t_cdf__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(_stdlib_stats_base_dists_t_cdf__WEBPACK_IMPORTED_MODULE_7__),_isle_project_components_table__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(63393),_isle_project_components_tooltip__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(77287),_isle_project_components_plotly__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(1846),_isle_project_components_plots_histogram__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(46667),_isle_project_components_plots_qqplot__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(2780),_isle_project_utils_subtract__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(93040),_isle_project_utils_statistic_mean__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(73306),_isle_project_utils_extract_categories_from_values__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(99375),_isle_project_utils_prop_check__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(25048),_isle_project_utils_factor_variable__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(93199),_isle_project_utils_is_non_missing_number__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(35865),_isle_project_utils_is_missing__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(45250),__defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp.call(b,prop)&&__defNormalProp(a,prop,b[prop]);if(__getOwnPropSymbols)for(var prop of __getOwnPropSymbols(b))__propIsEnum.call(b,prop)&&__defNormalProp(a,prop,b[prop]);return a},__spreadProps=(a,b)=>__defProps(a,__getOwnPropDescs(b)),__publicField=(obj,key,value)=>(__defNormalProp(obj,typeof key!="symbol"?key+"":key,value),value);let COUNTER=0;const TSTAT="t",DF="df",R2="R\xB2:";function designMatrix(x,y,data,quantitative,intercept){_stdlib_assert_is_array__WEBPACK_IMPORTED_MODULE_5___default()(x)||(x=[x]);const matrix=[],predictors=[],hash={},nobs=data[x[0]].length;for(let j=0;j<x.length;j++){const values=data[x[j]];if(_stdlib_assert_contains__WEBPACK_IMPORTED_MODULE_4___default()(quantitative,x[j]))predictors.push(x[j]);else{const categories=(0,_isle_project_utils_extract_categories_from_values__WEBPACK_IMPORTED_MODULE_15__.Z)(values,x[j]);for(let k=intercept?1:0;k<categories.length;k++)predictors.push(`${x[j]}_${categories[k]}`);hash[x[j]]=categories}}for(let i=0;i<nobs;i++){const row=[];for(let j=0;j<x.length;j++){const values=data[x[j]];if(_stdlib_assert_contains__WEBPACK_IMPORTED_MODULE_4___default()(quantitative,x[j]))row.push(values[i]);else{const categories=hash[x[j]],val=values[i];for(let k=intercept?1:0;k<categories.length;k++)row.push(val===categories[k]?1:0)}}matrix.push(row)}const yvalues=data[y].map(x2=>[x2]);return{matrix,predictors,yvalues,nobs}}function designMatrixMissing(x,y,data,quantitative,intercept){_stdlib_assert_is_array__WEBPACK_IMPORTED_MODULE_5___default()(x)||(x=[x]);const matrix=[],predictors=[],hash={},yvalues=[];for(let j=0;j<x.length;j++){const values=data[x[j]];if(_stdlib_assert_contains__WEBPACK_IMPORTED_MODULE_4___default()(quantitative,x[j]))predictors.push(x[j]);else{const categories=(0,_isle_project_utils_extract_categories_from_values__WEBPACK_IMPORTED_MODULE_15__.Z)(values,x[j]);for(let k=intercept?1:0;k<categories.length;k++)predictors.push(`${x[j]}_${categories[k]}`);hash[x[j]]=categories}}for(let i=0;i<data[x[0]].length;i++){const row=[];let missing=!1;for(let j=0;j<x.length;j++){const values=data[x[j]];if(_stdlib_assert_contains__WEBPACK_IMPORTED_MODULE_4___default()(quantitative,x[j]))if((0,_isle_project_utils_is_non_missing_number__WEBPACK_IMPORTED_MODULE_18__.Z)(values[i]))row.push(values[i]);else{missing=!0;break}else{const val=values[i];if((0,_isle_project_utils_is_missing__WEBPACK_IMPORTED_MODULE_19__.Z)(val)){missing=!0;break}else{const categories=hash[x[j]];for(let k=intercept?1:0;k<categories.length;k++)row.push(val===categories[k]?1:0)}}}const yval=data[y][i];!missing&&(0,_isle_project_utils_is_non_missing_number__WEBPACK_IMPORTED_MODULE_18__.Z)(yval)&&(matrix.push(row),yvalues.push([yval]))}const nobs=yvalues.length;return{matrix,predictors,yvalues,nobs}}const summaryTable=(y,x,nobs,result,t)=>{const cdf=_stdlib_stats_base_dists_t_cdf__WEBPACK_IMPORTED_MODULE_7___default().factory(nobs-x.length-1);return react__WEBPACK_IMPORTED_MODULE_0__.createElement(_isle_project_components_table__WEBPACK_IMPORTED_MODULE_8__.Z,{bordered:!0,size:"sm"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("thead",null,react__WEBPACK_IMPORTED_MODULE_0__.createElement("tr",null,react__WEBPACK_IMPORTED_MODULE_0__.createElement("th",null,t("predictor")),react__WEBPACK_IMPORTED_MODULE_0__.createElement("th",null,t("coefficient")),react__WEBPACK_IMPORTED_MODULE_0__.createElement("th",null,t("std-error")),react__WEBPACK_IMPORTED_MODULE_0__.createElement("th",null,TSTAT),react__WEBPACK_IMPORTED_MODULE_0__.createElement("th",null,t("p-value")))),react__WEBPACK_IMPORTED_MODULE_0__.createElement("tbody",null,result.intercept?react__WEBPACK_IMPORTED_MODULE_0__.createElement("tr",null,react__WEBPACK_IMPORTED_MODULE_0__.createElement("th",null,t("intercept")),react__WEBPACK_IMPORTED_MODULE_0__.createElement("td",null,result.weights[x.length][0].toFixed(6)),react__WEBPACK_IMPORTED_MODULE_0__.createElement("td",null,result.stdErrors[x.length].toFixed(4)),react__WEBPACK_IMPORTED_MODULE_0__.createElement("td",null,result.tStats[x.length].toFixed(4)),react__WEBPACK_IMPORTED_MODULE_0__.createElement("td",null,2*(1-cdf(_stdlib_math_base_special_abs__WEBPACK_IMPORTED_MODULE_6___default()(result.tStats[x.length]))).toFixed(4))):null,x.map((name,idx)=>react__WEBPACK_IMPORTED_MODULE_0__.createElement("tr",{key:idx},react__WEBPACK_IMPORTED_MODULE_0__.createElement("th",null,name),react__WEBPACK_IMPORTED_MODULE_0__.createElement("td",null,result.weights[idx][0].toFixed(6)),react__WEBPACK_IMPORTED_MODULE_0__.createElement("td",null,result.stdErrors[idx].toFixed(4)),react__WEBPACK_IMPORTED_MODULE_0__.createElement("td",null,result.tStats[idx].toFixed(4)),react__WEBPACK_IMPORTED_MODULE_0__.createElement("td",null,2*(1-cdf(_stdlib_math_base_special_abs__WEBPACK_IMPORTED_MODULE_6___default()(result.tStats[idx]))).toFixed(4))))))},fitModel=({x,y,intercept,omitMissing,data,quantitative})=>{const out={};try{const dMatrix=omitMissing?designMatrixMissing:designMatrix,{matrix,predictors,yvalues,nobs}=dMatrix(x,y,data,quantitative,intercept);out.result=new(ml_regression_multivariate_linear__WEBPACK_IMPORTED_MODULE_20___default())(matrix,yvalues,{intercept});const yhat=out.result.predict(matrix).map(v=>v[0]);out.yhat=yhat;const avgFitted=(0,_isle_project_utils_statistic_mean__WEBPACK_IMPORTED_MODULE_14__.Z)(yhat);let mss=0;for(let i=0;i<yhat.length;i++)mss+=_stdlib_math_base_special_pow__WEBPACK_IMPORTED_MODULE_1___default()(yhat[i]-avgFitted,2);const resid=(0,_isle_project_utils_subtract__WEBPACK_IMPORTED_MODULE_13__.Z)(yvalues,yhat);let rss=0;for(let i=0;i<resid.length;i++)rss+=_stdlib_math_base_special_pow__WEBPACK_IMPORTED_MODULE_1___default()(resid[i],2);const p=predictors.length;return out.resid=resid,out.rSquared=mss/(mss+rss),out.adjRSquared=1-(1-out.rSquared)*(nobs-1)/(nobs-p-1),out.fScore=mss/p/(rss/(nobs-p-1)),out.p=p,out.nobs=nobs,out.predictors=predictors,out}catch(_){return out}};class MultipleLinearRegression extends react__WEBPACK_IMPORTED_MODULE_0__.Component{constructor(props){super(props),__publicField(this,"handleDiagnostics",()=>{const{x:x2,y:y2,intercept:intercept2,t}=this.props,qqPlot=react__WEBPACK_IMPORTED_MODULE_0__.createElement(_isle_project_components_plotly__WEBPACK_IMPORTED_MODULE_10__.Z,__spreadProps(__spreadValues({draggable:!0,editable:!0,fit:!0},(0,_isle_project_components_plots_qqplot__WEBPACK_IMPORTED_MODULE_12__._)(this.state.resid,"residuals")),{meta:{type:"qqplot of regression residuals",x:x2,y:y2,intercept:intercept2}})),hist=react__WEBPACK_IMPORTED_MODULE_0__.createElement(_isle_project_components_plots_histogram__WEBPACK_IMPORTED_MODULE_11__.Z,{data:{Residuals:this.state.resid},variable:"Residuals",title:t("plotly:histogram-title",{x:"Residuals"})}),residualPlot=react__WEBPACK_IMPORTED_MODULE_0__.createElement(_isle_project_components_plotly__WEBPACK_IMPORTED_MODULE_10__.Z,{draggable:!0,editable:!0,fit:!0,data:[{x:this.state.yhat,y:this.state.resid,mode:"markers",type:this.state.yhat.length>2e3?"scattergl":"scatter"}],layout:{xaxis:{title:t("fitted-values")},yaxis:{title:t("residuals")},title:t("residuals-vs-fitted")},meta:{type:"regression residuals vs. fitted",x:x2,y:y2,intercept:intercept2}});this.props.onDiagnostics([qqPlot,hist,residualPlot])}),__publicField(this,"handlePredict",()=>{const{quantitative:quantitative2,intercept:intercept2}=this.props,predict=data2=>{const{x:x2,y:y2}=this.props,{matrix}=designMatrix(x2,y2,data2,quantitative2,intercept2),fitted=this.state.result.predict(matrix).map(v=>v[0]),residuals=(0,_isle_project_utils_subtract__WEBPACK_IMPORTED_MODULE_13__.Z)(data2[y2],fitted);return{fitted,residuals}};this.props.onPredict(predict,COUNTER)}),COUNTER+=1;const{x,y,intercept,omitMissing,data,quantitative}=props;this.state=__spreadValues(__spreadValues({},fitModel({x,y,intercept,omitMissing,data,quantitative})),props)}static getDerivedStateFromProps(nextProps,prevState){if(nextProps.data!==prevState.data||nextProps.quantitative!==prevState.quantitative||nextProps.x!==prevState.x||nextProps.y!==prevState.y||nextProps.omitMissing!==prevState.omitMissing||nextProps.intercept!==prevState.intercept){const{x,y,intercept,omitMissing,data,quantitative}=nextProps;return __spreadValues(__spreadValues({},fitModel({x,y,intercept,omitMissing,data,quantitative})),nextProps)}return null}render(){const{y,predictors,nobs,result,adjRSquared,p,fScore,rSquared}=this.state,{t}=this.props;return result?react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{style:{overflowX:"auto",width:"100%"}},react__WEBPACK_IMPORTED_MODULE_0__.createElement("span",{className:"title"},t("multiple-regression-title",{y,counter:COUNTER})),summaryTable(y,predictors,nobs,result,t),react__WEBPACK_IMPORTED_MODULE_0__.createElement("p",null,t("residual-standard-error"),": ",_stdlib_math_base_special_round__WEBPACK_IMPORTED_MODULE_2___default()(result.stdError)),react__WEBPACK_IMPORTED_MODULE_0__.createElement("p",null,R2," ",rSquared.toFixed(6),", ",t("adjusted")," ",R2," ",adjRSquared.toFixed(6)),react__WEBPACK_IMPORTED_MODULE_0__.createElement("p",null,t("f-statistic"),": ",fScore.toFixed(3)," ($",DF,": ",nobs-p-1,", ",p,"), ",t("p-value"),": ",(1-_stdlib_stats_base_dists_f_cdf__WEBPACK_IMPORTED_MODULE_3___default()(fScore,p,nobs-p-1)).toFixed(6)),this.props.onPredict?react__WEBPACK_IMPORTED_MODULE_0__.createElement(_isle_project_components_tooltip__WEBPACK_IMPORTED_MODULE_9__.Z,{placement:"top",tooltip:t("use-model-to-predict-tooltip")},react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_bootstrap_Button__WEBPACK_IMPORTED_MODULE_22___default(),{variant:"secondary",size:"sm",onClick:this.handlePredict},t("use-model-to-predict"))):null,this.props.onDiagnostics?react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_bootstrap_Button__WEBPACK_IMPORTED_MODULE_22___default(),{variant:"secondary",size:"sm",style:{marginLeft:6},onClick:this.handleDiagnostics},t("model-diagnostics")):null):react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_bootstrap_Alert__WEBPACK_IMPORTED_MODULE_21___default(),{variant:"danger"},this.props.t("missing-attributes"))}}MultipleLinearRegression.defaultProps={omitMissing:!1,intercept:!0,onDiagnostics:null,onPredict:null},MultipleLinearRegression.propTypes={data:prop_types__WEBPACK_IMPORTED_MODULE_23___default().object.isRequired,y:prop_types__WEBPACK_IMPORTED_MODULE_23___default().string.isRequired,x:prop_types__WEBPACK_IMPORTED_MODULE_23___default().oneOfType([prop_types__WEBPACK_IMPORTED_MODULE_23___default().arrayOf(prop_types__WEBPACK_IMPORTED_MODULE_23___default().oneOfType([prop_types__WEBPACK_IMPORTED_MODULE_23___default().string,prop_types__WEBPACK_IMPORTED_MODULE_23___default().instanceOf(_isle_project_utils_factor_variable__WEBPACK_IMPORTED_MODULE_17__.E)])),prop_types__WEBPACK_IMPORTED_MODULE_23___default().string,prop_types__WEBPACK_IMPORTED_MODULE_23___default().instanceOf(_isle_project_utils_factor_variable__WEBPACK_IMPORTED_MODULE_17__.E)]).isRequired,quantitative:prop_types__WEBPACK_IMPORTED_MODULE_23___default().arrayOf(prop_types__WEBPACK_IMPORTED_MODULE_23___default().string).isRequired,omitMissing:prop_types__WEBPACK_IMPORTED_MODULE_23___default().bool,intercept:prop_types__WEBPACK_IMPORTED_MODULE_23___default().bool,onDiagnostics:prop_types__WEBPACK_IMPORTED_MODULE_23___default().func,onPredict:prop_types__WEBPACK_IMPORTED_MODULE_23___default().func},__webpack_exports__.default=(0,react_i18next__WEBPACK_IMPORTED_MODULE_24__.Zh)(["models","plotly"])((0,_isle_project_utils_prop_check__WEBPACK_IMPORTED_MODULE_16__.W)(MultipleLinearRegression))},74654:function(module,__unused_webpack_exports,__webpack_require__){var mlMatrix=__webpack_require__(78406);class MultivariateLinearRegression{constructor(x,y,options={}){const{intercept=!0,statistics=!0}=options;if(this.statistics=statistics,x===!0)this.weights=y.weights,this.inputs=y.inputs,this.outputs=y.outputs,this.intercept=y.intercept;else{x=new mlMatrix.Matrix(x),y=new mlMatrix.Matrix(y),intercept&&x.addColumn(new Array(x.rows).fill(1));let xt=x.transpose();const xx=xt.mmul(x),xy=xt.mmul(y),invxx=new mlMatrix.SVD(xx).inverse(),beta=xy.transpose().mmul(invxx).transpose();if(this.weights=beta.to2DArray(),this.inputs=x.columns,this.outputs=y.columns,intercept&&this.inputs--,this.intercept=intercept,statistics){const fittedValues=x.mmul(beta),variance=y.clone().addM(fittedValues.neg()).to2DArray().map(ri=>Math.pow(ri[0],2)).reduce((a,b)=>a+b)/(y.rows-x.columns);this.stdError=Math.sqrt(variance),this.stdErrorMatrix=mlMatrix.pseudoInverse(xx).mul(variance),this.stdErrors=this.stdErrorMatrix.diagonal().map(d=>Math.sqrt(d)),this.tStats=this.weights.map((d,i)=>this.stdErrors[i]===0?0:d[0]/this.stdErrors[i])}}}predict(x){if(Array.isArray(x)){if(typeof x[0]=="number")return this._predict(x);if(Array.isArray(x[0])){const y=new Array(x.length);for(let i=0;i<x.length;i++)y[i]=this._predict(x[i]);return y}}else if(mlMatrix.Matrix.isMatrix(x)){const y=new mlMatrix.Matrix(x.rows,this.outputs);for(let i=0;i<x.rows;i++)y.setRow(i,this._predict(x.getRow(i)));return y}throw new TypeError("x must be a matrix or array of numbers")}_predict(x){const result=new Array(this.outputs);if(this.intercept)for(let i=0;i<this.outputs;i++)result[i]=this.weights[this.inputs][i];else result.fill(0);for(let i=0;i<this.inputs;i++)for(let j=0;j<this.outputs;j++)result[j]+=this.weights[i][j]*x[i];return result}score(){throw new Error("score method is not implemented yet")}toJSON(){return{name:"multivariateLinearRegression",weights:this.weights,inputs:this.inputs,outputs:this.outputs,intercept:this.intercept,summary:this.statistics?{regressionStatistics:{standardError:this.stdError,observations:this.outputs},variables:this.weights.map((d,i)=>({label:i===this.weights.length-1?"Intercept":`X Variable ${i+1}`,coefficients:d,standardError:this.stdErrors[i],tStat:this.tStats[i]}))}:void 0}}static load(model){if(model.name!=="multivariateLinearRegression")throw new Error("not a MLR model");return new MultivariateLinearRegression(!0,model)}}module.exports=MultivariateLinearRegression}}]);

//# sourceMappingURL=MultipleLinearRegression.10a7858c.chunk.js.map