"use strict";(self.webpackChunkisle_dashboard=self.webpackChunkisle_dashboard||[]).push([[1847],{29724:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{ZP:function(){return create_namespace},O5:function(){return validateDescription},OT:function(){return validateOwners},uq:function(){return validateTitle}});var react=__webpack_require__(67294),prop_types=__webpack_require__(45697),prop_types_default=__webpack_require__.n(prop_types),commonjs=__webpack_require__(81468),Button=__webpack_require__(89876),Button_default=__webpack_require__.n(Button),Card=__webpack_require__(51889),Card_default=__webpack_require__.n(Card),FormLabel=__webpack_require__(65903),FormLabel_default=__webpack_require__.n(FormLabel),FormControl=__webpack_require__(26199),FormControl_default=__webpack_require__.n(FormControl),FormGroup=__webpack_require__(34168),FormGroup_default=__webpack_require__.n(FormGroup),Form=__webpack_require__(17383),Form_default=__webpack_require__.n(Form),OverlayTrigger=__webpack_require__(99201),OverlayTrigger_default=__webpack_require__.n(OverlayTrigger),Tooltip=__webpack_require__(18868),Tooltip_default=__webpack_require__.n(Tooltip),browser=__webpack_require__(11227),browser_default=__webpack_require__.n(browser),lib=__webpack_require__(11738),lib_default=__webpack_require__.n(lib),trim_lib=__webpack_require__(87594),trim_lib_default=__webpack_require__.n(trim_lib),contains_lib=__webpack_require__(61635),contains_lib_default=__webpack_require__.n(contains_lib),text_select=__webpack_require__(70264),server=__webpack_require__(94204),check_url_path=__webpack_require__(48297);const debug=browser_default()("isle-dashboard:create-namespace");function validateOwners(owners){let invalid=!1;return owners.length===0?invalid=!0:owners.forEach(owner=>{lib_default()(owner)||(invalid=!0)}),!invalid}function validateTitle(title){return title.length>=3&&!contains_lib_default()(title," ")&&!(0,check_url_path.Z)(title)}function validateDescription(description){return description.length>=3}const CreateNamespace=props=>{const[title,setTitle]=(0,react.useState)(""),[description,setDescription]=(0,react.useState)(""),[owners,setOwners]=(0,react.useState)([props.user.email]),{t}=(0,commonjs.$G)(["namespace","common"]),handleSubmit=()=>{props.createNamespace({title,description,owners,props})},handleOwnerChange=newValue=>{newValue||setOwners([]);const newOwners=newValue.map(x=>trim_lib_default()(x.value));setOwners(newOwners)},handleTitleChange=event=>{const value=event.target.value;setTitle(value)},handleDescriptionChange=event=>{const value=event.target.value;setDescription(value)},validTitle=validateTitle(title),invalidTitleChars=(0,check_url_path.Z)(title),validDescription=validateDescription(description),validOwners=validateOwners(owners);return debug("Validation status of input fields: "),debug(`Title: ${validTitle}`),debug(`Description: ${validDescription}`),debug(`Owners: ${validOwners}`),react.createElement("div",{className:"create-namespace-container"},react.createElement(Card_default(),{className:"create-namespace-card"},react.createElement(Card_default().Header,null,react.createElement(Card_default().Title,{as:"h2"},t("create-course"))),react.createElement(Form_default(),{style:{padding:"20px"}},react.createElement(OverlayTrigger_default(),{placement:"right",overlay:react.createElement(Tooltip_default(),{id:"ownerTooltip"},t("owner-tooltip"))},react.createElement(FormGroup_default(),{controlId:"form-owners"},react.createElement(FormLabel_default(),null,t("common:owners")),react.createElement(text_select.Z,{id:"owners-text-select",onChange:handleOwnerChange,defaultValue:owners,isInvalid:!validOwners,placeholder:t("enter-emails")}),react.createElement(FormControl_default().Feedback,{type:"invalid"},t("invalid-owners")))),react.createElement(OverlayTrigger_default(),{placement:"right",overlay:react.createElement(Tooltip_default(),{id:"courseTooltip"},t("accessible-at"),react.createElement("code",null,server.ZP+"/<course>/<lesson>"))},react.createElement(FormGroup_default(),{controlId:"form-course"},react.createElement(FormLabel_default(),null,t("common:course")),react.createElement(FormControl_default(),{name:"title",type:"text",placeholder:t("course-placeholder"),onChange:handleTitleChange,isInvalid:title&&!validTitle}),react.createElement(FormControl_default().Feedback,{type:"invalid"},invalidTitleChars?"Course identifier contains invalid character(s): "+invalidTitleChars[0]:"Course identifier must be at least three characters long and should not contain any spaces."))),react.createElement(OverlayTrigger_default(),{placement:"right",overlay:react.createElement(Tooltip_default(),{id:"titleTooltip"},t("title-tooltip"))},react.createElement(FormGroup_default(),{controlId:"form-description"},react.createElement(FormLabel_default(),null,t("title-description")),react.createElement(FormControl_default(),{name:"description",type:"text",placeholder:t("title-placeholder"),onChange:handleDescriptionChange,isInvalid:description&&!validDescription}),react.createElement(FormControl_default().Feedback,{type:"invalid"},t("invalid-description"))))),react.createElement(Button_default(),{variant:"success",onClick:handleSubmit,disabled:!validOwners||!validTitle||!validDescription,block:!0},t("common:create"))))};CreateNamespace.propTypes={createNamespace:prop_types_default().func.isRequired,user:prop_types_default().object.isRequired},CreateNamespace.defaultProps={};var create_namespace=CreateNamespace},70264:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{Z:function(){return text_select}});var react=__webpack_require__(67294),prop_types=__webpack_require__(45697),prop_types_default=__webpack_require__.n(prop_types),commonjs=__webpack_require__(81468),clipboard_copy=__webpack_require__(66485),clipboard_copy_default=__webpack_require__.n(clipboard_copy),react_select_cjs=__webpack_require__(4665),react_select_cjs_prod=__webpack_require__(87583),Tooltip=__webpack_require__(18868),Tooltip_default=__webpack_require__.n(Tooltip),OverlayTrigger=__webpack_require__(99201),OverlayTrigger_default=__webpack_require__.n(OverlayTrigger),lib=__webpack_require__(90807),lib_default=__webpack_require__.n(lib),is_empty_string_lib=__webpack_require__(16897),is_empty_string_lib_default=__webpack_require__.n(is_empty_string_lib),contains_lib=__webpack_require__(61635),contains_lib_default=__webpack_require__.n(contains_lib),is_null_lib=__webpack_require__(95447),is_null_lib_default=__webpack_require__.n(is_null_lib),trim_lib=__webpack_require__(87594),trim_lib_default=__webpack_require__.n(trim_lib),__defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp.call(b,prop)&&__defNormalProp(a,prop,b[prop]);if(__getOwnPropSymbols)for(var prop of __getOwnPropSymbols(b))__propIsEnum.call(b,prop)&&__defNormalProp(a,prop,b[prop]);return a},__spreadProps=(a,b)=>__defProps(a,__getOwnPropDescs(b)),__publicField=(obj,key,value)=>(__defNormalProp(obj,typeof key!="symbol"?key+"":key,value),value);const customStyles={clearIndicator:(provided,state)=>__spreadProps(__spreadValues({},provided),{cursor:"pointer"}),multiValueRemove:(provided,state)=>__spreadProps(__spreadValues({},provided),{cursor:"pointer"}),valueContainer:(provided,state)=>__spreadProps(__spreadValues({},provided),{cursor:"text"})},createOption=label=>({label,value:label}),toOptions=arr=>is_null_lib_default()(arr)?null:lib_default()(arr)&&arr[0].label&&arr[0].value?arr:arr.map(createOption);class TextSelect extends react.Component{constructor(props){super(props),__publicField(this,"handleChange",value=>{this.setState({value}),this.props.onChange(value)}),__publicField(this,"handleInputChange",(inputValue,action)=>{action.action==="menu-close"?this.addInputValues():action.action!=="input-blur"&&this.setState({inputValue})}),__publicField(this,"addInputValues",()=>{let{inputValue,value}=this.state;if(!inputValue)return null;contains_lib_default()(inputValue,",")?inputValue=inputValue.split(",").map(x=>trim_lib_default()(x)).filter(x=>!is_empty_string_lib_default()(x)):inputValue=[trim_lib_default()(inputValue)];let newValue;value?newValue=value.concat(inputValue.map(createOption)):newValue=inputValue.map(createOption),this.setState({inputValue:"",value:newValue},()=>{this.props.onChange(this.state.value)})}),__publicField(this,"handleKeyDown",event=>{switch(event.key){case"Enter":case"Tab":this.addInputValues()}}),this.state={inputValue:"",value:toOptions(props.defaultValue)}}componentDidUpdate(prevProps){this.props.defaultValue!==prevProps.defaultValue&&this.setState({value:toOptions(this.props.defaultValue)})}render(){const{inputValue,value}=this.state,isInvalid=this.props.isInvalid,control=(provided,state)=>{const out=__spreadValues({},provided);return state.isFocused&&isInvalid&&(out.boxShadow="0 0 0 0.2rem rgba(220,53,69,0.25)"),out.borderColor=isInvalid?"#dc3545":"#ddd",out["&:hover"]={borderColor:isInvalid?"#dc3545":"#ddd"},out},customComponents={DropdownIndicator:null,MultiValueLabel:props=>{const copyToClipboard=()=>{clipboard_copy_default()(props.data.label)};return react.createElement(OverlayTrigger_default(),{overlay:react.createElement(Tooltip_default(),{id:"copy_tooltip"},this.props.t("copy-tooltip")),placement:"bottom"},react.createElement("span",{role:"button",tabIndex:0,onClick:copyToClipboard,onKeyPress:copyToClipboard,className:"text-select-copy","aria-label":this.props.t("copy-tooltip")},react.createElement(react_select_cjs_prod.wx.MultiValueLabel,__spreadValues({},props))))}};return react.createElement(react_select_cjs.default,{inputId:this.props.id,components:customComponents,inputValue,isClearable:this.props.isClearable,isMulti:!0,menuIsOpen:!1,onChange:this.handleChange,onInputChange:this.handleInputChange,onKeyDown:this.handleKeyDown,placeholder:this.props.placeholder,value,styles:__spreadValues(__spreadProps(__spreadValues({},customStyles),{control}),this.props.styles),t:this.props.t})}}TextSelect.propTypes={defaultValue:prop_types_default().array,id:prop_types_default().string,isClearable:prop_types_default().bool,isInvalid:prop_types_default().bool,onChange:prop_types_default().func,placeholder:prop_types_default().string,styles:prop_types_default().object},TextSelect.defaultProps={defaultValue:[],id:null,isClearable:!1,isInvalid:!1,onChange(){},placeholder:"",styles:{}};var text_select=(0,commonjs.Zh)(["text_select","common"])(TextSelect)},67638:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:function(){return visible_edit_namespace}});var react=__webpack_require__(67294),lib=__webpack_require__(37424),prop_types=__webpack_require__(45697),prop_types_default=__webpack_require__.n(prop_types),axios=__webpack_require__(9669),axios_default=__webpack_require__.n(axios),commonjs=__webpack_require__(81468),Tabs=__webpack_require__(29575),Tabs_default=__webpack_require__.n(Tabs),Tab=__webpack_require__(28350),Tab_default=__webpack_require__.n(Tab),Alert=__webpack_require__(93166),Alert_default=__webpack_require__.n(Alert),Badge=__webpack_require__(86100),Badge_default=__webpack_require__.n(Badge),Button=__webpack_require__(89876),Button_default=__webpack_require__.n(Button),ButtonGroup=__webpack_require__(63319),ButtonGroup_default=__webpack_require__.n(ButtonGroup),Card=__webpack_require__(51889),Card_default=__webpack_require__.n(Card),Container=__webpack_require__(70448),Container_default=__webpack_require__.n(Container),Col=__webpack_require__(1266),Row=__webpack_require__(28269),Row_default=__webpack_require__.n(Row),FormControl=__webpack_require__(26199),FormControl_default=__webpack_require__.n(FormControl),FormLabel=__webpack_require__(65903),FormLabel_default=__webpack_require__.n(FormLabel),FormGroup=__webpack_require__(34168),FormGroup_default=__webpack_require__.n(FormGroup),Form=__webpack_require__(17383),Form_default=__webpack_require__.n(Form),ListGroup=__webpack_require__(18350),ListGroup_default=__webpack_require__.n(ListGroup),ListGroupItem=__webpack_require__(36604),ListGroupItem_default=__webpack_require__.n(ListGroupItem),OverlayTrigger=__webpack_require__(99201),OverlayTrigger_default=__webpack_require__.n(OverlayTrigger),Tooltip=__webpack_require__(18868),Tooltip_default=__webpack_require__.n(Tooltip),is_array_lib=__webpack_require__(76266),is_array_lib_default=__webpack_require__.n(is_array_lib),trim_lib=__webpack_require__(87594),trim_lib_default=__webpack_require__.n(trim_lib),text_select=__webpack_require__(70264),Modal=__webpack_require__(89194),Modal_default=__webpack_require__.n(Modal);const MsgModal=({show,close,message,title})=>react.createElement(Modal_default(),{show,onHide:close},react.createElement(Modal_default().Header,{closeButton:!0},react.createElement(Modal_default().Title,null,title)),react.createElement(Modal_default().Body,null,message),react.createElement(Modal_default().Footer,null,react.createElement(Button_default(),{onClick:close},"Close")));MsgModal.propTypes={close:prop_types_default().func,message:prop_types_default().string,show:prop_types_default().bool,title:prop_types_default().string},MsgModal.defaultProps={close(){},message:"",show:!1,title:""};var message_modal=MsgModal,confirm_modal=__webpack_require__(88608),create_namespace=__webpack_require__(29724),lodash_debounce=__webpack_require__(91296),lodash_debounce_default=__webpack_require__.n(lodash_debounce),incrspace_lib=__webpack_require__(26658),incrspace_lib_default=__webpack_require__.n(incrspace_lib),server=__webpack_require__(94204),compute_modal=__webpack_require__(77530),react_select_cjs_prod=__webpack_require__(87583),react_select_cjs=__webpack_require__(4665),values_lib=__webpack_require__(49984),values_lib_default=__webpack_require__.n(values_lib);const levelFieldMapping={program:"namespaces",namespace:"lessons",lesson:null,component:null};function predecessor(level){switch(level){case"lesson":return"component";case"namespace":return"lesson";case"program":return"namespace";case"global":return"program";case"component":default:return null}}const levelPredecessorMapping={global:"program",program:"namespace",namespace:"lesson",lesson:"component",component:null};var coverage_options_namespaceObject=JSON.parse('{"all":{"value":"all","label":"All"},"include":{"value":"include","label":"Include"},"exclude":{"value":"exclude","label":"Exclude"}}'),__defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp.call(b,prop)&&__defNormalProp(a,prop,b[prop]);if(__getOwnPropSymbols)for(var prop of __getOwnPropSymbols(b))__propIsEnum.call(b,prop)&&__defNormalProp(a,prop,b[prop]);return a},__spreadProps=(a,b)=>__defProps(a,__getOwnPropDescs(b)),__objRest=(source,exclude)=>{var target={};for(var prop in source)__hasOwnProp.call(source,prop)&&exclude.indexOf(prop)<0&&(target[prop]=source[prop]);if(source!=null&&__getOwnPropSymbols)for(var prop of __getOwnPropSymbols(source))exclude.indexOf(prop)<0&&__propIsEnum.call(source,prop)&&(target[prop]=source[prop]);return target};function EditMetricModal({level,entity,show,onHide,allRules,refs,createNew,metric,onConfirm}){var _a;const{t}=(0,commonjs.$G)(),[name,setName]=(0,react.useState)((metric==null?void 0:metric.name)||""),[rule,setRule]=(0,react.useState)(metric!=null&&metric.rule?allRules[metric.rule[0]]:null),[ruleParameters,setRuleParameters]=(0,react.useState)(metric!=null&&metric.rule?metric.rule.slice(1):[]),[coverage,setCoverage]=(0,react.useState)(coverage_options_namespaceObject[((_a=metric==null?void 0:metric.coverage)==null?void 0:_a[0])||"all"]),[coverageEntities,setCoverageEntities]=(0,react.useState)([]),[selectedRef,setSelectedRef]=(0,react.useState)((metric==null?void 0:metric.ref)||null),subEntities=(0,react.useRef)([]);(0,react.useEffect)(()=>{if(level==="lesson")subEntities.current=[];else if(levelFieldMapping[level]){const entities=entity[levelFieldMapping[level]];if(console.log(entities),subEntities.current=entities.map(x=>({label:x.title,value:x})),metric&&metric.coverage){const ids=new Set(metric.coverage.slice(1));setCoverageEntities(subEntities.current.filter(x=>ids.has(x.value._id)))}}else subEntities.current=[]},[level,entity,metric]);const handleConfirm=()=>{onConfirm({name,rule:[rule.name].concat(ruleParameters),coverage:[coverage.value].concat(coverageEntities.map(x=>x.value._id)),level,id:entity._id,ref:selectedRef}),onHide()},handleEntityChange=value=>{console.log(value),setCoverageEntities(value)};console.log("Sub-entities:"),console.log(subEntities.current);const labelStyler=(styles,{data})=>!selectedRef||data.value.completions.some(x=>x.name===selectedRef)?styles:__spreadProps(__spreadValues({},styles),{opacity:.65}),subentitySelectorStyles={option:labelStyler,multiValueLabel:labelStyler};return react.createElement(Modal_default(),{size:"lg",show,onHide},react.createElement(Modal_default().Header,{closeButton:!0},react.createElement(Modal_default().Title,{as:"h3"},t(createNew?"create-completion-metric":"edit-completion-metric"))),react.createElement(Modal_default().Body,null,react.createElement("p",null,t(createNew?"create-completion-metric-description":"edit-completion-metric-description")),react.createElement(Form_default().Group,{className:"mb-2"},react.createElement(Form_default().Label,null,t("common:name")),react.createElement(Form_default().Control,{name:"metric-name",type:"text",placeholder:t("metric-name-placeholder"),onChange:event=>setName(event.target.value),value:name})),react.createElement(Form_default().Group,{className:"mb-2"},react.createElement(Form_default().Label,null,t("common:rule")),react.createElement(react_select_cjs_prod.ZP,{options:values_lib_default()(allRules).map(rule2=>({value:rule2,label:rule2.label})),onChange:option=>{const newRule=option.value;setRule(newRule),setRuleParameters(newRule.defaults)},value:rule?{value:rule,label:rule.label}:null})),rule&&rule.parameters.length>0?rule.parameters.map((parameter,idx)=>react.createElement(Form_default().Group,{key:`param-${idx}`,className:"mb-2"},react.createElement(Form_default().Label,null,parameter.name),react.createElement(Form_default().Control,{name:parameter.name,type:parameter.type,placeholder:t("enter-parameter-value"),onChange:event=>{const newParams=ruleParameters.slice();switch(parameter.type){case"number":newParams[idx]=parseFloat(event.target.value);break;case"string":newParams[idx]=event.target.value;break}setRuleParameters(newParams)},defaultValue:ruleParameters[idx]!==void 0?ruleParameters[idx]:rule.defaults[idx]}))):null,react.createElement(Form_default().Group,{className:"mb-2"},react.createElement(Form_default().Label,null,t("common:lesson-metric")),react.createElement(react_select_cjs.default,{isClearable:!0,options:refs.map(ref=>({value:ref,label:ref})),onChange:option=>{setSelectedRef(option?option.value:null)},defaultValue:selectedRef?{value:selectedRef,label:selectedRef}:null})),react.createElement(Form_default().Group,{className:"mb-2",as:Row_default()},react.createElement(Form_default().Label,null,t("common:coverage")),react.createElement(react_select_cjs_prod.ZP,{options:values_lib_default()(coverage_options_namespaceObject),onChange:option=>{setCoverage(option),option.value==="all"&&setCoverageEntities([])},value:coverage}),coverage.value==="include"||coverage.value==="exclude"?react.createElement(react_select_cjs_prod.ZP,{isMulti:!0,options:subEntities.current,onChange:handleEntityChange,value:coverageEntities,styles:subentitySelectorStyles,placeholder:"Select lessons...",components:{Placeholder:_b=>{var _c=_b,{children,isFocused}=_c,rest=__objRest(_c,["children","isFocused"]);return console.log(rest),react.createElement(react_select_cjs_prod.wx.Placeholder,__spreadValues({},rest),children," ",isFocused?"(opaque lessons have no metric for the selected ref)":"")}}}):null)),react.createElement(Modal_default().Footer,null,react.createElement(Button_default(),{onClick:onHide},t("common:cancel")),react.createElement(Button_default(),{variant:"success",onClick:handleConfirm,disabled:!rule||!name},t(createNew?"common:create":"common:save"))))}EditMetricModal.propTypes={allRules:prop_types_default().object.isRequired,createNew:prop_types_default().bool.isRequired,entity:prop_types_default().object.isRequired,level:prop_types_default().oneOf(["program","namespace","lesson","component"]).isRequired,metric:prop_types_default().object,onConfirm:prop_types_default().func.isRequired,onHide:prop_types_default().func.isRequired,refs:prop_types_default().array.isRequired,show:prop_types_default().bool.isRequired},EditMetricModal.defaultProps={metric:null};var edit_metric_modal=EditMetricModal,InputGroup=__webpack_require__(16644),InputGroup_default=__webpack_require__.n(InputGroup),object_hash=__webpack_require__(40705),object_hash_default=__webpack_require__.n(object_hash),shared_edit_lesson_metrics_modal_defProp=Object.defineProperty,shared_edit_lesson_metrics_modal_defProps=Object.defineProperties,shared_edit_lesson_metrics_modal_getOwnPropDescs=Object.getOwnPropertyDescriptors,shared_edit_lesson_metrics_modal_getOwnPropSymbols=Object.getOwnPropertySymbols,shared_edit_lesson_metrics_modal_hasOwnProp=Object.prototype.hasOwnProperty,shared_edit_lesson_metrics_modal_propIsEnum=Object.prototype.propertyIsEnumerable,shared_edit_lesson_metrics_modal_defNormalProp=(obj,key,value)=>key in obj?shared_edit_lesson_metrics_modal_defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,shared_edit_lesson_metrics_modal_spreadValues=(a,b)=>{for(var prop in b||(b={}))shared_edit_lesson_metrics_modal_hasOwnProp.call(b,prop)&&shared_edit_lesson_metrics_modal_defNormalProp(a,prop,b[prop]);if(shared_edit_lesson_metrics_modal_getOwnPropSymbols)for(var prop of shared_edit_lesson_metrics_modal_getOwnPropSymbols(b))shared_edit_lesson_metrics_modal_propIsEnum.call(b,prop)&&shared_edit_lesson_metrics_modal_defNormalProp(a,prop,b[prop]);return a},shared_edit_lesson_metrics_modal_spreadProps=(a,b)=>shared_edit_lesson_metrics_modal_defProps(a,shared_edit_lesson_metrics_modal_getOwnPropDescs(b));const COVERAGE_OPTIONS_ARRAY=values_lib_default()(coverage_options_namespaceObject),SELECT_STYLES={menuPortal:base=>shared_edit_lesson_metrics_modal_spreadProps(shared_edit_lesson_metrics_modal_spreadValues({},base),{zIndex:9999})};function convertRuleParameter(value,parameter){switch(parameter.type){case"number":return parseFloat(value);case"string":return value}}function selectOption(value){return{label:value,value}}function analyzeLessonMetrics(name,lessons){const lessonInfo=lessons.reduce((acc,lesson2)=>{const namedMetric=lesson2.completions.find(metric=>metric.name===name);return namedMetric&&(acc.active[lesson2._id]=namedMetric,acc.rules.add(JSON.stringify(namedMetric.rule)),acc.rule=namedMetric.rule,acc.refs.add(namedMetric.ref),acc.ref=namedMetric.ref),acc},{rules:new Set,refs:new Set,active:{},rule:null,ref:null},lessons);return lessonInfo.rules.size>0?{hasSharedRule:lessonInfo.rules.size===1,hasSharedRef:lessonInfo.refs.size===1,activeLessons:lessonInfo.active,rule:lessonInfo.rule,ref:lessonInfo.ref}:{activeLessons:{},hasSharedRule:!0,hasSharedRef:!0,rule:null,ref:null}}function availableLessonMetrics(lessons){const allMetrics=lessons.reduce((acc,lesson2)=>(lesson2.completions.forEach(metric=>{acc.add(metric.name)}),acc),new Set);return Array.from(allMetrics).sort().map(metric=>({value:metric,label:metric}))}function SharedEditLessonMetricsModal({name,preferredLesson,lessons,lessonRefs,lessonComponents,namespace:namespace2,allRules,show,onHide,onSave}){const[chosenName,setChosenName]=(0,react.useState)(name),[hasSharedRule,setHasSharedRule]=(0,react.useState)(!1),[sharedRule,setSharedRule]=(0,react.useState)(null),[sharedRuleParameters,setSharedRuleParameters]=(0,react.useState)([]),[hasSharedRef,setHasSharedRef]=(0,react.useState)(!1),[sharedRef,setSharedRef]=(0,react.useState)(null),[activeLessons,setActiveLessons]=(0,react.useState)({}),[selectedLessons,setSelectedLessons]=(0,react.useState)({}),[currentHash,setCurrentHash]=(0,react.useState)(null),[isNewMetric,setIsNewMetric]=(0,react.useState)(!1),availableMetrics=(0,react.useRef)(null),analyzedHash=(0,react.useRef)(null),analysisRef=(0,react.useRef)(null),incorporateAnalysis=(0,react.useCallback)(analysis=>{setHasSharedRule(analysis.hasSharedRule);let newSharedRule=null,newSharedRuleParameters=[];const isSharedRuleSet=analysis.hasSharedRule&&analysis.rule&&analysis.rule[0];isSharedRuleSet&&(newSharedRule=allRules[analysis.rule[0]],newSharedRuleParameters=analysis.rule.slice(1),setSharedRule(newSharedRule),setSharedRuleParameters(newSharedRuleParameters)),setHasSharedRef(analysis.hasSharedRef),analysis.hasSharedRef&&setSharedRef(analysis.ref);const lessonSpec={sharedRule:newSharedRule,sharedRuleParameters:newSharedRuleParameters,sharedRef:analysis.hasSharedRef?analysis.ref:null,activeLessons:shared_edit_lesson_metrics_modal_spreadValues({},analysis.activeLessons)},newSelectedLessons={};for(let i=0;i<lessons.length;i++){const lessonId=lessons[i]._id;lessonSpec.activeLessons[lessonId]?newSelectedLessons[lessonId]=!0:(newSelectedLessons[lessonId]=!1,lessonSpec.activeLessons[lessonId]={name:chosenName,rule:isSharedRuleSet?[lessonSpec.sharedRule.name,...lessonSpec.sharedRuleParameters]:null,ref:analysis.hasSharedRef?lessonSpec.sharedRef:null,coverage:["all"],level:"lesson"})}lessonSpec.selectedLessons=newSelectedLessons,analyzedHash.current=object_hash_default()(lessonSpec),setCurrentHash(analyzedHash.current),setActiveLessons(lessonSpec.activeLessons),setSelectedLessons(newSelectedLessons)},[allRules,chosenName,lessons]);(0,react.useEffect)(()=>{availableMetrics.current=availableLessonMetrics(lessons)},[lessons]),(0,react.useEffect)(()=>{const analysis=analyzeLessonMetrics(chosenName,lessons);analysisRef.current=analysis,incorporateAnalysis(analysis)},[allRules,incorporateAnalysis,lessons,chosenName]),(0,react.useEffect)(()=>{const lessonSpec={sharedRule:hasSharedRule?sharedRule:null,sharedRuleParameters:hasSharedRule?sharedRuleParameters:[],sharedRef:hasSharedRef?sharedRef:null,activeLessons,selectedLessons};setCurrentHash(object_hash_default()(lessonSpec))},[sharedRule,sharedRef,sharedRuleParameters,activeLessons,selectedLessons,hasSharedRef,hasSharedRule]);const handleSave=(0,react.useCallback)(()=>{const lessonMetrics=shared_edit_lesson_metrics_modal_spreadValues({},activeLessons);namespace2.lessons.forEach(lesson2=>{selectedLessons[lesson2._id]?lessonMetrics[lesson2._id]=shared_edit_lesson_metrics_modal_spreadValues(shared_edit_lesson_metrics_modal_spreadValues(shared_edit_lesson_metrics_modal_spreadValues({},lessonMetrics[lesson2._id]),hasSharedRef?{ref:sharedRef}:{}),hasSharedRule?{rule:[sharedRule.name,...sharedRuleParameters]}:{}):lessonMetrics[lesson2._id]=null});const body={namespaceID:namespace2._id,name:chosenName,lessonMetrics};onSave(body)},[activeLessons,chosenName,namespace2,hasSharedRef,sharedRef,hasSharedRule,selectedLessons,sharedRule,sharedRuleParameters,onSave]),{t}=(0,commonjs.$G)(),lessonRefOptions=lessonRefs.map(ref=>({value:ref,label:ref})),allRulesOptions=values_lib_default()(allRules).map(rule=>({value:rule,label:rule.label})),sharedInputs=react.createElement(react.Fragment,null,react.createElement(Form_default().Group,{className:"mb-2",as:Row_default()},react.createElement(Col.default,{sm:4},react.createElement(Form_default().Check,{type:"checkbox",id:"shared-rule-checkbox",label:t("share-across-lessons"),onChange:event=>{setHasSharedRule(event.target.checked)},checked:hasSharedRule})),react.createElement(Form_default().Label,{column:!0,sm:2},t("common:rule")),react.createElement(Col.default,{sm:6},react.createElement(react_select_cjs_prod.ZP,{isDisabled:!hasSharedRule,options:allRulesOptions,onChange:option=>{const newRule=option.value;setSharedRule(newRule),setSharedRuleParameters(newRule.defaults)},value:sharedRule?{value:sharedRule,label:sharedRule.label}:null}))),hasSharedRule&&sharedRule&&sharedRule.parameters.length>0&&sharedRule.parameters.map((parameter,idx)=>react.createElement(Form_default().Group,{key:`param-${idx}`,className:"mb-2",as:Row_default()},react.createElement(Col.default,{sm:4}),react.createElement(Form_default().Label,{column:!0,sm:2},parameter.name),react.createElement(Col.default,{sm:6},react.createElement(Form_default().Control,{name:parameter.name,type:parameter.type,placeholder:t("enter-parameter-value"),onChange:event=>{const newParams=sharedRuleParameters.slice();newParams[idx]=convertRuleParameter(event.target.value,parameter),setSharedRuleParameters(newParams)},defaultValue:sharedRuleParameters[idx]!==void 0?sharedRuleParameters[idx]:sharedRule.defaults[idx]})))),react.createElement(Form_default().Group,{className:"mb-2",as:Row_default()},react.createElement(Col.default,{sm:4},react.createElement(Form_default().Check,{type:"checkbox",id:"shared-ref-checkbox",label:t("share-across-lessons"),onChange:event=>{setHasSharedRef(event.target.checked)},checked:hasSharedRef})),react.createElement(Form_default().Label,{column:!0,sm:2},t("common:ref")),react.createElement(Col.default,{sm:6},react.createElement(react_select_cjs.default,{isClearable:!0,isDisabled:!hasSharedRef,options:lessonRefOptions,onChange:option=>{setSharedRef(option?option.value:null)},value:sharedRef?{value:sharedRef,label:sharedRef}:null})))),lessonInputs=Array.from(lessons).sort(preferredLesson?(a,b)=>a.title===preferredLesson.title?-1:b.title===preferredLesson.title?1:a.title.localeCompare(b.title):(a,b)=>a.title.localeCompare(b.title)).map(x=>{const lessonIsActive=selectedLessons[x._id];let defaultRuleParameters,defaultRule,defaultRef;if(lessonIsActive)if(hasSharedRef&&sharedRef?defaultRef={value:sharedRef,label:sharedRef}:defaultRef=activeLessons[x._id].ref?{value:activeLessons[x._id].ref,label:activeLessons[x._id].ref}:null,hasSharedRule&&sharedRule)defaultRule={value:sharedRule,label:sharedRule.label},defaultRuleParameters=sharedRuleParameters;else if(activeLessons[x._id].rule){const activeRule=allRules[activeLessons[x._id].rule[0]];defaultRule={value:activeRule,label:activeRule.label},defaultRuleParameters=activeLessons[x._id].rule.slice(1)}else defaultRule=null,defaultRuleParameters=[];const activeLesson=activeLessons[x._id],coverage=(activeLesson==null?void 0:activeLesson.coverage)||["all"],coverageQualifier=coverage[0],coverageEntities=coverage.slice(1).map(selectOption);return react.createElement(react.Fragment,null,react.createElement(Form_default().Check,{type:"switch",id:"custom-switch",label:x.title,key:x._id,onChange:event=>{const newSelected=shared_edit_lesson_metrics_modal_spreadValues({},selectedLessons);newSelected[x._id]=event.target.checked,setSelectedLessons(newSelected)},checked:lessonIsActive}),lessonIsActive&&react.createElement(react.Fragment,null,react.createElement(Form_default().Group,{className:"mb-2",as:Row_default()},react.createElement(Col.default,{sm:2}),react.createElement(Form_default().Label,{column:!0,sm:4},t("common:rule")),react.createElement(Col.default,{sm:6},react.createElement(react_select_cjs_prod.ZP,{options:allRulesOptions,isDisabled:hasSharedRule,onChange:option=>{const newActive=shared_edit_lesson_metrics_modal_spreadValues({},activeLessons);newActive[x._id].rule=[option.value.name,...option.value.defaults],setActiveLessons(newActive)},value:defaultRule,menuPortalTarget:document.body,menuPlacement:"auto",styles:SELECT_STYLES}))),defaultRuleParameters.length>0&&defaultRuleParameters.map((value,idx)=>{const parameter=allRules[defaultRule.value.name].parameters[idx];return react.createElement(Form_default().Group,{key:`${x._id}-param-${idx}`,className:"mb-2",as:Row_default()},react.createElement(Col.default,{sm:4}),react.createElement(Form_default().Label,{column:!0,sm:2},parameter.name),react.createElement(Col.default,{sm:6},react.createElement(Form_default().Control,{name:parameter.name,type:parameter.type,placeholder:t("enter-parameter-value"),disabled:hasSharedRule,onChange:event=>{const newActive=shared_edit_lesson_metrics_modal_spreadValues({},activeLessons);newActive[x._id].rule[idx+1]=convertRuleParameter(event.target.value,parameter),setActiveLessons(newActive)},value:defaultRuleParameters[idx]})))}),react.createElement(Form_default().Group,{className:"mb-2",as:Row_default()},react.createElement(Col.default,{sm:2}),react.createElement(Form_default().Label,{column:!0,sm:4},t("common:ref")),react.createElement(Col.default,{sm:6},react.createElement(react_select_cjs.default,{isClearable:!0,isDisabled:hasSharedRef,options:lessonRefOptions,onChange:option=>{const newActive=shared_edit_lesson_metrics_modal_spreadValues({},activeLessons);newActive[x._id].ref=option?option.value:null,setActiveLessons(newActive)},value:defaultRef,menuPortalTarget:document.body,menuPlacement:"auto",styles:SELECT_STYLES}))),react.createElement(Form_default().Group,{className:"mb-2",as:Row_default()},react.createElement(Col.default,{sm:2}),react.createElement(Form_default().Label,{column:!0,sm:4},t("common:coverage")),react.createElement(Col.default,{sm:6},react.createElement(react_select_cjs_prod.ZP,{options:COVERAGE_OPTIONS_ARRAY,onChange:option=>{const newActive=shared_edit_lesson_metrics_modal_spreadValues({},activeLessons);newActive[x._id].coverage[0]=option.value,setActiveLessons(newActive)},value:coverage_options_namespaceObject[coverageQualifier]}),coverageQualifier==="include"||coverageQualifier==="exclude"?react.createElement(react_select_cjs.default,{isMulti:!0,options:(lessonComponents[x._id]||[]).map(y=>{const label=y.componentType?`${y.component} (type ${y.componentType})`:y.component;return{value:y.component,label}}),onChange:option=>{const newActive=shared_edit_lesson_metrics_modal_spreadValues({},activeLessons);newActive[x._id].coverage=[coverageQualifier,...option.map(x2=>x2.value)],setActiveLessons(newActive)},value:coverageEntities,placeholder:"Select component identifiers..."}):null))))}),hasUnsavedChanges=currentHash!==analyzedHash.current;return react.createElement(Modal_default(),{size:"lg",show,onHide,dialogClassName:"modal-75w modal-80h"},react.createElement(Modal_default().Header,{closeButton:!hasUnsavedChanges},react.createElement(Modal_default().Title,{as:"h3"},`${t("lesson-metrics-for")} ${namespace2.title}`)),react.createElement(Modal_default().Body,null,react.createElement("p",null,t("lesson-metrics-description")),react.createElement(InputGroup_default(),{className:"mb-2"},react.createElement(InputGroup_default().Text,null,t("metric-name")),react.createElement(react_select_cjs.default,{name:"metric-name",placeholder:t("metric-name-placeholder"),onChange:value=>{value?setChosenName(value.value):(setChosenName(null),setSharedRule(null),setSharedRef(null))},onCreateOption:inputValue=>{console.log("Creating new lesson metric: ",inputValue),setChosenName(inputValue),setIsNewMetric(!0)},value:chosenName?{value:chosenName,label:chosenName}:null,isClearable:!0,isDisabled:name||currentHash&&currentHash!==analyzedHash.current,options:availableMetrics.current})),chosenName?react.createElement(react.Fragment,null,sharedInputs,react.createElement(Form_default().Check,{type:"switch",id:"all-lessons-switch",label:react.createElement("h3",null,"All Lessons"),onChange:event=>{const newSelectedLessons={};lessons.forEach(lesson2=>{newSelectedLessons[lesson2._id]=event.target.checked}),setSelectedLessons(newSelectedLessons)},checked:Object.values(selectedLessons).every(x=>x)}),react.createElement("div",{style:{maxHeight:"75vh",minHeight:"50vh",border:"solid 1px darkgray",overflowY:"auto",padding:4,overflowX:"hidden"}},lessonInputs)):null),chosenName&&react.createElement(Modal_default().Footer,null,react.createElement(Button_default(),{onClick:onHide,disabled:hasUnsavedChanges},t("common:dismiss")),react.createElement(Button_default(),{variant:hasUnsavedChanges?"warning":"secondary",disabled:!hasUnsavedChanges,onClick:()=>{analysisRef.current&&incorporateAnalysis(analysisRef.current)}},t("discard-unsaved-changes")),react.createElement(Button_default(),{variant:"success",onClick:handleSave,disabled:!hasUnsavedChanges||!sharedRef||!sharedRule||isNewMetric&&Object.values(selectedLessons).every(x=>!x)},t("common:save"))))}SharedEditLessonMetricsModal.propTypes={allRules:prop_types_default().array.isRequired,lessonComponents:prop_types_default().object,lessonRefs:prop_types_default().arrayOf(prop_types_default().string).isRequired,lessons:prop_types_default().array.isRequired,name:prop_types_default().string,namespace:prop_types_default().object.isRequired,onHide:prop_types_default().func.isRequired,onSave:prop_types_default().func.isRequired,preferredLesson:prop_types_default().object,show:prop_types_default().bool.isRequired},SharedEditLessonMetricsModal.defaultProps={name:null,lessonComponents:{},preferredLesson:null};var shared_edit_lesson_metrics_modal=SharedEditLessonMetricsModal,completion_rules_namespaceObject=JSON.parse('{"average":{"name":"average","label":"Average","description":"Average value of the completions","parameters":[],"defaults":[]},"dropLowest":{"name":"dropLowest","label":"Drop Lowest","description":"Average value after dropping the lowest value of the completions","parameters":[],"defaults":[]},"dropNLowest":{"name":"dropNLowest","label":"Drop N Lowest","description":"Average value after dropping the lowest N values of the completions","parameters":[{"name":"N","type":"number"}],"defaults":[3]}}');function CompletionsPage(props){const{t}=(0,commonjs.$G)("completions"),[selectedMetric,setSelectedMetric]=(0,react.useState)(null),[showComputeModal,setShowComputeModal]=(0,react.useState)(!1),[showDeleteModal,setShowDeleteModal]=(0,react.useState)(!1),[showCreateModal,setShowCreateModal]=(0,react.useState)(!1),[showEditModal,setShowEditModal]=(0,react.useState)(!1),[showLessonMetricsModal,setShowLessonMetricsModal]=(0,react.useState)(!1),[refs,setRefs]=(0,react.useState)(null),metrics=props.entity.completions||[],[order,setOrder]=(0,react.useState)(incrspace_lib_default()(0,metrics.length,1));(0,react.useEffect)(()=>{if(props.level==="lesson")setRefs(props.lessonRefs);else{const subentities=props.entity[levelFieldMapping[props.level]],completions2=new Set;subentities.forEach(subentity=>{subentity.completions.forEach(completion=>{completions2.add(completion.name)})}),setRefs(Array.from(completions2).sort())}},[props.entity,props.level,props.lessonRefs]);const handleDeleteMetric=()=>{const idx=metrics.findIndex(metric=>metric.name===selectedMetric.name),newOrder=order.filter(v=>v!==idx).map(x=>x>idx?x-1:x);setOrder(newOrder),props.deleteMetric({id:props.entity._id,level:props.level,name:selectedMetric.name}).then(response=>{setSelectedMetric(null),setShowDeleteModal(!1)}).catch(err=>{console.log("Error deleting metric:",err)})},transposeMetrics=(index,next)=>lodash_debounce_default()(()=>{const newOrder=[...order],i=newOrder[index];next?(newOrder[index]=newOrder[index+1],newOrder[index+1]=i):(newOrder[index]=newOrder[index-1],newOrder[index-1]=i),setOrder(newOrder),axios_default().post(`${server.ZP}/metric_order`,{id:props.entity._id,level:props.level,index,next}).then(response=>{console.log(response)}).catch(err=>{console.log("Error updating metric order:",err)})},200);return react.createElement("div",{style:{margin:12}},react.createElement(ListGroup_default(),null,order.map((metricIndex,idx)=>{const metric=metrics[metricIndex];if(!metric)return null;const handleCompute=()=>{setSelectedMetric(metric),setShowComputeModal(!0)};return react.createElement(ListGroup_default().Item,{key:`${metricIndex}-${idx}`,className:"d-flex w-100 justify-content-start metric-list-item"},react.createElement("label",{className:"me-2"},metric.name),react.createElement("span",{style:{display:"inline-block",maxWidth:"calc(100% - 400px)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontStyle:"italic"}},metric.description),react.createElement("span",{className:"ms-auto"},react.createElement(OverlayTrigger_default(),{placement:"top",overlay:react.createElement(Tooltip_default(),{id:`tooltip-compute-${idx}`},t("compute-metric-tooltip"))},react.createElement(Button_default(),{variant:"secondary",size:"sm",className:"mx-2",onClick:handleCompute},t("common:compute"))),react.createElement(OverlayTrigger_default(),{placement:"top",overlay:react.createElement(Tooltip_default(),{id:`tooltip-edit-${idx}`},t("edit-metric-tooltip"))},react.createElement(Button_default(),{variant:"secondary",size:"sm",className:"mx-2",onClick:()=>{setSelectedMetric(metric),setShowEditModal(!0)}},t("common:edit"))),react.createElement(OverlayTrigger_default(),{placement:"top",overlay:react.createElement(Tooltip_default(),{id:`tooltip-delete-${idx}`},t("delete-metric-tooltip"))},react.createElement(Button_default(),{variant:"danger",size:"sm",className:"mx-2",onClick:()=>{setSelectedMetric(metric),setShowDeleteModal(!0)}},t("common:delete"))),react.createElement(Button_default(),{"aria-label":t("move-metric-down"),size:"sm",variant:"secondary",className:"mx-1",disabled:idx===metrics.length-1,onClick:transposeMetrics(idx,!0)},react.createElement("i",{className:"fas fa-chevron-down"})),react.createElement(Button_default(),{"aria-label":t("move-metric-up"),size:"sm",variant:"secondary",disabled:idx===0,onClick:transposeMetrics(idx,!1)},react.createElement("i",{className:"fas fa-chevron-up"}))))})),react.createElement(OverlayTrigger_default(),{placement:"bottom",overlay:react.createElement(Tooltip_default(),{id:"tooltip-create-metric"},t("create-metric-tooltip"))},react.createElement(Button_default(),{variant:"primary",style:{marginTop:12},onClick:()=>{setShowCreateModal(!0)}},t("create-metric"))),selectedMetric?react.createElement(compute_modal.Z,{key:`compute-modal-${selectedMetric.name}`,metric:selectedMetric,show:showComputeModal,onHide:()=>setShowComputeModal(!1),cohorts:props.cohorts,tags:props.entity.tags,entity:props.entity,level:props.level,computeCompletions:props.computeCompletions,onCompute:()=>setShowComputeModal(!1)}):null,showCreateModal?react.createElement(edit_metric_modal,{key:"create-modal",show:showCreateModal,onHide:()=>setShowCreateModal(!1),allRules:completion_rules_namespaceObject,level:props.level,entity:props.entity,refs,createNew:!0,onConfirm:body=>{props.createMetric(body);const newOrder=order.slice();newOrder.push(order.length),setOrder(newOrder)}}):null,showDeleteModal?react.createElement(confirm_modal.Z,{title:t("delete-metric"),message:t("delete-metric-confirm"),close:()=>setShowDeleteModal(!1),show:showDeleteModal,onConfirm:handleDeleteMetric}):null,showEditModal?react.createElement(edit_metric_modal,{key:`edit-modal-${selectedMetric.name}`,show:showEditModal,onHide:()=>setShowEditModal(!1),allRules:completion_rules_namespaceObject,level:props.level,entity:props.entity,refs,createNew:!1,metric:selectedMetric,onConfirm:props.updateMetric}):null,showLessonMetricsModal?react.createElement(shared_edit_lesson_metrics_modal,{key:"lesson-metrics-modal",show:showLessonMetricsModal,onHide:()=>setShowLessonMetricsModal(!1),lessons:props.entity.lessons,allRules:completion_rules_namespaceObject,lessonRefs:props.lessonRefs,lessonComponents:props.entity.componentsByLesson,namespace:props.entity,onSave:body=>{axios_default().post(`${server.ZP}/save_lesson_metrics`,body).then(res=>{console.log("Response: ",res),setShowLessonMetricsModal(!1),props.updateLessonMetrics({lessons:res.data.lessons})}).catch(err=>{console.error(err)})}}):null)}CompletionsPage.propTypes={cohorts:prop_types_default().array.isRequired,computeCompletions:prop_types_default().func.isRequired,createMetric:prop_types_default().func.isRequired,deleteMetric:prop_types_default().func.isRequired,entity:prop_types_default().object.isRequired,lessonRefs:prop_types_default().array.isRequired,level:prop_types_default().string.isRequired,updateLessonMetrics:prop_types_default().func,updateMetric:prop_types_default().func.isRequired},CompletionsPage.defaultProps={updateLessonMetrics:()=>{}};var completions=CompletionsPage,actions_completions=__webpack_require__(83214),notification=__webpack_require__(16120);function mapStateToProps(state){return{user:state.user,namespace:state.namespace,cohorts:state.namespace.cohorts}}function mapDispatchToProps(dispatch){return{addNotification:(0,notification.pP)(dispatch),createMetric:(0,actions_completions.Wn)(dispatch),deleteMetric:(0,actions_completions._H)(dispatch),updateMetric:(0,actions_completions.q)(dispatch),computeCompletions:(0,actions_completions.sA)(dispatch)}}var visible_completions=(0,lib.connect)(mapStateToProps,mapDispatchToProps)(completions),edit_lesson_metrics_defProp=Object.defineProperty,edit_lesson_metrics_defProps=Object.defineProperties,edit_lesson_metrics_getOwnPropDescs=Object.getOwnPropertyDescriptors,edit_lesson_metrics_getOwnPropSymbols=Object.getOwnPropertySymbols,edit_lesson_metrics_hasOwnProp=Object.prototype.hasOwnProperty,edit_lesson_metrics_propIsEnum=Object.prototype.propertyIsEnumerable,edit_lesson_metrics_defNormalProp=(obj,key,value)=>key in obj?edit_lesson_metrics_defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,edit_lesson_metrics_spreadValues=(a,b)=>{for(var prop in b||(b={}))edit_lesson_metrics_hasOwnProp.call(b,prop)&&edit_lesson_metrics_defNormalProp(a,prop,b[prop]);if(edit_lesson_metrics_getOwnPropSymbols)for(var prop of edit_lesson_metrics_getOwnPropSymbols(b))edit_lesson_metrics_propIsEnum.call(b,prop)&&edit_lesson_metrics_defNormalProp(a,prop,b[prop]);return a},edit_lesson_metrics_spreadProps=(a,b)=>edit_lesson_metrics_defProps(a,edit_lesson_metrics_getOwnPropDescs(b));const edit_lesson_metrics_COVERAGE_OPTIONS_ARRAY=values_lib_default()(coverage_options_namespaceObject),edit_lesson_metrics_SELECT_STYLES={menuPortal:base=>edit_lesson_metrics_spreadProps(edit_lesson_metrics_spreadValues({},base),{zIndex:9999})};function edit_lesson_metrics_convertRuleParameter(value,parameter){switch(parameter.type){case"number":return parseFloat(value);case"string":return value}}function edit_lesson_metrics_selectOption(value){return{label:value,value}}function edit_lesson_metrics_analyzeLessonMetrics(name,lessons){const lessonInfo=lessons.reduce((acc,lesson2)=>{const namedMetric=lesson2.completions.find(metric=>metric.name===name);return namedMetric&&(acc.active[lesson2._id]=namedMetric,acc.rules.add(JSON.stringify(namedMetric.rule)),acc.rule=namedMetric.rule,acc.refs.add(namedMetric.ref),acc.ref=namedMetric.ref),acc},{rules:new Set,refs:new Set,active:{},rule:null,ref:null},lessons);return lessonInfo.rules.size>0?{hasSharedRule:lessonInfo.rules.size===1,hasSharedRef:lessonInfo.refs.size===1,activeLessons:lessonInfo.active,rule:lessonInfo.rule,ref:lessonInfo.ref}:{activeLessons:{},hasSharedRule:!0,hasSharedRef:!0,rule:null,ref:null}}function edit_lesson_metrics_availableLessonMetrics(lessons){const allMetrics=lessons.reduce((acc,lesson2)=>(lesson2.completions.forEach(metric=>{acc.add(metric.name)}),acc),new Set);return Array.from(allMetrics).sort().map(metric=>({value:metric,label:metric}))}function EditLessonMetrics({name,preferredLesson,lessons,lessonRefs,componentsByLesson,computeCompletions,namespace:namespace2,saveLessonMetrics,tags,onSave}){const[chosenName,setChosenName]=(0,react.useState)(name),[hasSharedRule,setHasSharedRule]=(0,react.useState)(!1),[sharedRule,setSharedRule]=(0,react.useState)(null),[sharedRuleParameters,setSharedRuleParameters]=(0,react.useState)([]),[hasSharedRef,setHasSharedRef]=(0,react.useState)(!1),[sharedRef,setSharedRef]=(0,react.useState)(null),[activeLessons,setActiveLessons]=(0,react.useState)({}),[selectedLessons,setSelectedLessons]=(0,react.useState)({}),[currentHash,setCurrentHash]=(0,react.useState)(null),[isNewMetric,setIsNewMetric]=(0,react.useState)(!1),[showComputeModal,setShowComputeModal]=(0,react.useState)(!1),[hasSaved,setHasSaved]=(0,react.useState)(!1),availableMetrics=(0,react.useRef)(null),analyzedHash=(0,react.useRef)(null),analysisRef=(0,react.useRef)(null),incorporateAnalysis=(0,react.useCallback)(analysis=>{setHasSharedRule(analysis.hasSharedRule);let newSharedRule=null,newSharedRuleParameters=[];const isSharedRuleSet=analysis.hasSharedRule&&analysis.rule&&analysis.rule[0];isSharedRuleSet&&(newSharedRule=completion_rules_namespaceObject[analysis.rule[0]],newSharedRuleParameters=analysis.rule.slice(1),setSharedRule(newSharedRule),setSharedRuleParameters(newSharedRuleParameters)),setHasSharedRef(analysis.hasSharedRef),analysis.hasSharedRef&&setSharedRef(analysis.ref);const lessonSpec={sharedRule:newSharedRule,sharedRuleParameters:newSharedRuleParameters,sharedRef:analysis.hasSharedRef?analysis.ref:null,activeLessons:edit_lesson_metrics_spreadValues({},analysis.activeLessons)},newSelectedLessons={};for(let i=0;i<lessons.length;i++){const lessonId=lessons[i]._id;lessonSpec.activeLessons[lessonId]?newSelectedLessons[lessonId]=!0:(newSelectedLessons[lessonId]=!1,lessonSpec.activeLessons[lessonId]={name:chosenName,rule:isSharedRuleSet?[lessonSpec.sharedRule.name,...lessonSpec.sharedRuleParameters]:null,ref:analysis.hasSharedRef?lessonSpec.sharedRef:null,coverage:["all"],level:"lesson"})}lessonSpec.selectedLessons=newSelectedLessons,analyzedHash.current=object_hash_default()(lessonSpec),setCurrentHash(analyzedHash.current),setActiveLessons(lessonSpec.activeLessons),setSelectedLessons(newSelectedLessons)},[chosenName,lessons]);(0,react.useEffect)(()=>{availableMetrics.current=edit_lesson_metrics_availableLessonMetrics(lessons)},[lessons]),(0,react.useEffect)(()=>{const analysis=edit_lesson_metrics_analyzeLessonMetrics(chosenName,lessons);analysisRef.current=analysis,incorporateAnalysis(analysis)},[incorporateAnalysis,lessons,chosenName]);const resetHash=(0,react.useCallback)(()=>{const lessonSpec={sharedRule:hasSharedRule?sharedRule:null,sharedRuleParameters:hasSharedRule?sharedRuleParameters:[],sharedRef:hasSharedRef?sharedRef:null,activeLessons,selectedLessons};setCurrentHash(object_hash_default()(lessonSpec))},[hasSharedRule,sharedRule,sharedRuleParameters,hasSharedRef,sharedRef,activeLessons,selectedLessons]);(0,react.useEffect)(resetHash,[resetHash]);const handleSave=(0,react.useCallback)(()=>{const lessonMetrics=edit_lesson_metrics_spreadValues({},activeLessons);namespace2.lessons.forEach(lesson2=>{selectedLessons[lesson2._id]?lessonMetrics[lesson2._id]=edit_lesson_metrics_spreadValues(edit_lesson_metrics_spreadValues(edit_lesson_metrics_spreadValues({},lessonMetrics[lesson2._id]),hasSharedRef?{ref:sharedRef}:{}),hasSharedRule?{rule:[sharedRule.name,...sharedRuleParameters]}:{}):lessonMetrics[lesson2._id]=null});const body={namespaceID:namespace2._id,name:chosenName,lessonMetrics};onSave(body),saveLessonMetrics(body).then(res=>{console.log("Saved lesson metrics:",res.data),setHasSaved(!0),resetHash()}).catch(err=>{})},[activeLessons,chosenName,namespace2,hasSharedRef,sharedRef,hasSharedRule,resetHash,selectedLessons,sharedRule,sharedRuleParameters,saveLessonMetrics,onSave]),{t}=(0,commonjs.$G)(),lessonRefOptions=lessonRefs.map(ref=>({value:ref,label:ref})),allRulesOptions=values_lib_default()(completion_rules_namespaceObject).map(rule=>({value:rule,label:rule.label})),sharedInputs=react.createElement(react.Fragment,null,react.createElement(Form_default().Group,{className:"mb-2",as:Row_default()},react.createElement(Col.default,{sm:4},react.createElement(Form_default().Check,{type:"checkbox",id:"shared-rule-checkbox",label:t("share-across-lessons"),onChange:event=>{setHasSharedRule(event.target.checked)},checked:hasSharedRule})),react.createElement(Form_default().Label,{column:!0,sm:2},t("common:rule")),react.createElement(Col.default,{sm:6},react.createElement(react_select_cjs_prod.ZP,{isDisabled:!hasSharedRule,options:allRulesOptions,onChange:option=>{const newRule=option.value;setSharedRule(newRule),setSharedRuleParameters(newRule.defaults)},value:sharedRule?{value:sharedRule,label:sharedRule.label}:null}))),hasSharedRule&&sharedRule&&sharedRule.parameters.length>0&&sharedRule.parameters.map((parameter,idx)=>react.createElement(Form_default().Group,{key:`param-${idx}`,className:"mb-2",as:Row_default()},react.createElement(Col.default,{sm:4}),react.createElement(Form_default().Label,{column:!0,sm:2},parameter.name),react.createElement(Col.default,{sm:6},react.createElement(Form_default().Control,{name:parameter.name,type:parameter.type,placeholder:t("enter-parameter-value"),onChange:event=>{const newParams=sharedRuleParameters.slice();newParams[idx]=edit_lesson_metrics_convertRuleParameter(event.target.value,parameter),setSharedRuleParameters(newParams)},defaultValue:sharedRuleParameters[idx]!==void 0?sharedRuleParameters[idx]:sharedRule.defaults[idx]})))),react.createElement(Form_default().Group,{className:"mb-2",as:Row_default()},react.createElement(Col.default,{sm:4},react.createElement(Form_default().Check,{type:"checkbox",id:"shared-ref-checkbox",label:t("share-across-lessons"),onChange:event=>{setHasSharedRef(event.target.checked)},checked:hasSharedRef})),react.createElement(Form_default().Label,{column:!0,sm:2},t("common:component-metric")),react.createElement(Col.default,{sm:6},react.createElement(react_select_cjs.default,{isClearable:!0,isDisabled:!hasSharedRef,options:lessonRefOptions,onChange:option=>{setSharedRef(option?option.value:null)},value:sharedRef?{value:sharedRef,label:sharedRef}:null})))),lessonInputs=Array.from(lessons).sort(preferredLesson?(a,b)=>a.title===preferredLesson.title?-1:b.title===preferredLesson.title?1:a.title.localeCompare(b.title):(a,b)=>a.title.localeCompare(b.title)).map(x=>{const lessonIsActive=selectedLessons[x._id];let defaultRuleParameters,defaultRule,defaultRef;if(lessonIsActive)if(hasSharedRef&&sharedRef?defaultRef={value:sharedRef,label:sharedRef}:defaultRef=activeLessons[x._id].ref?{value:activeLessons[x._id].ref,label:activeLessons[x._id].ref}:null,hasSharedRule&&sharedRule)defaultRule={value:sharedRule,label:sharedRule.label},defaultRuleParameters=sharedRuleParameters;else if(activeLessons[x._id].rule){const activeRule=completion_rules_namespaceObject[activeLessons[x._id].rule[0]];defaultRule={value:activeRule,label:activeRule.label},defaultRuleParameters=activeLessons[x._id].rule.slice(1)}else defaultRule=null,defaultRuleParameters=[];const activeLesson=activeLessons[x._id],coverage=(activeLesson==null?void 0:activeLesson.coverage)||["all"],coverageQualifier=coverage[0],coverageEntities=coverage.slice(1).map(edit_lesson_metrics_selectOption);return react.createElement(react.Fragment,null,react.createElement(Form_default().Check,{type:"switch",id:"custom-switch",label:x.title,key:x._id,onChange:event=>{const newSelected=edit_lesson_metrics_spreadValues({},selectedLessons);newSelected[x._id]=event.target.checked,setSelectedLessons(newSelected)},checked:lessonIsActive}),lessonIsActive&&react.createElement(react.Fragment,null,react.createElement(Form_default().Group,{className:"mb-2",as:Row_default()},react.createElement(Col.default,{sm:2}),react.createElement(Form_default().Label,{column:!0,sm:4},t("common:rule")),react.createElement(Col.default,{sm:6},react.createElement(react_select_cjs_prod.ZP,{options:allRulesOptions,isDisabled:hasSharedRule,onChange:option=>{const newActive=edit_lesson_metrics_spreadValues({},activeLessons);newActive[x._id].rule=[option.value.name,...option.value.defaults],setActiveLessons(newActive)},value:defaultRule,menuPortalTarget:document.body,menuPlacement:"auto",styles:edit_lesson_metrics_SELECT_STYLES}))),defaultRuleParameters.length>0&&defaultRuleParameters.map((value,idx)=>{const parameter=completion_rules_namespaceObject[defaultRule.value.name].parameters[idx];return react.createElement(Form_default().Group,{key:`${x._id}-param-${idx}`,className:"mb-2",as:Row_default()},react.createElement(Col.default,{sm:4}),react.createElement(Form_default().Label,{column:!0,sm:2},parameter.name),react.createElement(Col.default,{sm:6},react.createElement(Form_default().Control,{name:parameter.name,type:parameter.type,placeholder:t("enter-parameter-value"),disabled:hasSharedRule,onChange:event=>{const newActive=edit_lesson_metrics_spreadValues({},activeLessons);newActive[x._id].rule[idx+1]=edit_lesson_metrics_convertRuleParameter(event.target.value,parameter),setActiveLessons(newActive)},value:defaultRuleParameters[idx]})))}),react.createElement(Form_default().Group,{className:"mb-2",as:Row_default()},react.createElement(Col.default,{sm:2}),react.createElement(Form_default().Label,{column:!0,sm:4},t("common:component-metric")),react.createElement(Col.default,{sm:6},react.createElement(react_select_cjs.default,{isClearable:!0,isDisabled:hasSharedRef,options:lessonRefOptions,onChange:option=>{const newActive=edit_lesson_metrics_spreadValues({},activeLessons);newActive[x._id].ref=option?option.value:null,setActiveLessons(newActive)},value:defaultRef,menuPortalTarget:document.body,menuPlacement:"auto",styles:edit_lesson_metrics_SELECT_STYLES}))),react.createElement(Form_default().Group,{className:"mb-2",as:Row_default()},react.createElement(Col.default,{sm:2}),react.createElement(Form_default().Label,{column:!0,sm:4},t("common:coverage")),react.createElement(Col.default,{sm:6},react.createElement(react_select_cjs_prod.ZP,{options:edit_lesson_metrics_COVERAGE_OPTIONS_ARRAY,onChange:option=>{const newActive=edit_lesson_metrics_spreadValues({},activeLessons);newActive[x._id].coverage[0]=option.value,setActiveLessons(newActive)},value:coverage_options_namespaceObject[coverageQualifier]}),coverageQualifier==="include"||coverageQualifier==="exclude"?react.createElement(react_select_cjs.default,{isMulti:!0,options:(componentsByLesson[x._id]||[]).map(y=>{const label=y.componentType?`${y.component} (type ${y.componentType})`:y.component;return{value:y.component,label}}),onChange:option=>{const newActive=edit_lesson_metrics_spreadValues({},activeLessons);newActive[x._id].coverage=[coverageQualifier,...option.map(x2=>x2.value)],setActiveLessons(newActive)},value:coverageEntities,placeholder:"Select component identifiers..."}):null))))}),hasUnsavedChanges=currentHash!==analyzedHash.current,saveBar=chosenName&&react.createElement(react.Fragment,null,react.createElement(Button_default(),{variant:hasUnsavedChanges?"warning":"secondary",disabled:!hasUnsavedChanges,onClick:()=>{analysisRef.current&&incorporateAnalysis(analysisRef.current)},className:"me-2 ms-auto w-25"},t("discard-unsaved-changes")),react.createElement(Button_default(),{variant:"success",onClick:handleSave,className:"me-2",disabled:!hasUnsavedChanges||!sharedRef||!sharedRule||isNewMetric&&Object.values(selectedLessons).every(x=>!x)},t("common:save")),react.createElement(Button_default(),{variant:"info",disabled:hasUnsavedChanges||isNewMetric&&!hasSaved,onClick:()=>{setShowComputeModal(!0)}},t("compute")));return react.createElement(react.Fragment,null,react.createElement(Card_default(),{className:"pb-3"},react.createElement(Card_default().Body,null,react.createElement("p",null,t("lesson-metrics-description")),react.createElement("div",{className:"d-flex w-100 mb-2"},react.createElement("span",null,react.createElement(InputGroup_default(),{className:"mb-2"},react.createElement(InputGroup_default().Text,null,t("metric-name")),react.createElement(react_select_cjs.default,{name:"metric-name",placeholder:t("metric-name-placeholder"),onChange:value=>{value?setChosenName(value.value):(setChosenName(null),setSharedRule(null),setSharedRef(null))},onCreateOption:inputValue=>{console.log("Creating new lesson metric: ",inputValue),setChosenName(inputValue),setIsNewMetric(!0)},value:chosenName?{value:chosenName,label:chosenName}:null,isClearable:!0,isDisabled:name||currentHash&&currentHash!==analyzedHash.current,options:availableMetrics.current}))),saveBar),chosenName?react.createElement(react.Fragment,null,sharedInputs,react.createElement(Form_default().Check,{type:"switch",id:"all-lessons-switch",label:react.createElement("h3",null,"All Lessons"),onChange:event=>{const newSelectedLessons={};lessons.forEach(lesson2=>{newSelectedLessons[lesson2._id]=event.target.checked}),setSelectedLessons(newSelectedLessons)},checked:Object.values(selectedLessons).every(x=>x)}),react.createElement("div",{style:{maxHeight:"75vh",minHeight:"50vh",border:"solid 1px darkgray",overflowY:"auto",padding:4,overflowX:"hidden"}},lessonInputs)):null,react.createElement("div",{className:"d-flex w-100 mt-2",style:{height:46}},saveBar))),showComputeModal&&react.createElement(compute_modal.Z,{metric:namespace2.lessons.reduce((acc,lesson2)=>(selectedLessons[lesson2._id]&&acc.push(edit_lesson_metrics_spreadValues(edit_lesson_metrics_spreadValues(edit_lesson_metrics_spreadValues({},activeLessons[lesson2._id]),hasSharedRef?{ref:sharedRef}:{}),hasSharedRule?{rule:[sharedRule.name,...sharedRuleParameters]}:{})),acc),[]),show:showComputeModal,onHide:()=>setShowComputeModal(!1),cohorts:namespace2.cohorts,tags,entity:lessons.filter(x=>selectedLessons[x._id]),level:"lesson",onCompute:()=>setShowComputeModal(!1),computeCompletions}))}EditLessonMetrics.propTypes={componentsByLesson:prop_types_default().object,computeCompletions:prop_types_default().func.isRequired,lessonRefs:prop_types_default().arrayOf(prop_types_default().string).isRequired,lessons:prop_types_default().array.isRequired,name:prop_types_default().string,namespace:prop_types_default().object.isRequired,onSave:prop_types_default().func.isRequired,preferredLesson:prop_types_default().object,saveLessonMetrics:prop_types_default().func.isRequired,tags:prop_types_default().arrayOf(prop_types_default().string)},EditLessonMetrics.defaultProps={name:null,componentsByLesson:{},preferredLesson:null,tags:[]};var edit_lesson_metrics=EditLessonMetrics,check_url_path=__webpack_require__(48297),browser=__webpack_require__(11227),browser_default=__webpack_require__.n(browser),FormCheck=__webpack_require__(3692),FormCheck_default=__webpack_require__.n(FormCheck),react_dates=__webpack_require__(76141),moment=__webpack_require__(30381),moment_default=__webpack_require__.n(moment),is_email_address_lib=__webpack_require__(11738),is_email_address_lib_default=__webpack_require__.n(is_email_address_lib),_datepicker=__webpack_require__(71990),edit_cohort_modal_defProp=Object.defineProperty,edit_cohort_modal_defNormalProp=(obj,key,value)=>key in obj?edit_cohort_modal_defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__publicField=(obj,key,value)=>(edit_cohort_modal_defNormalProp(obj,typeof key!="symbol"?key+"":key,value),value);const debug=browser_default()("isle-dashboard:edit-cohort");function validateInputs({emails,title}){let invalid=!1;return emails.forEach(owner=>{is_email_address_lib_default()(owner)||(invalid=!0)}),invalid?!1:title.length>=4}class EditCohortModal extends react.Component{constructor(props){super(props),__publicField(this,"handleInputChange",event=>{const target=event.target,name=target.name;let value=target.value;this.setState({[name]:value},()=>{this.setState({disabled:!validateInputs({emails:this.state.members,title:this.state.title})})})}),__publicField(this,"handleUpdate",()=>{const updatedCohort={_id:this.props._id,emailFilter:this.state.emailFilter,startDate:this.state.startDate.startOf("day").toDate(),endDate:this.state.endDate.endOf("day").toDate(),members:this.state.members.join(","),title:this.state.title,private:this.state.private};this.props.onUpdate(updatedCohort),this.props.onHide()}),__publicField(this,"handleDelete",()=>{this.props.onDelete(this.props._id),this.closeDeleteModal(),this.props.onHide()}),__publicField(this,"closeDeleteModal",()=>{this.setState({showDeleteModal:!1})}),__publicField(this,"handleStudentChange",newValue=>{debug("Handle change of cohort members...");const members=is_array_lib_default()(newValue)?newValue.map(x=>x.value):[];this.setState({members,disabled:!validateInputs({emails:members,title:this.state.title})})}),this.state={disabled:!1,startDate:moment_default()(props.startDate),endDate:moment_default()(props.endDate),title:props.title,members:props.members.map(user=>user.email),showDeleteModal:!1,private:props.private,emailFilter:props.emailFilter}}render(){const{t}=this.props,content=react.createElement(Form_default(),{style:{padding:"10px"}},react.createElement(Row_default(),null,react.createElement(Col.default,{md:6},react.createElement(OverlayTrigger_default(),{placement:"right",overlay:react.createElement(Tooltip_default(),{id:"titleTooltip"},t("cohort-title-tooltip"))},react.createElement(FormGroup_default(),null,react.createElement(FormLabel_default(),null,t("common:title")),react.createElement(FormControl_default(),{name:"title",type:"text",value:this.state.title,onChange:this.handleInputChange})))),react.createElement(Col.default,{md:6},react.createElement(FormGroup_default(),null,react.createElement(FormLabel_default(),null,t("cohort-period")),react.createElement("br",null),react.createElement(react_dates.DateRangePicker,{startDateId:"panel_start_date_input",endDateId:"panel_end_date_input",startDate:this.state.startDate,endDate:this.state.endDate,onDatesChange:({startDate,endDate})=>this.setState({startDate,endDate}),focusedInput:this.state.focusedInput,onFocusChange:focusedInput=>this.setState({focusedInput})})))),react.createElement("hr",null),react.createElement(Row_default(),null,react.createElement(OverlayTrigger_default(),{placement:"right",overlay:react.createElement(Tooltip_default(),{id:"enrolledTooltip"},t("enrolled-tooltip"))},react.createElement(FormGroup_default(),{className:"cohort-modal-enrolled-group"},react.createElement(FormLabel_default(),null,t("enrolled-students")),react.createElement(text_select.Z,{placeholder:t("enter-emails"),defaultValue:this.state.members,onChange:this.handleStudentChange,styles:{control:()=>({width:"100%"})}})))),react.createElement("hr",null),react.createElement(Row_default(),null,react.createElement(OverlayTrigger_default(),{placement:"left",overlay:react.createElement(Tooltip_default(),{id:"preventTooltip"},t("prevent-tooltip"))},react.createElement(FormCheck_default(),{checked:this.state.private,onChange:event=>{this.setState({private:!this.state.private})},type:"checkbox",label:t("prevent-label")}))),react.createElement("hr",null),react.createElement(Row_default(),null,react.createElement(OverlayTrigger_default(),{placement:"right",overlay:react.createElement(Tooltip_default(),{id:"filterTooltip"},t("filter-tooltip"))},react.createElement(FormGroup_default(),null,react.createElement(FormLabel_default(),null,t("email-filter")),react.createElement(FormControl_default(),{style:{width:"25vw"},name:"emailFilter",type:"text",value:this.state.emailFilter,placeholder:t("filter-placeholder"),onChange:this.handleInputChange})))));return react.createElement(react.Fragment,null,react.createElement(Modal_default(),{size:"lg",show:this.props.show,onHide:this.props.onHide},react.createElement(Modal_default().Header,{closeButton:!0},react.createElement(Modal_default().Title,{as:"h3"},t("edit-cohort",{title:this.props.title}))),react.createElement(Modal_default().Body,null,content),react.createElement(Modal_default().Footer,null,react.createElement(ButtonGroup_default(),null,react.createElement(Button_default(),{onClick:()=>{this.setState({showDeleteModal:!0})},variant:"danger"},t("common:delete")),react.createElement(Button_default(),{onClick:this.props.onHide},t("common:cancel")),react.createElement(Button_default(),{variant:"success",disabled:this.state.disabled,onClick:this.handleUpdate},t("common:save"))))),react.createElement(confirm_modal.Z,{show:this.state.showDeleteModal,close:this.closeDeleteModal,message:t("delete-cohort"),title:`${t("delete")}?`,onConfirm:this.handleDelete}))}}EditCohortModal.propTypes={_id:prop_types_default().string.isRequired,emailFilter:prop_types_default().string.isRequired,endDate:prop_types_default().string,members:prop_types_default().array.isRequired,onDelete:prop_types_default().func,onHide:prop_types_default().func.isRequired,onUpdate:prop_types_default().func,private:prop_types_default().bool.isRequired,show:prop_types_default().bool.isRequired,startDate:prop_types_default().string.isRequired,t:prop_types_default().func.isRequired,title:prop_types_default().string.isRequired},EditCohortModal.defaultProps={endDate:null,onUpdate(){},onDelete(){}};var edit_cohort_modal=EditCohortModal;function create_cohort_modal_validateInputs(emails,title){let invalid=!1;return emails.forEach(owner=>{is_email_address_lib_default()(owner)||(invalid=!0)}),invalid?!1:title.length>=4}const CreateCohortModal=({close,onCreate,show,t})=>{const[title,setTitle]=(0,react.useState)(""),[emailFilter,setEmailFilter]=(0,react.useState)(""),[dates,setDates]=(0,react.useState)({start:moment_default()().startOf("day"),end:moment_default()().add(3,"months").endOf("day")}),[isPrivate,setIsPrivate]=(0,react.useState)(!1),[students,setStudents]=(0,react.useState)([]),[focusedInput,setFocusedInput]=(0,react.useState)(null),handleClose=()=>{close()},handleCreate=()=>{const cohort2={emailFilter,title,startDate:dates.start.startOf("day").toDate(),endDate:dates.end.endOf("day").toDate(),private:isPrivate,students:students.join(",")};onCreate(cohort2)},disabled=!create_cohort_modal_validateInputs(students,title),body=react.createElement(Form_default(),{style:{paddingLeft:20,paddingRight:20}},react.createElement(Row_default(),null,react.createElement(Col.default,{md:6},react.createElement(OverlayTrigger_default(),{placement:"right",overlay:react.createElement(Tooltip_default(),{id:"titleTooltip"},t("cohort-title-tooltip"))},react.createElement(FormGroup_default(),null,react.createElement(FormLabel_default(),null,t("common:title")),react.createElement(FormControl_default(),{name:"title",type:"text",placeholder:t("cohort-title-placeholder"),onChange:event=>setTitle(event.target.value)})))),react.createElement(Col.default,{md:6},react.createElement(FormGroup_default(),null,react.createElement(FormLabel_default(),null,t("cohort-period")),react.createElement(react_dates.DateRangePicker,{startDateId:"start_date_input",endDateId:"end_date_input",startDate:dates.start,endDate:dates.end,onDatesChange:({startDate,endDate})=>{setDates({start:startDate,end:endDate})},focusedInput,onFocusChange:setFocusedInput})))),react.createElement("hr",null),react.createElement(Row_default(),null,react.createElement(OverlayTrigger_default(),{placement:"right",overlay:react.createElement(Tooltip_default(),{id:"enrolledTooltip"},t("enrolled-tooltip"))},react.createElement(FormGroup_default(),{className:"cohort-modal-enrolled-group"},react.createElement(FormLabel_default(),null,t("enrolled-students")),react.createElement(text_select.Z,{placeholder:t("enter-emails"),onChange:newValue=>{const newStudents=is_array_lib_default()(newValue)?newValue.map(x=>x.value):[];setStudents(newStudents)},defaultValue:students,isClearable:!0,styles:{control:()=>({width:"100%"})}})))),react.createElement("hr",null),react.createElement(Row_default(),null,react.createElement(OverlayTrigger_default(),{placement:"left",overlay:react.createElement(Tooltip_default(),{id:"preventTooltip"},t("prevent-tooltip"))},react.createElement(FormCheck_default(),{checked:isPrivate,onChange:()=>{setIsPrivate(!isPrivate)},type:"checkbox",label:t("prevent-label")}))),react.createElement("hr",null),react.createElement(Row_default(),null,react.createElement(OverlayTrigger_default(),{placement:"right",overlay:react.createElement(Tooltip_default(),{id:"filterTooltip"},t("filter-tooltip"))},react.createElement(FormGroup_default(),null,react.createElement(FormLabel_default(),null,t("email-filter")),react.createElement(FormControl_default(),{style:{width:"25vw"},name:"emailFilter",type:"text",placeholder:t("filter-placeholder"),onChange:event=>setEmailFilter(event.target.value)})))));return react.createElement(Modal_default(),{size:"lg",show,onHide:handleClose},react.createElement(Modal_default().Header,{closeButton:!0},react.createElement(Modal_default().Title,{as:"h3"},t("create-new-cohort"))),react.createElement(Modal_default().Body,null,body),react.createElement(Modal_default().Footer,null,react.createElement(Button_default(),{onClick:handleClose},t("common:cancel")),react.createElement(Button_default(),{variant:"success",disabled,onClick:handleCreate},t("common:create"))))};CreateCohortModal.propTypes={close:prop_types_default().func,onCreate:prop_types_default().func,show:prop_types_default().bool,t:prop_types_default().func.isRequired},CreateCohortModal.defaultProps={close(){},onCreate(){},show:!1};var create_cohort_modal=CreateCohortModal,__async=(__this,__arguments,generator)=>new Promise((resolve,reject)=>{var fulfilled=value=>{try{step(generator.next(value))}catch(e){reject(e)}},rejected=value=>{try{step(generator.throw(value))}catch(e){reject(e)}},step=x=>x.done?resolve(x.value):Promise.resolve(x.value).then(fulfilled,rejected);step((generator=generator.apply(__this,__arguments)).next())});const ImportCourseModal=({namespaces,show,close,targetNamespace,copyNamespaceLessons,t})=>{const[selectedCourse,setSelectedCourse]=(0,react.useState)(null),handleSelection=obj=>{setSelectedCourse(obj.value)},handleImport=()=>__async(void 0,null,function*(){(yield copyNamespaceLessons({source:selectedCourse.title,target:targetNamespace.title}))instanceof Error||close()}),options=namespaces.map(x=>({label:x.title,value:x}));return react.createElement(Modal_default(),{size:"lg",show,onHide:close},react.createElement(Modal_default().Header,{closeButton:!0},react.createElement(Modal_default().Title,{as:"h3"},t("import-course"))),react.createElement(Modal_default().Body,null,react.createElement("p",null,t("import-course-description")),react.createElement(Form_default().Group,{controlId:"form-course-select"},react.createElement(Form_default().Label,null,t("select-namespace")),react.createElement(react_select_cjs_prod.ZP,{options,onChange:handleSelection}))),react.createElement(Modal_default().Footer,null,react.createElement(Button_default(),{onClick:close},t("common:cancel")),react.createElement(Button_default(),{variant:"success",disabled:!selectedCourse,onClick:handleImport},t("common:import"))))};ImportCourseModal.propTypes={close:prop_types_default().func.isRequired,copyNamespaceLessons:prop_types_default().func.isRequired,namespaces:prop_types_default().array,show:prop_types_default().bool,t:prop_types_default().func.isRequired,targetNamespace:prop_types_default().object.isRequired},ImportCourseModal.defaultProps={namespaces:[],show:!1};var import_course_modal=ImportCourseModal,edit_namespace_defProp=Object.defineProperty,edit_namespace_defProps=Object.defineProperties,edit_namespace_getOwnPropDescs=Object.getOwnPropertyDescriptors,edit_namespace_getOwnPropSymbols=Object.getOwnPropertySymbols,edit_namespace_hasOwnProp=Object.prototype.hasOwnProperty,edit_namespace_propIsEnum=Object.prototype.propertyIsEnumerable,edit_namespace_defNormalProp=(obj,key,value)=>key in obj?edit_namespace_defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,edit_namespace_spreadValues=(a,b)=>{for(var prop in b||(b={}))edit_namespace_hasOwnProp.call(b,prop)&&edit_namespace_defNormalProp(a,prop,b[prop]);if(edit_namespace_getOwnPropSymbols)for(var prop of edit_namespace_getOwnPropSymbols(b))edit_namespace_propIsEnum.call(b,prop)&&edit_namespace_defNormalProp(a,prop,b[prop]);return a},edit_namespace_spreadProps=(a,b)=>edit_namespace_defProps(a,edit_namespace_getOwnPropDescs(b)),edit_namespace_publicField=(obj,key,value)=>(edit_namespace_defNormalProp(obj,typeof key!="symbol"?key+"":key,value),value);class EditNamespace extends react.Component{constructor(props){super(props),edit_namespace_publicField(this,"handleInputChange",event=>{const target=event.target,name=target.name;let value=target.value;this.setState({[name]:value})}),edit_namespace_publicField(this,"handleUpdate",()=>{this.props.updateCurrentNamespace({_id:this.props.namespace._id,description:this.state.description,title:this.state.title,enableTicketing:this.state.enableTicketing,owners:this.state.owners})}),edit_namespace_publicField(this,"handleDelete",()=>{this.props.deleteCurrentNamespace(this.props.namespace._id,this.props.history)}),edit_namespace_publicField(this,"close",()=>{this.setState({showModal:!1})}),edit_namespace_publicField(this,"closeDeleteModal",()=>{this.setState({showDeleteModal:!1})}),edit_namespace_publicField(this,"closeCreateCohortModal",()=>{this.setState({showCreateCohortModal:!1})}),edit_namespace_publicField(this,"closeImportModal",()=>{this.setState({showImportModal:!1})}),edit_namespace_publicField(this,"createCohort",cohort2=>{cohort2.namespaceID=this.props.namespace._id,this.props.createCohort(cohort2,this.props.namespace._id),this.closeCreateCohortModal()}),edit_namespace_publicField(this,"deleteCohort",cohortID=>{this.props.deleteCohort(cohortID,this.props.namespace._id)}),edit_namespace_publicField(this,"updateCohort",cohort2=>{this.props.updateCohort(cohort2,this.props.namespace._id)}),edit_namespace_publicField(this,"handleOwnerChange",newValue=>{if(!newValue)return this.setState({owners:[]});const owners2=newValue.map(x=>trim_lib_default()(x.value));this.setState({owners:owners2})}),edit_namespace_publicField(this,"closeEditCohortModal",()=>{this.setState({selectedCohort:null,showEditCohortModal:!1})}),edit_namespace_publicField(this,"cohortModalFactory",idx=>()=>{this.setState({selectedCohort:this.props.cohorts[idx],showEditCohortModal:!0})});let{title,description,owners,enableTicketing}=this.props.namespace;is_array_lib_default()(owners)&&(owners=owners.map(owner=>owner.email)),this.state={title,description,owners,enableTicketing,showDeleteModal:!1,showImportModal:!1,showCreateCohortModal:!1,showEditCohortModal:!1,selectedCohort:null,lessonRefs:[]}}componentDidMount(){axios_default().post(`${server.ZP}/completion_refs`,{target:"lesson",entities:this.props.namespace.lessons.map(x=>x._id)}).then(response=>{this.setState({lessonRefs:response.data})}).catch(err=>{console.log("Error fetching completion refs:",err)})}renderModals(){const{t}=this.props;return react.createElement(react.Fragment,null,react.createElement(message_modal,{show:this.state.showModal,close:this.close,message:this.state.message,successful:this.state.successful,title:t("update-course")}),react.createElement(confirm_modal.Z,{show:this.state.showDeleteModal,close:this.closeDeleteModal,message:t("delete-course"),title:`${t("delete")}?`,onConfirm:this.handleDelete}),this.state.showCreateCohortModal?react.createElement(create_cohort_modal,{show:this.state.showCreateCohortModal,close:this.closeCreateCohortModal,onCreate:this.createCohort,t:this.props.t}):null,this.state.showImportModal?react.createElement(import_course_modal,{show:this.state.showImportModal,close:this.closeImportModal,namespaces:this.props.user.ownedNamespaces,targetNamespace:this.props.namespace,copyNamespaceLessons:this.props.copyNamespaceLessons,t:this.props.t}):null,this.state.showEditCohortModal?react.createElement(edit_cohort_modal,edit_namespace_spreadProps(edit_namespace_spreadValues({show:this.state.showEditCohortModal},this.state.selectedCohort),{onDelete:this.deleteCohort,onHide:this.closeEditCohortModal,onUpdate:this.updateCohort,t:this.props.t})):null)}renderCohortList(){const{t}=this.props;return react.createElement(ListGroup_default(),null,this.props.cohorts.map((cohort2,idx)=>react.createElement(ListGroupItem_default(),{variant:"light",eventKey:idx,key:idx,style:{backgroundColor:"white"}},react.createElement("label",null,cohort2.title),react.createElement("span",{style:{marginLeft:5,color:"black"}},"(",t("no-students"),":"),react.createElement(Badge_default(),{bg:"primary"},cohort2.members.length),react.createElement("span",{style:{color:"black"}},")"),react.createElement(Button_default(),{size:"sm",onClick:this.cohortModalFactory(idx),style:{float:"right"}},t("common:edit")))))}render(){const{t}=this.props;if(!this.props.namespace._id)return react.createElement(Container_default(),{className:"edit-namespace-container"},react.createElement(Alert_default(),{variant:"danger"},t("common:no-course-selected")));const validTitle=(0,create_namespace.uq)(this.state.title),invalidTitleChars=(0,check_url_path.Z)(this.state.title),validDescription=(0,create_namespace.O5)(this.state.description),validOwners=(0,create_namespace.OT)(this.state.owners);return react.createElement(Container_default(),{className:"edit-namespace-container"},react.createElement(Row_default(),null,react.createElement(Col.default,{sm:9},react.createElement(Card_default(),null,react.createElement(Tabs_default(),{defaultActiveKey:"manage-cohorts"},react.createElement(Tab_default(),{eventKey:"manage-cohorts",title:react.createElement("h3",null,t("manage-cohorts")),style:{padding:12}},this.renderCohortList(),react.createElement(Button_default(),{size:"small",variant:"success",style:{marginTop:10,background:"#3c763d"},onClick:()=>{this.setState({showCreateCohortModal:!0})}},t("create-cohort"))),react.createElement(Tab_default(),{eventKey:"completions",title:react.createElement("h3",null,t("completions"))},react.createElement(Tabs_default(),{variant:"pills",defaultActiveKey:"namespace-completion-metrics"},react.createElement(Tab_default(),{eventKey:"namespace-completion-metrics",title:t("course-wide")},react.createElement(visible_completions,{entity:this.props.namespace,level:"namespace",cohorts:this.props.cohorts,lessonRefs:this.state.lessonRefs})),react.createElement(Tab_default(),{eventKey:"lesson-completion-metrics",title:t("lessons")},react.createElement(edit_lesson_metrics,{lessonRefs:this.state.lessonRefs,lessons:this.props.namespace.lessons,namespace:this.props.namespace,onSave:()=>{},saveLessonMetrics:this.props.saveLessonMetrics,componentsByLesson:this.props.namespace.componentsByLesson,computeCompletions:this.props.computeCompletions,tags:this.props.namespace.tags})))),react.createElement(Tab_default(),{eventKey:"edit-course",title:react.createElement("h3",null,t("edit-course")),style:{padding:12}},react.createElement(Form_default(),{style:{padding:"20px"},className:"d-grid gap-3"},react.createElement(OverlayTrigger_default(),{placement:"right",overlay:react.createElement(Tooltip_default(),{id:"ownerTooltip"},t("owner-tooltip"))},react.createElement(FormGroup_default(),null,react.createElement(FormLabel_default(),{htmlFor:"owners-text-select"},t("common:owners")),react.createElement(text_select.Z,{id:"owners-text-select",placeholder:t("enter-emails"),onChange:this.handleOwnerChange,defaultValue:this.state.owners,isInvalid:!(0,create_namespace.OT)(this.state.owners)}),react.createElement(FormControl_default().Feedback,{type:"invalid"},t("invalid-owners")))),react.createElement(OverlayTrigger_default(),{placement:"right",overlay:react.createElement(Tooltip_default(),{id:"courseTooltip"},t("accessible-at"),react.createElement("code",null,server.ZP+"/<course>/<lesson>"))},react.createElement(FormGroup_default(),{controlId:"form-course"},react.createElement(FormLabel_default(),null,t("course-identifier")),react.createElement(FormControl_default(),{name:"title",type:"text",value:this.state.title,onChange:this.handleInputChange,isInvalid:!validTitle}),react.createElement(FormControl_default().Feedback,{type:"invalid"},invalidTitleChars?"Course identifier contains invalid character(s): "+invalidTitleChars[0]:"Course identifier must be at least three characters long and should not contain any spaces."))),react.createElement(OverlayTrigger_default(),{placement:"right",overlay:react.createElement(Tooltip_default(),{id:"titleTooltip"},t("title-tooltip"))},react.createElement(FormGroup_default(),{controlId:"form-description"},react.createElement(FormLabel_default(),null,t("title-description")),react.createElement(FormControl_default(),{name:"description",type:"text",value:this.state.description,onChange:this.handleInputChange,isInvalid:!validDescription}),react.createElement(FormControl_default().Feedback,{type:"invalid"},t("invalid-description")))),react.createElement(Form_default().Check,{"aria-label":t("enable-ticketing"),type:"checkbox",label:t("enable-ticketing"),defaultChecked:this.state.enableTicketing,onChange:event=>{this.setState({enableTicketing:event.target.checked})}})),react.createElement(Button_default(),{type:"submit",disabled:!validOwners||!validTitle||!validDescription,onClick:this.handleUpdate},t("common:update")),this.renderModals()),react.createElement(Tab_default(),{eventKey:"permissions",title:react.createElement("h3",null,t("permissions")),disabled:!0})))),react.createElement(Col.default,{sm:3},react.createElement(Card_default(),null,react.createElement(Card_default().Body,null,react.createElement(ButtonGroup_default(),{vertical:!0},react.createElement(Button_default(),{onClick:()=>{this.setState({showImportModal:!0})},variant:"outline-danger"},t("import-existing-course")),react.createElement(Button_default(),{onClick:()=>{this.setState({showDeleteModal:!0})},variant:"outline-danger"},t("delete-namespace"))))))))}}EditNamespace.propTypes={addNotification:prop_types_default().func.isRequired,cohorts:prop_types_default().array,computeCompletions:prop_types_default().func.isRequired,copyNamespaceLessons:prop_types_default().func.isRequired,createCohort:prop_types_default().func.isRequired,deleteCohort:prop_types_default().func.isRequired,deleteCurrentNamespace:prop_types_default().func.isRequired,history:prop_types_default().object.isRequired,namespace:prop_types_default().object.isRequired,saveLessonMetrics:prop_types_default().func.isRequired,t:prop_types_default().func.isRequired,updateCohort:prop_types_default().func.isRequired,updateCurrentNamespace:prop_types_default().func.isRequired,user:prop_types_default().object.isRequired},EditNamespace.defaultProps={cohorts:[]};var edit_namespace=(0,commonjs.Zh)(["namespace","common"])(EditNamespace),cohort=__webpack_require__(72371),namespace=__webpack_require__(23218),lesson=__webpack_require__(36189);function visible_edit_namespace_mapStateToProps(state){return{user:state.user,namespace:state.namespace,cohorts:state.namespace.cohorts}}function visible_edit_namespace_mapDispatchToProps(dispatch){return{addNotification:(0,notification.pP)(dispatch),createCohort:(0,cohort.CA)(dispatch),deleteCohort:(0,cohort.p6)(dispatch),updateCohort:(0,cohort.nm)(dispatch),deleteCurrentNamespace:(0,namespace.kC)(dispatch),updateCurrentNamespace:(0,namespace.J3)(dispatch),copyNamespaceLessons:(0,lesson.Ao)(dispatch),computeCompletions:(0,actions_completions.sA)(dispatch),saveLessonMetrics:(0,actions_completions.Uw)(dispatch)}}var visible_edit_namespace=(0,lib.connect)(visible_edit_namespace_mapStateToProps,visible_edit_namespace_mapDispatchToProps)(edit_namespace)},48297:function(__unused_webpack_module,__webpack_exports__){const REGEXP_CHARS=/[!#$%&+^<=>{}()[\]`]/;function checkURLPath(str){return str.match(REGEXP_CHARS)}__webpack_exports__.Z=checkURLPath}}]);

//# sourceMappingURL=1847.4b6e9f39.chunk.js.map