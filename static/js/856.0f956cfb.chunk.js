"use strict";(self.webpackChunkisle_dashboard=self.webpackChunkisle_dashboard||[]).push([[856],{52443:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:function(){return visible_profile_page}});var react=__webpack_require__(67294),lib=__webpack_require__(37424),prop_types=__webpack_require__(45697),prop_types_default=__webpack_require__.n(prop_types),commonjs=__webpack_require__(81468),path_browserify=__webpack_require__(26470),path_browserify_default=__webpack_require__.n(path_browserify),Button=__webpack_require__(89876),Button_default=__webpack_require__.n(Button),Card=__webpack_require__(51889),Card_default=__webpack_require__.n(Card),Nav=__webpack_require__(75655),Nav_default=__webpack_require__.n(Nav),OverlayTrigger=__webpack_require__(99201),OverlayTrigger_default=__webpack_require__.n(OverlayTrigger),Tooltip=__webpack_require__(18868),Tooltip_default=__webpack_require__.n(Tooltip),keys_lib=__webpack_require__(25351),keys_lib_default=__webpack_require__.n(keys_lib),is_object_lib=__webpack_require__(21405),is_object_lib_default=__webpack_require__.n(is_object_lib),is_array_lib=__webpack_require__(76266),is_array_lib_default=__webpack_require__.n(is_array_lib),any_by_lib=__webpack_require__(31322),any_by_lib_default=__webpack_require__.n(any_by_lib),format_time=__webpack_require__(27505),components_async=__webpack_require__(15052),server=__webpack_require__(94204),react_select_cjs_prod=__webpack_require__(87583),Badge=__webpack_require__(86100),Badge_default=__webpack_require__.n(Badge),Row=__webpack_require__(28269),Row_default=__webpack_require__.n(Row),Col=__webpack_require__(1266),FormLabel=__webpack_require__(65903),FormLabel_default=__webpack_require__.n(FormLabel),FormControl=__webpack_require__(26199),FormControl_default=__webpack_require__.n(FormControl),FormGroup=__webpack_require__(34168),FormGroup_default=__webpack_require__.n(FormGroup),Form=__webpack_require__(17383),Form_default=__webpack_require__.n(Form),Modal=__webpack_require__(89194),Modal_default=__webpack_require__.n(Modal),is_empty_object_lib=__webpack_require__(83966),is_empty_object_lib_default=__webpack_require__.n(is_empty_object_lib),browser=__webpack_require__(11227),browser_default=__webpack_require__.n(browser),__defProp=Object.defineProperty,__defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__publicField=(obj,key,value)=>(__defNormalProp(obj,typeof key!="symbol"?key+"":key,value),value),__async=(__this,__arguments,generator)=>new Promise((resolve,reject)=>{var fulfilled=value=>{try{step(generator.next(value))}catch(e){reject(e)}},rejected=value=>{try{step(generator.throw(value))}catch(e){reject(e)}},step=x=>x.done?resolve(x.value):Promise.resolve(x.value).then(fulfilled,rejected);step((generator=generator.apply(__this,__arguments)).next())});class TwoFactorAuthentication extends react.Component{constructor(props){super(props);__publicField(this,"requestTfaQRCode",()=>__async(this,null,function*(){const res=yield this.props.getTfaQRCode();res&&this.setState({tfaQRCode:{__html:res.data}})})),__publicField(this,"enableTfa",()=>{this.props.enableTFA(this.state.token)}),__publicField(this,"disableTfa",()=>{this.props.disableTFA()}),__publicField(this,"renderQRCode",()=>{if(!this.state.tfaQRCode)return null;const t=this.props.t;return react.createElement(react.Fragment,null,react.createElement("div",{dangerouslySetInnerHTML:this.state.tfaQRCode}),react.createElement("p",null,t("tfa-enable-instructions")),react.createElement(Row_default(),null,react.createElement(Col.default,{sm:8},react.createElement(FormControl_default(),{autoFocus:!0,type:"text",onChange:event=>{this.setState({token:event.target.value})}})),react.createElement(Col.default,{sm:3},react.createElement(Button_default(),{onClick:this.enableTfa,disabled:this.state.token.length!==6},t("common:confirm")))))}),this.state={token:""}}render(){const t=this.props.t;return this.props.user.twoFactorAuth?react.createElement(Card_default(),{bg:"light",border:"success"},react.createElement(Card_default().Header,null,t("two-factor-authentication")),react.createElement(Card_default().Body,null,react.createElement("p",null,t("two-factor-authentication-is-enabled")),react.createElement(Button_default(),{variant:"warning",style:{float:"right",marginRight:5},onClick:this.disableTfa},t("common:disable")))):react.createElement(Card_default(),{bg:"light"},react.createElement(Card_default().Header,null,react.createElement("span",{className:"title"},t("common:two-factor-authentication"))),react.createElement(Card_default().Body,null,react.createElement("p",null,t("two-factor-authentication-is-disabled")),react.createElement(Button_default(),{variant:"success",style:{float:"right",marginRight:5},onClick:this.requestTfaQRCode},react.createElement("i",{className:"fas fa-qrcode",style:{marginRight:10}}),t("common:enable")),this.renderQRCode()))}}TwoFactorAuthentication.propTypes={disableTFA:prop_types_default().func.isRequired,enableTFA:prop_types_default().func.isRequired,getTfaQRCode:prop_types_default().func.isRequired,t:prop_types_default().func.isRequired,user:prop_types_default().object.isRequired},TwoFactorAuthentication.defaultProps={};var two_factor_authentication=TwoFactorAuthentication,enter_token_modal_async=(__this,__arguments,generator)=>new Promise((resolve,reject)=>{var fulfilled=value=>{try{step(generator.next(value))}catch(e){reject(e)}},rejected=value=>{try{step(generator.throw(value))}catch(e){reject(e)}},step=x=>x.done?resolve(x.value):Promise.resolve(x.value).then(fulfilled,rejected);step((generator=generator.apply(__this,__arguments)).next())});const EnterTokenModal=({authenticate,onHide,show})=>{const[token,setToken]=(0,react.useState)(null),handleInputChange=event=>{setToken(event.target.value)},handleSubmit=()=>enter_token_modal_async(void 0,null,function*(){(yield authenticate({writeAccessToken:token}))&&onHide()});return react.createElement(Modal_default(),{onHide,show},react.createElement(Modal_default().Header,{closeButton:!0},react.createElement(Modal_default().Title,{as:"h3"},"Enter Access Token")),react.createElement(Modal_default().Body,null,react.createElement("div",null,"Please enter the write-access token that was sent to you. If you have not received it yet, please get in touch with ",react.createElement("a",{href:"mailto:pgb@andrew.cmu.edu"},"Philipp Burckhardt"),"."),react.createElement("br",null),react.createElement(Form_default(),null,react.createElement(OverlayTrigger_default(),{placement:"right",overlay:react.createElement(Tooltip_default(),{id:"ownerTooltip"},"Please enter the access token.")},react.createElement(FormGroup_default(),null,react.createElement(Row_default(),null,react.createElement(Col.default,{sm:2},react.createElement(FormLabel_default(),null,"Token")),react.createElement(Col.default,{sm:10},react.createElement(FormControl_default(),{name:"title",type:"text",placeholder:"Enter token",onChange:handleInputChange}))))))),react.createElement(Modal_default().Footer,null,react.createElement(Button_default(),{onClick:handleSubmit,disabled:!token},"Submit")))};EnterTokenModal.propTypes={authenticate:prop_types_default().func.isRequired,onHide:prop_types_default().func.isRequired,show:prop_types_default().bool.isRequired};var enter_token_modal=EnterTokenModal,edit_modal_defProp=Object.defineProperty,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,edit_modal_defNormalProp=(obj,key,value)=>key in obj?edit_modal_defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp.call(b,prop)&&edit_modal_defNormalProp(a,prop,b[prop]);if(__getOwnPropSymbols)for(var prop of __getOwnPropSymbols(b))__propIsEnum.call(b,prop)&&edit_modal_defNormalProp(a,prop,b[prop]);return a},edit_modal_publicField=(obj,key,value)=>(edit_modal_defNormalProp(obj,typeof key!="symbol"?key+"":key,value),value);const createTooltip=str=>react.createElement(Tooltip_default(),{id:"tooltip"},str),validateName=name=>!name||name.length>=2,debug=browser_default()("isle-dashboard");class EditModal extends react.Component{constructor(props){super(props);edit_modal_publicField(this,"handleUpdate",()=>{const{firstName,lastName,preferredName,pronouns,password,passwordRepeat,organization,customFields}=this.state,form={organization};firstName&&(form.firstName=firstName),lastName&&(form.lastName=lastName),preferredName&&(form.preferredName=preferredName),pronouns&&(form.pronouns=pronouns);let change=!1;password&&passwordRepeat===password&&(change=!0,form.password=password),(firstName!==this.props.user.firstName||lastName!==this.props.user.lastName||preferredName!==this.props.user.preferredName||pronouns!==this.props.user.pronouns||organization!==this.props.user.organization)&&(change=!0),is_empty_object_lib_default()(customFields)||(form.customFields=customFields,change=!0),change&&(debug("Update user..."),this.props.updateUser(form),this.props.onHide())}),edit_modal_publicField(this,"handleInputChange",event=>{const target=event.target,value=target.value,name=target.name;this.setState({[name]:value,changed:!0})}),edit_modal_publicField(this,"getPasswordValidationState",()=>{const{password,passwordRepeat}=this.state;return!(password.length<6||passwordRepeat.length===0||password!==passwordRepeat)}),edit_modal_publicField(this,"toggleTokenModal",()=>{this.setState({showTokenModal:!this.state.showTokenModal})}),this.state={email:props.user.email,firstName:props.user.firstName,lastName:props.user.lastName,preferredName:props.user.preferredName,organization:props.user.organization,pronouns:props.user.pronouns,password:"",passwordRepeat:"",changed:!1,showTokenModal:!1,customFields:props.user.customFields||{}}}renderInstructorButton(){if(this.props.user.writeAccess)return null;const t=this.props.t;return react.createElement(Button_default(),{onClick:this.toggleTokenModal,variant:"outline-success",style:{float:"right",marginRight:5}},t("get-instructor-access"))}render(){const validPasswords=this.getPasswordValidationState(),validFirstName=validateName(this.state.firstName),validLastName=validateName(this.state.lastName),validPreferredName=validateName(this.state.preferredName),enteredPasswords=this.state.password||this.state.passwordRepeat,user2=this.props.user,t=this.props.t,userCustomFields=this.state.customFields,availableCustomFields=user2.availableCustomFields||[];let passwordCol;return user2.loginWithoutPassword?passwordCol=null:passwordCol=react.createElement(Col.default,{sm:6,className:"d-grid gap-3"},react.createElement(OverlayTrigger_default(),{placement:"right",overlay:createTooltip(t("enter-password"))},react.createElement(FormGroup_default(),{controlId:"form-password"},react.createElement(FormLabel_default(),null,t("common:password")),react.createElement(FormControl_default(),{name:"password",type:"password",value:this.state.password,autoComplete:"none",placeholder:t("common:choose-new-password"),onChange:this.handleInputChange,maxLength:30,minLength:6,isInvalid:enteredPasswords&&!validPasswords}),react.createElement(Form_default().Control.Feedback,{type:"invalid"},"Please enter a new password with at least six characters."))),react.createElement(FormGroup_default(),{controlId:"form-repeat-password"},react.createElement(FormControl_default(),{name:"passwordRepeat",type:"password",value:this.state.passwordRepeat,autoComplete:"none",placeholder:t("repeat-new-password"),onChange:this.handleInputChange,maxLength:30,minLength:6,isInvalid:enteredPasswords&&!validPasswords}),react.createElement(Form_default().Control.Feedback,{type:"invalid"},t("invalid-password"))),react.createElement(two_factor_authentication,{user:this.props.user,t:this.props.t,disableTFA:this.props.disableTFA,enableTFA:this.props.enableTFA,getTfaQRCode:this.props.getTfaQRCode})),react.createElement(react.Fragment,null,react.createElement(Modal_default(),{show:this.props.show,onHide:this.props.onHide,dialogClassName:"edit-modal"},react.createElement(Modal_default().Header,null,react.createElement(Modal_default().Title,{as:"h3",style:{width:"100%"}},t("profile"),react.createElement(OverlayTrigger_default(),{placement:"right",overlay:createTooltip(t("close-edit-modal"))},react.createElement(Button_default(),{onClick:this.props.onHide,style:{float:"right"},variant:"outline-secondary","aria-label":t("close-edit-modal"),className:"modal-close"},react.createElement("span",{"aria-hidden":"true"},"x"))),this.renderInstructorButton())),react.createElement(Modal_default().Body,null,react.createElement(Form_default(),{as:Row_default()},react.createElement(Col.default,{sm:6,className:"d-grid gap-2"},react.createElement(FormGroup_default(),{controlId:"form-email"},react.createElement(FormLabel_default(),{style:{width:"100%"}},t("common:email"),user2.verifiedEmail?null:react.createElement(Badge_default(),{bg:"danger",style:{float:"right"}},t("common:email-not-verified"),react.createElement(OverlayTrigger_default(),{placement:"right",overlay:createTooltip(t("resend-confirm-email"))},react.createElement(Button_default(),{"aria-label":t("resend-confirm-email"),size:"sm",variant:"outline-light",onClick:this.props.resendConfirmEmail,style:{fontSize:12,marginLeft:6}},react.createElement("i",{className:"fas fa-redo-alt"}))))),react.createElement(FormControl_default(),{name:"email",type:"email",value:this.state.email,disabled:!0})),react.createElement(OverlayTrigger_default(),{placement:"right",overlay:createTooltip(t("update-first-name"))},react.createElement(FormGroup_default(),{controlId:"form-first-name"},react.createElement(FormLabel_default(),null,t("common:first-name")),react.createElement(FormControl_default(),{name:"firstName",type:"text",value:this.state.firstName,onChange:this.handleInputChange,isInvalid:!validFirstName}),react.createElement(Form_default().Control.Feedback,{type:"invalid"},t("invalid-name")))),react.createElement(Row_default(),null,react.createElement(Col.default,{md:6},react.createElement(OverlayTrigger_default(),{placement:"right",overlay:createTooltip(t("update-preferred-name"))},react.createElement(FormGroup_default(),{controlId:"form-preferred-name"},react.createElement(FormLabel_default(),null,t("common:preferred-name")),react.createElement(FormControl_default(),{name:"preferredName",type:"text",value:this.state.preferredName,onChange:this.handleInputChange,isInvalid:!validPreferredName}),react.createElement(Form_default().Control.Feedback,{type:"invalid"},t("invalid-name"))))),react.createElement(Col.default,{md:6},react.createElement(OverlayTrigger_default(),{placement:"right",overlay:createTooltip(t("update-pronouns"))},react.createElement(FormGroup_default(),{controlId:"form-pronouns"},react.createElement(FormLabel_default(),null,t("common:pronouns")),react.createElement(FormControl_default(),{name:"pronouns",type:"text",value:this.state.pronouns,onChange:this.handleInputChange}))))),react.createElement(OverlayTrigger_default(),{placement:"right",overlay:createTooltip(t("update-last-name"))},react.createElement(FormGroup_default(),{controlId:"form-last-name"},react.createElement(FormLabel_default(),null,t("common:last-name")),react.createElement(FormControl_default(),{name:"lastName",type:"text",value:this.state.lastName,onChange:this.handleInputChange,isInvalid:!validLastName}),react.createElement(Form_default().Control.Feedback,{type:"invalid"},t("invalid-name")))),react.createElement(OverlayTrigger_default(),{placement:"right",overlay:createTooltip(t("update-organization"))},react.createElement(FormGroup_default(),{controlId:"form-organization"},react.createElement(FormLabel_default(),null,t("common:organization")),react.createElement(FormControl_default(),{name:"organization",type:"text",value:this.state.organization,onChange:this.handleInputChange}))),availableCustomFields.filter(x=>x.showOnProfile||x.editableOnProfile).map((x,idx)=>{let input;const value=userCustomFields[x.name];return x.type==="checkbox"?input=react.createElement(Form_default().Check,{type:"checkbox",label:x.name,defaultChecked:value,disabled:!x.editableOnProfile,onChange:event=>{const newCustomFields=__spreadValues({},this.state.customFields);newCustomFields[x.name]=event.target.checked,this.setState({customFields:newCustomFields,changed:!0})}}):x.type==="text"?input=react.createElement(FormGroup_default(),{controlId:`form-${x.name}`},react.createElement(FormLabel_default(),null,x.name),react.createElement(FormControl_default(),{name:x.name,type:"text",value,placeholder:`Enter ${x.name}...`,disabled:!x.editableOnProfile,onChange:event=>{const newCustomFields=__spreadValues({},this.state.customFields);newCustomFields[x.name]=event.target.value,this.setState({customFields:newCustomFields,changed:!0})},autoComplete:"none"})):input=react.createElement(FormGroup_default(),{controlId:`form-${x.name}`},react.createElement(FormLabel_default(),null,x.name),react.createElement(react_select_cjs_prod.ZP,{defaultValue:value?{label:value,value}:null,disabled:!x.editableOnProfile,options:x.options.map(e=>({value:e,label:e})),onChange:elem=>{const newCustomFields=__spreadValues({},this.state.customFields);newCustomFields[x.name]=elem.value,this.setState({customFields:newCustomFields,changed:!0})}})),react.createElement(OverlayTrigger_default(),{key:idx,placement:"top",overlay:createTooltip(x.description)},input)})),passwordCol),react.createElement(Row_default(),{style:{paddingTop:10},className:"d-grid"},react.createElement(Button_default(),{disabled:!this.state.changed||!validFirstName||!validLastName||!validPreferredName||!validPasswords&&enteredPasswords,onClick:this.handleUpdate},t("common:update"))))),react.createElement(enter_token_modal,{user:user2,authenticate:this.props.authenticate,show:this.state.showTokenModal,onHide:this.toggleTokenModal}))}}EditModal.propTypes={authenticate:prop_types_default().func.isRequired,disableTFA:prop_types_default().func.isRequired,enableTFA:prop_types_default().func.isRequired,getTfaQRCode:prop_types_default().func.isRequired,onHide:prop_types_default().func.isRequired,resendConfirmEmail:prop_types_default().func.isRequired,show:prop_types_default().bool.isRequired,t:prop_types_default().func.isRequired,updateUser:prop_types_default().func.isRequired,user:prop_types_default().object.isRequired},EditModal.defaultProps={};var edit_modal=EditModal,Table=__webpack_require__(80983),Table_default=__webpack_require__.n(Table);class ActionTypesDisplay extends react.Component{shouldComponentUpdate(nextProps){return nextProps.selectedNamespaceID!==this.props.selectedNamespaceID}render(){const{selectedNamespace,lessonData:data}=this.props;if(!selectedNamespace||!data)return null;const lessons=selectedNamespace.lessons;if(!lessons)return null;const actionTypes={};for(let i=0;i<lessons.length;i++){const id=lessons[i]._id;if(data[id]){const types=data[id].actionTypes;if(types){const typeNames=keys_lib_default()(types);for(let j=0;j<typeNames.length;j++){const name=typeNames[j];actionTypes[name]?actionTypes[name]+=types[name]:actionTypes[name]=types[name]}}}}const keys=keys_lib_default()(actionTypes),rows=new Array(keys.length);for(let i=0;i<keys.length;i++){const type=keys[i],count=actionTypes[keys[i]];rows[i]=react.createElement("tr",{key:i},react.createElement("td",null,type),react.createElement("td",null,count))}return react.createElement(Table_default(),{size:"sm",striped:!0,style:{fontSize:"0.8rem"}},react.createElement("thead",null,react.createElement("tr",null,react.createElement("th",null,"Action Type"),react.createElement("th",null,"Count"))),react.createElement("tbody",null,rows))}}ActionTypesDisplay.propTypes={lessonData:prop_types_default().object,selectedNamespace:prop_types_default().object,selectedNamespaceID:prop_types_default().string},ActionTypesDisplay.defaultProps={lessonData:null,selectedNamespace:null,selectedNamespaceID:""};var action_types_display=ActionTypesDisplay,ListGroup=__webpack_require__(18350),ListGroup_default=__webpack_require__.n(ListGroup),ticket_modal=__webpack_require__(5760),platform=__webpack_require__(31795),platform_default=__webpack_require__.n(platform),create_ticket_modal_defProp=Object.defineProperty,create_ticket_modal_defNormalProp=(obj,key,value)=>key in obj?create_ticket_modal_defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,create_ticket_modal_publicField=(obj,key,value)=>(create_ticket_modal_defNormalProp(obj,typeof key!="symbol"?key+"":key,value),value),create_ticket_modal_async=(__this,__arguments,generator)=>new Promise((resolve,reject)=>{var fulfilled=value=>{try{step(generator.next(value))}catch(e){reject(e)}},rejected=value=>{try{step(generator.throw(value))}catch(e){reject(e)}},step=x=>x.done?resolve(x.value):Promise.resolve(x.value).then(fulfilled,rejected);step((generator=generator.apply(__this,__arguments)).next())});const create_ticket_modal_debug=browser_default()("isle:toolbar:ticketing"),createOption=ns=>({value:ns,label:ns.title});class CreateTicketModal extends react.Component{constructor(props){super(props);create_ticket_modal_publicField(this,"attachFile",()=>{const input=document.createElement("input");input.type="file",input.onchange=e=>{const files=e.target.files,newFiles=[...this.state.files,...files];this.setState({files:newFiles})},input.click()}),create_ticket_modal_publicField(this,"handleTitleChange",event=>{this.setState({title:event.target.value})}),create_ticket_modal_publicField(this,"handleDescriptionChange",event=>{this.setState({description:event.target.value})}),create_ticket_modal_publicField(this,"handleCourseChange",newValue=>{this.setState({selectedCourse:newValue})}),create_ticket_modal_publicField(this,"handleSubmit",()=>create_ticket_modal_async(this,null,function*(){create_ticket_modal_debug("Create ticket..."),yield this.props.createTicket({title:this.state.title,description:this.state.description,platform:{name:platform_default().name,version:platform_default().version,product:platform_default().product,manufacturer:platform_default().manufacturer,os:platform_default().os,description:platform_default().description},namespace:this.state.selectedCourse.value,files:this.state.files}),this.props.onHide()})),create_ticket_modal_publicField(this,"removeFileFactory",idx=>()=>{const newFiles=this.state.files.slice();newFiles.splice(idx,1),this.setState({files:newFiles})}),this.state={title:"",description:"",selectedCourse:props.enrolledNamespaces?createOption(props.enrolledNamespaces[0]):null,files:[]}}renderAttachments(){return this.state.files.length===0?null:react.createElement(react.Fragment,null,react.createElement("span",{className:"title"},this.props.t("attachments"),":"),react.createElement(ListGroup_default(),{className:"ticketing-attachment-list"},this.state.files.map((file2,idx)=>react.createElement(ListGroup_default().Item,{key:`file-${idx}`},file2.name,react.createElement(Button_default(),{variant:"danger",size:"sm",onClick:this.removeFileFactory(idx),style:{float:"right"}},"x")))))}render(){const{t}=this.props;return react.createElement(Modal_default(),{onHide:this.props.onHide,show:this.props.show,dialogClassName:"modal-40w"},react.createElement(Modal_default().Header,{closeButton:!0},react.createElement(Modal_default().Title,{as:"h3"},t("new-ticket"))),react.createElement(Modal_default().Body,null,react.createElement("p",null,t("ticketing-intro")),react.createElement(FormGroup_default(),null,react.createElement(FormLabel_default(),null,t("common:course"),":"),react.createElement(react_select_cjs_prod.ZP,{options:this.props.enrolledNamespaces.map(createOption),onChange:this.handleCourseChange,value:this.state.selectedCourse})),react.createElement(FormGroup_default(),null,react.createElement(FormLabel_default(),null,t("common:title"),":"),react.createElement(FormControl_default(),{type:"text",placeholder:t("ticket-title-placeholder"),onChange:this.handleTitleChange})),react.createElement(FormGroup_default(),{controlId:"form-text"},react.createElement(FormLabel_default(),null,t("common:description"),":"),react.createElement(FormControl_default(),{name:"body",type:"text",as:"textarea",rows:"5",placeholder:t("ticket-description-placeholder"),value:this.state.description,onChange:this.handleDescriptionChange})),this.renderAttachments()),react.createElement(Modal_default().Footer,null,react.createElement(OverlayTrigger_default(),{placement:"left",overlay:react.createElement(Tooltip_default(),{id:"attachmentTooltip"},t("attach-file"))},react.createElement(Button_default(),{onClick:this.attachFile},react.createElement("i",{className:"fas fa-paperclip"}))),react.createElement(Button_default(),{onClick:this.props.onHide},t("common:cancel")),react.createElement(Button_default(),{onClick:this.handleSubmit},t("create-ticket"))))}}CreateTicketModal.propTypes={createTicket:prop_types_default().func.isRequired,enrolledNamespaces:prop_types_default().array,onHide:prop_types_default().func.isRequired,show:prop_types_default().bool.isRequired},CreateTicketModal.defaultProps={enrolledNamespaces:[]};var create_ticket_modal=CreateTicketModal,ticket_list_defProp=Object.defineProperty,ticket_list_defNormalProp=(obj,key,value)=>key in obj?ticket_list_defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,ticket_list_publicField=(obj,key,value)=>(ticket_list_defNormalProp(obj,typeof key!="symbol"?key+"":key,value),value),ticket_list_async=(__this,__arguments,generator)=>new Promise((resolve,reject)=>{var fulfilled=value=>{try{step(generator.next(value))}catch(e){reject(e)}},rejected=value=>{try{step(generator.throw(value))}catch(e){reject(e)}},step=x=>x.done?resolve(x.value):Promise.resolve(x.value).then(fulfilled,rejected);step((generator=generator.apply(__this,__arguments)).next())});const RE_TICKET=/ticket=([^&]*)/;class TicketListModal extends react.Component{constructor(props){super(props);ticket_list_publicField(this,"toggleCreateModal",()=>{this.setState({showCreateModal:!this.state.showCreateModal})}),ticket_list_publicField(this,"toggleTicketModal",()=>{this.setState({showMessagesModal:!this.state.showMessagesModal})}),ticket_list_publicField(this,"toggleShowAll",()=>{this.setState({showOpen:!this.state.showOpen})}),this.state={showCreateModal:!1,showMessagesModal:!1,showOpen:!0}}componentDidMount(){return ticket_list_async(this,null,function*(){if(yield this.props.getUserTickets(),window&&window.location.search){const match=RE_TICKET.exec(window.location.search);if(match&&match[1]){const{tickets}=this.props.user;if(tickets)for(let i=0;i<tickets.length;i++){const ticket2=tickets[i];if(ticket2._id===match[1]){this.setState({selectedTicket:ticket2,showMessagesModal:!0});break}}}}})}renderTicketList(){const out=[],{user:user2,t}=this.props;if(!user2)return null;const{tickets}=user2;if(!tickets)return null;if(this.state.showOpen)for(let i=0;i<tickets.length;i++){const ticket2=tickets[i];ticket2.done!==!0&&out.push(react.createElement(ListGroup_default().Item,{key:`ticket-${i}`},ticket2.title,": ",ticket2.description,react.createElement(OverlayTrigger_default(),{placement:"bottom",overlay:react.createElement(Tooltip_default(),{id:"ticket-status-tooltip"},t("common:close-ticket"))},react.createElement(Button_default(),{variant:"outline-secondary",size:"sm",style:{float:"right",marginLeft:6},onClick:()=>{this.props.closeTicket(ticket2._id)}},react.createElement("i",{className:"far fa-square"}))),react.createElement(Button_default(),{size:"sm",variant:"outline-secondary",style:{float:"right"},onClick:()=>{this.setState({selectedTicket:ticket2},this.toggleTicketModal)}},t("common:messages"),react.createElement(Badge_default(),{className:"ticket-badge",bg:"secondary"},ticket2.messages.length))))}else for(let i=0;i<tickets.length;i++){const ticket2=tickets[i];ticket2.done!==!1&&out.push(react.createElement(ListGroup_default().Item,{key:`ticket-${i}`},ticket2.title,": ",ticket2.description,react.createElement(OverlayTrigger_default(),{placement:"bottom",overlay:react.createElement(Tooltip_default(),{id:"ticket-status-tooltip"},t("common:open-ticket"))},react.createElement(Button_default(),{bg:"outline-secondary",size:"sm",style:{float:"right",marginLeft:6},onClick:()=>{this.props.openTicket(ticket2._id)}},react.createElement("i",{className:"far fa-check-square"}))),react.createElement(Button_default(),{size:"sm",variant:"outline-secondary",style:{float:"right"},onClick:()=>{this.setState({selectedTicket:ticket2},this.toggleTicketModal)}},t("common:messages"),react.createElement(Badge_default(),{className:"ticket-badge",bg:"secondary"},ticket2.messages.length))))}return react.createElement(ListGroup_default(),null,out)}render(){const{t}=this.props,enrolledNamespaces=this.props.user.enrolledNamespaces.filter(x=>x.enableTicketing);return react.createElement(react.Fragment,null,react.createElement(Modal_default(),{onHide:this.props.onHide,show:this.props.show,dialogClassName:"modal-40w"},react.createElement(Modal_default().Header,{closeButton:!0},react.createElement(Modal_default().Title,{as:"h3"},t("my-tickets"))),react.createElement(Modal_default().Body,null,this.renderTicketList()),react.createElement(Modal_default().Footer,null,react.createElement(Button_default(),{onClick:this.toggleShowAll},this.state.showOpen?t("show-completed-tickets"):t("show-open-tickets")),react.createElement(Button_default(),{onClick:this.toggleCreateModal},t("new-ticket")),react.createElement(Button_default(),{onClick:this.props.onHide},t("common:close")))),this.state.showCreateModal?react.createElement(create_ticket_modal,{show:this.state.showCreateModal,onHide:this.toggleCreateModal,enrolledNamespaces,createTicket:this.props.createTicket,t}):null,this.state.showMessagesModal?react.createElement(ticket_modal.Z,{show:this.state.showMessagesModal,onHide:this.toggleTicketModal,ticket:this.state.selectedTicket,submitTicketMessage:this.props.submitTicketMessage,closeTicket:this.props.closeTicket,openTicket:this.props.openTicket}):null)}}TicketListModal.propTypes={closeTicket:prop_types_default().func.isRequired,createTicket:prop_types_default().func.isRequired,getUserTickets:prop_types_default().func.isRequired,onHide:prop_types_default().func.isRequired,openTicket:prop_types_default().func.isRequired,show:prop_types_default().bool.isRequired,submitTicketMessage:prop_types_default().func.isRequired,user:prop_types_default().object.isRequired};var ticket_list=TicketListModal,hoodie=__webpack_require__(41565),question=__webpack_require__(27695),badge_circle=__webpack_require__(42270),message_page=__webpack_require__(60176),profile_page_defProp=Object.defineProperty,profile_page_defNormalProp=(obj,key,value)=>key in obj?profile_page_defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,profile_page_publicField=(obj,key,value)=>(profile_page_defNormalProp(obj,typeof key!="symbol"?key+"":key,value),value);const ProfilePicModal=(0,components_async.Z)(()=>__webpack_require__.e(9859).then(__webpack_require__.bind(__webpack_require__,59859))),TimeSpent=(0,components_async.Z)(()=>Promise.all([__webpack_require__.e(8660),__webpack_require__.e(9244),__webpack_require__.e(1723)]).then(__webpack_require__.bind(__webpack_require__,91723))),ProgressStats=(0,components_async.Z)(()=>Promise.all([__webpack_require__.e(8660),__webpack_require__.e(9244),__webpack_require__.e(9929)]).then(__webpack_require__.bind(__webpack_require__,39929)));function id2Name(lessons,id){if(!lessons)return"";for(let i=0;i<lessons.length;i++)if(lessons[i]._id===id)return lessons[i].title;return""}class ProfilePage extends react.Component{constructor(props){super(props);profile_page_publicField(this,"toggleEditModal",()=>{this.setState({showEditModal:!this.state.showEditModal})}),profile_page_publicField(this,"toggleTicketListModal",()=>{this.setState({showTicketListModal:!this.state.showTicketListModal})}),profile_page_publicField(this,"toggleProfilePicModal",()=>{this.setState({showProfilePicModal:!this.state.showProfilePicModal})}),profile_page_publicField(this,"handleSelect",(newValue,event)=>{const namespaceName=event.target.title,id=event.target.dataset.id;this.setState({selectedNamespaceID:newValue,selectedNamespace:this.props.user.enrolledNamespaces[id]},()=>{const course=this.props.user.enrolledNamespaces[id];is_object_lib_default()(course.lessons[0])||this.props.getLessons(namespaceName)})}),profile_page_publicField(this,"handleStatsSelect",(newValue,event)=>{this.setState({selectedStatsType:newValue})}),profile_page_publicField(this,"handleDataSelect",(newValue,event)=>{this.setState({selectedDataType:newValue})}),profile_page_publicField(this,"submitTicketMessage",({message,ticketID})=>{this.props.sendTicketMessage({message,ticketID,user:this.props.user})});let selectedNamespace=null,selectedNamespaceID=null;props.user.enrolledNamespaces.length>0&&(selectedNamespace=props.user.enrolledNamespaces[0],selectedNamespaceID=selectedNamespace._id),this.state={showEditModal:!1,showProfilePicModal:!1,showTicketListModal:!1,selectedNamespace,selectedNamespaceID,selectedDataType:"messages",selectedStatsType:"progress"}}componentDidMount(){this.props.user.files||this.props.getUserFiles();const course=this.state.selectedNamespace;course&&this.props.getLessons(course.title),this.props.getUserBadges()}renderRightPanel(){if(!this.state.selectedNamespace)return null;if(this.state.selectedStatsType==="progress")return react.createElement(ProgressStats,{user:this.props.user,selectedNamespace:this.state.selectedNamespace});if(this.state.selectedStatsType==="timeSpent")return react.createElement(TimeSpent,{user:this.props.user,selectedNamespace:this.state.selectedNamespace})}renderLeftPanel(){if(!this.state.selectedNamespace)return null;if(this.state.selectedDataType==="files")return this.renderFiles();if(this.state.selectedDataType==="actions"){const data=this.props.user.lessonData;return react.createElement(action_types_display,{lessonData:data,selectedNamespace:this.state.selectedNamespace,selectedNamespaceID:this.state.selectedNamespaceID})}if(this.state.selectedDataType==="messages")return this.renderMessages()}renderFiles(){const{t,user:user2}=this.props;let files=user2.files;if(files&&(files=files[this.state.selectedNamespaceID]),!is_array_lib_default()(files))return null;const out=[];for(let i=0;i<files.length;i++){const file2=files[i],lessonName=id2Name(this.state.selectedNamespace.lessons,file2.lesson);let cl="fas fa-file-image fa-4x";switch(path_browserify_default().extname(file2.filename)){case".html":cl="fab fa-html5 fa-4x";break;case".pdf":cl="far fa-file-pdf fa-4x";break;case".jpg":cl="fas fa-file-image fa-4x";break}out.push(react.createElement("div",{className:"media",key:i},react.createElement("div",{className:"mr-3"},react.createElement("a",{href:server.ZP+"/"+file2.filename,target:"_blank",rel:"noopener noreferrer"},react.createElement("i",{className:cl}))),react.createElement("div",{className:"media-body"},react.createElement("a",{href:server.ZP+"/"+file2.filename,target:"_blank",rel:"noopener noreferrer"},react.createElement("h4",null,file2.title)),react.createElement("p",null,t("common:date"),": ",new Date(file2.createdAt).toLocaleDateString(),lessonName&&`, ${t("common:lesson")}: ${lessonName}`))))}return out}renderMessages(){return this.state.selectedNamespace.announcements?react.createElement("div",null,this.state.selectedNamespace.announcements.map((value,index)=>{const date=new Date(value.createdAt),dateString=date.toLocaleDateString()+"  -  "+date.toLocaleTimeString(navigator.language,{hour:"2-digit",minute:"2-digit"});return react.createElement("div",{key:index,className:"message-container"},react.createElement("div",{className:"message-data"},react.createElement("div",{className:"message-profile-pic"},react.createElement("img",{src:value.picture,alt:"Message User Profile"})),react.createElement("div",{className:"message-author-line"},react.createElement("span",{className:"message-author"},value.author," "),"wrote on ",dateString)),react.createElement("div",{className:"message-title"},value.title),react.createElement("div",{className:"message-body"},value.body))})):null}renderStatisticDataToolbar(){const{t}=this.props;return react.createElement(Nav_default(),{variant:"tabs",activeKey:this.state.selectedDataType,onSelect:this.handleDataSelect},react.createElement(Nav_default().Item,null,react.createElement(Nav_default().Link,{eventKey:"messages",title:t("messages")},t("messages"))),react.createElement(Nav_default().Item,null,react.createElement(Nav_default().Link,{eventKey:"files",title:t("common:files")},t("common:files"))),react.createElement(Nav_default().Item,null,react.createElement(Nav_default().Link,{eventKey:"actions",title:t("actions")},t("actions"))))}renderStatisticStatsToolbar(){const{t}=this.props;return react.createElement(Nav_default(),{variant:"tabs",activeKey:this.state.selectedStatsType,onSelect:this.handleStatsSelect},react.createElement(Nav_default().Item,null,react.createElement(Nav_default().Link,{eventKey:"progress",title:t("progress")},t("progress"))),react.createElement(Nav_default().Item,null,react.createElement(Nav_default().Link,{eventKey:"timeSpent",title:t("time-spent")},t("time-spent"))))}renderStatisticSection(){const{t,user:user2}=this.props,courses=user2.enrolledNamespaces;return react.createElement("div",{className:"profile-page-statistics"},react.createElement("div",{className:"profile-page-statistics-navigation-title"},t("common:courses")),react.createElement("div",{className:"profile-page-statistics-navigation"},react.createElement(Nav_default(),{variant:"tabs",activeKey:this.state.selectedNamespaceID,onSelect:this.handleSelect},courses.map((course,i)=>{const title=course.title,id=course._id;return react.createElement(Nav_default().Item,{key:i},react.createElement(Nav_default().Link,{eventKey:id,title,"data-id":i},title))}))),react.createElement("div",{className:"profile-page-statistics-data-select"},t("common:data")),react.createElement("div",{className:"profile-page-statistics-top-actions"},this.state.selectedNamespaceID?this.renderStatisticDataToolbar():null),react.createElement("div",{className:"profile-page-statistics-title2"},t("common:statistics")),react.createElement("div",{className:"profile-page-statistics-actions"},this.renderLeftPanel()),react.createElement("div",{className:"profile-page-statistics-select"},this.state.selectedNamespaceID?this.renderStatisticStatsToolbar():null),react.createElement("div",{className:"profile-page-statistics-stats"},this.renderRightPanel()))}renderBadgesSection(){let list=[],badges=this.props.user.badges||[];for(let i=0;i<24;i++){let temp=question,desc="Hidden Badge",display="profile-page-badge-item-interior unknown",badgeState="badge-not-acquired";i<badges.length&&(temp=server.ZP+"/badges/"+badges[i].picture,desc=badges[i].description,display="profile-page-badge-item-interior",badges[i].acquired&&(badgeState="badge-acquired")),list.push(react.createElement("div",{style:{animation:"scale-up "+(i*.05+.1)+"s"},className:"profile-page-badge-item-nova",key:i},react.createElement(OverlayTrigger_default(),{placement:"top",overlay:react.createElement(Tooltip_default(),{id:`badge-${i}-description`},desc)},react.createElement("div",{className:"profile-page-badge-item"},react.createElement("img",{className:"mask",src:badge_circle,alt:""}),react.createElement("div",{className:display},react.createElement("img",{className:badgeState,src:temp,alt:"User Badge"}))))))}return list}renderUserSection(){const{t,user:user2}=this.props;let date=null;user2.createdAt&&(date=new Date(user2.createdAt).toLocaleDateString());let userPic=hoodie;user2.picture&&(userPic=user2.picture);const showTicketingButton=any_by_lib_default()(this.props.user.enrolledNamespaces,x=>x.enableTicketing),nLessons=keys_lib_default()(user2.lessonData).length;return react.createElement("div",{className:"profile-page-user-container"},react.createElement("div",{role:"button",className:"profile-page-user-portrait",onClick:this.toggleProfilePicModal,onKeyPress:this.toggleProfilePicModal,tabIndex:0},react.createElement("img",{alt:"User Profile",src:userPic})),react.createElement("div",{className:"profile-page-user-personal"},react.createElement("div",{className:"profile-page-user-personal-name"},react.createElement(Card_default(),null,react.createElement(Card_default().Header,null,react.createElement(Card_default().Title,{as:"h3"},user2.name," ",react.createElement("br",null),user2.organization?react.createElement("small",null,user2.organization):null),date?react.createElement("div",null,t("registered-since",{date})):null),react.createElement(Card_default().Body,null,react.createElement("div",{className:"profile-page-user-values"},react.createElement("div",{className:"profile-page-user-legend"},t("score")),react.createElement("div",{className:"profile-page-user-value"},user2.score),react.createElement("div",{className:"profile-page-user-legend"},t("no-lessons")),react.createElement("div",{className:"profile-page-user-value"},nLessons),react.createElement("div",{className:"profile-page-user-legend"},t("time-spent")),react.createElement("div",{className:"profile-page-user-value"},(0,format_time.Z)(user2.spentTime))))),react.createElement("div",{className:"d-grid gap-2"},react.createElement(Button_default(),{style:{marginTop:15},onClick:this.toggleEditModal},t("edit-profile")),showTicketingButton?react.createElement(Button_default(),{style:{marginTop:15},onClick:this.toggleTicketListModal},t("show-tickets")):null))),react.createElement("div",{className:"profile-page-user-footer"}))}render(){const{t}=this.props;return react.createElement(react.Fragment,null,react.createElement("div",{className:"profile-page-grid-container"},react.createElement("div",{className:"profile-page-left"},this.renderUserSection()),this.renderStatisticSection(),react.createElement("div",{className:"profile-page-badge-title"},t("common:badges")),react.createElement("div",{className:"profile-page-badge-container"},this.renderBadgesSection())),react.createElement(edit_modal,{user:this.props.user,authenticate:this.props.authenticate,show:this.state.showEditModal,addNotification:this.props.addNotification,updateUser:this.props.updateUser,onHide:this.toggleEditModal,resendConfirmEmail:this.props.resendConfirmEmail,disableTFA:this.props.disableTFA,enableTFA:this.props.enableTFA,getTfaQRCode:this.props.getTfaQRCode,t}),react.createElement(ticket_list,{createTicket:this.props.createTicket,show:this.state.showTicketListModal,onHide:this.toggleTicketListModal,getUserTickets:this.props.getUserTickets,user:this.props.user,submitTicketMessage:this.submitTicketMessage,closeTicket:this.props.closeTicket,openTicket:this.props.openTicket,t}),react.createElement(ProfilePicModal,{user:this.props.user,show:this.state.showProfilePicModal,onHide:this.toggleProfilePicModal,uploadProfilePic:this.props.uploadProfilePic,t}))}}ProfilePage.propTypes={addNotification:prop_types_default().func.isRequired,authenticate:prop_types_default().func.isRequired,closeTicket:prop_types_default().func.isRequired,createTicket:prop_types_default().func.isRequired,disableTFA:prop_types_default().func.isRequired,enableTFA:prop_types_default().func.isRequired,getLessons:prop_types_default().func.isRequired,getTfaQRCode:prop_types_default().func.isRequired,getUserBadges:prop_types_default().func.isRequired,getUserFiles:prop_types_default().func.isRequired,getUserTickets:prop_types_default().func.isRequired,openTicket:prop_types_default().func.isRequired,resendConfirmEmail:prop_types_default().func.isRequired,sendTicketMessage:prop_types_default().func.isRequired,updateUser:prop_types_default().func.isRequired,uploadProfilePic:prop_types_default().func.isRequired,user:prop_types_default().object.isRequired},ProfilePage.defaultProps={};var profile_page=(0,commonjs.Zh)(["profile_page","common"])(ProfilePage),lesson=__webpack_require__(36189),badge=__webpack_require__(25218),file=__webpack_require__(7534),user=__webpack_require__(37344),notification=__webpack_require__(16120),ticket=__webpack_require__(41054),axios=__webpack_require__(9669),axios_default=__webpack_require__.n(axios),i18next=__webpack_require__(41631),action_types=__webpack_require__(84499),two_factor_auth_async=(__this,__arguments,generator)=>new Promise((resolve,reject)=>{var fulfilled=value=>{try{step(generator.next(value))}catch(e){reject(e)}},rejected=value=>{try{step(generator.throw(value))}catch(e){reject(e)}},step=x=>x.done?resolve(x.value):Promise.resolve(x.value).then(fulfilled,rejected);step((generator=generator.apply(__this,__arguments)).next())});const getTfaQRCode=dispatch=>two_factor_auth_async(void 0,null,function*(){try{const res=yield axios_default().get(server.ZP+"/get_tfa_qrcode");return dispatch({type:action_types.Bu,payload:{events:res.data.events}}),res}catch(err){return(0,notification.EG)(dispatch,err)}}),getTfaQRCodeInjector=dispatch=>()=>two_factor_auth_async(void 0,null,function*(){return yield getTfaQRCode(dispatch)}),enableTFA=(dispatch,token)=>two_factor_auth_async(void 0,null,function*(){try{const res=yield axios_default().post(server.ZP+"/enable_tfa",{token});(0,notification.wN)(dispatch,{title:res.data.verified?i18next.ZP.t("common:tfa-enabled"):i18next.ZP.t("common:tfa-not-enabled"),message:res.data.message,level:res.data.verified?"success":"error"}),dispatch({type:action_types.E4,payload:{verified:res.data.verified}})}catch(err){return(0,notification.EG)(dispatch,err)}}),enableTFAInjector=dispatch=>token=>two_factor_auth_async(void 0,null,function*(){yield enableTFA(dispatch,token)}),disableTFA=dispatch=>two_factor_auth_async(void 0,null,function*(){try{const res=yield axios_default().post(server.ZP+"/disable_tfa");(0,notification.wN)(dispatch,{title:i18next.ZP.t("common:tfa-disabled"),message:res.data.message,level:"success"}),dispatch({type:action_types.oF,payload:{message:res.data.message,disabled:res.data.disabled}})}catch(err){return(0,notification.EG)(dispatch,err)}}),disableTFAInjector=dispatch=>()=>two_factor_auth_async(void 0,null,function*(){yield disableTFA(dispatch)});function mapStateToProps(state){return{user:state.user}}function mapDispatchToProps(dispatch){return{addNotification:(0,notification.pP)(dispatch),createTicket:(0,ticket.Cn)(dispatch),getUserBadges:(0,badge.fH)(dispatch),updateUser:(0,user.vi)(dispatch),authenticate:(0,user.m8)(dispatch),getUserFiles:(0,file.f2)(dispatch),getLessons:(0,lesson.Hy)(dispatch),resendConfirmEmail:(0,user.WA)(dispatch),sendTicketMessage:(0,ticket.fG)(dispatch),closeTicket:(0,ticket.xG)(dispatch),openTicket:(0,ticket.mJ)(dispatch),getUserTickets:(0,ticket.S$)(dispatch),uploadProfilePic:(0,user.UA)(dispatch),enableTFA:enableTFAInjector(dispatch),disableTFA:disableTFAInjector(dispatch),getTfaQRCode:getTfaQRCodeInjector(dispatch)}}var visible_profile_page=(0,lib.connect)(mapStateToProps,mapDispatchToProps)(profile_page)},42270:function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"static/media/16cd66f661ed4287b3f1.svg"},27695:function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"static/media/584e31f68e0208c9f28a.svg"},41565:function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__.p+"static/media/b28478deeaed54279dc6.jpg"}}]);

//# sourceMappingURL=856.0f956cfb.chunk.js.map