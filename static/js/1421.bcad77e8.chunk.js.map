{"version":3,"sources":["components/completions/compute_modal.js","components/completions/helpful_label.js","components/confirm-modal/index.js","components/message-modal/index.js","components/completions/level_fields.js","components/completions/tag_weights_editor.js","components/completions/parameter_input.js","components/completions/edit_metric_modal.js","components/completions/index.js","containers/visible-completions/index.js","components/completions/edit_lesson_metrics.js","components/edit-namespace/edit_cohort_modal.js","components/edit-namespace/create_cohort_modal.js","components/edit-namespace/import_course_modal.js","components/edit-namespace/index.js","containers/visible-edit-namespace/index.js"],"names":["value","rule","completions","lesson","namespace","x","cohort","owners"],"mappings":"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","file":"static/js/1421.bcad77e8.chunk.js","sourcesContent":["/**\n* Copyright (C) 2016-present The ISLE Authors\n*\n* The isle-dashboard program is free software: you can redistribute it and/or modify\n* it under the terms of the GNU Affero General Public License as\n* published by the Free Software Foundation, either version 3 of the\n* License, or (at your option) any later version.\n*\n* This program is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n* GNU Affero General Public License for more details.\n*\n* You should have received a copy of the GNU Affero General Public License\n* along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\n// MODULES //\n\nimport React, { useCallback, useEffect, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { useTranslation } from 'react-i18next';\nimport DateTimeRangePicker from '@wojtekmaj/react-datetimerange-picker';\nimport Container from 'react-bootstrap/Container';\nimport Modal from 'react-bootstrap/Modal';\nimport Button from 'react-bootstrap/Button';\nimport Form from 'react-bootstrap/Form';\nimport Row from 'react-bootstrap/Row';\nimport Col from 'react-bootstrap/Col';\nimport SelectInput from 'react-select';\nimport isArray from '@stdlib/assert/is-array';\nimport HelpfulLabel from './helpful_label.js';\n\n\n// VARIABLES //\n\nconst MULTIPLES_POLICIES = [\n\t{ value: 'last', label: 'Last submitted value' },\n\t{ value: 'first', label: 'First submitted value' },\n\t{ value: 'pass-through', label: 'All submitted values' },\n\t{ value: 'max', label: 'Best submitted value' }\n];\n\n\n// MAIN //\n\nconst memberSelection =( member ) => {\n\treturn { value: member.id, label: `${member.firstName} ${member.lastName} (${member.email})` };\n};\n\nfunction ComputeModal({ cohorts, metric, entity, level, show, onHide, computeCompletions, onCompute }) {\n\tconst { t } = useTranslation([ 'completions', 'common' ]);\n\tconst metricName = isArray( metric ) ? metric[ 0 ].name : metric.name;\n\n\tconst [ formValues, setFormValues ] = useState({\n\t\tusers: [],\n\t\tactiveCohorts: {},\n\t\tpolicyOptions: {\n\t\t\tmultiples: MULTIPLES_POLICIES[ 0 ]\n\t\t}\n\t});\n\tconst FORM_STORAGE_KEY = `ISLE?level=${level}&metric=${metricName}`;\n\tuseEffect( () => {\n\t\tlet oldFormValues = localStorage.getItem( FORM_STORAGE_KEY );\n\t\tif ( oldFormValues ) {\n\t\t\toldFormValues = JSON.parse( oldFormValues );\n\t\t\tif ( oldFormValues.policyOptions?.timeFilter ) {\n\t\t\t\toldFormValues.policyOptions.timeFilter = oldFormValues.policyOptions.timeFilter.map( x => new Date( x ) );\n\t\t\t}\n\t\t\tsetFormValues( oldFormValues );\n\t\t}\n\t}, [ FORM_STORAGE_KEY ] );\n\tconst onTimeChange = useCallback( ( dates ) => {\n\t\tconst newFormValues = { ...formValues };\n\t\tif ( dates ) {\n\t\t\tnewFormValues.policyOptions.timeFilter = dates;\n\t\t} else {\n\t\t\tdelete newFormValues.policyOptions.timeFilter;\n\t\t}\n\t\tsetFormValues( newFormValues );\n\t}, [ formValues ] );\n\tconst handleMultiplesPolicyChange = useCallback( ( multiples ) => {\n\t\tconst newFormValues = { ...formValues };\n\t\tnewFormValues.policyOptions.multiples = multiples;\n\t\tsetFormValues( newFormValues );\n\t}, [ formValues ] );\n\tconst handleCompute = useCallback( () => {\n\t\tconst policyOptions = {\n\t\t\t...formValues.policyOptions,\n\t\t\tmultiples: formValues.policyOptions.multiples.value\n\t\t};\n\t\tif ( formValues.policyOptions.timeFilter ) {\n\t\t\tpolicyOptions.timeFilter = formValues.policyOptions.timeFilter.map( x => x.getTime() );\n\t\t}\n\t\tlocalStorage.setItem( FORM_STORAGE_KEY, JSON.stringify( formValues ) );\n\t\tconst body = {\n\t\t\tids: isArray( entity ) ? entity.map( x => x._id ) : [ entity._id ],\n\t\t\tusers: formValues.users.map( x => x.value ),\n\t\t\tmetric: metric,\n\t\t\tpolicyOptions\n\t\t};\n\t\tcomputeCompletions( body ).then( onCompute );\n\t}, [ metric, entity, formValues, FORM_STORAGE_KEY, computeCompletions, onCompute ] );\n\tconst users = cohorts.reduce( ( userList, cohort ) => {\n\t\tconst members = cohort.members.map( member => memberSelection(member) );\n\t\treturn userList.concat( members );\n\t}, [] );\n\tconst selectOptions = [\n\t\t{ value: { category: 'all', members: users }, label: t( 'All users' ) },\n\t\t...( cohorts.length > 1 ? cohorts.map( cohort => {\n\t\t\treturn { value: { category: 'cohort', id: cohort._id, members: cohort.members }, label: 'Cohort ' + cohort.title };\n\t\t}) : [] )\n\t].concat( users );\n\n\tconst userSelectStyles = {\n\t\toption: ( styles, { data }) => {\n\t\t\tif ( data.value.category === 'cohort' && formValues.activeCohorts[ data.value.id ] ) {\n\t\t\t\treturn {\n\t\t\t\t\t...styles,\n\t\t\t\t\t':before': {\n\t\t\t\t\t\tcontent: '\"\\u2713 \"'\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn styles;\n\t\t}\n\t};\n\tconst handleUserSelectChange = useCallback( ( value ) => {\n\t\tif ( !value ) {\n\t\t\tsetFormValues( {\n\t\t\t\t...formValues,\n\t\t\t\tusers: []\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\t\tif ( value.some( x => x.value.category === 'all' ) ) {\n\t\t\tsetFormValues({\n\t\t\t\t...formValues,\n\t\t\t\tusers: users,\n\t\t\t\tactiveCohorts: {}\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\t\tconst selectedUsersSet= new Set();\n\t\tconst removeIds = new Set();\n\t\tconst newValue = [];\n\t\tconst newActiveCohorts = Object.assign( {}, formValues.activeCohorts );\n\t\tfor ( let i = 0; i < value.length; i++ ) {\n\t\t\tif ( value[ i ].value.category === 'cohort' ) {\n\t\t\t\tif ( !formValues.activeCohorts[ value[i].value.id ] ) {\n\t\t\t\t\tnewActiveCohorts[ value[i].value.id ] = true;\n\t\t\t\t\tfor ( let j = 0; j < value[ i ].value.members.length; ++j ) {\n\t\t\t\t\t\tif ( !selectedUsersSet.has( value[ i ].value.members[ j ].id ) ) {\n\t\t\t\t\t\t\tconst member = value[ i ].value.members[ j ];\n\t\t\t\t\t\t\tnewValue.push( memberSelection( member ) );\n\t\t\t\t\t\t\tselectedUsersSet.add( member.id );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tnewActiveCohorts[ value[i].value.id ] = false;\n\t\t\t\t\tvalue[ i ].value.members.forEach( member => {\n\t\t\t\t\t\tremoveIds.add( member.id );\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if ( !selectedUsersSet.has( value[ i ].value ) ) {\n\t\t\t\tnewValue.push( value[ i ] );\n\t\t\t\tselectedUsersSet.add( value[ i ].value );\n\t\t\t}\n\t\t}\n\t\tsetFormValues({\n\t\t\t...formValues,\n\t\t\tusers: newValue.filter( x => !removeIds.has( x.value ) ),\n\t\t\tactiveCohorts: newActiveCohorts\n\t\t});\n\t}, [ formValues, users ] );\n\treturn (\n\t\t<Modal size=\"lg\" show={show} onHide={onHide}>\n\t\t\t<Modal.Header closeButton>\n\t\t\t\t<Modal.Title as=\"h3\">{t('calculate-scores-for', { metric: metricName })}</Modal.Title>\n\t\t\t</Modal.Header>\n\t\t\t<Modal.Body>\n\t\t\t\t<Container>\n\t\t\t\t\t<Form.Group className=\"mb-2\" as={Row} controlId=\"multiplesPolicy\" >\n\t\t\t\t\t\t<HelpfulLabel colWidth={3} name={t('multiples-policy')} description={t('multiples-policy-description')} />\n\t\t\t\t\t\t<Col sm={9} >\n\t\t\t\t\t\t\t<SelectInput value={formValues.policyOptions.multiples} options={MULTIPLES_POLICIES} onChange={handleMultiplesPolicyChange} />\n\t\t\t\t\t\t</Col>\n\t\t\t\t\t</Form.Group>\n\t\t\t\t\t<Form.Group className=\"mb-2\" as={Row} controlId=\"timeFilter\" >\n\t\t\t\t\t\t<HelpfulLabel colWidth={3} name={t('time-filter')} description={t('time-filter-description')} />\n\t\t\t\t\t\t<Col sm={9} >\n\t\t\t\t\t\t\t<DateTimeRangePicker onChange={onTimeChange} value={formValues.policyOptions.timeFilter} />\n\t\t\t\t\t\t</Col>\n\t\t\t\t\t</Form.Group>\n\t\t\t\t\t<Form.Group className=\"mb-2\" as={Row} controlId=\"users\" >\n\t\t\t\t\t\t<HelpfulLabel colWidth={3} name={t('common:users')} description={t('users-description')} />\n\t\t\t\t\t\t<Col sm={9} >\n\t\t\t\t\t\t\t<SelectInput\n\t\t\t\t\t\t\t\tvalue={formValues.users} isMulti\n\t\t\t\t\t\t\t\toptions={selectOptions} onChange={handleUserSelectChange}\n\t\t\t\t\t\t\t\thideSelectedOptions={true}\n\t\t\t\t\t\t\t\tstyles={userSelectStyles}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</Col>\n\t\t\t\t\t</Form.Group>\n\t\t\t\t</Container>\n\t\t\t</Modal.Body>\n\t\t\t<Modal.Footer>\n\t\t\t\t<Button onClick={onHide}>\n\t\t\t\t\t{t('common:cancel')}\n\t\t\t\t</Button>\n\t\t\t\t<Button variant=\"success\" onClick={handleCompute} disabled={formValues.users.length === 0}>\n\t\t\t\t\t{t('common:calculate')}\n\t\t\t\t</Button>\n\t\t\t</Modal.Footer>\n\t\t</Modal>\n\t);\n}\n\n\n// PROPERTIES //\n\nComputeModal.propTypes = {\n\tcohorts: PropTypes.array.isRequired,\n\tcomputeCompletions: PropTypes.func.isRequired,\n\tentity: PropTypes.oneOfType([\n\t\tPropTypes.arrayOf( PropTypes.object ),\n\t\tPropTypes.object\n\t]).isRequired,\n\tlevel: PropTypes.string.isRequired,\n\tmetric: PropTypes.oneOfType([\n\t\tPropTypes.arrayOf( PropTypes.object ),\n\t\tPropTypes.object\n\t]).isRequired,\n\tonCompute: PropTypes.func.isRequired,\n\tonHide: PropTypes.func.isRequired,\n\tshow: PropTypes.bool.isRequired\n};\n\nComputeModal.defaultProps = {};\n\n\n// EXPORTS //\n\nexport default ComputeModal;\n","// MODULES //\n\nimport React from 'react';\nimport OverlayTrigger from 'react-bootstrap/OverlayTrigger';\nimport Tooltip from 'react-bootstrap/Tooltip';\nimport Form from 'react-bootstrap/Form';\n\n\n// MAIN //\n\nfunction HelpfulLabel({ name, description, colWidth, className, placement = 'left', disabled = false, as = Form.Label }) {\n\tconst children = [ <span key=\"name\" >{name}</span> ];\n\tif ( disabled ) {\n\t\treturn React.createElement( as, { sm: colWidth, className: className, column: true }, children );\n\t}\n\tchildren.push( <i key=\"info-icon\" className=\"info-icon ms-2 fas fa-info\"></i> );\n\treturn (\n\t\t<OverlayTrigger placement={placement} overlay={<Tooltip id={`param-${name}-tooltip`}>{description}</Tooltip>} >\n\t\t\t{React.createElement( as, { sm: colWidth, className: className, column: true }, children )}\n\t\t</OverlayTrigger>\n\t);\n}\n\n\n// EXPORTS //\n\nexport default HelpfulLabel;\n","/**\r\n* Copyright (C) 2016-present The ISLE Authors\r\n*\r\n* The isle-dashboard program is free software: you can redistribute it and/or modify\r\n* it under the terms of the GNU Affero General Public License as\r\n* published by the Free Software Foundation, either version 3 of the\r\n* License, or (at your option) any later version.\r\n*\r\n* This program is distributed in the hope that it will be useful,\r\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n* GNU Affero General Public License for more details.\r\n*\r\n* You should have received a copy of the GNU Affero General Public License\r\n* along with this program.  If not, see <https://www.gnu.org/licenses/>.\r\n*/\r\n\r\n// MODULES //\r\n\r\nimport React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { withTranslation } from 'react-i18next';\r\nimport Button from 'react-bootstrap/Button';\r\nimport Modal from 'react-bootstrap/Modal';\r\n\r\n\r\n// MAIN //\r\n\r\n/**\r\n * A confirmation modal component.\r\n *\r\n * @param {Object} props - component properties\r\n * @param {string} props.title - modal title\r\n * @param {string} props.message - modal message\r\n * @param {boolean} props.show - boolean indicating whether the modal is visible\r\n * @param {Function} props.close - callback to invoke upon hiding the modal\r\n * @param {Function} props.onConfirm - callback to invoke upon confirming the modal\r\n * @returns {ReactElement} modal component\r\n */\r\nconst ConfirmModal = ( props ) => (\r\n\t<Modal show={props.show} onHide={props.close} >\r\n\t\t<Modal.Header>\r\n\t\t\t<Modal.Title as=\"h3\">{props.title}</Modal.Title>\r\n\t\t</Modal.Header>\r\n\t\t<Modal.Body>\r\n\t\t\t{props.message}\r\n\t\t</Modal.Body>\r\n\t\t<Modal.Footer>\r\n\t\t\t<Button onClick={props.close}>\r\n\t\t\t\t{props.t('cancel')}\r\n\t\t\t</Button>\r\n\t\t\t<Button variant=\"danger\" onClick={props.onConfirm}>\r\n\t\t\t\t{props.t('confirm')}\r\n\t\t\t</Button>\r\n\t\t</Modal.Footer>\r\n\t</Modal>\r\n);\r\n\r\n\r\n// PROPERTIES //\r\n\r\nConfirmModal.propTypes = {\r\n\tclose: PropTypes.func,\r\n\tmessage: PropTypes.node,\r\n\tonConfirm: PropTypes.func,\r\n\tshow: PropTypes.bool,\r\n\ttitle: PropTypes.string\r\n};\r\n\r\nConfirmModal.defaultProps = {\r\n\tclose() {},\r\n\tmessage: '',\r\n\tonConfirm() {},\r\n\tshow: false,\r\n\ttitle: ''\r\n};\r\n\r\n\r\n// EXPORTS //\r\n\r\nexport default withTranslation( [ 'common' ] )( ConfirmModal );\r\n","/**\r\n* Copyright (C) 2016-present The ISLE Authors\r\n*\r\n* The isle-dashboard program is free software: you can redistribute it and/or modify\r\n* it under the terms of the GNU Affero General Public License as\r\n* published by the Free Software Foundation, either version 3 of the\r\n* License, or (at your option) any later version.\r\n*\r\n* This program is distributed in the hope that it will be useful,\r\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n* GNU Affero General Public License for more details.\r\n*\r\n* You should have received a copy of the GNU Affero General Public License\r\n* along with this program.  If not, see <https://www.gnu.org/licenses/>.\r\n*/\r\n\r\n// MODULES //\r\n\r\nimport React from 'react';\r\nimport Button from 'react-bootstrap/Button';\r\nimport Modal from 'react-bootstrap/Modal';\r\nimport PropTypes from 'prop-types';\r\n\r\n\r\n// MAIN //\r\n\r\n/**\r\n * A modal dialog for displaying messages.\r\n *\r\n * @param {Object} props - component properties\r\n * @param {string} props.message - message to display\r\n * @param {string} props.title - title of the modal\r\n * @param {boolean} props.show - boolean indicating whether the modal is shown\r\n * @param {Function} props.close - callback invoked upon closing the modal\r\n * @returns {ReactElement} modal dialog\r\n */\r\nconst MsgModal = ({ show, close, message, title }) => (\r\n\t<Modal show={show} onHide={close}>\r\n\t\t<Modal.Header closeButton>\r\n\t\t\t<Modal.Title>{title}</Modal.Title>\r\n\t\t</Modal.Header>\r\n\t\t<Modal.Body>\r\n\t\t\t{message}\r\n\t\t</Modal.Body>\r\n\t\t<Modal.Footer>\r\n\t\t\t<Button onClick={close}>\r\n\t\t\t\tClose\r\n\t\t\t</Button>\r\n\t\t</Modal.Footer>\r\n\t</Modal>\r\n);\r\n\r\n\r\n// PROPERTIES //\r\n\r\nMsgModal.propTypes = {\r\n\tclose: PropTypes.func,\r\n\tmessage: PropTypes.string,\r\n\tshow: PropTypes.bool,\r\n\ttitle: PropTypes.string\r\n};\r\n\r\nMsgModal.defaultProps = {\r\n\tclose() {},\r\n\tmessage: '',\r\n\tshow: false,\r\n\ttitle: ''\r\n};\r\n\r\n\r\n// EXPORTS //\r\n\r\nexport default MsgModal;\r\n","// MAIN //\n\n/**\n* Mapping from a given node level to the corresponding field in the schema that contains the children.\n*/\nexport const levelFieldMapping = {\n\tprogram: 'namespaces',\n\tnamespace: 'lessons',\n\tlesson: null,\n\tcomponent: null\n};\n\n/**\n* Returns the next lower level in the hierarchy.\n*\n* @private\n* @param {string} level - input level\n* @returns {string} predecessor level\n*/\nexport function predecessor( level ) {\n\tswitch ( level ) {\n\tcase 'lesson':\n\t\treturn 'component';\n\tcase 'namespace':\n\t\treturn 'lesson';\n\tcase 'program':\n\t\treturn 'namespace';\n\tcase 'global':\n\t\treturn 'program';\n\tcase 'component':\n\tdefault:\n\t\treturn null;\n\t}\n}\n\n/**\n* Returns the next lower level in the hierarchy.\n*/\nexport const levelPredecessorMapping = {\n\tglobal: 'program',\n\tprogram: 'namespace',\n\tnamespace: 'lesson',\n\tlesson: 'component',\n\tcomponent: null\n};\n","/**\n* Copyright (C) 2016-present The ISLE Authors\n*\n* The isle-dashboard program is free software: you can redistribute it and/or modify\n* it under the terms of the GNU Affero General Public License as\n* published by the Free Software Foundation, either version 3 of the\n* License, or (at your option) any later version.\n*\n* This program is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n* GNU Affero General Public License for more details.\n*\n* You should have received a copy of the GNU Affero General Public License\n* along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\n// MODULES //\n\nimport React, { useCallback, useState, Fragment } from 'react';\nimport PropTypes from 'prop-types';\nimport { useTranslation } from 'react-i18next';\nimport Button from 'react-bootstrap/Button';\nimport Row from 'react-bootstrap/Row';\nimport Col from 'react-bootstrap/Col';\nimport Form from 'react-bootstrap/Form';\nimport CreatableSelect from 'react-select/creatable';\nimport objectKeys from '@stdlib/utils/keys';\nimport isEmptyObject from '@stdlib/assert/is-empty-object';\n\n\n// FUNCTIONS //\n\nfunction createOptions( arr ) {\n\treturn arr.map( ( tag ) => {\n\t\treturn {\n\t\t\tvalue: tag,\n\t\t\tlabel: tag\n\t\t};\n\t});\n}\n\n\n// MAIN //\n\nfunction TagWeightsEditor({ tagWeights, visibleTags, onUpdate }) {\n\tconst { t } = useTranslation( 'completions' );\n\tconst tags = objectKeys( tagWeights );\n\tconst [ newTag, setNewTag ] = useState( null );\n\n\tconst handleChange = useCallback( ( event ) => {\n\t\tconst weight = Number( event.target.value );\n\t\tconst tag = event.target.getAttribute( 'data-tag' );\n\t\tconst newWeights = { ...tagWeights };\n\t\tnewWeights[ tag ] = weight;\n\t\tonUpdate( newWeights );\n\t}, [ tagWeights, onUpdate ] );\n\n\tconst handleTagDeletion = useCallback( ( event ) => {\n\t\tconst tag = event.target.getAttribute( 'data-tag' );\n\t\tconst newWeights = { ...tagWeights };\n\t\tdelete newWeights[ tag ];\n\t\tif ( isEmptyObject( newWeights ) ) {\n\t\t\tnewWeights[ '_default_tag' ] = 1;\n\t\t}\n\t\tonUpdate( newWeights );\n\t}, [ tagWeights, onUpdate ] );\n\n\tconst handleTagCreation = useCallback( ( elem ) => {\n\t\tif ( elem && elem.value && tagWeights[ elem.value ] === void 0 ) {\n\t\t\tconst { value } = elem;\n\t\t\tconst newWeights = { ...tagWeights };\n\t\t\tnewWeights[ value ] = 0;\n\t\t\tsetNewTag( null );\n\t\t\tonUpdate( newWeights );\n\t\t}\n\t}, [ tagWeights, onUpdate ] );\n\n\tconst inputs = new Array( tags.length );\n\tconst showDelete = !(tags.length === 1 && tags[ 0 ] === '_default_tag' );\n\tfor ( let i = 0; i < tags.length; i++ ) {\n\t\tconst tag = tags[ i ];\n\t\tconst weight = tagWeights[ tag ];\n\t\tinputs[ i ] = ( <Form.Group className=\"mb-1\" as={Row} key={`tag-${i}`} >\n\t\t\t<Form.Label column sm={5} >{tag === '_default_tag' ? t( 'default' ) : tag}</Form.Label>\n\t\t\t<Col sm={5} >\n\t\t\t\t<Form.Control\n\t\t\t\t\ttype=\"number\"\n\t\t\t\t\tvalue={weight}\n\t\t\t\t\tonChange={handleChange}\n\t\t\t\t\tplaceholder={1}\n\t\t\t\t\tdata-tag={tag}\n\t\t\t\t\tmin={0}\n\t\t\t\t/>\n\t\t\t</Col>\n\t\t\t<Col sm={2} >\n\t\t\t\t{showDelete && <Button variant=\"outline-secondary\" onClick={handleTagDeletion} data-tag={tag} size=\"xm\" >\n\t\t\t\t\t<i className=\"fa fa-times\" style={{ pointerEvents: 'none' }} />\n\t\t\t\t</Button>}\n\t\t\t</Col>\n\t\t</Form.Group> );\n\t}\n\treturn (\n\t\t<Fragment>\n\t\t\t{inputs}\n\t\t\t<Form.Group className=\"mb-1\" as={Row} >\n\t\t\t\t<Col sm={5} >\n\t\t\t\t\t<CreatableSelect\n\t\t\t\t\t\toptions={createOptions( visibleTags.filter( tag => tagWeights?.[ tag ] === void 0 ) )}\n\t\t\t\t\t\tonChange={handleTagCreation}\n\t\t\t\t\t\tplaceholder={t('select-a-new-tag')}\n\t\t\t\t\t\tvalue={newTag}\n\t\t\t\t\t/>\n\t\t\t\t</Col>\n\t\t\t\t<Form.Label className=\"completions-info\" column sm={5} >{t( 'add-new-weight' )}</Form.Label>\n\t\t\t\t<Col sm={2} >\n\n\t\t\t\t</Col>\n\t\t\t</Form.Group>\n\t\t</Fragment>\n\t);\n}\n\n\n// PROPERTIES //\n\nTagWeightsEditor.propTypes = {\n\tonUpdate: PropTypes.func.isRequired,\n\ttagWeights: PropTypes.object,\n\tvisibleTags: PropTypes.array.isRequired\n};\n\nTagWeightsEditor.defaultProps = {\n\ttagWeights: {\n\t\t'_default_tag': 1\n\t}\n};\n\n\n// EXPORTS //\n\nexport default TagWeightsEditor;\n","// MODULES //\n\nimport React from 'react';\nimport DateTimePicker from 'react-datetime-picker';\nimport SelectInput from 'react-select';\nimport Form from 'react-bootstrap/Form';\n\n\n// FUNCTIONS //\n\nfunction selectOption( value, transform ) {\n\treturn {\n\t\tlabel: transform ? transform(value) : value,\n\t\tvalue: value\n\t};\n}\n\nfunction convertRuleParam( value, parameter ) {\n\tswitch ( parameter.type ) {\n\t\tcase 'number':\n\t\t\treturn parseFloat( value );\n\t\tcase 'datetime':\n\t\t\treturn value.getTime();\n\t\tcase 'string':\n\t\tcase 'enum':\n\t\tcase 'text':\n\t\tdefault:\n\t\t\treturn value;\n\t}\n}\n\n\n// MAIN //\n\nfunction ParameterInput({ parameter, onChange, t, value, ...rest }) {\n\tconst { type, name, values } = parameter;\n\tswitch ( type ) {\n\t\tcase 'number':\n\t\tcase 'text':\n\t\t\treturn (\n\t\t\t\t<Form.Control\n\t\t\t\t\tkey={`${name}-param`}\n\t\t\t\t\tname={name}\n\t\t\t\t\ttype={type}\n\t\t\t\t\tplaceholder={t('enter-parameter-value')}\n\t\t\t\t\tonChange={( event ) => {\n\t\t\t\t\t\tonChange( event.target.value );\n\t\t\t\t\t}}\n\t\t\t\t\tvalue={value}\n\t\t\t\t\t{...rest}\n\t\t\t\t/>\n\t\t\t);\n\t\tcase 'enum':\n\t\t\treturn (\n\t\t\t\t<SelectInput\n\t\t\t\t\tkey={`${name}-param`}\n\t\t\t\t\tonChange={( elem ) => {\n\t\t\t\t\t\tonChange( elem ? elem.value : null );\n\t\t\t\t\t}}\n\t\t\t\t\toptions={values.map( value => selectOption( value, t ) )}\n\t\t\t\t\tvalue={value ? selectOption( value, t ) : null}\n\t\t\t\t\tisDisabled={rest.disabled}\n\t\t\t\t/>\n\t\t\t);\n\t\tcase 'datetime':\n\t\t\treturn (\n\t\t\t\t<DateTimePicker\n\t\t\t\t\tonChange={( time ) => {\n\t\t\t\t\t\tonChange( time );\n\t\t\t\t\t}}\n\t\t\t\t\tclearIcon={null}\n\t\t\t\t\tvalue={value ? new Date( value ) : new Date()}\n\t\t\t\t\t{...rest}\n\t\t\t\t/>\n\t\t\t);\n\t}\n}\n\n\n// EXPORTS //\n\nexport default ParameterInput;\n\nexport const convertRuleParameter = convertRuleParam;\n","/**\n* Copyright (C) 2016-present The ISLE Authors\n*\n* The isle-dashboard program is free software: you can redistribute it and/or modify\n* it under the terms of the GNU Affero General Public License as\n* published by the Free Software Foundation, either version 3 of the\n* License, or (at your option) any later version.\n*\n* This program is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n* GNU Affero General Public License for more details.\n*\n* You should have received a copy of the GNU Affero General Public License\n* along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\n// MODULES //\n\nimport React, { useEffect, useRef, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { useTranslation } from 'react-i18next';\nimport Button from 'react-bootstrap/Button';\nimport Row from 'react-bootstrap/Row';\nimport Col from 'react-bootstrap/Col';\nimport Modal from 'react-bootstrap/Modal';\nimport Form from 'react-bootstrap/Form';\nimport SelectInput, { components } from 'react-select';\nimport CreatableSelect from 'react-select/creatable';\nimport isPositiveNumber from '@stdlib/assert/is-positive-number';\nimport objectValues from '@stdlib/utils/values';\nimport { levelFieldMapping } from './level_fields.js';\nimport COVERAGE_OPTIONS from './coverage_options.json';\nimport TagWeightsEditor from './tag_weights_editor.js';\nimport ParameterInput, { convertRuleParameter } from './parameter_input.js';\nimport HelpfulLabel from './helpful_label.js';\n\n\n// FUNCTIONS //\n\n/**\n * Returns an object mapping tags to weights of one.\n *\n * @param {Array<string>} tags - list of tags\n * @param {Object} [existingWeights] - existing weights\n * @returns {Object} map of tag to weight\n */\n function createTagWeights( tags, existingWeights ) {\n\tif ( !tags && !existingWeights ) {\n\t\treturn {\n\t\t\t'_default_tag': 1\n\t\t};\n\t}\n\tif ( !tags ) {\n\t\treturn existingWeights;\n\t}\n\tconst defaultWeight = ( existingWeights && objectValues( existingWeights ).some( isPositiveNumber ) ) ? 0 : 1;\n\tconst weights = { ...existingWeights };\n\ttags.forEach( tag => {\n\t\tweights[ tag ] = existingWeights?.[ tag ] ?? defaultWeight;\n\t});\n\treturn weights;\n}\n\n\n// MAIN //\n\nfunction EditMetricModal({ level, entity, show, onHide, allRules, refs, createNew, metric, onConfirm }) {\n\tconst { t } = useTranslation( 'completions' );\n\tconst [ name, setName ] = useState( metric?.name || '' );\n\tconst [ rule, setRule ] = useState( metric?.rule ? allRules[ metric.rule[ 0 ] ] : null );\n\tconst [ ruleParameters, setRuleParameters ] = useState( metric?.rule ? metric.rule.slice( 1 ) : [] );\n\tconst [ coverage, setCoverage ] = useState( COVERAGE_OPTIONS[ metric?.coverage?.[ 0 ] || 'all' ] );\n\tconst [ coverageEntities, setCoverageEntities ] = useState( [] );\n\tconst [ selectedRef, setSelectedRef ] = useState( metric?.ref || null );\n\tconst [ tagWeights, setTagWeights ] = useState( createTagWeights( null, metric?.tagWeights ) );\n\tconst [ autoCompute, setAutoCompute ] = useState( metric?.autoCompute ?? false );\n\tconst [ visibleToStudent, setVisibleToStudent ] = useState( metric?.visibleToStudent ?? false );\n\tconst subEntities = useRef( [] );\n\n\tuseEffect( () => {\n\t\tif ( level === 'lesson' ) {\n\t\t\t// TODO: fetch component IDs of that lesson from completion data table\n\t\t\tsubEntities.current = [];\n\t\t} else if ( levelFieldMapping[ level ] ) {\n\t\t\tconst entities = entity[ levelFieldMapping[ level ] ];\n\t\t\tsubEntities.current = entities.map( x => {\n\t\t\t\treturn {\n\t\t\t\t\tlabel: x.title,\n\t\t\t\t\tvalue: x\n\t\t\t\t};\n\t\t\t});\n\t\t\tif ( metric && metric.coverage ) {\n\t\t\t\tconst ids = new Set( metric.coverage.slice( 1 ) );\n\t\t\t\tsetCoverageEntities( subEntities.current.filter( x => ids.has( x.value._id ) ) );\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tsubEntities.current = [];\n\t\t}\n\t}, [ level, entity, metric ] );\n\n\tconst handleConfirm = () => {\n\t\tonConfirm({\n\t\t\tname,\n\t\t\trule: [ rule.name ].concat( ruleParameters ),\n\t\t\tcoverage: [ coverage.value ].concat( coverageEntities.map( x => x.value._id ) ),\n\t\t\tlevel,\n\t\t\tid: entity._id,\n\t\t\tref: selectedRef,\n\t\t\ttagWeights,\n\t\t\tautoCompute,\n\t\t\tvisibleToStudent\n\t\t});\n\t\tonHide();\n\t};\n\tconst handleEntityChange = ( value ) => {\n\t\tsetCoverageEntities( value );\n\t};\n\tconst labelStyler = ( styles, { data }) => {\n\t\tif ( !selectedRef || data.value.completions.some( x => x.name === selectedRef ) ) {\n\t\t\treturn styles;\n\t\t}\n\t\treturn {\n\t\t\t...styles,\n\t\t\topacity: 0.65\n\t\t};\n\t};\n\tconst subentitySelectorStyles = {\n\t\toption: labelStyler,\n\t\tmultiValueLabel: labelStyler\n\t};\n\treturn (\n\t\t<Modal size=\"lg\" show={show} onHide={onHide}>\n\t\t\t<Modal.Header closeButton >\n\t\t\t\t<Modal.Title as=\"h3\">{createNew ? t('create-assessment-metric') : t('edit-assessment-metric')}</Modal.Title>\n\t\t\t</Modal.Header>\n\t\t\t<Modal.Body>\n\t\t\t\t<p>\n\t\t\t\t\t{createNew ? t('create-assessment-metric-description') : t('edit-assessment-metric-description')}\n\t\t\t\t</p>\n\t\t\t\t<Form.Group className=\"mb-2\" as={Row} >\n\t\t\t\t\t<Col sm={3} >\n\t\t\t\t\t\t<Form.Label>{t('common:name')}</Form.Label>\n\t\t\t\t\t</Col>\n\t\t\t\t\t<Col sm={9} >\n\t\t\t\t\t\t<Form.Control\n\t\t\t\t\t\t\tname=\"metric-name\"\n\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\tplaceholder={t('metric-name-placeholder')}\n\t\t\t\t\t\t\tonChange={( event ) => setName( event.target.value )}\n\t\t\t\t\t\t\tvalue={name}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Col>\n\t\t\t\t</Form.Group>\n\t\t\t\t<Form.Group className=\"mb-2\" as={Row} >\n\t\t\t\t\t<HelpfulLabel colWidth={3} name={t('common:rule')} description={rule && rule.description} disabled={!rule} />\n\t\t\t\t\t<Col sm={9} >\n\t\t\t\t\t\t<SelectInput\n\t\t\t\t\t\t\toptions={objectValues( allRules ).map( ( rule ) => ({ value: rule, label: rule.label }) )}\n\t\t\t\t\t\t\tonChange={( option ) => {\n\t\t\t\t\t\t\t\tconst newRule = option.value;\n\t\t\t\t\t\t\t\tsetRule( newRule );\n\t\t\t\t\t\t\t\tsetRuleParameters( newRule.parameters.map( x => x.default || null ) );\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tvalue={rule ? { value: rule, label: rule.label } : null}\n\t\t\t\t\t\t\tplaceholder={t('select-rule')}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Col>\n\t\t\t\t</Form.Group>\n\t\t\t\t{rule && rule.parameters.length > 0 ?\n\t\t\t\t\trule.parameters.map( ( parameter, idx ) => {\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<Form.Group key={`param-${idx}`} className=\"mb-2\" as={Row} >\n\t\t\t\t\t\t\t\t<HelpfulLabel colWidth={3} className=\"ps-5\" name={parameter.name} description={parameter.description} />\n\t\t\t\t\t\t\t\t<Col sm={9}>\n\t\t\t\t\t\t\t\t\t<ParameterInput\n\t\t\t\t\t\t\t\t\t\tparameter={parameter}\n\t\t\t\t\t\t\t\t\t\tonChange={( value ) => {\n\t\t\t\t\t\t\t\t\t\t\tconst newParams = ruleParameters.slice();\n\t\t\t\t\t\t\t\t\t\t\tnewParams[ idx ] = convertRuleParameter( value, parameter );\n\t\t\t\t\t\t\t\t\t\t\tsetRuleParameters( newParams );\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\tvalue={ruleParameters[ idx ] !== void 0 ? ruleParameters[ idx ] : parameter.default}\n\t\t\t\t\t\t\t\t\t\tt={t}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</Col>\n\t\t\t\t\t\t\t</Form.Group>\n\t\t\t\t\t\t);\n\t\t\t\t\t}) : null}\n\t\t\t\t<Form.Group className=\"mb-2\" as={Row} >\n\t\t\t\t\t<HelpfulLabel colWidth={3} name={t('common:lesson-metric')} description={t('lesson-metric-tooltip')} />\n\t\t\t\t\t<Col sm={9} >\n\t\t\t\t\t\t<CreatableSelect\n\t\t\t\t\t\t\tisClearable\n\t\t\t\t\t\t\toptions={refs.map( ( ref ) => ({ value: ref, label: ref }) )}\n\t\t\t\t\t\t\tonChange={( option ) => {\n\t\t\t\t\t\t\t\tsetSelectedRef( option ? option.value : null );\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tdefaultValue={selectedRef ? { value: selectedRef, label: selectedRef } : null}\n\t\t\t\t\t\t\tcomponents={{\n\t\t\t\t\t\t\t\tSingleValue: ({ children, ...rest }) => {\n\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t<components.SingleValue {...rest} >\n\t\t\t\t\t\t\t\t\t\t\t{children}{refs && !refs.includes( selectedRef ) && <span className=\"completions-warning\" >{` (${t('lesson-metric-does-not-exist-yet')})`}</span>}\n\t\t\t\t\t\t\t\t\t\t</components.SingleValue>\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Col>\n\t\t\t\t</Form.Group>\n\t\t\t\t<Form.Group className=\"mb-2\" as={Row} >\n\t\t\t\t\t<HelpfulLabel colWidth={3} name={t('common:coverage')} description={t('coverage-tooltip')} />\n\t\t\t\t\t<Col sm={9} >\n\t\t\t\t\t\t<SelectInput\n\t\t\t\t\t\t\toptions={objectValues( COVERAGE_OPTIONS )}\n\t\t\t\t\t\t\tonChange={( option ) => {\n\t\t\t\t\t\t\t\tsetCoverage( option );\n\t\t\t\t\t\t\t\tif ( option.value === 'all' ) {\n\t\t\t\t\t\t\t\t\tsetCoverageEntities( [] );\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tvalue={coverage}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t{( coverage.value === 'include' || coverage.value === 'exclude' ) ?\n\t\t\t\t\t\t\t<SelectInput\n\t\t\t\t\t\t\t\tisMulti\n\t\t\t\t\t\t\t\toptions={subEntities.current}\n\t\t\t\t\t\t\t\tonChange={handleEntityChange}\n\t\t\t\t\t\t\t\tvalue={coverageEntities}\n\t\t\t\t\t\t\t\tstyles={subentitySelectorStyles}\n\t\t\t\t\t\t\t\tplaceholder=\"Select lessons...\"\n\t\t\t\t\t\t\t\tcomponents={{\n\t\t\t\t\t\t\t\t\tPlaceholder: ({ children, isFocused, ...rest }) => {\n\t\t\t\t\t\t\t\t\t\tconsole.log( rest );\n\t\t\t\t\t\t\t\t\t\treturn ( <components.Placeholder {...rest}>\n\t\t\t\t\t\t\t\t\t\t\t{children} {isFocused ? '(opaque lessons have no metric for the selected ref)' : ''}\n\t\t\t\t\t\t\t\t\t\t</components.Placeholder> );\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t/> : null\n\t\t\t\t\t\t}\n\t\t\t\t\t</Col>\n\t\t\t\t</Form.Group>\n\t\t\t\t<Form.Group className=\"mb-2\" as={Row} controlId=\"users\" >\n\t\t\t\t\t<HelpfulLabel colWidth={3} name={t('tag-weights')} description={t('tag-weights-tooltip')} />\n\t\t\t\t\t<Col sm={9} >\n\t\t\t\t\t\t<TagWeightsEditor tagWeights={tagWeights} visibleTags={entity.lessonTags} onUpdate={setTagWeights} />\n\t\t\t\t\t</Col>\n\t\t\t\t</Form.Group>\n\t\t\t\t<Form.Check\n\t\t\t\t\taria-label={t('auto-compute')}\n\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\tlabel={<HelpfulLabel name={t('auto-compute')} description={t('auto-compute-tooltip')} placement=\"right\" as=\"span\" />}\n\t\t\t\t\tdefaultChecked={autoCompute}\n\t\t\t\t\tonChange={( event) => {\n\t\t\t\t\t\tsetAutoCompute( event.target.checked );\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t\t<Form.Check\n\t\t\t\t\taria-label={t('visible-to-student')}\n\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\tlabel={<HelpfulLabel name={t('visible-to-student')} description={t('visible-to-student-tooltip')} placement=\"right\" as=\"span\" />}\n\t\t\t\t\tdefaultChecked={visibleToStudent}\n\t\t\t\t\tonChange={( event) => {\n\t\t\t\t\t\tsetVisibleToStudent( event.target.checked );\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t</Modal.Body>\n\t\t\t<Modal.Footer>\n\t\t\t\t<Button onClick={onHide}>\n\t\t\t\t\t{t('common:cancel')}\n\t\t\t\t</Button>\n\t\t\t\t<Button variant=\"success\" onClick={handleConfirm} disabled={!rule || !name} >\n\t\t\t\t\t{createNew ? t('common:create') : t('common:save')}\n\t\t\t\t</Button>\n\t\t\t</Modal.Footer>\n\t\t</Modal>\n\t);\n}\n\n\n// PROPERTIES //\n\nEditMetricModal.propTypes = {\n\tallRules: PropTypes.object.isRequired,\n\tcreateNew: PropTypes.bool.isRequired,\n\tentity: PropTypes.object.isRequired,\n\tlevel: PropTypes.oneOf([ 'program', 'namespace' ]).isRequired,\n\tmetric: PropTypes.object,\n\tonConfirm: PropTypes.func.isRequired,\n\tonHide: PropTypes.func.isRequired,\n\trefs: PropTypes.array.isRequired,\n\tshow: PropTypes.bool.isRequired\n};\n\nEditMetricModal.defaultProps = {\n\tmetric: null\n};\n\n\n// EXPORTS //\n\nexport default EditMetricModal;\n","/**\n* Copyright (C) 2016-present The ISLE Authors\n*\n* The isle-dashboard program is free software: you can redistribute it and/or modify\n* it under the terms of the GNU Affero General Public License as\n* published by the Free Software Foundation, either version 3 of the\n* License, or (at your option) any later version.\n*\n* This program is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n* GNU Affero General Public License for more details.\n*\n* You should have received a copy of the GNU Affero General Public License\n* along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\n// MODULES //\n\nimport React, { useEffect, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport axios from 'axios';\nimport { useTranslation } from 'react-i18next';\nimport debounce from 'lodash.debounce';\nimport ListGroup from 'react-bootstrap/ListGroup';\nimport Button from 'react-bootstrap/Button';\nimport OverlayTrigger from 'react-bootstrap/OverlayTrigger';\nimport Tooltip from 'react-bootstrap/Tooltip';\nimport incrspace from '@stdlib/array/incrspace';\nimport server from 'constants/server';\nimport ConfirmModal from 'components/confirm-modal';\nimport ComputeModal from './compute_modal.js';\nimport EditMetricModal from './edit_metric_modal.js';\nimport { levelFieldMapping } from './level_fields.js';\nimport './completions.css';\n\n\n// MAIN //\n\n/**\n* Completion and assessment reports pane.\n*\n* ## Notes\n*\n* -   Renders the list of completion metrics for the course\n* -   Configuration displays the list of completion for the course with an edit and delete button as well as a button to create a new completion metric.\n* -   When creating or editing a completion metric, users will have to choose a name, the coverage (multi-select box with \"all\" lessons or ones to \"include\" or \"exclude\"), the rule for combining the information across lessons (selected from a fixed list of options) with associated parameters (e.g., dropN where the lowest N grades are dropped), and a `ref` select field that specifies which metric to use on the lower level (populated by the metrics contained in the selected lessons of the course)\n* -   Each completion metric item has a compute button, which opens a form in a model window containing four fields: A date range select box to define the time range, a multi-select field to choose the set of users for which to compute the grades, a select field for the multiples policy ('last', 'first', 'max', or 'pass-through'), and a tag weight selector\n* -   Computing the scores will save the generated results within the individual user objects (associated with the data when they were last computed)\n*/\nfunction CompletionsPage( props ) {\n\tconst { t } = useTranslation( 'completions' );\n\tconst [ selectedMetric, setSelectedMetric ] = useState( null );\n\tconst [ showComputeModal, setShowComputeModal ] = useState( false );\n\tconst [ showDeleteModal, setShowDeleteModal ] = useState( false );\n\tconst [ showCreateModal, setShowCreateModal ] = useState( false );\n\tconst [ showEditModal, setShowEditModal ] = useState( false );\n\tconst [ refs, setRefs ] = useState( null );\n\tconst metrics = props.entity.completions || [];\n\tconst [ order, setOrder ] = useState( incrspace( 0, metrics.length, 1 ) );\n\tuseEffect( () => {\n\t\t// ATTN: this is a hack to get the tags and refs to be populated before the first render\n\t\tif ( props.level === 'lesson' ) {\n\t\t\tsetRefs( props.lessonRefs );\n\t\t} else {\n\t\t\tconst subentities = props.entity[ levelFieldMapping[ props.level ] ];\n\t\t\tconst completions = new Set();\n\t\t\tsubentities.forEach( subentity => {\n\t\t\t\tsubentity.completions.forEach( completion => {\n\t\t\t\t\tcompletions.add( completion.name );\n\t\t\t\t});\n\t\t\t});\n\t\t\tsetRefs( Array.from( completions ).sort() );\n\t\t}\n\t}, [ props.entity, props.level, props.lessonRefs ] );\n\n\tconst handleDeleteMetric = () => {\n\t\tconst idx = metrics.findIndex( metric => metric.name === selectedMetric.name );\n\t\tconst newOrder = order.filter( v => v !== idx ).map( x => {\n\t\t\tif ( x > idx ) {\n\t\t\t\treturn x - 1;\n\t\t\t}\n\t\t\treturn x;\n\t\t});\n\t\tsetOrder( newOrder );\n\t\tprops.deleteMetric({\n\t\t\tid: props.entity._id,\n\t\t\tlevel: props.level,\n\t\t\tname: selectedMetric.name\n\t\t})\n\t\t\t.then( response => {\n\t\t\t\tsetSelectedMetric( null );\n\t\t\t\tsetShowDeleteModal( false );\n\t\t\t})\n\t\t\t.catch( err => {\n\t\t\t\tconsole.log( 'Error deleting metric:', err );\n\t\t\t});\n\t};\n\tconst transposeMetrics = ( index, next ) => {\n\t\treturn debounce( () => {\n\t\t\tconst newOrder = [ ...order ];\n\t\t\tconst i = newOrder[ index ];\n\t\t\tif ( next ) {\n\t\t\t\tnewOrder[ index ] = newOrder[ index + 1 ];\n\t\t\t\tnewOrder[ index + 1 ] = i;\n\t\t\t} else {\n\t\t\t\tnewOrder[ index ] = newOrder[ index - 1 ];\n\t\t\t\tnewOrder[ index - 1 ] = i;\n\t\t\t}\n\t\t\tsetOrder( newOrder );\n\t\t\taxios.post( `${server}/metric_order`, { id: props.entity._id, level: props.level, index: index, next: next })\n\t\t\t\t.then( response => {\n\t\t\t\t\tconsole.log( response );\n\t\t\t\t})\n\t\t\t\t.catch( err => {\n\t\t\t\t\tconsole.log( 'Error updating metric order:', err );\n\t\t\t\t});\n\t\t}, 200 );\n\t};\n\treturn (\n\t\t<div style={{ margin: 12 }} >\n\t\t\t<ListGroup>\n\t\t\t\t{order.map( ( metricIndex, idx ) => {\n\t\t\t\t\tconst metric = metrics[ metricIndex ];\n\t\t\t\t\tif ( !metric ) {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t\tconst handleCompute = () => {\n\t\t\t\t\t\tsetSelectedMetric( metric );\n\t\t\t\t\t\tsetShowComputeModal( true );\n\t\t\t\t\t};\n\t\t\t\t\t// TODO: edit metric functionality & delete metric functionality\n\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<ListGroup.Item key={`${metricIndex}-${idx}`} className=\"d-flex w-100 justify-content-start metric-list-item\" >\n\t\t\t\t\t\t\t<label className=\"me-2\" >\n\t\t\t\t\t\t\t\t{metric.name}\n\t\t\t\t\t\t\t\t{refs && !refs.includes( metric.ref ) && <span className=\"completions-warning ms-2\" >{t('uses-not-yet-existing-lesson-metric')}</span>}\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\t\tdisplay: 'inline-block',\n\t\t\t\t\t\t\t\t\tmaxWidth: 'calc(100% - 400px)',\n\t\t\t\t\t\t\t\t\toverflow: 'hidden',\n\t\t\t\t\t\t\t\t\ttextOverflow: 'ellipsis',\n\t\t\t\t\t\t\t\t\twhiteSpace: 'nowrap',\n\t\t\t\t\t\t\t\t\tfontStyle: 'italic'\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>{metric.description}</span>\n\t\t\t\t\t\t\t<span className=\"ms-auto\" >\n\t\t\t\t\t\t\t\t{!metric.autoCompute && <OverlayTrigger placement=\"top\" overlay={<Tooltip id={`tooltip-compute-${idx}`} >{t( 'compute-metric-tooltip' )}</Tooltip>} >\n\t\t\t\t\t\t\t\t\t<Button variant=\"secondary\" size=\"sm\" className=\"mx-2\" onClick={handleCompute} >{t('common:compute')}</Button>\n\t\t\t\t\t\t\t\t</OverlayTrigger>}\n\t\t\t\t\t\t\t\t<OverlayTrigger placement=\"top\" overlay={<Tooltip id={`tooltip-edit-${idx}`} >{t( 'edit-metric-tooltip' )}</Tooltip>} >\n\t\t\t\t\t\t\t\t\t<Button variant=\"secondary\" size=\"sm\" className=\"mx-2\" onClick={() => {\n\t\t\t\t\t\t\t\t\t\tsetSelectedMetric( metric );\n\t\t\t\t\t\t\t\t\t\tsetShowEditModal( true );\n\t\t\t\t\t\t\t\t\t}} >{t('common:edit')}</Button>\n\t\t\t\t\t\t\t\t</OverlayTrigger>\n\t\t\t\t\t\t\t\t<OverlayTrigger placement=\"top\" overlay={<Tooltip id={`tooltip-delete-${idx}`} >{t( 'delete-metric-tooltip' )}</Tooltip>} >\n\t\t\t\t\t\t\t\t\t<Button variant=\"danger\" size=\"sm\" className=\"mx-2\" onClick={() => {\n\t\t\t\t\t\t\t\t\t\tsetSelectedMetric( metric );\n\t\t\t\t\t\t\t\t\t\tsetShowDeleteModal( true );\n\t\t\t\t\t\t\t\t\t}} >{t('common:delete')}</Button>\n\t\t\t\t\t\t\t\t</OverlayTrigger>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\taria-label={t('move-metric-down')}\n\t\t\t\t\t\t\t\t\tsize=\"sm\" variant=\"secondary\"\n\t\t\t\t\t\t\t\t\tclassName=\"mx-1\" disabled={idx === metrics.length - 1}\n\t\t\t\t\t\t\t\t\tonClick={transposeMetrics( idx, true )}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<i className=\"fas fa-chevron-down\" />\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\taria-label={t('move-metric-up')}\n\t\t\t\t\t\t\t\t\tsize=\"sm\" variant=\"secondary\"\n\t\t\t\t\t\t\t\t\tdisabled={idx === 0}\n\t\t\t\t\t\t\t\t\tonClick={transposeMetrics( idx, false )}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<i className=\"fas fa-chevron-up\" />\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</ListGroup.Item>\n\t\t\t\t\t);\n\t\t\t\t})}\n\t\t\t</ListGroup>\n\t\t\t<OverlayTrigger placement=\"bottom\" overlay={<Tooltip id=\"tooltip-create-metric\" >{t( 'create-metric-tooltip' )}</Tooltip>} >\n\t\t\t\t<Button variant=\"primary\" style={{ marginTop: 12 }} onClick={() => {\n\t\t\t\t\tsetShowCreateModal( true );\n\t\t\t\t}} >\n\t\t\t\t\t{t('create-metric')}\n\t\t\t\t</Button>\n\t\t\t</OverlayTrigger>\n\t\t\t{selectedMetric ? <ComputeModal\n\t\t\t\tkey={`compute-modal-${selectedMetric.name}`}\n\t\t\t\tmetric={selectedMetric}\n\t\t\t\tshow={showComputeModal}\n\t\t\t\tonHide={() => setShowComputeModal( false )}\n\t\t\t\tcohorts={props.cohorts}\n\n\t\t\t\tentity={props.entity}\n\t\t\t\tlevel={props.level}\n\t\t\t\tcomputeCompletions={props.computeCompletions}\n\t\t\t\tonCompute={() => setShowComputeModal( false )}\n\t\t\t/> : null}\n\t\t\t{showCreateModal ? <EditMetricModal\n\t\t\t\tkey=\"create-modal\"\n\t\t\t\tshow={showCreateModal}\n\t\t\t\tonHide={() => setShowCreateModal( false )}\n\t\t\t\tallRules={props.settings.completionRules}\n\t\t\t\tlevel={props.level}\n\t\t\t\tentity={props.entity}\n\t\t\t\trefs={refs}\n\t\t\t\tcreateNew={true}\n\t\t\t\tonConfirm={( body ) => {\n\t\t\t\t\tprops.createMetric( body );\n\t\t\t\t\tconst newOrder = order.slice();\n\t\t\t\t\tnewOrder.push( order.length );\n\t\t\t\t\tsetOrder( newOrder );\n\t\t\t\t}}\n\t\t\t/> : null}\n\t\t\t{showDeleteModal ? <ConfirmModal\n\t\t\t\ttitle={t('delete-metric')}\n\t\t\t\tmessage={t('delete-metric-confirm')}\n\t\t\t\tclose={() => setShowDeleteModal( false )}\n\t\t\t\tshow={showDeleteModal}\n\t\t\t\tonConfirm={handleDeleteMetric}\n\t\t\t/> : null }\n\t\t\t{showEditModal ? <EditMetricModal\n\t\t\t\tkey={`edit-modal-${selectedMetric.name}`}\n\t\t\t\tshow={showEditModal}\n\t\t\t\tonHide={() => setShowEditModal( false )}\n\t\t\t\tallRules={props.settings.completionRules}\n\t\t\t\tlevel={props.level}\n\t\t\t\tentity={props.entity}\n\t\t\t\trefs={refs}\n\t\t\t\tcreateNew={false}\n\t\t\t\tmetric={selectedMetric}\n\t\t\t\tonConfirm={props.updateMetric}\n\t\t\t/> : null}\n\t\t</div>\n\t);\n}\n\n\n// PROPERTIES //\n\nCompletionsPage.propTypes = {\n\tcohorts: PropTypes.array.isRequired,\n\tcomputeCompletions: PropTypes.func.isRequired,\n\tcreateMetric: PropTypes.func.isRequired,\n\tdeleteMetric: PropTypes.func.isRequired,\n\tentity: PropTypes.object.isRequired,\n\tlessonRefs: PropTypes.array.isRequired,\n\tlevel: PropTypes.string.isRequired,\n\tsettings: PropTypes.object.isRequired,\n\tupdateMetric: PropTypes.func.isRequired\n};\n\n\n// EXPORTS //\n\nexport default CompletionsPage;\n","/**\n* Copyright (C) 2016-present The ISLE Authors\n*\n* The isle-dashboard program is free software: you can redistribute it and/or modify\n* it under the terms of the GNU Affero General Public License as\n* published by the Free Software Foundation, either version 3 of the\n* License, or (at your option) any later version.\n*\n* This program is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n* GNU Affero General Public License for more details.\n*\n* You should have received a copy of the GNU Affero General Public License\n* along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\n// MODULES //\n\nimport React from 'react';\nimport { connect } from 'react-redux';\nimport Completions from 'components/completions';\nimport { computeCompletionsInjector, createMetricInjector, deleteMetricInjector, updateMetricInjector } from 'actions/completions';\nimport { addNotificationInjector } from 'actions/notification';\n\n\n// FUNCTIONS //\n\nfunction mapStateToProps( state ) {\n\treturn {\n\t\tuser: state.user,\n\t\tnamespace: state.namespace,\n\t\tcohorts: state.namespace.cohorts,\n\t\tsettings: state.settings\n\t};\n}\n\nfunction mapDispatchToProps( dispatch ) {\n\treturn {\n\t\taddNotification: addNotificationInjector( dispatch ),\n\t\tcreateMetric: createMetricInjector( dispatch ),\n\t\tdeleteMetric: deleteMetricInjector( dispatch ),\n\t\tupdateMetric: updateMetricInjector( dispatch ),\n\t\tcomputeCompletions: computeCompletionsInjector( dispatch )\n\t};\n}\n\n\n// MAIN //\n\nconst VisibleCompletions = connect( mapStateToProps, mapDispatchToProps )( Completions );\n\n\n// EXPORTS //\n\nexport default VisibleCompletions;\n","/**\n* Copyright (C) 2016-present The ISLE Authors\n*\n* The isle-dashboard program is free software: you can redistribute it and/or modify\n* it under the terms of the GNU Affero General Public License as\n* published by the Free Software Foundation, either version 3 of the\n* License, or (at your option) any later version.\n*\n* This program is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n* GNU Affero General Public License for more details.\n*\n* You should have received a copy of the GNU Affero General Public License\n* along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\n// MODULES //\n\nimport React, { Fragment, useCallback, useEffect, useRef, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { useTranslation } from 'react-i18next';\nimport Button from 'react-bootstrap/Button';\nimport Row from 'react-bootstrap/Row';\nimport Col from 'react-bootstrap/Col';\nimport Card from 'react-bootstrap/Card';\nimport Form from 'react-bootstrap/Form';\nimport InputGroup from 'react-bootstrap/InputGroup';\nimport SelectInput from 'react-select';\nimport CreatableSelect from 'react-select/creatable';\nimport objectValues from '@stdlib/utils/values';\nimport ConfirmModal from 'components/confirm-modal';\nimport COVERAGE_OPTIONS from './coverage_options.json';\nimport hash from 'object-hash';\nimport ComputeModal from './compute_modal.js';\nimport TagWeightsEditor from './tag_weights_editor';\nimport ParameterInput, { convertRuleParameter } from './parameter_input.js';\nimport HelpfulLabel from './helpful_label.js';\n\n\n// VARIABLES //\n\nconst COVERAGE_OPTIONS_ARRAY = objectValues( COVERAGE_OPTIONS );\nconst SELECT_STYLES = {\n\tmenuPortal: ( base ) => ({\n\t\t...base,\n\t\tzIndex: 9999\n\t})\n};\n\n\n// FUNCTIONS //\n\nfunction selectOption( value, transform ) {\n\treturn {\n\t\tlabel: transform ? transform(value) : value,\n\t\tvalue: value\n\t};\n}\n\nfunction analyzeLessonMetrics( name, lessons ) {\n\tconst lessonInfo = lessons.reduce( (acc, lesson) => {\n\t\tconst namedMetric = lesson.completions.find( metric => metric.name === name );\n\t\tif ( namedMetric ) {\n\t\t\tacc.active[lesson._id] = namedMetric;\n\t\t\tacc.rules.add( JSON.stringify(namedMetric.rule) );\n\t\t\tacc.rule = namedMetric.rule;\n\t\t\tacc.refs.add( namedMetric.ref );\n\t\t\tacc.ref = namedMetric.ref;\n\t\t}\n\t\treturn acc;\n\t}, { rules: new Set(), refs: new Set(), active: {}, rule: null, ref: null }, lessons);\n\tif ( lessonInfo.rules.size > 0 ) {\n\t\treturn {\n\t\t\thasSharedRule: lessonInfo.rules.size === 1,\n\t\t\thasSharedRef: lessonInfo.refs.size === 1,\n\t\t\tactiveLessons: lessonInfo.active,\n\t\t\trule: lessonInfo.rule,\n\t\t\tref: lessonInfo.ref\n\t\t};\n\t}\n\treturn {\n\t\tactiveLessons: {},\n\t\thasSharedRule: true,\n\t\thasSharedRef: true,\n\t\trule: null,\n\t\tref: null\n\t};\n}\n\nfunction availableLessonMetrics( lessons ) {\n\tconst allMetrics = lessons.reduce( ( acc, lesson ) => {\n\t\tlesson.completions.forEach( metric => {\n\t\t\tacc.add( metric.name );\n\t\t});\n\t\treturn acc;\n\t}, new Set() );\n\treturn Array.from( allMetrics ).sort().map( metric => ({ value: metric, label: metric }) );\n}\n\n\n// MAIN //\n\nfunction EditLessonMetrics({ name, preferredLesson, lessons, lessonRefs, componentsByLesson, computeCompletions, namespace, saveLessonMetrics, allRules, tags, onSave }) {\n\tconst [ chosenName, setChosenName ] = useState( name );\n\tconst [ hasSharedRule, setHasSharedRule ] = useState( false );\n\tconst [ sharedRule, setSharedRule ] = useState( null );\n\tconst [ sharedRuleParameters, setSharedRuleParameters ] = useState( [] );\n\tconst [ hasSharedRef, setHasSharedRef ] = useState( false );\n\tconst [ sharedRef, setSharedRef ] = useState( null );\n\tconst [ activeLessons, setActiveLessons ] = useState( {} );\n\tconst [ selectedLessons, setSelectedLessons ] = useState( {} );\n\tconst [ currentHash, setCurrentHash ] = useState( null );\n\tconst [ isNewMetric, setIsNewMetric ] = useState( false );\n\tconst [ showComputeModal, setShowComputeModal ] = useState( false );\n\tconst [ showDeleteModal, setShowDeleteModal ] = useState( false );\n\tconst [ hasSaved, setHasSaved ] = useState( false );\n\n\tconst availableMetrics = useRef( null );\n\tconst analyzedHash = useRef( null );\n\tconst analysisRef = useRef( null );\n\n\tconst incorporateAnalysis = useCallback( ( analysis ) => {\n\t\tsetHasSharedRule( analysis.hasSharedRule );\n\t\tlet newSharedRule = null;\n\t\tlet newSharedRuleParameters = [];\n\t\tconst isSharedRuleSet = analysis.hasSharedRule && analysis.rule && analysis.rule[ 0 ];\n\t\tif ( isSharedRuleSet ) {\n\t\t\tnewSharedRule = allRules[ analysis.rule[ 0 ] ];\n\t\t\tnewSharedRuleParameters = analysis.rule.slice( 1 );\n\t\t\tsetSharedRule( newSharedRule );\n\t\t\tsetSharedRuleParameters( newSharedRuleParameters );\n\t\t}\n\t\tsetHasSharedRef( analysis.hasSharedRef );\n\t\tif ( analysis.hasSharedRef ) {\n\t\t\tsetSharedRef( analysis.ref );\n\t\t}\n\t\tconst lessonSpec = {\n\t\t\tsharedRule: newSharedRule,\n\t\t\tsharedRuleParameters: newSharedRuleParameters,\n\t\t\tsharedRef: analysis.hasSharedRef ? analysis.ref : null,\n\t\t\tactiveLessons: { ...analysis.activeLessons }\n\t\t};\n\t\tconst newSelectedLessons = {};\n\t\tfor ( let i = 0; i < lessons.length; i++ ) {\n\t\t\tconst lesson = lessons[ i ];\n\t\t\tconst lessonId = lesson._id;\n\t\t\tconst lessonMetric = lessonSpec.activeLessons[ lessonId ];\n\t\t\tif ( lessonMetric ) {\n\t\t\t\tnewSelectedLessons[ lessonId ] = true;\n\t\t\t} else {\n\t\t\t\t// Case: lesson does not have the metric (yet)\n\t\t\t\tnewSelectedLessons[ lessonId ] = false;\n\t\t\t\tlessonSpec.activeLessons[ lessonId ] = {\n\t\t\t\t\tname: chosenName,\n\t\t\t\t\trule: isSharedRuleSet ? [ lessonSpec.sharedRule.name, ...lessonSpec.sharedRuleParameters ] : null,\n\t\t\t\t\tref: analysis.hasSharedRef ? lessonSpec.sharedRef : null,\n\t\t\t\t\tcoverage: [ 'all' ],\n\t\t\t\t\tlevel: 'lesson',\n\t\t\t\t\tautoCompute: false,\n\t\t\t\t\tvisibleToStudents: false,\n\t\t\t\t\ttagWeights: {\n\t\t\t\t\t\t'_default_tag': 1\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\tlessonSpec.selectedLessons = newSelectedLessons;\n\t\tanalyzedHash.current = hash( lessonSpec );\n\t\tsetCurrentHash( analyzedHash.current );\n\t\tsetActiveLessons( lessonSpec.activeLessons );\n\t\tsetSelectedLessons( newSelectedLessons );\n\t}, [ chosenName, lessons ] );\n\n\tuseEffect( () => {\n\t\tavailableMetrics.current = availableLessonMetrics( lessons );\n\t}, [ lessons ] );\n\tuseEffect( () => {\n\t\tconsole.log( 'Analyze lesson metrics and incorporate analysis...' );\n\t\tconst analysis = analyzeLessonMetrics( chosenName, lessons );\n\t\tanalysisRef.current = analysis;\n\t\tincorporateAnalysis( analysis );\n\t}, [ incorporateAnalysis, lessons, chosenName ] );\n\tconst resetHash = useCallback( () => {\n\t\tconst lessonSpec = {\n\t\t\tsharedRule: hasSharedRule ? sharedRule : null,\n\t\t\tsharedRuleParameters: hasSharedRule ? sharedRuleParameters : [],\n\t\t\tsharedRef: hasSharedRef ? sharedRef : null,\n\t\t\tactiveLessons,\n\t\t\tselectedLessons\n\t\t};\n\t\tsetCurrentHash( hash( lessonSpec ) );\n\t}, [ hasSharedRule, sharedRule, sharedRuleParameters, hasSharedRef, sharedRef, activeLessons, selectedLessons ] );\n\tuseEffect( resetHash, [ resetHash ] );\n\n\tconst handleSave = useCallback( () => {\n\t\tconst lessonMetrics = { ...activeLessons };\n\t\tnamespace.lessons.forEach( lesson => {\n\t\t\tif ( !selectedLessons[ lesson._id ] ) {\n\t\t\t\t// Case: mark for deletion on server\n\t\t\t\tlessonMetrics[ lesson._id ] = null;\n\t\t\t} else {\n\t\t\t\tlessonMetrics[ lesson._id ] = {\n\t\t\t\t\t...lessonMetrics[ lesson._id ],\n\t\t\t\t\t...( hasSharedRef ? { ref: sharedRef } : {} ),\n\t\t\t\t\t...( hasSharedRule ? { rule: [ sharedRule.name, ...sharedRuleParameters ] } : {} )\n\t\t\t\t};\n\t\t\t}\n\t\t});\n\t\tconst body = {\n\t\t\tnamespaceID: namespace._id,\n\t\t\tname: chosenName,\n\t\t\tlessonMetrics\n\t\t};\n\t\tonSave( body );\n\t\tsaveLessonMetrics( body )\n\t\t\t.then( res => {\n\t\t\t\tconsole.log( 'Saved lesson metrics:', res.data );\n\t\t\t\tsetHasSaved( true );\n\t\t\t\tsetIsNewMetric( false );\n\t\t\t\tif ( objectValues( selectedLessons ).every( x => x === false ) ) {\n\t\t\t\t\tsetChosenName( null );\n\t\t\t\t\tsetCurrentHash( null );\n\t\t\t\t\tsetSharedRef( null );\n\t\t\t\t\tsetSharedRule( null );\n\t\t\t\t}\n\t\t\t\tresetHash();\n\t\t\t})\n\t\t\t.catch( err => {\n\n\t\t\t});\n\t}, [ activeLessons, chosenName, namespace, hasSharedRef, sharedRef, hasSharedRule, resetHash, selectedLessons, sharedRule, sharedRuleParameters, saveLessonMetrics, onSave ] );\n\tconst { t } = useTranslation( 'completions' );\n\tconst lessonRefOptions = lessonRefs.map( ( ref ) => ({ value: ref, label: ref }) );\n\tconst allRulesOptions = objectValues( allRules ).map( ( rule ) => ({ value: rule, label: rule.label }) );\n\tconst sharedInputs = <>\n\t\t<Form.Group className=\"mb-2\" as={Row} >\n\t\t\t<Col sm={3} >\n\t\t\t\t<Form.Check\n\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\tid=\"shared-rule-checkbox\"\n\t\t\t\t\tlabel={t('share-across-lessons')}\n\t\t\t\t\tonChange={( event ) => {\n\t\t\t\t\t\tsetHasSharedRule( event.target.checked );\n\t\t\t\t\t}}\n\t\t\t\t\tchecked={hasSharedRule}\n\t\t\t\t/>\n\t\t\t</Col>\n\t\t\t<HelpfulLabel colWidth={3} name={t('common:rule')} description={sharedRule && sharedRule.description} disabled={!hasSharedRule} />\n\t\t\t<Col sm={6} >\n\t\t\t\t<SelectInput\n\t\t\t\t\tisDisabled={!hasSharedRule}\n\t\t\t\t\toptions={allRulesOptions}\n\t\t\t\t\tonChange={( option ) => {\n\t\t\t\t\t\tconst newRule = option.value;\n\t\t\t\t\t\tsetSharedRule( newRule );\n\t\t\t\t\t\tsetSharedRuleParameters( newRule.parameters.map( x => x.default || null ) );\n\t\t\t\t\t}}\n\t\t\t\t\tvalue={sharedRule ? { value: sharedRule, label: sharedRule.label } : null}\n\t\t\t\t/>\n\t\t\t</Col>\n\t\t</Form.Group>\n\t\t{hasSharedRule && sharedRule && sharedRule.parameters.length > 0 &&\n\t\t\tsharedRule.parameters.map( ( parameter, idx ) => {\n\t\t\t\treturn (\n\t\t\t\t\t<Form.Group key={`param-${idx}`} className=\"mb-2\" as={Row} >\n\t\t\t\t\t\t<Col sm={3} ></Col>\n\t\t\t\t\t\t<HelpfulLabel className=\"ps-5\" colWidth={3} name={parameter.name} description={parameter.description} />\n\t\t\t\t\t\t<Col sm={6} >\n\t\t\t\t\t\t\t<ParameterInput\n\t\t\t\t\t\t\t\tkey={`${sharedRule.name}-param-${idx}`}\n\t\t\t\t\t\t\t\tparameter={parameter}\n\t\t\t\t\t\t\t\tvalue={sharedRuleParameters[ idx ] !== void 0 ? sharedRuleParameters[ idx ] : parameter.default}\n\t\t\t\t\t\t\t\tonChange={( value ) => {\n\t\t\t\t\t\t\t\t\tconsole.log( 'Changed parameter value:', value );\n\t\t\t\t\t\t\t\t\tconst newParams = sharedRuleParameters.slice();\n\t\t\t\t\t\t\t\t\tnewParams[ idx ] = convertRuleParameter( value, parameter );\n\t\t\t\t\t\t\t\t\tsetSharedRuleParameters( newParams );\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tt={t}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</Col>\n\t\t\t\t\t</Form.Group>\n\t\t\t\t);\n\t\t})}\n\t\t<Form.Group className=\"mb-2\" as={Row} >\n\t\t\t<Col sm={3} >\n\t\t\t\t<Form.Check\n\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\tid=\"shared-ref-checkbox\"\n\t\t\t\t\tlabel={t('share-across-lessons')}\n\t\t\t\t\tonChange={( event ) => {\n\t\t\t\t\t\tsetHasSharedRef( event.target.checked );\n\t\t\t\t\t}}\n\t\t\t\t\tchecked={hasSharedRef}\n\t\t\t\t/>\n\t\t\t</Col>\n\t\t\t<HelpfulLabel colWidth={3} name={t('common:component-metric')} description={t('component-metric-tooltip')} />\n\t\t\t<Col sm={6} >\n\t\t\t\t<CreatableSelect\n\t\t\t\t\tisClearable\n\t\t\t\t\tisDisabled={!hasSharedRef}\n\t\t\t\t\toptions={lessonRefOptions}\n\t\t\t\t\tonChange={( option ) => {\n\t\t\t\t\t\tsetSharedRef( option ? option.value : null );\n\t\t\t\t\t}}\n\t\t\t\t\tvalue={sharedRef ? { value: sharedRef, label: sharedRef } : null}\n\t\t\t\t/>\n\t\t\t</Col>\n\t\t</Form.Group>\n\t</>;\n\tconst sortedLessons = Array.from( lessons ).sort( preferredLesson ? ( a, b ) => {\n\t\tif ( a.title === preferredLesson.title ) {\n\t\t\treturn -1;\n\t\t}\n\t\tif ( b.title === preferredLesson.title ) {\n\t\t\treturn 1;\n\t\t}\n\t\treturn a.title.localeCompare( b.title );\n\t} : ( a, b ) => a.title.localeCompare( b.title ) );\n\tconst lessonInputs = sortedLessons.map( x => {\n\t\tconst lessonIsActive = selectedLessons[ x._id ];\n\t\tlet defaultRuleParameters;\n\t\tlet defaultRule;\n\t\tlet defaultRef;\n\t\tif ( lessonIsActive ) {\n\t\t\tif ( hasSharedRef && sharedRef ) {\n\t\t\t\tdefaultRef = { value: sharedRef, label: sharedRef };\n\t\t\t} else {\n\t\t\t\tdefaultRef = activeLessons[ x._id ].ref ? { value: activeLessons[ x._id ].ref, label: activeLessons[ x._id ].ref } : null;\n\t\t\t}\n\t\t\tif ( hasSharedRule && sharedRule ) {\n\t\t\t\tdefaultRule = { value: sharedRule, label: sharedRule.label };\n\t\t\t\tdefaultRuleParameters = sharedRuleParameters;\n\t\t\t} else if ( activeLessons[ x._id ].rule ) {\n\t\t\t\tconst activeRule = allRules[ activeLessons[ x._id ].rule[ 0 ] ];\n\t\t\t\tdefaultRule = { value: activeRule, label: activeRule.label };\n\t\t\t\tdefaultRuleParameters = activeLessons[ x._id ].rule.slice( 1 );\n\t\t\t} else {\n\t\t\t\tdefaultRule = null;\n\t\t\t\tdefaultRuleParameters = [];\n\t\t\t}\n\t\t}\n\t\tconst activeLesson = activeLessons[ x._id ];\n\t\tconst coverage = activeLesson?.coverage || [ 'all' ];\n\t\tconst coverageQualifier = coverage[ 0 ];\n\t\tconst coverageEntities = coverage.slice( 1 ).map( selectOption );\n\t\treturn (\n\t\t\t<div key={`${x._id}-inputs`} >\n\t\t\t\t<Form.Check\n\t\t\t\t\ttype=\"switch\"\n\t\t\t\t\tid=\"custom-switch\"\n\t\t\t\t\tlabel={x.title}\n\t\t\t\t\tkey={x._id}\n\t\t\t\t\tonChange={( event ) => {\n\t\t\t\t\t\tconst newSelected = { ...selectedLessons };\n\t\t\t\t\t\tnewSelected[ x._id ] = event.target.checked;\n\t\t\t\t\t\tsetSelectedLessons( newSelected );\n\t\t\t\t\t}}\n\t\t\t\t\tchecked={lessonIsActive}\n\t\t\t\t/>\n\t\t\t\t{lessonIsActive && <>\n\t\t\t\t\t<Form.Group className=\"mb-2\" as={Row} >\n\t\t\t\t\t\t<Col sm={3} />\n\t\t\t\t\t\t<HelpfulLabel colWidth={3} name={t('common:rule')} description={defaultRule.value.description} />\n\t\t\t\t\t\t<Col sm={6} >\n\t\t\t\t\t\t\t<SelectInput\n\t\t\t\t\t\t\t\toptions={allRulesOptions}\n\t\t\t\t\t\t\t\tisDisabled={hasSharedRule}\n\t\t\t\t\t\t\t\tonChange={( option ) => {\n\t\t\t\t\t\t\t\t\tconst newActive = { ...activeLessons };\n\t\t\t\t\t\t\t\t\tnewActive[ x._id ].rule = [ option.value.name, ...option.value.parameters.map( x => x.default || null ) ];\n\t\t\t\t\t\t\t\t\tsetActiveLessons( newActive );\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tvalue={defaultRule}\n\t\t\t\t\t\t\t\tmenuPortalTarget={document.body}\n\t\t\t\t\t\t\t\tmenuPlacement=\"auto\"\n\t\t\t\t\t\t\t\tstyles={SELECT_STYLES}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</Col>\n\t\t\t\t\t</Form.Group>\n\t\t\t\t\t{defaultRuleParameters.length > 0 &&\n\t\t\t\t\t\tdefaultRuleParameters.map( ( value, idx ) => {\n\t\t\t\t\t\t\tconst parameter = allRules[ defaultRule.value.name ].parameters[ idx ];\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t<Form.Group key={`${x._id}-param-${idx}`} className=\"mb-2\" as={Row} >\n\t\t\t\t\t\t\t\t\t<Col sm={3} ></Col>\n\t\t\t\t\t\t\t\t\t<HelpfulLabel className=\"ps-5\" colWidth={3} name={parameter.name} description={parameter.description} />\n\t\t\t\t\t\t\t\t\t<Col sm={6} >\n\t\t\t\t\t\t\t\t\t\t<ParameterInput\n\t\t\t\t\t\t\t\t\t\t\tkey={`${defaultRule.value.name}-param-${idx}`}\n\t\t\t\t\t\t\t\t\t\t\tparameter={parameter}\n\t\t\t\t\t\t\t\t\t\t\tdisabled={hasSharedRule}\n\t\t\t\t\t\t\t\t\t\t\tvalue={defaultRuleParameters[ idx ]}\n\t\t\t\t\t\t\t\t\t\t\tonChange={( value ) => {\n\t\t\t\t\t\t\t\t\t\t\t\tconst newActive = { ...activeLessons };\n\t\t\t\t\t\t\t\t\t\t\t\tnewActive[ x._id ].rule[ idx + 1 ] = convertRuleParameter( value, parameter );\n\t\t\t\t\t\t\t\t\t\t\t\tsetActiveLessons( newActive );\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\tt={t}\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</Col>\n\t\t\t\t\t\t\t\t</Form.Group>\n\t\t\t\t\t\t\t);\n\t\t\t\t\t})}\n\t\t\t\t\t<Form.Group className=\"mb-2\" as={Row} >\n\t\t\t\t\t\t<Col sm={3} />\n\t\t\t\t\t\t<HelpfulLabel colWidth={3} name={t('common:component-metric')} description={t('component-metric-tooltip')} />\n\t\t\t\t\t\t<Col sm={6} >\n\t\t\t\t\t\t\t<CreatableSelect\n\t\t\t\t\t\t\t\tisClearable\n\t\t\t\t\t\t\t\tisDisabled={hasSharedRef}\n\t\t\t\t\t\t\t\toptions={lessonRefOptions}\n\t\t\t\t\t\t\t\tonChange={( option ) => {\n\t\t\t\t\t\t\t\t\tconst newActive = { ...activeLessons };\n\t\t\t\t\t\t\t\t\tnewActive[ x._id ].ref = option ? option.value : null;\n\t\t\t\t\t\t\t\t\tsetActiveLessons( newActive );\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tvalue={defaultRef}\n\t\t\t\t\t\t\t\tmenuPortalTarget={document.body}\n\t\t\t\t\t\t\t\tmenuPlacement=\"auto\"\n\t\t\t\t\t\t\t\tstyles={SELECT_STYLES}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</Col>\n\t\t\t\t\t</Form.Group>\n\t\t\t\t\t<Form.Group className=\"mb-2\" as={Row} >\n\t\t\t\t\t\t<Col sm={3} />\n\t\t\t\t\t\t<HelpfulLabel colWidth={3} name={t('common:coverage')} description={t('coverage-tooltip')} />\n\t\t\t\t\t\t<Col sm={6} >\n\t\t\t\t\t\t\t<SelectInput\n\t\t\t\t\t\t\t\toptions={COVERAGE_OPTIONS_ARRAY}\n\t\t\t\t\t\t\t\tonChange={( option ) => {\n\t\t\t\t\t\t\t\t\tconst newActive = { ...activeLessons };\n\t\t\t\t\t\t\t\t\tnewActive[ x._id ].coverage[ 0 ] = option.value;\n\t\t\t\t\t\t\t\t\tsetActiveLessons( newActive );\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tvalue={COVERAGE_OPTIONS[ coverageQualifier ]}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t{( coverageQualifier === 'include' || coverageQualifier === 'exclude' ) ?\n\t\t\t\t\t\t\t\t<CreatableSelect\n\t\t\t\t\t\t\t\t\tisMulti\n\t\t\t\t\t\t\t\t\toptions={( componentsByLesson[ x._id ] || [] ).map( ( y ) => {\n\t\t\t\t\t\t\t\t\t\tconst label = y.componentType ? `${y.component} (type ${y.componentType})` : y.component;\n\t\t\t\t\t\t\t\t\t\treturn { value: y.component, label };\n\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\tonChange={( option ) => {\n\t\t\t\t\t\t\t\t\t\tconst newActive = { ...activeLessons };\n\t\t\t\t\t\t\t\t\t\tnewActive[ x._id ].coverage = [ coverageQualifier, ...option.map( ( x ) => x.value ) ];\n\t\t\t\t\t\t\t\t\t\tsetActiveLessons( newActive );\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\tvalue={coverageEntities}\n\t\t\t\t\t\t\t\t\tplaceholder=\"Select component identifiers...\"\n\t\t\t\t\t\t\t\t/> : null\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t</Col>\n\t\t\t\t\t</Form.Group>\n\t\t\t\t\t<Form.Group className=\"mb-2\" as={Row} >\n\t\t\t\t\t\t<Col sm={3} />\n\t\t\t\t\t\t<HelpfulLabel colWidth={3} name={t('tag-weights')} description={t('tag-weights-tooltip')} />\n\t\t\t\t\t\t<Col sm={6} >\n\t\t\t\t\t\t\t<TagWeightsEditor\n\t\t\t\t\t\t\t\tkey={`${x._id}-tag-weights`}\n\t\t\t\t\t\t\t\ttagWeights={activeLessons[ x._id ].tagWeights || void 0}\n\t\t\t\t\t\t\t\tvisibleTags={namespace.componentTags}\n\t\t\t\t\t\t\t\tonUpdate={( tagWeights ) => {\n\t\t\t\t\t\t\t\t\tconst newActive = { ...activeLessons };\n\t\t\t\t\t\t\t\t\tnewActive[ x._id ].tagWeights = tagWeights;\n\t\t\t\t\t\t\t\t\tsetActiveLessons( newActive );\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</Col>\n\t\t\t\t\t</Form.Group>\n\t\t\t\t\t<Form.Group className=\"mb-2\" as={Row} >\n\t\t\t\t\t\t<Col sm={6} />\n\t\t\t\t\t\t<Col sm={3} >\n\t\t\t\t\t\t\t<Form.Check\n\t\t\t\t\t\t\t\taria-label={t('visible-to-student')}\n\t\t\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\t\t\tlabel={<HelpfulLabel name={t('visible-to-student')} description={t('visible-to-student-tooltip')} placement=\"top\" as=\"span\" />}\n\t\t\t\t\t\t\t\tdefaultChecked={activeLessons[ x._id ].visibleToStudent}\n\t\t\t\t\t\t\t\tonChange={( event) => {\n\t\t\t\t\t\t\t\t\tconst newActive = { ...activeLessons };\n\t\t\t\t\t\t\t\t\tnewActive[ x._id ].visibleToStudent = event.target.checked;\n\t\t\t\t\t\t\t\t\tsetActiveLessons( newActive );\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</Col>\n\t\t\t\t\t\t<Col sm={3} >\n\t\t\t\t\t\t\t<Form.Check\n\t\t\t\t\t\t\t\taria-label={t('auto-compute')}\n\t\t\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\t\t\tlabel={<HelpfulLabel name={t('auto-compute')} description={t('auto-compute-tooltip')} placement=\"top\" as=\"span\" />}\n\t\t\t\t\t\t\t\tdefaultChecked={activeLessons[ x._id ].autoCompute}\n\t\t\t\t\t\t\t\tonChange={( event) => {\n\t\t\t\t\t\t\t\t\tconst newActive = { ...activeLessons };\n\t\t\t\t\t\t\t\t\tnewActive[ x._id ].autoCompute = event.target.checked;\n\t\t\t\t\t\t\t\t\tsetActiveLessons( newActive );\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</Col>\n\t\t\t\t\t</Form.Group>\n\t\t\t\t</>}\n\t\t\t</div>\n\t\t);\n\t});\n\tconst hasUnsavedChanges = currentHash !== analyzedHash.current;\n\tconst noLessonsSelected = Object.values( selectedLessons ).every( x => !x );\n\tconst saveBar = chosenName && <Fragment>\n\t\t<Button\n\t\t\tvariant={hasUnsavedChanges ? 'warning' : 'secondary'}\n\t\t\tdisabled={!hasUnsavedChanges}\n\t\t\tonClick={() => {\n\t\t\t\tif ( analysisRef.current ) {\n\t\t\t\t\tincorporateAnalysis( analysisRef.current );\n\t\t\t\t}\n\t\t\t}}\n\t\t\tclassName=\"me-2 ms-auto w-25\"\n\t\t>\n\t\t\t{t('discard-unsaved-changes')}\n\t\t</Button>\n\t\t<Button variant=\"success\" className=\"me-2\"\n\t\t\tdisabled={!hasUnsavedChanges || !sharedRef || !sharedRule || ( isNewMetric && noLessonsSelected )}\n\t\t\tonClick={noLessonsSelected ? () => setShowDeleteModal( true ) : handleSave}\n\t\t>\n\t\t\t{t('common:save')}\n\t\t</Button>\n\t\t<Button variant=\"info\" disabled={hasUnsavedChanges || ( isNewMetric && !hasSaved)} onClick={() => {\n\t\t\tsetShowComputeModal( true );\n\t\t}} >\n\t\t\t{t('common:compute')}\n\t\t</Button>\n\t</Fragment>;\n\treturn (\n\t\t<Fragment>\n\t\t\t<Card className=\"pb-3\" >\n\t\t\t\t<Card.Body>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t{t('lesson-metrics-description')}\n\t\t\t\t\t</p>\n\t\t\t\t\t<div className=\"d-flex w-100 mb-2\" >\n\t\t\t\t\t\t<span><InputGroup className=\"mb-2\" >\n\t\t\t\t\t\t\t<InputGroup.Text>{t('metric-name')}</InputGroup.Text>\n\t\t\t\t\t\t\t<CreatableSelect\n\t\t\t\t\t\t\t\tname=\"metric-name\"\n\t\t\t\t\t\t\t\tplaceholder={t('metric-name-placeholder')}\n\t\t\t\t\t\t\t\tonChange={( value ) => {\n\t\t\t\t\t\t\t\t\tif ( value ) {\n\t\t\t\t\t\t\t\t\t\tsetChosenName( value.value );\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tsetChosenName( null );\n\t\t\t\t\t\t\t\t\t\tsetSharedRule( null );\n\t\t\t\t\t\t\t\t\t\tsetSharedRef( null );\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tonCreateOption={( inputValue ) => {\n\t\t\t\t\t\t\t\t\tconsole.log( 'Creating new lesson metric: ', inputValue );\n\t\t\t\t\t\t\t\t\tsetChosenName( inputValue );\n\t\t\t\t\t\t\t\t\tsetIsNewMetric( true );\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tvalue={chosenName ? { value: chosenName, label: chosenName } : null}\n\t\t\t\t\t\t\t\tisClearable\n\t\t\t\t\t\t\t\tisDisabled={name || ( currentHash && currentHash !== analyzedHash.current )}\n\t\t\t\t\t\t\t\toptions={availableMetrics.current}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</InputGroup ></span>\n\t\t\t\t\t\t{saveBar}\n\t\t\t\t\t</div>\n\t\t\t\t\t{chosenName ? <>\n\t\t\t\t\t\t{sharedInputs}\n\t\t\t\t\t\t<Form.Check\n\t\t\t\t\t\t\ttype=\"switch\"\n\t\t\t\t\t\t\tid=\"all-lessons-switch\"\n\t\t\t\t\t\t\tlabel={<h3>All Lessons</h3>}\n\t\t\t\t\t\t\tonChange={( event ) => {\n\t\t\t\t\t\t\t\tconst newSelectedLessons = {};\n\t\t\t\t\t\t\t\tlessons.forEach( ( lesson ) => {\n\t\t\t\t\t\t\t\t\tnewSelectedLessons[ lesson._id ] = event.target.checked;\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tsetSelectedLessons( newSelectedLessons );\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tchecked={Object.values( selectedLessons ).every( ( x ) => x )}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div style={{ maxHeight: '75vh', minHeight: '50vh', border: 'solid 1px darkgray', overflowY: 'auto', padding: 4, overflowX: 'hidden' }} >\n\t\t\t\t\t\t\t{lessonInputs}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</> : null}\n\t\t\t\t\t<div className=\"d-flex w-100 mt-2\" style={{ height: 46 }} >\n\t\t\t\t\t\t{saveBar}\n\t\t\t\t\t</div>\n\t\t\t\t</Card.Body>\n\t\t\t</Card>\n\t\t\t{showComputeModal && <ComputeModal\n\t\t\t\tmetric={namespace.lessons.reduce( ( acc, lesson ) => {\n\t\t\t\t\tif ( selectedLessons[ lesson._id ] ) {\n\t\t\t\t\t\tacc.push({\n\t\t\t\t\t\t\t...activeLessons[ lesson._id ],\n\t\t\t\t\t\t\t...( hasSharedRef ? { ref: sharedRef } : {} ),\n\t\t\t\t\t\t\t...( hasSharedRule ? { rule: [ sharedRule.name, ...sharedRuleParameters ] } : {} )\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\treturn acc;\n\t\t\t\t}, [] )}\n\t\t\t\tshow={showComputeModal}\n\t\t\t\tonHide={() => setShowComputeModal( false )}\n\t\t\t\tcohorts={namespace.cohorts}\n\t\t\t\ttags={tags}\n\t\t\t\tentity={lessons.filter( ( x ) => selectedLessons[ x._id ] )}\n\t\t\t\tlevel=\"lesson\"\n\t\t\t\tonCompute={() => setShowComputeModal( false )}\n\t\t\t\tcomputeCompletions={computeCompletions}\n\t\t\t/>}\n\t\t\t{showDeleteModal && <ConfirmModal\n\t\t\t\ttitle={t('delete-lesson-metric')}\n\t\t\t\tmessage={<span>\n\t\t\t\t\t{t('delete-lesson-metric-confirm', { name: chosenName })}\n\t\t\t\t</span>}\n\t\t\t\tclose={() => setShowDeleteModal( false )}\n\t\t\t\tshow={showDeleteModal}\n\t\t\t\tonConfirm={() => {\n\t\t\t\t\thandleSave();\n\t\t\t\t\tsetShowDeleteModal( false );\n\t\t\t\t}}\n\t\t\t/>}\n\t\t</Fragment>\n\t);\n}\n\n\n// PROPERTIES //\n\nEditLessonMetrics.propTypes = {\n\tallRules: PropTypes.object.isRequired,\n\tcomponentsByLesson: PropTypes.object,\n\tcomputeCompletions: PropTypes.func.isRequired,\n\tlessonRefs: PropTypes.arrayOf( PropTypes.string ).isRequired,\n\tlessons: PropTypes.array.isRequired,\n\tname: PropTypes.string,\n\tnamespace: PropTypes.object.isRequired,\n\tonSave: PropTypes.func.isRequired,\n\tpreferredLesson: PropTypes.object,\n\tsaveLessonMetrics: PropTypes.func.isRequired,\n\ttags: PropTypes.arrayOf( PropTypes.string )\n};\n\nEditLessonMetrics.defaultProps = {\n\tname: null,\n\tcomponentsByLesson: {},\n\tpreferredLesson: null,\n\ttags: []\n};\n\n\n// EXPORTS //\n\nexport default EditLessonMetrics;\n","/**\r\n* Copyright (C) 2016-present The ISLE Authors\r\n*\r\n* The isle-dashboard program is free software: you can redistribute it and/or modify\r\n* it under the terms of the GNU Affero General Public License as\r\n* published by the Free Software Foundation, either version 3 of the\r\n* License, or (at your option) any later version.\r\n*\r\n* This program is distributed in the hope that it will be useful,\r\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n* GNU Affero General Public License for more details.\r\n*\r\n* You should have received a copy of the GNU Affero General Public License\r\n* along with this program.  If not, see <https://www.gnu.org/licenses/>.\r\n*/\r\n\r\n// MODULES //\r\n\r\nimport React, { Component, Fragment } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport logger from 'debug';\r\nimport Button from 'react-bootstrap/Button';\r\nimport ButtonGroup from 'react-bootstrap/ButtonGroup';\r\nimport Modal from 'react-bootstrap/Modal';\r\nimport FormControl from 'react-bootstrap/FormControl';\r\nimport FormCheck from 'react-bootstrap/FormCheck';\r\nimport FormGroup from 'react-bootstrap/FormGroup';\r\nimport FormLabel from 'react-bootstrap/FormLabel';\r\nimport Form from 'react-bootstrap/Form';\r\nimport OverlayTrigger from 'react-bootstrap/OverlayTrigger';\r\nimport Tooltip from 'react-bootstrap/Tooltip';\r\nimport Col from 'react-bootstrap/Col';\r\nimport Row from 'react-bootstrap/Row';\r\nimport { DateRangePicker } from 'react-dates';\r\nimport moment from 'moment';\r\nimport isEmail from '@stdlib/assert/is-email-address';\r\nimport isArray from '@stdlib/assert/is-array';\r\nimport ConfirmModal from 'components/confirm-modal';\r\nimport TextSelect from 'components/text-select';\r\nimport 'react-dates/lib/css/_datepicker.css';\r\nimport './cohort_modal.css';\r\n\r\n\r\n// VARIABLES //\r\n\r\nconst debug = logger( 'isle-dashboard:edit-cohort' );\r\n\r\n\r\n// FUNCTIONS //\r\n\r\nfunction validateInputs({ emails, title }) {\r\n\tlet invalid = false;\r\n\temails.forEach( owner => {\r\n\t\tif ( !isEmail( owner ) ) {\r\n\t\t\tinvalid = true;\r\n\t\t}\r\n\t});\r\n\tif ( invalid ) {\r\n\t\treturn false;\r\n\t}\r\n\treturn title.length >= 4;\r\n}\r\n\r\n\r\n// MAIN //\r\n\r\nclass EditCohortModal extends Component {\r\n\tconstructor( props ) {\r\n\t\tsuper( props );\r\n\r\n\t\tthis.state = {\r\n\t\t\tdisabled: false,\r\n\t\t\tstartDate: moment( props.startDate ),\r\n\t\t\tendDate: moment( props.endDate ),\r\n\t\t\ttitle: props.title,\r\n\t\t\tmembers: props.members.map( user => user.email ),\r\n\t\t\tshowDeleteModal: false,\r\n\t\t\tprivate: props.private,\r\n\t\t\temailFilter: props.emailFilter\r\n\t\t};\r\n\t}\r\n\r\n\thandleInputChange = ( event ) => {\r\n\t\tconst target = event.target;\r\n\t\tconst name = target.name;\r\n\t\tlet value = target.value;\r\n\t\tthis.setState({\r\n\t\t\t[ name ]: value\r\n\t\t}, () => {\r\n\t\t\tthis.setState({\r\n\t\t\t\tdisabled: !validateInputs({\r\n\t\t\t\t\temails: this.state.members,\r\n\t\t\t\t\ttitle: this.state.title\r\n\t\t\t\t})\r\n\t\t\t});\r\n\t\t});\r\n\t};\r\n\r\n\thandleUpdate = () => {\r\n\t\tconst updatedCohort = {\r\n\t\t\t_id: this.props._id,\r\n\t\t\temailFilter: this.state.emailFilter,\r\n\t\t\tstartDate: this.state.startDate.startOf( 'day' ).toDate(),\r\n\t\t\tendDate: this.state.endDate.endOf( 'day' ).toDate(),\r\n\t\t\tmembers: this.state.members.join( ',' ),\r\n\t\t\ttitle: this.state.title,\r\n\t\t\tprivate: this.state.private\r\n\t\t};\r\n\t\tthis.props.onUpdate( updatedCohort );\r\n\t\tthis.props.onHide();\r\n\t};\r\n\r\n\thandleDelete = () => {\r\n\t\tthis.props.onDelete( this.props._id );\r\n\t\tthis.closeDeleteModal();\r\n\t\tthis.props.onHide();\r\n\t};\r\n\r\n\tcloseDeleteModal = () => {\r\n\t\tthis.setState({\r\n\t\t\tshowDeleteModal: false\r\n\t\t});\r\n\t};\r\n\r\n\thandleStudentChange = ( newValue ) => {\r\n\t\tdebug( 'Handle change of cohort members...' );\r\n\t\tconst members = isArray( newValue ) ? newValue.map( x => x.value ) : [];\r\n\t\tthis.setState({\r\n\t\t\tmembers: members,\r\n\t\t\tdisabled: !validateInputs({\r\n\t\t\t\temails: members,\r\n\t\t\t\ttitle: this.state.title\r\n\t\t\t})\r\n\t\t});\r\n\t};\r\n\r\n\trender() {\r\n\t\tconst { t } = this.props;\r\n\t\tconst content = (\r\n\t\t\t<Form style={{ padding: '10px' }}>\r\n\t\t\t\t<Row>\r\n\t\t\t\t\t<Col md={6}>\r\n\t\t\t\t\t\t<OverlayTrigger placement=\"right\" overlay={<Tooltip id=\"titleTooltip\">{t('cohort-title-tooltip')}</Tooltip>}>\r\n\t\t\t\t\t\t\t<FormGroup>\r\n\t\t\t\t\t\t\t\t<FormLabel>{t('common:title')}</FormLabel>\r\n\t\t\t\t\t\t\t\t<FormControl\r\n\t\t\t\t\t\t\t\t\tname=\"title\"\r\n\t\t\t\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\t\t\t\tvalue={this.state.title}\r\n\t\t\t\t\t\t\t\t\tonChange={this.handleInputChange}\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t</FormGroup>\r\n\t\t\t\t\t\t</OverlayTrigger>\r\n\t\t\t\t\t</Col>\r\n\t\t\t\t\t<Col md={6}>\r\n\t\t\t\t\t\t<FormGroup>\r\n\t\t\t\t\t\t\t<FormLabel>{t('cohort-period')}</FormLabel>\r\n\t\t\t\t\t\t\t<br />\r\n\t\t\t\t\t\t\t<DateRangePicker\r\n\t\t\t\t\t\t\t\tstartDateId=\"panel_start_date_input\"\r\n\t\t\t\t\t\t\t\tendDateId=\"panel_end_date_input\"\r\n\t\t\t\t\t\t\t\tstartDate={this.state.startDate}\r\n\t\t\t\t\t\t\t\tendDate={this.state.endDate}\r\n\t\t\t\t\t\t\t\tonDatesChange={({ startDate, endDate }) =>\r\n\t\t\t\t\t\t\t\t\tthis.setState({ startDate, endDate })\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tfocusedInput={this.state.focusedInput}\r\n\t\t\t\t\t\t\t\tonFocusChange={focusedInput => this.setState({ focusedInput })}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t</FormGroup>\r\n\t\t\t\t\t</Col>\r\n\t\t\t\t</Row>\r\n\t\t\t\t<hr />\r\n\t\t\t\t<Row>\r\n\t\t\t\t\t<OverlayTrigger placement=\"right\" overlay={<Tooltip id=\"enrolledTooltip\">{t('enrolled-tooltip')}</Tooltip>}>\r\n\t\t\t\t\t\t<FormGroup className=\"cohort-modal-enrolled-group\" >\r\n\t\t\t\t\t\t\t<FormLabel>{t('enrolled-students')}</FormLabel>\r\n\t\t\t\t\t\t\t<TextSelect\r\n\t\t\t\t\t\t\t\tplaceholder={t('enter-emails')}\r\n\t\t\t\t\t\t\t\tdefaultValue={this.state.members}\r\n\t\t\t\t\t\t\t\tonChange={this.handleStudentChange}\r\n\t\t\t\t\t\t\t\tstyles={{\r\n\t\t\t\t\t\t\t\t\tcontrol: () => ({\r\n\t\t\t\t\t\t\t\t\t\twidth: '100%'\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t</FormGroup>\r\n\t\t\t\t\t</OverlayTrigger>\r\n\t\t\t\t</Row>\r\n\t\t\t\t<hr />\r\n\t\t\t\t<Row>\r\n\t\t\t\t<OverlayTrigger placement=\"left\" overlay={<Tooltip id=\"preventTooltip\">{t('prevent-tooltip')}</Tooltip>}>\r\n\t\t\t\t\t<FormCheck checked={this.state.private} onChange={(event) => {\r\n\t\t\t\t\t\tthis.setState({\r\n\t\t\t\t\t\t\tprivate: !this.state.private\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}} type=\"checkbox\" label={t('prevent-label')} />\r\n\t\t\t\t</OverlayTrigger>\r\n\t\t\t\t</Row>\r\n\t\t\t\t<hr />\r\n\t\t\t<Row>\r\n\t\t\t\t<OverlayTrigger placement=\"right\" overlay={<Tooltip id=\"filterTooltip\">{t('filter-tooltip')}</Tooltip>}>\r\n\t\t\t\t\t\t<FormGroup>\r\n\t\t\t\t\t\t\t<FormLabel>{t('email-filter')}</FormLabel>\r\n\t\t\t\t\t\t\t<FormControl style={{ width: '25vw' }}\r\n\t\t\t\t\t\t\t\tname=\"emailFilter\"\r\n\t\t\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\t\t\tvalue={this.state.emailFilter}\r\n\t\t\t\t\t\t\t\tplaceholder={t('filter-placeholder')}\r\n\t\t\t\t\t\t\t\tonChange={this.handleInputChange}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t</FormGroup>\r\n\t\t\t\t\t</OverlayTrigger>\r\n\t\t\t</Row>\r\n\t\t\t</Form>\r\n\t\t);\r\n\r\n\t\treturn (\r\n\t\t\t<Fragment>\r\n\t\t\t\t<Modal size=\"lg\" show={this.props.show} onHide={this.props.onHide} >\r\n\t\t\t\t\t<Modal.Header closeButton>\r\n\t\t\t\t\t\t<Modal.Title as=\"h3\">\r\n\t\t\t\t\t\t\t{t('edit-cohort', { title: this.props.title })}\r\n\t\t\t\t\t\t</Modal.Title>\r\n\t\t\t\t\t</Modal.Header>\r\n\t\t\t\t\t<Modal.Body>\r\n\t\t\t\t\t\t{content}\r\n\t\t\t\t\t</Modal.Body>\r\n\t\t\t\t\t<Modal.Footer>\r\n\t\t\t\t\t\t<ButtonGroup>\r\n\t\t\t\t\t\t\t<Button onClick={() => {\r\n\t\t\t\t\t\t\t\tthis.setState({\r\n\t\t\t\t\t\t\t\t\tshowDeleteModal: true\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}} variant=\"danger\">{t('common:delete')}</Button>\r\n\t\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\t\tonClick={this.props.onHide}\r\n\t\t\t\t\t\t\t>{t('common:cancel')}</Button>\r\n\t\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\t\tvariant=\"success\"\r\n\t\t\t\t\t\t\t\tdisabled={this.state.disabled}\r\n\t\t\t\t\t\t\t\tonClick={this.handleUpdate}\r\n\t\t\t\t\t\t\t>{t('common:save')}</Button>\r\n\t\t\t\t\t\t</ButtonGroup>\r\n\t\t\t\t\t</Modal.Footer>\r\n\t\t\t\t</Modal>\r\n\t\t\t\t<ConfirmModal\r\n\t\t\t\t\tshow={this.state.showDeleteModal}\r\n\t\t\t\t\tclose={this.closeDeleteModal}\r\n\t\t\t\t\tmessage={t('delete-cohort')}\r\n\t\t\t\t\ttitle={`${t('delete')}?`}\r\n\t\t\t\t\tonConfirm={this.handleDelete}\r\n\t\t\t\t/>\r\n\t\t\t</Fragment>\r\n\t\t);\r\n\t}\r\n}\r\n\r\n\r\n// PROPERTIES //\r\n\r\nEditCohortModal.propTypes = {\r\n\t_id: PropTypes.string.isRequired,\r\n\temailFilter: PropTypes.string.isRequired,\r\n\tendDate: PropTypes.string,\r\n\tmembers: PropTypes.array.isRequired,\r\n\tonDelete: PropTypes.func,\r\n\tonHide: PropTypes.func.isRequired,\r\n\tonUpdate: PropTypes.func,\r\n\tprivate: PropTypes.bool.isRequired,\r\n\tshow: PropTypes.bool.isRequired,\r\n\tstartDate: PropTypes.string.isRequired,\r\n\tt: PropTypes.func.isRequired,\r\n\ttitle: PropTypes.string.isRequired\r\n};\r\n\r\nEditCohortModal.defaultProps = {\r\n\tendDate: null,\r\n\tonUpdate() {},\r\n\tonDelete() {}\r\n};\r\n\r\n\r\n// EXPORTS //\r\n\r\nexport default EditCohortModal;\r\n","/**\r\n* Copyright (C) 2016-present The ISLE Authors\r\n*\r\n* The isle-dashboard program is free software: you can redistribute it and/or modify\r\n* it under the terms of the GNU Affero General Public License as\r\n* published by the Free Software Foundation, either version 3 of the\r\n* License, or (at your option) any later version.\r\n*\r\n* This program is distributed in the hope that it will be useful,\r\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n* GNU Affero General Public License for more details.\r\n*\r\n* You should have received a copy of the GNU Affero General Public License\r\n* along with this program.  If not, see <https://www.gnu.org/licenses/>.\r\n*/\r\n\r\n// MODULES //\r\n\r\nimport React, { useState } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport Button from 'react-bootstrap/Button';\r\nimport Col from 'react-bootstrap/Col';\r\nimport Row from 'react-bootstrap/Row';\r\nimport FormLabel from 'react-bootstrap/FormLabel';\r\nimport Form from 'react-bootstrap/Form';\r\nimport FormCheck from 'react-bootstrap/FormCheck';\r\nimport FormControl from 'react-bootstrap/FormControl';\r\nimport FormGroup from 'react-bootstrap/FormGroup';\r\nimport Modal from 'react-bootstrap/Modal';\r\nimport OverlayTrigger from 'react-bootstrap/OverlayTrigger';\r\nimport Tooltip from 'react-bootstrap/Tooltip';\r\nimport { DateRangePicker } from 'react-dates';\r\nimport moment from 'moment';\r\nimport isEmail from '@stdlib/assert/is-email-address';\r\nimport isArray from '@stdlib/assert/is-array';\r\nimport TextSelect from 'components/text-select';\r\nimport './cohort_modal.css';\r\n\r\n\r\n// FUNCTIONS //\r\n\r\n/**\r\n * Validate a list of emails and namespace title.\r\n *\r\n * @private\r\n * @param {Array<string>} emails - list of emails\r\n * @param {string} title - namespace title\r\n * @returns {boolean} boolean indicating whether the list of emails and namespace title are valid\r\n */\r\nfunction validateInputs( emails, title ) {\r\n\tlet invalid = false;\r\n\temails.forEach( owner => {\r\n\t\tif ( !isEmail( owner ) ) {\r\n\t\t\tinvalid = true;\r\n\t\t}\r\n\t});\r\n\tif ( invalid ) {\r\n\t\treturn false;\r\n\t}\r\n\treturn title.length >= 4;\r\n}\r\n\r\n\r\n// MAIN //\r\n\r\n/**\r\n * A modal for creating a new cohort.\r\n *\r\n * @param {Object} props - component properties\r\n * @param {boolean} props.show - boolean indicating whether the modal is visible\r\n * @param {Function} props.close - callback to invoke upon hiding the modal\r\n * @param {Function} props.onCreate - callback to invoke upon creating a new cohort\r\n * @param {Function} props.t - i18n translation function\r\n * @returns {ReactElement} modal dialog\r\n */\r\nconst CreateCohortModal = ({ close, onCreate, show, t }) => {\r\n\tconst [ title, setTitle ] = useState( '' );\r\n\tconst [ emailFilter, setEmailFilter ] = useState( '' );\r\n\tconst [ dates, setDates ] = useState({\r\n\t\tstart: moment()\r\n\t\t\t.startOf( 'day' ),\r\n\t\tend: moment()\r\n\t\t\t.add( 3, 'months' )\r\n\t\t\t.endOf( 'day' )\r\n\t});\r\n\tconst [ isPrivate, setIsPrivate ] = useState( false );\r\n\tconst [ students, setStudents ] = useState( [] );\r\n\tconst [ focusedInput, setFocusedInput ] = useState( null );\r\n\r\n\tconst handleClose = () => {\r\n\t\tclose();\r\n\t};\r\n\tconst handleCreate = () => {\r\n\t\tconst cohort = {\r\n\t\t\temailFilter,\r\n\t\t\ttitle,\r\n\t\t\tstartDate: dates.start.startOf( 'day' ).toDate(),\r\n\t\t\tendDate: dates.end.endOf( 'day' ).toDate(),\r\n\t\t\tprivate: isPrivate,\r\n\t\t\tstudents: students.join( ',' )\r\n\t\t};\r\n\t\tonCreate( cohort );\r\n\t};\r\n\tconst disabled = !validateInputs( students, title );\r\n\tconst body = <Form style={{ paddingLeft: 20, paddingRight: 20 }}>\r\n\t\t<Row>\r\n\t\t\t<Col md={6}>\r\n\t\t\t\t<OverlayTrigger placement=\"right\" overlay={<Tooltip id=\"titleTooltip\">{t('cohort-title-tooltip')}</Tooltip>}>\r\n\t\t\t\t\t<FormGroup>\r\n\t\t\t\t\t\t<FormLabel>{t('common:title')}</FormLabel>\r\n\t\t\t\t\t\t<FormControl\r\n\t\t\t\t\t\t\tname=\"title\"\r\n\t\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\t\tplaceholder={t('cohort-title-placeholder')}\r\n\t\t\t\t\t\t\tonChange={( event ) => setTitle( event.target.value )}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</FormGroup>\r\n\t\t\t\t</OverlayTrigger>\r\n\t\t\t</Col>\r\n\t\t\t<Col md={6}>\r\n\t\t\t\t<FormGroup>\r\n\t\t\t\t\t<FormLabel>{t('cohort-period')}</FormLabel>\r\n\t\t\t\t\t<DateRangePicker\r\n\t\t\t\t\t\tstartDateId=\"start_date_input\"\r\n\t\t\t\t\t\tendDateId=\"end_date_input\"\r\n\t\t\t\t\t\tstartDate={dates.start}\r\n\t\t\t\t\t\tendDate={dates.end}\r\n\t\t\t\t\t\tonDatesChange={({ startDate, endDate }) => {\r\n\t\t\t\t\t\t\tsetDates({ start: startDate, end: endDate });\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t\tfocusedInput={focusedInput}\r\n\t\t\t\t\t\tonFocusChange={setFocusedInput}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</FormGroup>\r\n\t\t\t</Col>\r\n\t\t</Row>\r\n\t\t<hr />\r\n\t\t<Row>\r\n\t\t\t<OverlayTrigger placement=\"right\" overlay={<Tooltip id=\"enrolledTooltip\">{t('enrolled-tooltip')}</Tooltip>}>\r\n\t\t\t\t<FormGroup className=\"cohort-modal-enrolled-group\" >\r\n\t\t\t\t\t<FormLabel>{t('enrolled-students')}</FormLabel>\r\n\t\t\t\t\t<TextSelect\r\n\t\t\t\t\t\tplaceholder={t('enter-emails')}\r\n\t\t\t\t\t\tonChange={( newValue ) => {\r\n\t\t\t\t\t\t\tconst newStudents = isArray( newValue ) ? newValue.map( x => x.value ) : [];\r\n\t\t\t\t\t\t\tsetStudents( newStudents );\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t\tdefaultValue={students}\r\n\t\t\t\t\t\tisClearable\r\n\t\t\t\t\t\tstyles={{\r\n\t\t\t\t\t\t\tcontrol: () => ({\r\n\t\t\t\t\t\t\t\twidth: '100%'\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</FormGroup>\r\n\t\t\t</OverlayTrigger>\r\n\t\t</Row>\r\n\t\t<hr />\r\n\t\t<Row>\r\n\t\t\t<OverlayTrigger placement=\"left\" overlay={<Tooltip id=\"preventTooltip\">{t('prevent-tooltip')}</Tooltip>}>\r\n\t\t\t\t<FormCheck checked={isPrivate} onChange={() => {\r\n\t\t\t\t\tsetIsPrivate( !isPrivate );\r\n\t\t\t\t}} type=\"checkbox\" label={t('prevent-label')} />\r\n\t\t\t</OverlayTrigger>\r\n\t\t</Row>\r\n\t\t<hr />\r\n\t\t<Row>\r\n\t\t\t<OverlayTrigger placement=\"right\" overlay={<Tooltip id=\"filterTooltip\">{t('filter-tooltip')}</Tooltip>}>\r\n\t\t\t\t<FormGroup>\r\n\t\t\t\t\t<FormLabel>{t('email-filter')}</FormLabel>\r\n\t\t\t\t\t<FormControl\r\n\t\t\t\t\t\tstyle={{ width: '25vw' }}\r\n\t\t\t\t\t\tname=\"emailFilter\"\r\n\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\tplaceholder={t('filter-placeholder')}\r\n\t\t\t\t\t\tonChange={( event ) => setEmailFilter( event.target.value )}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</FormGroup>\r\n\t\t\t</OverlayTrigger>\r\n\t\t</Row>\r\n\t</Form>;\r\n\treturn (\r\n\t\t<Modal size=\"lg\" show={show} onHide={handleClose}>\r\n\t\t\t<Modal.Header closeButton>\r\n\t\t\t\t<Modal.Title as=\"h3\">{t('create-new-cohort')}</Modal.Title>\r\n\t\t\t</Modal.Header>\r\n\t\t\t<Modal.Body>\r\n\t\t\t\t{body}\r\n\t\t\t</Modal.Body>\r\n\t\t\t<Modal.Footer>\r\n\t\t\t\t<Button onClick={handleClose}>\r\n\t\t\t\t\t{t('common:cancel')}\r\n\t\t\t\t</Button>\r\n\t\t\t\t<Button variant=\"success\" disabled={disabled} onClick={handleCreate} >\r\n\t\t\t\t\t{t('common:create')}\r\n\t\t\t\t</Button>\r\n\t\t\t</Modal.Footer>\r\n\t\t</Modal>\r\n\t);\r\n};\r\n\r\n\r\n// PROPERTIES //\r\n\r\nCreateCohortModal.propTypes = {\r\n\tclose: PropTypes.func,\r\n\tonCreate: PropTypes.func,\r\n\tshow: PropTypes.bool,\r\n\tt: PropTypes.func.isRequired\r\n};\r\n\r\nCreateCohortModal.defaultProps = {\r\n\tclose() {},\r\n\tonCreate() {},\r\n\tshow: false\r\n};\r\n\r\n\r\n// EXPORTS //\r\n\r\nexport default CreateCohortModal;\r\n","/**\r\n* Copyright (C) 2016-present The ISLE Authors\r\n*\r\n* The isle-dashboard program is free software: you can redistribute it and/or modify\r\n* it under the terms of the GNU Affero General Public License as\r\n* published by the Free Software Foundation, either version 3 of the\r\n* License, or (at your option) any later version.\r\n*\r\n* This program is distributed in the hope that it will be useful,\r\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n* GNU Affero General Public License for more details.\r\n*\r\n* You should have received a copy of the GNU Affero General Public License\r\n* along with this program.  If not, see <https://www.gnu.org/licenses/>.\r\n*/\r\n\r\n// MODULES //\r\n\r\nimport React, { useState } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport SelectInput from 'react-select';\r\nimport Button from 'react-bootstrap/Button';\r\nimport Modal from 'react-bootstrap/Modal';\r\nimport Form from 'react-bootstrap/Form';\r\n\r\n\r\n// MAIN //\r\n\r\n/**\r\n* A modal dialog for importing an existing course into a namespace.\r\n*\r\n* @param {Object} props - component props\r\n* @param {boolean} props.show - boolean indicating whether the modal is visible\r\n* @param {Function} props.close - callback to hide the modal\r\n* @param {Function} props.copyNamespaceLessons - callback to copy a course's lessons into a namespace\r\n* @param {Object} props.targetNamespace - target namespace\r\n* @param {Object} props.namespaces - available namespaces\r\n* @param {Function} props.t - translation function\r\n* @returns {ReactElement} modal dialog\r\n*/\r\nconst ImportCourseModal = ({ namespaces, show, close, targetNamespace, copyNamespaceLessons, t }) => {\r\n\tconst [ selectedCourse, setSelectedCourse ] = useState( null );\r\n\r\n\tconst handleSelection = ( obj ) => {\r\n\t\tsetSelectedCourse( obj.value );\r\n\t};\r\n\tconst handleImport = async () => {\r\n\t\tconst res = await copyNamespaceLessons({\r\n\t\t\tsource: selectedCourse.title,\r\n\t\t\ttarget: targetNamespace.title\r\n\t\t});\r\n\t\tif ( res instanceof Error === false ) {\r\n\t\t\tclose();\r\n\t\t}\r\n\t};\r\n\tconst options = namespaces.map( x => {\r\n\t\treturn {\r\n\t\t\tlabel: x.title,\r\n\t\t\tvalue: x\r\n\t\t};\r\n\t});\r\n\treturn (\r\n\t\t<Modal size=\"lg\" show={show} onHide={close}>\r\n\t\t\t<Modal.Header closeButton>\r\n\t\t\t\t<Modal.Title as=\"h3\">{t('import-course')}</Modal.Title>\r\n\t\t\t</Modal.Header>\r\n\t\t\t<Modal.Body>\r\n\t\t\t\t<p>\r\n\t\t\t\t\t{t('import-course-description')}\r\n\t\t\t\t</p>\r\n\t\t\t\t<Form.Group controlId=\"form-course-select\" >\r\n\t\t\t\t\t<Form.Label>{t('select-namespace')}</Form.Label>\r\n\t\t\t\t\t<SelectInput\r\n\t\t\t\t\t\toptions={options}\r\n\t\t\t\t\t\tonChange={handleSelection}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</Form.Group>\r\n\t\t\t</Modal.Body>\r\n\t\t\t<Modal.Footer>\r\n\t\t\t\t<Button onClick={close}>{t('common:cancel')}</Button>\r\n\t\t\t\t<Button variant=\"success\" disabled={!selectedCourse} onClick={handleImport}>{t('common:import')}</Button>\r\n\t\t\t</Modal.Footer>\r\n\t\t</Modal>\r\n\t);\r\n};\r\n\r\n\r\n// PROPERTIES //\r\n\r\nImportCourseModal.propTypes = {\r\n\tclose: PropTypes.func.isRequired,\r\n\tcopyNamespaceLessons: PropTypes.func.isRequired,\r\n\tnamespaces: PropTypes.array,\r\n\tshow: PropTypes.bool,\r\n\tt: PropTypes.func.isRequired,\r\n\ttargetNamespace: PropTypes.object.isRequired\r\n};\r\n\r\nImportCourseModal.defaultProps = {\r\n\tnamespaces: [],\r\n\tshow: false\r\n};\r\n\r\n\r\n// EXPORTS //\r\n\r\nexport default ImportCourseModal;\r\n","/**\n* Copyright (C) 2016-present The ISLE Authors\n*\n* The isle-dashboard program is free software: you can redistribute it and/or modify\n* it under the terms of the GNU Affero General Public License as\n* published by the Free Software Foundation, either version 3 of the\n* License, or (at your option) any later version.\n*\n* This program is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n* GNU Affero General Public License for more details.\n*\n* You should have received a copy of the GNU Affero General Public License\n* along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\n// MODULES //\n\nimport React, { Component, Fragment } from 'react';\nimport PropTypes from 'prop-types';\nimport axios from 'axios';\nimport { withTranslation } from 'react-i18next';\nimport Tabs from 'react-bootstrap/Tabs';\nimport Tab from 'react-bootstrap/Tab';\nimport Alert from 'react-bootstrap/Alert';\nimport Badge from 'react-bootstrap/Badge';\nimport Button from 'react-bootstrap/Button';\nimport ButtonGroup from 'react-bootstrap/ButtonGroup';\nimport Card from 'react-bootstrap/Card';\nimport Container from 'react-bootstrap/Container';\nimport Col from 'react-bootstrap/Col';\nimport Row from 'react-bootstrap/Row';\nimport FormControl from 'react-bootstrap/FormControl';\nimport FormLabel from 'react-bootstrap/FormLabel';\nimport FormGroup from 'react-bootstrap/FormGroup';\nimport Form from 'react-bootstrap/Form';\nimport ListGroup from 'react-bootstrap/ListGroup';\nimport ListGroupItem from 'react-bootstrap/ListGroupItem';\nimport OverlayTrigger from 'react-bootstrap/OverlayTrigger';\nimport Tooltip from 'react-bootstrap/Tooltip';\nimport isArray from '@stdlib/assert/is-array';\nimport trim from '@stdlib/string/trim';\nimport TextSelect from 'components/text-select';\nimport MsgModal from 'components/message-modal';\nimport ConfirmModal from 'components/confirm-modal';\nimport { validateOwners, validateDescription, validateTitle } from 'components/create-namespace';\nimport CompletionsPage from 'containers/visible-completions';\nimport EditLessonMetrics from 'components/completions/edit_lesson_metrics.js';\nimport checkURLPath from 'utils/check_url_path.js';\nimport EditCohortModal from './edit_cohort_modal.js';\nimport CreateCohortModal from './create_cohort_modal.js';\nimport ImportCourseModal from './import_course_modal.js';\nimport SERVER from 'constants/server';\nimport 'react-dates/lib/css/_datepicker.css';\nimport './edit_namespace.css';\n\n\n// MAIN //\n\nclass EditNamespace extends Component {\n\tconstructor( props ) {\n\t\tsuper( props );\n\t\tlet { title, description, owners, enableTicketing, tag } = this.props.namespace;\n\t\tif ( isArray( owners ) ) {\n\t\t\towners = owners.map( ( owner ) => {\n\t\t\t\treturn owner.email;\n\t\t\t});\n\t\t}\n\t\tthis.state = {\n\t\t\ttitle,\n\t\t\tdescription,\n\t\t\towners,\n\t\t\tenableTicketing,\n\t\t\tshowDeleteModal: false,\n\t\t\tshowImportModal: false,\n\t\t\tshowCreateCohortModal: false,\n\t\t\tshowEditCohortModal: false,\n\t\t\tselectedCohort: null,\n\t\t\ttag,\n\t\t\tlessonRefs: []\n\t\t};\n\t}\n\n\tcomponentDidMount() {\n\t\taxios.post( `${SERVER}/completion_refs`, {\n\t\t\ttarget: 'lesson',\n\t\t\tentities: this.props.namespace.lessons.map( x => x._id )\n\t\t})\n\t\t\t.then( response => {\n\t\t\t\tthis.setState({\n\t\t\t\t\tlessonRefs: response.data\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch( err => {\n\t\t\t\tconsole.log( 'Error fetching completion refs:', err );\n\t\t\t});\n\t}\n\n\thandleInputChange = ( event ) => {\n\t\tconst target = event.target;\n\t\tconst name = target.name;\n\t\tlet value = target.value;\n\t\tthis.setState({\n\t\t\t[ name ]: value\n\t\t});\n\t};\n\n\thandleUpdate = () => {\n\t\tthis.props.updateCurrentNamespace({\n\t\t\t_id: this.props.namespace._id,\n\t\t\tdescription: this.state.description,\n\t\t\ttitle: this.state.title,\n\t\t\ttag: this.state.tag,\n\t\t\tenableTicketing: this.state.enableTicketing,\n\t\t\towners: this.state.owners\n\t\t});\n\t};\n\n\thandleDelete = () => {\n\t\tthis.props.deleteCurrentNamespace( this.props.namespace._id );\n\t};\n\n\tclose = () => {\n\t\tthis.setState({\n\t\t\tshowModal: false\n\t\t});\n\t};\n\n\tcloseDeleteModal = () => {\n\t\tthis.setState({\n\t\t\tshowDeleteModal: false\n\t\t});\n\t};\n\n\tcloseCreateCohortModal = () => {\n\t\tthis.setState({\n\t\t\tshowCreateCohortModal: false\n\t\t});\n\t};\n\n\tcloseImportModal = () => {\n\t\tthis.setState({\n\t\t\tshowImportModal: false\n\t\t});\n\t};\n\n\tcreateCohort = ( cohort ) => {\n\t\tcohort.namespaceID = this.props.namespace._id;\n\t\tthis.props.createCohort( cohort, this.props.namespace._id );\n\t\tthis.closeCreateCohortModal();\n\t};\n\n\tdeleteCohort = ( cohortID ) => {\n\t\tthis.props.deleteCohort( cohortID, this.props.namespace._id );\n\t};\n\n\tupdateCohort = ( cohort ) => {\n\t\tthis.props.updateCohort( cohort, this.props.namespace._id );\n\t};\n\n\thandleOwnerChange = ( newValue ) => {\n\t\tif ( !newValue ) {\n\t\t\treturn this.setState({\n\t\t\t\towners: []\n\t\t\t});\n\t\t}\n\t\tconst owners = newValue.map( x => trim( x.value ) );\n\t\tthis.setState({\n\t\t\towners: owners\n\t\t});\n\t};\n\n\tcloseEditCohortModal = () => {\n\t\tthis.setState({\n\t\t\tselectedCohort: null,\n\t\t\tshowEditCohortModal: false\n\t\t});\n\t};\n\n\tcohortModalFactory = ( idx ) => {\n\t\treturn () => {\n\t\t\tthis.setState({\n\t\t\t\tselectedCohort: this.props.cohorts[ idx ],\n\t\t\t\tshowEditCohortModal: true\n\t\t\t});\n\t\t};\n\t};\n\n\trenderModals() {\n\t\tconst { t } = this.props;\n\t\treturn (\n\t\t\t<Fragment>\n\t\t\t\t<MsgModal\n\t\t\t\t\tshow={this.state.showModal}\n\t\t\t\t\tclose={this.close}\n\t\t\t\t\tmessage={this.state.message}\n\t\t\t\t\tsuccessful={this.state.successful}\n\t\t\t\t\ttitle={t('update-course')}\n\t\t\t\t/>\n\t\t\t\t<ConfirmModal\n\t\t\t\t\tshow={this.state.showDeleteModal}\n\t\t\t\t\tclose={this.closeDeleteModal}\n\t\t\t\t\tmessage={t('delete-course')}\n\t\t\t\t\ttitle={`${t('delete')}?`}\n\t\t\t\t\tonConfirm={this.handleDelete}\n\t\t\t\t/>\n\t\t\t\t{ this.state.showCreateCohortModal ? <CreateCohortModal\n\t\t\t\t\tshow={this.state.showCreateCohortModal}\n\t\t\t\t\tclose={this.closeCreateCohortModal}\n\t\t\t\t\tonCreate={this.createCohort}\n\t\t\t\t\tt={this.props.t}\n\t\t\t\t/> : null }\n\t\t\t\t{ this.state.showImportModal ? <ImportCourseModal\n\t\t\t\t\tshow={this.state.showImportModal}\n\t\t\t\t\tclose={this.closeImportModal}\n\t\t\t\t\tnamespaces={this.props.user.ownedNamespaces}\n\t\t\t\t\ttargetNamespace={this.props.namespace}\n\t\t\t\t\tcopyNamespaceLessons={this.props.copyNamespaceLessons}\n\t\t\t\t\tt={this.props.t}\n\t\t\t\t/> : null }\n\t\t\t\t{ this.state.showEditCohortModal ? <EditCohortModal\n\t\t\t\t\tshow={this.state.showEditCohortModal}\n\t\t\t\t\t{...this.state.selectedCohort}\n\t\t\t\t\tonDelete={this.deleteCohort}\n\t\t\t\t\tonHide={this.closeEditCohortModal}\n\t\t\t\t\tonUpdate={this.updateCohort}\n\t\t\t\t\tt={this.props.t}\n\t\t\t\t/> : null }\n\t\t\t</Fragment>\n\t\t);\n\t}\n\n\trenderCohortList() {\n\t\tconst { t } = this.props;\n\t\treturn ( <ListGroup>\n\t\t\t{this.props.cohorts.map( ( cohort, idx ) => {\n\t\t\t\treturn (\n\t\t\t\t\t<ListGroupItem\n\t\t\t\t\t\tvariant=\"light\"\n\t\t\t\t\t\teventKey={idx}\n\t\t\t\t\t\tkey={idx}\n\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\tbackgroundColor: 'white'\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<label>{cohort.title}</label>\n\t\t\t\t\t\t<span style={{ marginLeft: 5, color: 'black' }} >\n\t\t\t\t\t\t\t({t('no-students')}:\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<Badge bg=\"primary\">{cohort.members.length}</Badge>\n\t\t\t\t\t\t<span style={{ color: 'black' }} >)</span>\n\t\t\t\t\t\t<Button size=\"sm\" onClick={this.cohortModalFactory( idx )} style={{ float: 'right' }}>{t('common:edit')}</Button>\n\t\t\t\t\t</ListGroupItem>\n\t\t\t\t);\n\t\t\t})}\n\t\t</ListGroup> );\n\t}\n\n\trender() {\n\t\tconst { t } = this.props;\n\t\tif ( !this.props.namespace._id ) {\n\t\t\treturn ( <Container className=\"edit-namespace-container\" >\n\t\t\t\t<Alert variant=\"danger\">{t('common:no-course-selected')}</Alert>\n\t\t\t</Container> );\n\t\t}\n\t\tconst validTitle = validateTitle( this.state.title );\n\t\tconst invalidTitleChars = checkURLPath( this.state.title );\n\t\tconst validDescription = validateDescription( this.state.description );\n\t\tconst validOwners = validateOwners( this.state.owners );\n\t\treturn (\n\t\t\t<Container className=\"edit-namespace-container\" >\n\t\t\t\t<Row>\n\t\t\t\t\t<Col sm={9} >\n\t\t\t\t\t\t<Card>\n\t\t\t\t\t\t\t<Tabs defaultActiveKey=\"manage-cohorts\" >\n\t\t\t\t\t\t\t\t<Tab eventKey=\"manage-cohorts\" title={<h3>{t('manage-cohorts')}</h3>} style={{ padding: 12 }} >\n\t\t\t\t\t\t\t\t\t{this.renderCohortList()}\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tsize=\"small\"\n\t\t\t\t\t\t\t\t\t\tvariant=\"success\"\n\t\t\t\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\t\t\t\tmarginTop: 10, background: '#3c763d'\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\t\t\tthis.setState({\n\t\t\t\t\t\t\t\t\t\t\t\tshowCreateCohortModal: true\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{t('create-cohort')}\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t</Tab>\n\t\t\t\t\t\t\t\t<Tab eventKey=\"assessments\" title={<h3>{t('common:assessments')}</h3>} >\n\t\t\t\t\t\t\t\t\t<Tabs variant=\"pills\" defaultActiveKey=\"namespace-completion-metrics\" >\n\t\t\t\t\t\t\t\t\t\t<Tab eventKey=\"namespace-completion-metrics\" title={t('common:course-wide')} >\n\t\t\t\t\t\t\t\t\t\t\t<CompletionsPage\n\t\t\t\t\t\t\t\t\t\t\t\tentity={this.props.namespace}\n\t\t\t\t\t\t\t\t\t\t\t\tlevel=\"namespace\"\n\t\t\t\t\t\t\t\t\t\t\t\tcohorts={this.props.cohorts}\n\t\t\t\t\t\t\t\t\t\t\t\tlessonRefs={this.state.lessonRefs}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</Tab>\n\t\t\t\t\t\t\t\t\t\t<Tab eventKey=\"lesson-completion-metrics\" title={t('lessons')} >\n\t\t\t\t\t\t\t\t\t\t\t<EditLessonMetrics\n\t\t\t\t\t\t\t\t\t\t\t\tlessonRefs={this.state.lessonRefs}\n\t\t\t\t\t\t\t\t\t\t\t\tlessons={this.props.namespace.lessons}\n\t\t\t\t\t\t\t\t\t\t\t\tnamespace={this.props.namespace}\n\t\t\t\t\t\t\t\t\t\t\t\tonSave={() => {}}\n\t\t\t\t\t\t\t\t\t\t\t\tsaveLessonMetrics={this.props.saveLessonMetrics}\n\t\t\t\t\t\t\t\t\t\t\t\tcomponentsByLesson={this.props.namespace.componentsByLesson}\n\t\t\t\t\t\t\t\t\t\t\t\tcomputeCompletions={this.props.computeCompletions}\n\t\t\t\t\t\t\t\t\t\t\t\ttags={this.props.namespace.tags}\n\t\t\t\t\t\t\t\t\t\t\t\tallRules={this.props.settings.completionRules}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</Tab>\n\t\t\t\t\t\t\t\t\t</Tabs>\n\t\t\t\t\t\t\t\t</Tab>\n\t\t\t\t\t\t\t\t<Tab eventKey=\"edit-course\" title={<h3>{t('edit-course')}</h3>} style={{ padding: 12 }} >\n\t\t\t\t\t\t\t\t\t<Form style={{ padding: '20px' }} className=\"d-grid gap-3\" >\n\t\t\t\t\t\t\t\t\t\t<OverlayTrigger placement=\"right\" overlay={<Tooltip id=\"ownerTooltip\">{t('owner-tooltip')}</Tooltip>}>\n\t\t\t\t\t\t\t\t\t\t\t<FormGroup >\n\t\t\t\t\t\t\t\t\t\t\t\t<FormLabel htmlFor=\"owners-text-select\" >{t('common:owners')}</FormLabel>\n\t\t\t\t\t\t\t\t\t\t\t\t<TextSelect\n\t\t\t\t\t\t\t\t\t\t\t\t\tid=\"owners-text-select\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tplaceholder={t('enter-emails')}\n\t\t\t\t\t\t\t\t\t\t\t\t\tonChange={this.handleOwnerChange}\n\t\t\t\t\t\t\t\t\t\t\t\t\tdefaultValue={this.state.owners}\n\t\t\t\t\t\t\t\t\t\t\t\t\tisInvalid={!validateOwners( this.state.owners )}\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t<FormControl.Feedback type=\"invalid\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{t('invalid-owners')}\n\t\t\t\t\t\t\t\t\t\t\t\t</FormControl.Feedback>\n\t\t\t\t\t\t\t\t\t\t\t</FormGroup>\n\t\t\t\t\t\t\t\t\t\t</OverlayTrigger>\n\t\t\t\t\t\t\t\t\t\t<OverlayTrigger placement=\"right\" overlay={<Tooltip id=\"courseTooltip\">{t('accessible-at')}<code>{SERVER+'/<course>/<lesson>'}</code></Tooltip>}>\n\t\t\t\t\t\t\t\t\t\t\t<FormGroup controlId=\"form-course\" >\n\t\t\t\t\t\t\t\t\t\t\t\t<FormLabel>{t('course-identifier')}</FormLabel>\n\t\t\t\t\t\t\t\t\t\t\t\t<FormControl\n\t\t\t\t\t\t\t\t\t\t\t\t\tname=\"title\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tvalue={this.state.title}\n\t\t\t\t\t\t\t\t\t\t\t\t\tonChange={this.handleInputChange}\n\t\t\t\t\t\t\t\t\t\t\t\t\tisInvalid={!validTitle}\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t<FormControl.Feedback type=\"invalid\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{ invalidTitleChars ?\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'Course identifier contains invalid character(s): '+invalidTitleChars[ 0 ] :\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'Course identifier must be at least three characters long and should not contain any spaces.'\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t</FormControl.Feedback>\n\t\t\t\t\t\t\t\t\t\t\t</FormGroup>\n\t\t\t\t\t\t\t\t\t\t</OverlayTrigger>\n\t\t\t\t\t\t\t\t\t\t<OverlayTrigger placement=\"right\" overlay={<Tooltip id=\"titleTooltip\">{t('title-tooltip')}</Tooltip>}>\n\t\t\t\t\t\t\t\t\t\t\t<FormGroup controlId=\"form-description\" >\n\t\t\t\t\t\t\t\t\t\t\t\t<FormLabel>{t('title-description')}</FormLabel>\n\t\t\t\t\t\t\t\t\t\t\t\t<FormControl\n\t\t\t\t\t\t\t\t\t\t\t\t\tname=\"description\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tvalue={this.state.description}\n\t\t\t\t\t\t\t\t\t\t\t\t\tonChange={this.handleInputChange}\n\t\t\t\t\t\t\t\t\t\t\t\t\tisInvalid={!validDescription}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t</FormControl>\n\t\t\t\t\t\t\t\t\t\t\t\t<FormControl.Feedback type=\"invalid\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{t('invalid-description')}\n\t\t\t\t\t\t\t\t\t\t\t\t</FormControl.Feedback>\n\t\t\t\t\t\t\t\t\t\t\t</FormGroup>\n\t\t\t\t\t\t\t\t\t\t</OverlayTrigger>\n\t\t\t\t\t\t\t\t\t\t<Form.Check\n\t\t\t\t\t\t\t\t\t\t\taria-label={t('enable-ticketing')}\n\t\t\t\t\t\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\t\t\t\t\t\tlabel={t('enable-ticketing')}\n\t\t\t\t\t\t\t\t\t\t\tdefaultChecked={this.state.enableTicketing}\n\t\t\t\t\t\t\t\t\t\t\tonChange={( event) => {\n\t\t\t\t\t\t\t\t\t\t\t\tthis.setState({\n\t\t\t\t\t\t\t\t\t\t\t\t\tenableTicketing: event.target.checked\n\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t<OverlayTrigger placement=\"right\" overlay={<Tooltip id=\"tagTooltip\">{t('tag-tooltip')}</Tooltip>}>\n\t\t\t\t\t\t\t\t\t\t\t<FormGroup controlId=\"form-tag\" >\n\t\t\t\t\t\t\t\t\t\t\t\t<FormLabel>{t('tag-description')}</FormLabel>\n\t\t\t\t\t\t\t\t\t\t\t\t<FormControl\n\t\t\t\t\t\t\t\t\t\t\t\t\tname=\"tag\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tvalue={this.state.tag}\n\t\t\t\t\t\t\t\t\t\t\t\t\tonChange={this.handleInputChange}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t</FormControl>\n\t\t\t\t\t\t\t\t\t\t\t</FormGroup>\n\t\t\t\t\t\t\t\t\t\t</OverlayTrigger>\n\t\t\t\t\t\t\t\t\t</Form>\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t\t\t\t\t\tdisabled={!validOwners || !validTitle || !validDescription}\n\t\t\t\t\t\t\t\t\t\tonClick={this.handleUpdate}\n\t\t\t\t\t\t\t\t\t>{t('common:update')}</Button>\n\t\t\t\t\t\t\t\t\t{this.renderModals()}\n\t\t\t\t\t\t\t\t</Tab>\n\t\t\t\t\t\t\t\t<Tab eventKey=\"permissions\" title={<h3>{t('common:permissions')}</h3>} disabled >\n\t\t\t\t\t\t\t\t</Tab>\n\t\t\t\t\t\t\t</Tabs>\n\t\t\t\t\t\t</Card>\n\t\t\t\t\t</Col>\n\t\t\t\t\t<Col sm={3} >\n\t\t\t\t\t\t<Card>\n\t\t\t\t\t\t\t<Card.Body>\n\t\t\t\t\t\t\t\t<ButtonGroup vertical>\n\t\t\t\t\t\t\t\t\t<Button onClick={() => {\n\t\t\t\t\t\t\t\t\t\tthis.setState({\n\t\t\t\t\t\t\t\t\t\t\tshowImportModal: true\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}} variant=\"outline-danger\" >{t('import-existing-course')}</Button>\n\t\t\t\t\t\t\t\t\t<Button onClick={() => {\n\t\t\t\t\t\t\t\t\t\tthis.setState({\n\t\t\t\t\t\t\t\t\t\t\tshowDeleteModal: true\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}} variant=\"outline-danger\">{t('delete-namespace')}</Button>\n\t\t\t\t\t\t\t\t</ButtonGroup>\n\t\t\t\t\t\t\t</Card.Body>\n\t\t\t\t\t\t</Card>\n\t\t\t\t\t</Col>\n\t\t\t\t</Row>\n\t\t\t</Container>\n\t\t);\n\t}\n}\n\n\n// PROPERTIES //\n\nEditNamespace.propTypes = {\n\taddNotification: PropTypes.func.isRequired,\n\tcohorts: PropTypes.array,\n\tcomputeCompletions: PropTypes.func.isRequired,\n\tcopyNamespaceLessons: PropTypes.func.isRequired,\n\tcreateCohort: PropTypes.func.isRequired,\n\tdeleteCohort: PropTypes.func.isRequired,\n\tdeleteCurrentNamespace: PropTypes.func.isRequired,\n\tnamespace: PropTypes.object.isRequired,\n\tsaveLessonMetrics: PropTypes.func.isRequired,\n\tsettings: PropTypes.object.isRequired,\n\tt: PropTypes.func.isRequired,\n\tupdateCohort: PropTypes.func.isRequired,\n\tupdateCurrentNamespace: PropTypes.func.isRequired,\n\tuser: PropTypes.object.isRequired\n};\n\nEditNamespace.defaultProps = {\n\tcohorts: []\n};\n\n\n// EXPORTS //\n\nexport default withTranslation( [ 'namespace', 'common' ] )( EditNamespace );\n","/**\n* Copyright (C) 2016-present The ISLE Authors\n*\n* The isle-dashboard program is free software: you can redistribute it and/or modify\n* it under the terms of the GNU Affero General Public License as\n* published by the Free Software Foundation, either version 3 of the\n* License, or (at your option) any later version.\n*\n* This program is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n* GNU Affero General Public License for more details.\n*\n* You should have received a copy of the GNU Affero General Public License\n* along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\n// MODULES //\n\nimport React from 'react';\nimport { connect } from 'react-redux';\nimport EditNamespace from 'components/edit-namespace';\nimport { createCohortInjector, deleteCohortInjector, updateCohortInjector } from 'actions/cohort';\nimport { deleteCurrentNamespaceInjector, updateCurrentNamespaceInjector } from 'actions/namespace';\nimport { addNotificationInjector } from 'actions/notification';\nimport { copyNamespaceLessonsInjector } from 'actions/lesson';\nimport { saveLessonMetricsInjector, computeCompletionsInjector } from 'actions/completions';\n\n\n// FUNCTIONS //\n\nfunction mapStateToProps( state ) {\n\treturn {\n\t\tuser: state.user,\n\t\tnamespace: state.namespace,\n\t\tcohorts: state.namespace.cohorts,\n\t\tsettings: state.settings\n\t};\n}\n\nfunction mapDispatchToProps( dispatch ) {\n\treturn {\n\t\taddNotification: addNotificationInjector( dispatch ),\n\t\tcreateCohort: createCohortInjector( dispatch ),\n\t\tdeleteCohort: deleteCohortInjector( dispatch ),\n\t\tupdateCohort: updateCohortInjector( dispatch ),\n\t\tdeleteCurrentNamespace: deleteCurrentNamespaceInjector( dispatch ),\n\t\tupdateCurrentNamespace: updateCurrentNamespaceInjector( dispatch ),\n\t\tcopyNamespaceLessons: copyNamespaceLessonsInjector( dispatch ),\n\t\tcomputeCompletions: computeCompletionsInjector( dispatch ),\n\t\tsaveLessonMetrics: saveLessonMetricsInjector( dispatch )\n\t};\n}\n\n\n// MAIN //\n\nconst VisibleEditNamespace = connect( mapStateToProps, mapDispatchToProps )( EditNamespace );\n\n\n// EXPORTS //\n\nexport default VisibleEditNamespace;\n"],"sourceRoot":""}