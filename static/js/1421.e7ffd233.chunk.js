"use strict";(self.webpackChunkisle_dashboard=self.webpackChunkisle_dashboard||[]).push([[1421],{49063:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(67294),prop_types__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(45697),prop_types__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_12__),react_i18next__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(81468),_wojtekmaj_react_datetimerange_picker__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(15141),react_bootstrap_Container__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(70448),react_bootstrap_Container__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(react_bootstrap_Container__WEBPACK_IMPORTED_MODULE_6__),react_bootstrap_Modal__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(89194),react_bootstrap_Modal__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(react_bootstrap_Modal__WEBPACK_IMPORTED_MODULE_5__),react_bootstrap_Button__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(89876),react_bootstrap_Button__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(react_bootstrap_Button__WEBPACK_IMPORTED_MODULE_11__),react_bootstrap_Form__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(17383),react_bootstrap_Form__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(react_bootstrap_Form__WEBPACK_IMPORTED_MODULE_7__),react_bootstrap_Row__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(28269),react_bootstrap_Row__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(react_bootstrap_Row__WEBPACK_IMPORTED_MODULE_8__),react_bootstrap_Col__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(1266),react_select__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(87583),_stdlib_assert_is_array__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(76266),_stdlib_assert_is_array__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_stdlib_assert_is_array__WEBPACK_IMPORTED_MODULE_2__),_helpful_label_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(6141),__defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp.call(b,prop)&&__defNormalProp(a,prop,b[prop]);if(__getOwnPropSymbols)for(var prop of __getOwnPropSymbols(b))__propIsEnum.call(b,prop)&&__defNormalProp(a,prop,b[prop]);return a},__spreadProps=(a,b)=>__defProps(a,__getOwnPropDescs(b));const MULTIPLES_POLICIES=[{value:"last",label:"Last submitted value"},{value:"first",label:"First submitted value"},{value:"pass-through",label:"All submitted values"},{value:"max",label:"Best submitted value"}],memberSelection=member=>({value:member.id,label:`${member.firstName} ${member.lastName} (${member.email})`});function ComputeModal({cohorts,metric,entity,level,show,onHide,computeCompletions,onCompute}){const{t}=(0,react_i18next__WEBPACK_IMPORTED_MODULE_4__.$G)(["completions","common"]),metricName=_stdlib_assert_is_array__WEBPACK_IMPORTED_MODULE_2___default()(metric)?metric[0].name:metric.name,[formValues,setFormValues]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)({users:[],activeCohorts:{},policyOptions:{multiples:MULTIPLES_POLICIES[0]}}),FORM_STORAGE_KEY=`ISLE?level=${level}&metric=${metricName}`;(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(()=>{var _a;let oldFormValues=localStorage.getItem(FORM_STORAGE_KEY);oldFormValues&&(oldFormValues=JSON.parse(oldFormValues),(_a=oldFormValues.policyOptions)!=null&&_a.timeFilter&&(oldFormValues.policyOptions.timeFilter=oldFormValues.policyOptions.timeFilter.map(x=>new Date(x))),setFormValues(oldFormValues))},[FORM_STORAGE_KEY]);const onTimeChange=(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(dates=>{const newFormValues=__spreadValues({},formValues);dates?newFormValues.policyOptions.timeFilter=dates:delete newFormValues.policyOptions.timeFilter,setFormValues(newFormValues)},[formValues]),handleMultiplesPolicyChange=(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(multiples=>{const newFormValues=__spreadValues({},formValues);newFormValues.policyOptions.multiples=multiples,setFormValues(newFormValues)},[formValues]),handleCompute=(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(()=>{const policyOptions=__spreadProps(__spreadValues({},formValues.policyOptions),{multiples:formValues.policyOptions.multiples.value});formValues.policyOptions.timeFilter&&(policyOptions.timeFilter=formValues.policyOptions.timeFilter.map(x=>x.getTime())),localStorage.setItem(FORM_STORAGE_KEY,JSON.stringify(formValues));const body={ids:_stdlib_assert_is_array__WEBPACK_IMPORTED_MODULE_2___default()(entity)?entity.map(x=>x._id):[entity._id],users:formValues.users.map(x=>x.value),metric,policyOptions};computeCompletions(body).then(onCompute)},[metric,entity,formValues,FORM_STORAGE_KEY,computeCompletions,onCompute]),users=cohorts.reduce((userList,cohort)=>{const members=cohort.members.map(member=>memberSelection(member));return userList.concat(members)},[]),selectOptions=[{value:{category:"all",members:users},label:t("All users")},...cohorts.length>1?cohorts.map(cohort=>({value:{category:"cohort",id:cohort._id,members:cohort.members},label:"Cohort "+cohort.title})):[]].concat(users),userSelectStyles={option:(styles,{data})=>data.value.category==="cohort"&&formValues.activeCohorts[data.value.id]?__spreadProps(__spreadValues({},styles),{":before":{content:'"\u2713 "'}}):styles},handleUserSelectChange=(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(value=>{if(!value){setFormValues(__spreadProps(__spreadValues({},formValues),{users:[]}));return}if(value.some(x=>x.value.category==="all")){setFormValues(__spreadProps(__spreadValues({},formValues),{users,activeCohorts:{}}));return}const selectedUsersSet=new Set,removeIds=new Set,newValue=[],newActiveCohorts=Object.assign({},formValues.activeCohorts);for(let i=0;i<value.length;i++)if(value[i].value.category==="cohort")if(formValues.activeCohorts[value[i].value.id])newActiveCohorts[value[i].value.id]=!1,value[i].value.members.forEach(member=>{removeIds.add(member.id)});else{newActiveCohorts[value[i].value.id]=!0;for(let j=0;j<value[i].value.members.length;++j)if(!selectedUsersSet.has(value[i].value.members[j].id)){const member=value[i].value.members[j];newValue.push(memberSelection(member)),selectedUsersSet.add(member.id)}}else selectedUsersSet.has(value[i].value)||(newValue.push(value[i]),selectedUsersSet.add(value[i].value));setFormValues(__spreadProps(__spreadValues({},formValues),{users:newValue.filter(x=>!removeIds.has(x.value)),activeCohorts:newActiveCohorts}))},[formValues,users]);return react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_bootstrap_Modal__WEBPACK_IMPORTED_MODULE_5___default(),{size:"lg",show,onHide},react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_bootstrap_Modal__WEBPACK_IMPORTED_MODULE_5___default().Header,{closeButton:!0},react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_bootstrap_Modal__WEBPACK_IMPORTED_MODULE_5___default().Title,{as:"h3"},t("calculate-scores-for",{metric:metricName}))),react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_bootstrap_Modal__WEBPACK_IMPORTED_MODULE_5___default().Body,null,react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_bootstrap_Container__WEBPACK_IMPORTED_MODULE_6___default(),null,react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_bootstrap_Form__WEBPACK_IMPORTED_MODULE_7___default().Group,{className:"mb-2",as:react_bootstrap_Row__WEBPACK_IMPORTED_MODULE_8___default(),controlId:"multiplesPolicy"},react__WEBPACK_IMPORTED_MODULE_0__.createElement(_helpful_label_js__WEBPACK_IMPORTED_MODULE_3__.Z,{colWidth:3,name:t("multiples-policy"),description:t("multiples-policy-description")}),react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_bootstrap_Col__WEBPACK_IMPORTED_MODULE_9__.default,{sm:9},react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_select__WEBPACK_IMPORTED_MODULE_10__.ZP,{value:formValues.policyOptions.multiples,options:MULTIPLES_POLICIES,onChange:handleMultiplesPolicyChange}))),react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_bootstrap_Form__WEBPACK_IMPORTED_MODULE_7___default().Group,{className:"mb-2",as:react_bootstrap_Row__WEBPACK_IMPORTED_MODULE_8___default(),controlId:"timeFilter"},react__WEBPACK_IMPORTED_MODULE_0__.createElement(_helpful_label_js__WEBPACK_IMPORTED_MODULE_3__.Z,{colWidth:3,name:t("time-filter"),description:t("time-filter-description")}),react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_bootstrap_Col__WEBPACK_IMPORTED_MODULE_9__.default,{sm:9},react__WEBPACK_IMPORTED_MODULE_0__.createElement(_wojtekmaj_react_datetimerange_picker__WEBPACK_IMPORTED_MODULE_1__.Z,{onChange:onTimeChange,value:formValues.policyOptions.timeFilter}))),react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_bootstrap_Form__WEBPACK_IMPORTED_MODULE_7___default().Group,{className:"mb-2",as:react_bootstrap_Row__WEBPACK_IMPORTED_MODULE_8___default(),controlId:"users"},react__WEBPACK_IMPORTED_MODULE_0__.createElement(_helpful_label_js__WEBPACK_IMPORTED_MODULE_3__.Z,{colWidth:3,name:t("common:users"),description:t("users-description")}),react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_bootstrap_Col__WEBPACK_IMPORTED_MODULE_9__.default,{sm:9},react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_select__WEBPACK_IMPORTED_MODULE_10__.ZP,{value:formValues.users,isMulti:!0,options:selectOptions,onChange:handleUserSelectChange,hideSelectedOptions:!0,styles:userSelectStyles,placeholder:t("common:select-users-placeholder")}))))),react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_bootstrap_Modal__WEBPACK_IMPORTED_MODULE_5___default().Footer,null,react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_bootstrap_Button__WEBPACK_IMPORTED_MODULE_11___default(),{onClick:onHide},t("common:cancel")),react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_bootstrap_Button__WEBPACK_IMPORTED_MODULE_11___default(),{variant:"success",onClick:handleCompute,disabled:formValues.users.length===0},t("common:compute"))))}ComputeModal.propTypes={cohorts:prop_types__WEBPACK_IMPORTED_MODULE_12___default().array.isRequired,computeCompletions:prop_types__WEBPACK_IMPORTED_MODULE_12___default().func.isRequired,entity:prop_types__WEBPACK_IMPORTED_MODULE_12___default().oneOfType([prop_types__WEBPACK_IMPORTED_MODULE_12___default().arrayOf(prop_types__WEBPACK_IMPORTED_MODULE_12___default().object),prop_types__WEBPACK_IMPORTED_MODULE_12___default().object]).isRequired,level:prop_types__WEBPACK_IMPORTED_MODULE_12___default().string.isRequired,metric:prop_types__WEBPACK_IMPORTED_MODULE_12___default().oneOfType([prop_types__WEBPACK_IMPORTED_MODULE_12___default().arrayOf(prop_types__WEBPACK_IMPORTED_MODULE_12___default().object),prop_types__WEBPACK_IMPORTED_MODULE_12___default().object]).isRequired,onCompute:prop_types__WEBPACK_IMPORTED_MODULE_12___default().func.isRequired,onHide:prop_types__WEBPACK_IMPORTED_MODULE_12___default().func.isRequired,show:prop_types__WEBPACK_IMPORTED_MODULE_12___default().bool.isRequired},ComputeModal.defaultProps={},__webpack_exports__.Z=ComputeModal},6141:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(67294),react_bootstrap_OverlayTrigger__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(99201),react_bootstrap_OverlayTrigger__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(react_bootstrap_OverlayTrigger__WEBPACK_IMPORTED_MODULE_2__),react_bootstrap_Tooltip__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(18868),react_bootstrap_Tooltip__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(react_bootstrap_Tooltip__WEBPACK_IMPORTED_MODULE_3__),react_bootstrap_Form__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(17383),react_bootstrap_Form__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(react_bootstrap_Form__WEBPACK_IMPORTED_MODULE_1__);function HelpfulLabel({name,description,colWidth,className,placement="left",disabled=!1,as=react_bootstrap_Form__WEBPACK_IMPORTED_MODULE_1___default().Label}){const children=[react__WEBPACK_IMPORTED_MODULE_0__.createElement("span",{key:"name"},name)];return disabled?react__WEBPACK_IMPORTED_MODULE_0__.createElement(as,{sm:colWidth,className,column:!0},children):(children.push(react__WEBPACK_IMPORTED_MODULE_0__.createElement("i",{key:"info-icon",className:"info-icon ms-2 fas fa-info"})),react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_bootstrap_OverlayTrigger__WEBPACK_IMPORTED_MODULE_2___default(),{placement,overlay:react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_bootstrap_Tooltip__WEBPACK_IMPORTED_MODULE_3___default(),{id:`param-${name}-tooltip`},description)},react__WEBPACK_IMPORTED_MODULE_0__.createElement(as,{sm:colWidth,className,column:!0},children)))}__webpack_exports__.Z=HelpfulLabel},88608:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(67294),prop_types__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(45697),prop_types__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_3__),react_i18next__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(81468),react_bootstrap_Button__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(89876),react_bootstrap_Button__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(react_bootstrap_Button__WEBPACK_IMPORTED_MODULE_2__),react_bootstrap_Modal__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(89194),react_bootstrap_Modal__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(react_bootstrap_Modal__WEBPACK_IMPORTED_MODULE_1__);const ConfirmModal=props=>react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_bootstrap_Modal__WEBPACK_IMPORTED_MODULE_1___default(),{show:props.show,onHide:props.close},react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_bootstrap_Modal__WEBPACK_IMPORTED_MODULE_1___default().Header,null,react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_bootstrap_Modal__WEBPACK_IMPORTED_MODULE_1___default().Title,{as:"h3"},props.title)),react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_bootstrap_Modal__WEBPACK_IMPORTED_MODULE_1___default().Body,null,props.message),react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_bootstrap_Modal__WEBPACK_IMPORTED_MODULE_1___default().Footer,null,react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_bootstrap_Button__WEBPACK_IMPORTED_MODULE_2___default(),{onClick:props.close},props.t("cancel")),react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_bootstrap_Button__WEBPACK_IMPORTED_MODULE_2___default(),{variant:"danger",onClick:props.onConfirm},props.t("confirm"))));ConfirmModal.propTypes={close:prop_types__WEBPACK_IMPORTED_MODULE_3___default().func,message:prop_types__WEBPACK_IMPORTED_MODULE_3___default().node,onConfirm:prop_types__WEBPACK_IMPORTED_MODULE_3___default().func,show:prop_types__WEBPACK_IMPORTED_MODULE_3___default().bool,title:prop_types__WEBPACK_IMPORTED_MODULE_3___default().string},ConfirmModal.defaultProps={close(){},message:"",onConfirm(){},show:!1,title:""},__webpack_exports__.Z=(0,react_i18next__WEBPACK_IMPORTED_MODULE_4__.Zh)(["common"])(ConfirmModal)},61197:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:function(){return visible_edit_namespace}});var react=__webpack_require__(67294),lib=__webpack_require__(37424),prop_types=__webpack_require__(45697),prop_types_default=__webpack_require__.n(prop_types),axios=__webpack_require__(9669),axios_default=__webpack_require__.n(axios),commonjs=__webpack_require__(81468),Tabs=__webpack_require__(29575),Tabs_default=__webpack_require__.n(Tabs),Tab=__webpack_require__(28350),Tab_default=__webpack_require__.n(Tab),Alert=__webpack_require__(93166),Alert_default=__webpack_require__.n(Alert),Badge=__webpack_require__(86100),Badge_default=__webpack_require__.n(Badge),Button=__webpack_require__(89876),Button_default=__webpack_require__.n(Button),ButtonGroup=__webpack_require__(63319),ButtonGroup_default=__webpack_require__.n(ButtonGroup),Card=__webpack_require__(51889),Card_default=__webpack_require__.n(Card),Container=__webpack_require__(70448),Container_default=__webpack_require__.n(Container),Col=__webpack_require__(1266),Row=__webpack_require__(28269),Row_default=__webpack_require__.n(Row),FormControl=__webpack_require__(26199),FormControl_default=__webpack_require__.n(FormControl),FormLabel=__webpack_require__(65903),FormLabel_default=__webpack_require__.n(FormLabel),FormGroup=__webpack_require__(34168),FormGroup_default=__webpack_require__.n(FormGroup),Form=__webpack_require__(17383),Form_default=__webpack_require__.n(Form),ListGroup=__webpack_require__(18350),ListGroup_default=__webpack_require__.n(ListGroup),ListGroupItem=__webpack_require__(36604),ListGroupItem_default=__webpack_require__.n(ListGroupItem),OverlayTrigger=__webpack_require__(99201),OverlayTrigger_default=__webpack_require__.n(OverlayTrigger),Tooltip=__webpack_require__(18868),Tooltip_default=__webpack_require__.n(Tooltip),is_array_lib=__webpack_require__(76266),is_array_lib_default=__webpack_require__.n(is_array_lib),trim_lib=__webpack_require__(87594),trim_lib_default=__webpack_require__.n(trim_lib),text_select=__webpack_require__(70264),Modal=__webpack_require__(89194),Modal_default=__webpack_require__.n(Modal);const MsgModal=({show,close,message,title})=>react.createElement(Modal_default(),{show,onHide:close},react.createElement(Modal_default().Header,{closeButton:!0},react.createElement(Modal_default().Title,null,title)),react.createElement(Modal_default().Body,null,message),react.createElement(Modal_default().Footer,null,react.createElement(Button_default(),{onClick:close},"Close")));MsgModal.propTypes={close:prop_types_default().func,message:prop_types_default().string,show:prop_types_default().bool,title:prop_types_default().string},MsgModal.defaultProps={close(){},message:"",show:!1,title:""};var message_modal=MsgModal,confirm_modal=__webpack_require__(88608),create_namespace=__webpack_require__(29724),lodash_debounce=__webpack_require__(91296),lodash_debounce_default=__webpack_require__.n(lodash_debounce),incrspace_lib=__webpack_require__(26658),incrspace_lib_default=__webpack_require__.n(incrspace_lib),server=__webpack_require__(94204),compute_modal=__webpack_require__(49063),react_select_cjs_prod=__webpack_require__(87583),react_select_cjs=__webpack_require__(4665),is_positive_number_lib=__webpack_require__(86688),is_positive_number_lib_default=__webpack_require__.n(is_positive_number_lib),values_lib=__webpack_require__(49984),values_lib_default=__webpack_require__.n(values_lib);const levelFieldMapping={program:"namespaces",namespace:"lessons",lesson:null,component:null};function predecessor(level){switch(level){case"lesson":return"component";case"namespace":return"lesson";case"program":return"namespace";case"global":return"program";case"component":default:return null}}const levelPredecessorMapping={global:"program",program:"namespace",namespace:"lesson",lesson:"component",component:null};var coverage_options_namespaceObject=JSON.parse('{"all":{"value":"all","label":"All"},"include":{"value":"include","label":"Include"},"exclude":{"value":"exclude","label":"Exclude"}}'),keys_lib=__webpack_require__(25351),keys_lib_default=__webpack_require__.n(keys_lib),is_empty_object_lib=__webpack_require__(83966),is_empty_object_lib_default=__webpack_require__.n(is_empty_object_lib),__defProp=Object.defineProperty,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues=(a,b)=>{for(var prop in b||(b={}))__hasOwnProp.call(b,prop)&&__defNormalProp(a,prop,b[prop]);if(__getOwnPropSymbols)for(var prop of __getOwnPropSymbols(b))__propIsEnum.call(b,prop)&&__defNormalProp(a,prop,b[prop]);return a};function createOptions(arr){return arr.map(tag=>({value:tag,label:tag}))}function TagWeightsEditor({tagWeights,visibleTags,onUpdate}){const{t}=(0,commonjs.$G)("completions"),tags=keys_lib_default()(tagWeights),[newTag,setNewTag]=(0,react.useState)(null),handleChange=(0,react.useCallback)(event=>{const weight=Number(event.target.value),tag=event.target.getAttribute("data-tag"),newWeights=__spreadValues({},tagWeights);newWeights[tag]=weight,onUpdate(newWeights)},[tagWeights,onUpdate]),handleTagDeletion=(0,react.useCallback)(event=>{const tag=event.target.getAttribute("data-tag"),newWeights=__spreadValues({},tagWeights);delete newWeights[tag],is_empty_object_lib_default()(newWeights)&&(newWeights._default_tag=1),onUpdate(newWeights)},[tagWeights,onUpdate]),handleTagCreation=(0,react.useCallback)(elem=>{if(elem&&elem.value&&tagWeights[elem.value]===void 0){const{value}=elem,newWeights=__spreadValues({},tagWeights);newWeights[value]=0,setNewTag(null),onUpdate(newWeights)}},[tagWeights,onUpdate]),inputs=new Array(tags.length),showDelete=!(tags.length===1&&tags[0]==="_default_tag");for(let i=0;i<tags.length;i++){const tag=tags[i],weight=tagWeights[tag];inputs[i]=react.createElement(Form_default().Group,{className:"mb-1",as:Row_default(),key:`tag-${i}`},react.createElement(Form_default().Label,{column:!0,sm:5},tag==="_default_tag"?t("default"):tag),react.createElement(Col.default,{sm:5},react.createElement(Form_default().Control,{type:"number",value:weight,onChange:handleChange,placeholder:1,"data-tag":tag,min:0})),react.createElement(Col.default,{sm:2},showDelete&&react.createElement(Button_default(),{variant:"outline-secondary",onClick:handleTagDeletion,"data-tag":tag,size:"xm"},react.createElement("i",{className:"fa fa-times",style:{pointerEvents:"none"}}))))}return react.createElement(react.Fragment,null,inputs,react.createElement(Form_default().Group,{className:"mb-1",as:Row_default()},react.createElement(Col.default,{sm:5},react.createElement(react_select_cjs.default,{options:createOptions(visibleTags.filter(tag=>(tagWeights==null?void 0:tagWeights[tag])===void 0)),onChange:handleTagCreation,placeholder:t("select-a-new-tag"),value:newTag})),react.createElement(Form_default().Label,{className:"completions-info",column:!0,sm:5},t("add-new-weight")),react.createElement(Col.default,{sm:2})))}TagWeightsEditor.propTypes={onUpdate:prop_types_default().func.isRequired,tagWeights:prop_types_default().object,visibleTags:prop_types_default().array.isRequired},TagWeightsEditor.defaultProps={tagWeights:{_default_tag:1}};var tag_weights_editor=TagWeightsEditor,entry=__webpack_require__(38591),parameter_input_defProp=Object.defineProperty,parameter_input_getOwnPropSymbols=Object.getOwnPropertySymbols,parameter_input_hasOwnProp=Object.prototype.hasOwnProperty,parameter_input_propIsEnum=Object.prototype.propertyIsEnumerable,parameter_input_defNormalProp=(obj,key,value)=>key in obj?parameter_input_defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,parameter_input_spreadValues=(a,b)=>{for(var prop in b||(b={}))parameter_input_hasOwnProp.call(b,prop)&&parameter_input_defNormalProp(a,prop,b[prop]);if(parameter_input_getOwnPropSymbols)for(var prop of parameter_input_getOwnPropSymbols(b))parameter_input_propIsEnum.call(b,prop)&&parameter_input_defNormalProp(a,prop,b[prop]);return a},__objRest=(source,exclude)=>{var target={};for(var prop in source)parameter_input_hasOwnProp.call(source,prop)&&exclude.indexOf(prop)<0&&(target[prop]=source[prop]);if(source!=null&&parameter_input_getOwnPropSymbols)for(var prop of parameter_input_getOwnPropSymbols(source))exclude.indexOf(prop)<0&&parameter_input_propIsEnum.call(source,prop)&&(target[prop]=source[prop]);return target};function selectOption(value,transform){return{label:transform?transform(value):value,value}}function convertRuleParam(value,parameter){switch(parameter.type){case"number":return parseFloat(value);case"datetime":return value.getTime();case"string":case"enum":case"text":default:return value}}function ParameterInput(_a){var _b=_a,{parameter,onChange,t,value}=_b,rest=__objRest(_b,["parameter","onChange","t","value"]);const{type,name,values}=parameter;switch(type){case"number":case"text":return react.createElement(Form_default().Control,parameter_input_spreadValues({key:`${name}-param`,name,type,placeholder:t("enter-parameter-value"),onChange:event=>{onChange(event.target.value)},value},rest));case"enum":return react.createElement(react_select_cjs_prod.ZP,{key:`${name}-param`,onChange:elem=>{onChange(elem?elem.value:null)},options:values.map(value2=>selectOption(value2,t)),value:value?selectOption(value,t):null,isDisabled:rest.disabled});case"datetime":return react.createElement(entry.Z,parameter_input_spreadValues({onChange:time=>{onChange(time)},clearIcon:null,value:value?new Date(value):new Date},rest))}}var parameter_input=ParameterInput;const convertRuleParameter=convertRuleParam;var helpful_label=__webpack_require__(6141),edit_metric_modal_defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,edit_metric_modal_getOwnPropSymbols=Object.getOwnPropertySymbols,edit_metric_modal_hasOwnProp=Object.prototype.hasOwnProperty,edit_metric_modal_propIsEnum=Object.prototype.propertyIsEnumerable,edit_metric_modal_defNormalProp=(obj,key,value)=>key in obj?edit_metric_modal_defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,edit_metric_modal_spreadValues=(a,b)=>{for(var prop in b||(b={}))edit_metric_modal_hasOwnProp.call(b,prop)&&edit_metric_modal_defNormalProp(a,prop,b[prop]);if(edit_metric_modal_getOwnPropSymbols)for(var prop of edit_metric_modal_getOwnPropSymbols(b))edit_metric_modal_propIsEnum.call(b,prop)&&edit_metric_modal_defNormalProp(a,prop,b[prop]);return a},__spreadProps=(a,b)=>__defProps(a,__getOwnPropDescs(b)),edit_metric_modal_objRest=(source,exclude)=>{var target={};for(var prop in source)edit_metric_modal_hasOwnProp.call(source,prop)&&exclude.indexOf(prop)<0&&(target[prop]=source[prop]);if(source!=null&&edit_metric_modal_getOwnPropSymbols)for(var prop of edit_metric_modal_getOwnPropSymbols(source))exclude.indexOf(prop)<0&&edit_metric_modal_propIsEnum.call(source,prop)&&(target[prop]=source[prop]);return target};function createTagWeights(tags,existingWeights){if(!tags&&!existingWeights)return{_default_tag:1};if(!tags)return existingWeights;const defaultWeight=existingWeights&&values_lib_default()(existingWeights).some(is_positive_number_lib_default())?0:1,weights=edit_metric_modal_spreadValues({},existingWeights);return tags.forEach(tag=>{var _a;weights[tag]=(_a=existingWeights==null?void 0:existingWeights[tag])!=null?_a:defaultWeight}),weights}function EditMetricModal({level,entity,show,onHide,allRules,refs,createNew,metric,onConfirm}){var _a,_b,_c;const{t}=(0,commonjs.$G)("completions"),[name,setName]=(0,react.useState)((metric==null?void 0:metric.name)||""),[rule,setRule]=(0,react.useState)(metric!=null&&metric.rule?allRules[metric.rule[0]]:null),[ruleParameters,setRuleParameters]=(0,react.useState)(metric!=null&&metric.rule?metric.rule.slice(1):[]),[coverage,setCoverage]=(0,react.useState)(coverage_options_namespaceObject[((_a=metric==null?void 0:metric.coverage)==null?void 0:_a[0])||"all"]),[coverageEntities,setCoverageEntities]=(0,react.useState)([]),[selectedRef,setSelectedRef]=(0,react.useState)((metric==null?void 0:metric.ref)||null),[tagWeights,setTagWeights]=(0,react.useState)(createTagWeights(null,metric==null?void 0:metric.tagWeights)),[autoCompute,setAutoCompute]=(0,react.useState)((_b=metric==null?void 0:metric.autoCompute)!=null?_b:!1),[visibleToStudent,setVisibleToStudent]=(0,react.useState)((_c=metric==null?void 0:metric.visibleToStudent)!=null?_c:!1),subEntities=(0,react.useRef)([]);(0,react.useEffect)(()=>{if(level==="lesson")subEntities.current=[];else if(levelFieldMapping[level]){const entities=entity[levelFieldMapping[level]];if(subEntities.current=entities.map(x=>({label:x.title,value:x})),metric&&metric.coverage){const ids=new Set(metric.coverage.slice(1));setCoverageEntities(subEntities.current.filter(x=>ids.has(x.value._id)))}}else subEntities.current=[]},[level,entity,metric]);const handleConfirm=()=>{onConfirm({name,rule:[rule.name].concat(ruleParameters),coverage:[coverage.value].concat(coverageEntities.map(x=>x.value._id)),level,id:entity._id,ref:selectedRef,tagWeights,autoCompute,visibleToStudent}),onHide()},handleEntityChange=value=>{setCoverageEntities(value)},labelStyler=(styles,{data})=>!selectedRef||data.value.completions.some(x=>x.name===selectedRef)?styles:__spreadProps(edit_metric_modal_spreadValues({},styles),{opacity:.65}),subentitySelectorStyles={option:labelStyler,multiValueLabel:labelStyler};return react.createElement(Modal_default(),{size:"lg",show,onHide},react.createElement(Modal_default().Header,{closeButton:!0},react.createElement(Modal_default().Title,{as:"h3"},t(createNew?"create-assessment-metric":"edit-assessment-metric"))),react.createElement(Modal_default().Body,null,react.createElement("p",null,t(createNew?"create-assessment-metric-description":"edit-assessment-metric-description")),react.createElement(Form_default().Group,{className:"mb-2",as:Row_default()},react.createElement(Col.default,{sm:3},react.createElement(Form_default().Label,null,t("common:name"))),react.createElement(Col.default,{sm:9},react.createElement(Form_default().Control,{name:"metric-name",type:"text",placeholder:t("metric-name-placeholder"),onChange:event=>setName(event.target.value),value:name}))),react.createElement(Form_default().Group,{className:"mb-2",as:Row_default()},react.createElement(helpful_label.Z,{colWidth:3,name:t("common:rule"),description:rule&&rule.description,disabled:!rule}),react.createElement(Col.default,{sm:9},react.createElement(react_select_cjs_prod.ZP,{options:values_lib_default()(allRules).map(rule2=>({value:rule2,label:rule2.label})),onChange:option=>{const newRule=option.value;setRule(newRule),setRuleParameters(newRule.parameters.map(x=>x.default||null))},value:rule?{value:rule,label:rule.label}:null,placeholder:t("select-rule")}))),rule&&rule.parameters.length>0?rule.parameters.map((parameter,idx)=>react.createElement(Form_default().Group,{key:`param-${idx}`,className:"mb-2",as:Row_default()},react.createElement(helpful_label.Z,{colWidth:3,className:"ps-5",name:parameter.name,description:parameter.description}),react.createElement(Col.default,{sm:9},react.createElement(parameter_input,{parameter,onChange:value=>{const newParams=ruleParameters.slice();newParams[idx]=convertRuleParameter(value,parameter),setRuleParameters(newParams)},value:ruleParameters[idx]!==void 0?ruleParameters[idx]:parameter.default,t})))):null,react.createElement(Form_default().Group,{className:"mb-2",as:Row_default()},react.createElement(helpful_label.Z,{colWidth:3,name:t("lesson-metric"),description:t("lesson-metric-tooltip")}),react.createElement(Col.default,{sm:9},react.createElement(react_select_cjs.default,{isClearable:!0,options:refs.map(ref=>({value:ref,label:ref})),onChange:option=>{setSelectedRef(option?option.value:null)},defaultValue:selectedRef?{value:selectedRef,label:selectedRef}:null,components:{SingleValue:_d=>{var _e=_d,{children}=_e,rest=edit_metric_modal_objRest(_e,["children"]);return react.createElement(react_select_cjs_prod.wx.SingleValue,edit_metric_modal_spreadValues({},rest),children,refs&&!refs.includes(selectedRef)&&react.createElement("span",{className:"completions-warning"},` (${t("lesson-metric-does-not-exist-yet")})`))}},placeholder:t("select-lower-metric-placeholder")}))),react.createElement(Form_default().Group,{className:"mb-2",as:Row_default()},react.createElement(helpful_label.Z,{colWidth:3,name:t("common:coverage"),description:t("coverage-tooltip")}),react.createElement(Col.default,{sm:9},react.createElement(react_select_cjs_prod.ZP,{options:values_lib_default()(coverage_options_namespaceObject),onChange:option=>{setCoverage(option),option.value==="all"&&setCoverageEntities([])},value:coverage}),coverage.value==="include"||coverage.value==="exclude"?react.createElement(react_select_cjs_prod.ZP,{isMulti:!0,options:subEntities.current,onChange:handleEntityChange,value:coverageEntities,styles:subentitySelectorStyles,placeholder:"Select lessons...",components:{Placeholder:_f=>{var _g=_f,{children,isFocused}=_g,rest=edit_metric_modal_objRest(_g,["children","isFocused"]);return console.log(rest),react.createElement(react_select_cjs_prod.wx.Placeholder,edit_metric_modal_spreadValues({},rest),children," ",isFocused?"(opaque lessons have no metric for the selected ref)":"")}}}):null)),react.createElement(Form_default().Group,{className:"mb-2",as:Row_default(),controlId:"users"},react.createElement(helpful_label.Z,{colWidth:3,name:t("tag-weights"),description:t("tag-weights-tooltip")}),react.createElement(Col.default,{sm:9},react.createElement(tag_weights_editor,{tagWeights,visibleTags:entity.lessonTags,onUpdate:setTagWeights}))),react.createElement(Form_default().Check,{"aria-label":t("auto-compute"),type:"checkbox",label:react.createElement(helpful_label.Z,{name:t("auto-compute"),description:t("auto-compute-tooltip"),placement:"right",as:"span"}),defaultChecked:autoCompute,onChange:event=>{setAutoCompute(event.target.checked)}}),react.createElement(Form_default().Check,{"aria-label":t("visible-to-student"),type:"checkbox",label:react.createElement(helpful_label.Z,{name:t("visible-to-student"),description:t("visible-to-student-tooltip"),placement:"right",as:"span"}),defaultChecked:visibleToStudent,onChange:event=>{setVisibleToStudent(event.target.checked)}})),react.createElement(Modal_default().Footer,null,react.createElement(Button_default(),{onClick:onHide},t("common:cancel")),react.createElement(Button_default(),{variant:"success",onClick:handleConfirm,disabled:!rule||!name},t(createNew?"common:create":"common:save"))))}EditMetricModal.propTypes={allRules:prop_types_default().object.isRequired,createNew:prop_types_default().bool.isRequired,entity:prop_types_default().object.isRequired,level:prop_types_default().oneOf(["program","namespace"]).isRequired,metric:prop_types_default().object,onConfirm:prop_types_default().func.isRequired,onHide:prop_types_default().func.isRequired,refs:prop_types_default().array.isRequired,show:prop_types_default().bool.isRequired},EditMetricModal.defaultProps={metric:null};var edit_metric_modal=EditMetricModal;function CompletionsPage(props){const{t}=(0,commonjs.$G)("completions"),[selectedMetric,setSelectedMetric]=(0,react.useState)(null),[showComputeModal,setShowComputeModal]=(0,react.useState)(!1),[showDeleteModal,setShowDeleteModal]=(0,react.useState)(!1),[showCreateModal,setShowCreateModal]=(0,react.useState)(!1),[showEditModal,setShowEditModal]=(0,react.useState)(!1),[refs,setRefs]=(0,react.useState)(null),metrics=props.entity.completions||[],[order,setOrder]=(0,react.useState)(incrspace_lib_default()(0,metrics.length,1));(0,react.useEffect)(()=>{if(props.level==="lesson")setRefs(props.lessonRefs);else{const subentities=props.entity[levelFieldMapping[props.level]],completions2=new Set;subentities.forEach(subentity=>{subentity.completions.forEach(completion=>{completions2.add(completion.name)})}),setRefs(Array.from(completions2).sort())}},[props.entity,props.level,props.lessonRefs]);const handleDeleteMetric=()=>{const idx=metrics.findIndex(metric=>metric.name===selectedMetric.name),newOrder=order.filter(v=>v!==idx).map(x=>x>idx?x-1:x);setOrder(newOrder),props.deleteMetric({id:props.entity._id,level:props.level,name:selectedMetric.name}).then(response=>{setSelectedMetric(null),setShowDeleteModal(!1)}).catch(err=>{console.log("Error deleting metric:",err)})},transposeMetrics=(index,next)=>lodash_debounce_default()(()=>{const newOrder=[...order],i=newOrder[index];next?(newOrder[index]=newOrder[index+1],newOrder[index+1]=i):(newOrder[index]=newOrder[index-1],newOrder[index-1]=i),setOrder(newOrder),axios_default().post(`${server.ZP}/metric_order`,{id:props.entity._id,level:props.level,index,next}).then(response=>{console.log(response)}).catch(err=>{console.log("Error updating metric order:",err)})},200);return react.createElement("div",{style:{margin:12}},react.createElement(ListGroup_default(),null,order.map((metricIndex,idx)=>{const metric=metrics[metricIndex];if(!metric)return null;const handleCompute=()=>{setSelectedMetric(metric),setShowComputeModal(!0)};return react.createElement(ListGroup_default().Item,{key:`${metricIndex}-${idx}`,className:"d-flex w-100 justify-content-start metric-list-item"},react.createElement("label",{className:"me-2"},metric.name,refs&&!refs.includes(metric.ref)&&react.createElement("span",{className:"completions-warning ms-2"},t("uses-not-yet-existing-lesson-metric"))),react.createElement("span",{style:{display:"inline-block",maxWidth:"calc(100% - 400px)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontStyle:"italic"}},metric.description),react.createElement("span",{className:"ms-auto"},!metric.autoCompute&&react.createElement(OverlayTrigger_default(),{placement:"top",overlay:react.createElement(Tooltip_default(),{id:`tooltip-compute-${idx}`},t("compute-metric-tooltip"))},react.createElement(Button_default(),{variant:"secondary",size:"sm",className:"mx-2",onClick:handleCompute},t("common:compute"))),react.createElement(OverlayTrigger_default(),{placement:"top",overlay:react.createElement(Tooltip_default(),{id:`tooltip-edit-${idx}`},t("edit-metric-tooltip"))},react.createElement(Button_default(),{variant:"secondary",size:"sm",className:"mx-2",onClick:()=>{setSelectedMetric(metric),setShowEditModal(!0)}},t("common:edit"))),react.createElement(OverlayTrigger_default(),{placement:"top",overlay:react.createElement(Tooltip_default(),{id:`tooltip-delete-${idx}`},t("delete-metric-tooltip"))},react.createElement(Button_default(),{variant:"danger",size:"sm",className:"mx-2",onClick:()=>{setSelectedMetric(metric),setShowDeleteModal(!0)}},t("common:delete"))),react.createElement(Button_default(),{"aria-label":t("move-metric-down"),size:"sm",variant:"secondary",className:"mx-1",disabled:idx===metrics.length-1,onClick:transposeMetrics(idx,!0)},react.createElement("i",{className:"fas fa-chevron-down"})),react.createElement(Button_default(),{"aria-label":t("move-metric-up"),size:"sm",variant:"secondary",disabled:idx===0,onClick:transposeMetrics(idx,!1)},react.createElement("i",{className:"fas fa-chevron-up"}))))})),react.createElement(OverlayTrigger_default(),{placement:"bottom",overlay:react.createElement(Tooltip_default(),{id:"tooltip-create-metric"},t("create-metric-tooltip"))},react.createElement(Button_default(),{variant:"primary",style:{marginTop:12},onClick:()=>{setShowCreateModal(!0)}},t("create-metric"))),selectedMetric?react.createElement(compute_modal.Z,{key:`compute-modal-${selectedMetric.name}`,metric:selectedMetric,show:showComputeModal,onHide:()=>setShowComputeModal(!1),cohorts:props.cohorts,entity:props.entity,level:props.level,computeCompletions:props.computeCompletions,onCompute:()=>setShowComputeModal(!1)}):null,showCreateModal?react.createElement(edit_metric_modal,{key:"create-modal",show:showCreateModal,onHide:()=>setShowCreateModal(!1),allRules:props.settings.completionRules,level:props.level,entity:props.entity,refs,createNew:!0,onConfirm:body=>{props.createMetric(body);const newOrder=order.slice();newOrder.push(order.length),setOrder(newOrder)}}):null,showDeleteModal?react.createElement(confirm_modal.Z,{title:t("delete-metric"),message:t("delete-metric-confirm"),close:()=>setShowDeleteModal(!1),show:showDeleteModal,onConfirm:handleDeleteMetric}):null,showEditModal?react.createElement(edit_metric_modal,{key:`edit-modal-${selectedMetric.name}`,show:showEditModal,onHide:()=>setShowEditModal(!1),allRules:props.settings.completionRules,level:props.level,entity:props.entity,refs,createNew:!1,metric:selectedMetric,onConfirm:props.updateMetric}):null)}CompletionsPage.propTypes={cohorts:prop_types_default().array.isRequired,computeCompletions:prop_types_default().func.isRequired,createMetric:prop_types_default().func.isRequired,deleteMetric:prop_types_default().func.isRequired,entity:prop_types_default().object.isRequired,lessonRefs:prop_types_default().array.isRequired,level:prop_types_default().string.isRequired,settings:prop_types_default().object.isRequired,updateMetric:prop_types_default().func.isRequired};var completions=CompletionsPage,actions_completions=__webpack_require__(83214),notification=__webpack_require__(16120);function mapStateToProps(state){return{user:state.user,namespace:state.namespace,cohorts:state.namespace.cohorts,settings:state.settings}}function mapDispatchToProps(dispatch){return{addNotification:(0,notification.pP)(dispatch),createMetric:(0,actions_completions.Wn)(dispatch),deleteMetric:(0,actions_completions._H)(dispatch),updateMetric:(0,actions_completions.q)(dispatch),computeCompletions:(0,actions_completions.sA)(dispatch)}}var visible_completions=(0,lib.connect)(mapStateToProps,mapDispatchToProps)(completions),InputGroup=__webpack_require__(16644),InputGroup_default=__webpack_require__.n(InputGroup),object_hash=__webpack_require__(40705),object_hash_default=__webpack_require__.n(object_hash),edit_lesson_metrics_defProp=Object.defineProperty,edit_lesson_metrics_defProps=Object.defineProperties,edit_lesson_metrics_getOwnPropDescs=Object.getOwnPropertyDescriptors,edit_lesson_metrics_getOwnPropSymbols=Object.getOwnPropertySymbols,edit_lesson_metrics_hasOwnProp=Object.prototype.hasOwnProperty,edit_lesson_metrics_propIsEnum=Object.prototype.propertyIsEnumerable,edit_lesson_metrics_defNormalProp=(obj,key,value)=>key in obj?edit_lesson_metrics_defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,edit_lesson_metrics_spreadValues=(a,b)=>{for(var prop in b||(b={}))edit_lesson_metrics_hasOwnProp.call(b,prop)&&edit_lesson_metrics_defNormalProp(a,prop,b[prop]);if(edit_lesson_metrics_getOwnPropSymbols)for(var prop of edit_lesson_metrics_getOwnPropSymbols(b))edit_lesson_metrics_propIsEnum.call(b,prop)&&edit_lesson_metrics_defNormalProp(a,prop,b[prop]);return a},edit_lesson_metrics_spreadProps=(a,b)=>edit_lesson_metrics_defProps(a,edit_lesson_metrics_getOwnPropDescs(b));const COVERAGE_OPTIONS_ARRAY=values_lib_default()(coverage_options_namespaceObject),SELECT_STYLES={menuPortal:base=>edit_lesson_metrics_spreadProps(edit_lesson_metrics_spreadValues({},base),{zIndex:9999})};function edit_lesson_metrics_selectOption(value,transform){return{label:transform?transform(value):value,value}}function analyzeLessonMetrics(name,lessons){const lessonInfo=lessons.reduce((acc,lesson2)=>{const namedMetric=lesson2.completions.find(metric=>metric.name===name);return namedMetric&&(acc.active[lesson2._id]=namedMetric,acc.rules.add(JSON.stringify(namedMetric.rule)),acc.rule=namedMetric.rule,acc.refs.add(namedMetric.ref),acc.ref=namedMetric.ref),acc},{rules:new Set,refs:new Set,active:{},rule:null,ref:null},lessons);return lessonInfo.rules.size>0?{hasSharedRule:lessonInfo.rules.size===1,hasSharedRef:lessonInfo.refs.size===1,activeLessons:lessonInfo.active,rule:lessonInfo.rule,ref:lessonInfo.ref}:{activeLessons:{},hasSharedRule:!0,hasSharedRef:!0,rule:null,ref:null}}function availableLessonMetrics(lessons){const allMetrics=lessons.reduce((acc,lesson2)=>(lesson2.completions.forEach(metric=>{acc.add(metric.name)}),acc),new Set);return Array.from(allMetrics).sort().map(metric=>({value:metric,label:metric}))}function EditLessonMetrics({name,preferredLesson,lessons,lessonRefs,componentsByLesson,computeCompletions,namespace:namespace2,saveLessonMetrics,allRules,tags,onSave}){const[chosenName,setChosenName]=(0,react.useState)(name),[hasSharedRule,setHasSharedRule]=(0,react.useState)(!1),[sharedRule,setSharedRule]=(0,react.useState)(null),[sharedRuleParameters,setSharedRuleParameters]=(0,react.useState)([]),[hasSharedRef,setHasSharedRef]=(0,react.useState)(!1),[sharedRef,setSharedRef]=(0,react.useState)(null),[activeLessons,setActiveLessons]=(0,react.useState)({}),[selectedLessons,setSelectedLessons]=(0,react.useState)({}),[currentHash,setCurrentHash]=(0,react.useState)(null),[isNewMetric,setIsNewMetric]=(0,react.useState)(!1),[showComputeModal,setShowComputeModal]=(0,react.useState)(!1),[showDeleteModal,setShowDeleteModal]=(0,react.useState)(!1),[hasSaved,setHasSaved]=(0,react.useState)(!1),availableMetrics=(0,react.useRef)(null),analyzedHash=(0,react.useRef)(null),analysisRef=(0,react.useRef)(null),incorporateAnalysis=(0,react.useCallback)(analysis=>{setHasSharedRule(analysis.hasSharedRule);let newSharedRule=null,newSharedRuleParameters=[];const isSharedRuleSet=analysis.hasSharedRule&&analysis.rule&&analysis.rule[0];isSharedRuleSet&&(newSharedRule=allRules[analysis.rule[0]],newSharedRuleParameters=analysis.rule.slice(1),setSharedRule(newSharedRule),setSharedRuleParameters(newSharedRuleParameters)),setHasSharedRef(analysis.hasSharedRef),analysis.hasSharedRef&&setSharedRef(analysis.ref);const lessonSpec={sharedRule:newSharedRule,sharedRuleParameters:newSharedRuleParameters,sharedRef:analysis.hasSharedRef?analysis.ref:null,activeLessons:edit_lesson_metrics_spreadValues({},analysis.activeLessons)},newSelectedLessons={};for(let i=0;i<lessons.length;i++){const lessonId=lessons[i]._id;lessonSpec.activeLessons[lessonId]?newSelectedLessons[lessonId]=!0:(newSelectedLessons[lessonId]=!1,lessonSpec.activeLessons[lessonId]={name:chosenName,rule:isSharedRuleSet?[lessonSpec.sharedRule.name,...lessonSpec.sharedRuleParameters]:null,ref:analysis.hasSharedRef?lessonSpec.sharedRef:null,coverage:["all"],level:"lesson",autoCompute:!1,visibleToStudents:!1,tagWeights:{_default_tag:1}})}lessonSpec.selectedLessons=newSelectedLessons,analyzedHash.current=object_hash_default()(lessonSpec),setCurrentHash(analyzedHash.current),setActiveLessons(lessonSpec.activeLessons),setSelectedLessons(newSelectedLessons)},[chosenName,lessons]);(0,react.useEffect)(()=>{availableMetrics.current=availableLessonMetrics(lessons)},[lessons]),(0,react.useEffect)(()=>{console.log("Analyze lesson metrics and incorporate analysis...");const analysis=analyzeLessonMetrics(chosenName,lessons);analysisRef.current=analysis,incorporateAnalysis(analysis)},[incorporateAnalysis,lessons,chosenName]);const resetHash=(0,react.useCallback)(()=>{const lessonSpec={sharedRule:hasSharedRule?sharedRule:null,sharedRuleParameters:hasSharedRule?sharedRuleParameters:[],sharedRef:hasSharedRef?sharedRef:null,activeLessons,selectedLessons};setCurrentHash(object_hash_default()(lessonSpec))},[hasSharedRule,sharedRule,sharedRuleParameters,hasSharedRef,sharedRef,activeLessons,selectedLessons]);(0,react.useEffect)(resetHash,[resetHash]);const handleSave=(0,react.useCallback)(()=>{const lessonMetrics=edit_lesson_metrics_spreadValues({},activeLessons);namespace2.lessons.forEach(lesson2=>{selectedLessons[lesson2._id]?lessonMetrics[lesson2._id]=edit_lesson_metrics_spreadValues(edit_lesson_metrics_spreadValues(edit_lesson_metrics_spreadValues({},lessonMetrics[lesson2._id]),hasSharedRef?{ref:sharedRef}:{}),hasSharedRule?{rule:[sharedRule.name,...sharedRuleParameters]}:{}):lessonMetrics[lesson2._id]=null});const body={namespaceID:namespace2._id,name:chosenName,lessonMetrics};onSave(body),saveLessonMetrics(body).then(res=>{console.log("Saved lesson metrics:",res.data),setHasSaved(!0),setIsNewMetric(!1),values_lib_default()(selectedLessons).every(x=>x===!1)&&(setChosenName(null),setCurrentHash(null),setSharedRef(null),setSharedRule(null)),resetHash()}).catch(err=>{})},[activeLessons,chosenName,namespace2,hasSharedRef,sharedRef,hasSharedRule,resetHash,selectedLessons,sharedRule,sharedRuleParameters,saveLessonMetrics,onSave]),{t}=(0,commonjs.$G)("completions"),lessonRefOptions=lessonRefs.map(ref=>({value:ref,label:ref})),allRulesOptions=values_lib_default()(allRules).map(rule=>({value:rule,label:rule.label})),sharedInputs=react.createElement(react.Fragment,null,react.createElement(Form_default().Group,{className:"mb-2",as:Row_default()},react.createElement(Col.default,{sm:3},react.createElement(Form_default().Check,{type:"checkbox",id:"shared-rule-checkbox",label:t("share-across-lessons"),onChange:event=>{setHasSharedRule(event.target.checked)},checked:hasSharedRule})),react.createElement(helpful_label.Z,{colWidth:3,name:t("common:rule"),description:sharedRule&&sharedRule.description,disabled:!hasSharedRule}),react.createElement(Col.default,{sm:6},react.createElement(react_select_cjs_prod.ZP,{isDisabled:!hasSharedRule,options:allRulesOptions,onChange:option=>{const newRule=option.value;setSharedRule(newRule),setSharedRuleParameters(newRule.parameters.map(x=>x.default||null))},value:sharedRule?{value:sharedRule,label:sharedRule.label}:null}))),hasSharedRule&&sharedRule&&sharedRule.parameters.length>0&&sharedRule.parameters.map((parameter,idx)=>react.createElement(Form_default().Group,{key:`param-${idx}`,className:"mb-2",as:Row_default()},react.createElement(Col.default,{sm:3}),react.createElement(helpful_label.Z,{className:"ps-5",colWidth:3,name:parameter.name,description:parameter.description}),react.createElement(Col.default,{sm:6},react.createElement(parameter_input,{key:`${sharedRule.name}-param-${idx}`,parameter,value:sharedRuleParameters[idx]!==void 0?sharedRuleParameters[idx]:parameter.default,onChange:value=>{console.log("Changed parameter value:",value);const newParams=sharedRuleParameters.slice();newParams[idx]=convertRuleParameter(value,parameter),setSharedRuleParameters(newParams)},t})))),react.createElement(Form_default().Group,{className:"mb-2",as:Row_default()},react.createElement(Col.default,{sm:3},react.createElement(Form_default().Check,{type:"checkbox",id:"shared-ref-checkbox",label:t("share-across-lessons"),onChange:event=>{setHasSharedRef(event.target.checked)},checked:hasSharedRef})),react.createElement(helpful_label.Z,{colWidth:3,name:t("component-metric"),description:t("component-metric-tooltip")}),react.createElement(Col.default,{sm:6},react.createElement(react_select_cjs.default,{isClearable:!0,isDisabled:!hasSharedRef,options:lessonRefOptions,onChange:option=>{setSharedRef(option?option.value:null)},value:sharedRef?{value:sharedRef,label:sharedRef}:null})))),lessonInputs=Array.from(lessons).sort(preferredLesson?(a,b)=>a.title===preferredLesson.title?-1:b.title===preferredLesson.title?1:a.title.localeCompare(b.title):(a,b)=>a.title.localeCompare(b.title)).map(x=>{const lessonIsActive=selectedLessons[x._id];let defaultRuleParameters,defaultRule,defaultRef;if(lessonIsActive)if(hasSharedRef&&sharedRef?defaultRef={value:sharedRef,label:sharedRef}:defaultRef=activeLessons[x._id].ref?{value:activeLessons[x._id].ref,label:activeLessons[x._id].ref}:null,hasSharedRule&&sharedRule)defaultRule={value:sharedRule,label:sharedRule.label},defaultRuleParameters=sharedRuleParameters;else if(activeLessons[x._id].rule){const activeRule=allRules[activeLessons[x._id].rule[0]];defaultRule={value:activeRule,label:activeRule.label},defaultRuleParameters=activeLessons[x._id].rule.slice(1)}else defaultRule=null,defaultRuleParameters=[];const activeLesson=activeLessons[x._id],coverage=(activeLesson==null?void 0:activeLesson.coverage)||["all"],coverageQualifier=coverage[0],coverageEntities=coverage.slice(1).map(edit_lesson_metrics_selectOption);return react.createElement("div",{key:`${x._id}-inputs`},react.createElement(Form_default().Check,{type:"switch",id:"custom-switch",label:x.title,key:x._id,onChange:event=>{const newSelected=edit_lesson_metrics_spreadValues({},selectedLessons);newSelected[x._id]=event.target.checked,setSelectedLessons(newSelected)},checked:lessonIsActive}),lessonIsActive&&react.createElement(react.Fragment,null,react.createElement(Form_default().Group,{className:"mb-2",as:Row_default()},react.createElement(Col.default,{sm:3}),react.createElement(helpful_label.Z,{colWidth:3,name:t("common:rule"),description:defaultRule.value.description}),react.createElement(Col.default,{sm:6},react.createElement(react_select_cjs_prod.ZP,{options:allRulesOptions,isDisabled:hasSharedRule,onChange:option=>{const newActive=edit_lesson_metrics_spreadValues({},activeLessons);newActive[x._id].rule=[option.value.name,...option.value.parameters.map(x2=>x2.default||null)],setActiveLessons(newActive)},value:defaultRule,menuPortalTarget:document.body,menuPlacement:"auto",styles:SELECT_STYLES}))),defaultRuleParameters.length>0&&defaultRuleParameters.map((value,idx)=>{const parameter=allRules[defaultRule.value.name].parameters[idx];return react.createElement(Form_default().Group,{key:`${x._id}-param-${idx}`,className:"mb-2",as:Row_default()},react.createElement(Col.default,{sm:3}),react.createElement(helpful_label.Z,{className:"ps-5",colWidth:3,name:parameter.name,description:parameter.description}),react.createElement(Col.default,{sm:6},react.createElement(parameter_input,{key:`${defaultRule.value.name}-param-${idx}`,parameter,disabled:hasSharedRule,value:defaultRuleParameters[idx],onChange:value2=>{const newActive=edit_lesson_metrics_spreadValues({},activeLessons);newActive[x._id].rule[idx+1]=convertRuleParameter(value2,parameter),setActiveLessons(newActive)},t})))}),react.createElement(Form_default().Group,{className:"mb-2",as:Row_default()},react.createElement(Col.default,{sm:3}),react.createElement(helpful_label.Z,{colWidth:3,name:t("component-metric"),description:t("component-metric-tooltip")}),react.createElement(Col.default,{sm:6},react.createElement(react_select_cjs.default,{isClearable:!0,isDisabled:hasSharedRef,options:lessonRefOptions,onChange:option=>{const newActive=edit_lesson_metrics_spreadValues({},activeLessons);newActive[x._id].ref=option?option.value:null,setActiveLessons(newActive)},value:defaultRef,menuPortalTarget:document.body,menuPlacement:"auto",styles:SELECT_STYLES}))),react.createElement(Form_default().Group,{className:"mb-2",as:Row_default()},react.createElement(Col.default,{sm:3}),react.createElement(helpful_label.Z,{colWidth:3,name:t("common:coverage"),description:t("coverage-tooltip")}),react.createElement(Col.default,{sm:6},react.createElement(react_select_cjs_prod.ZP,{options:COVERAGE_OPTIONS_ARRAY,onChange:option=>{const newActive=edit_lesson_metrics_spreadValues({},activeLessons);newActive[x._id].coverage[0]=option.value,setActiveLessons(newActive)},value:coverage_options_namespaceObject[coverageQualifier]}),coverageQualifier==="include"||coverageQualifier==="exclude"?react.createElement(react_select_cjs.default,{isMulti:!0,options:(componentsByLesson[x._id]||[]).map(y=>{const label=y.componentType?`${y.component} (type ${y.componentType})`:y.component;return{value:y.component,label}}),onChange:option=>{const newActive=edit_lesson_metrics_spreadValues({},activeLessons);newActive[x._id].coverage=[coverageQualifier,...option.map(x2=>x2.value)],setActiveLessons(newActive)},value:coverageEntities,placeholder:"Select component identifiers..."}):null)),react.createElement(Form_default().Group,{className:"mb-2",as:Row_default()},react.createElement(Col.default,{sm:3}),react.createElement(helpful_label.Z,{colWidth:3,name:t("tag-weights"),description:t("tag-weights-tooltip")}),react.createElement(Col.default,{sm:6},react.createElement(tag_weights_editor,{key:`${x._id}-tag-weights`,tagWeights:activeLessons[x._id].tagWeights||void 0,visibleTags:namespace2.componentTags,onUpdate:tagWeights=>{const newActive=edit_lesson_metrics_spreadValues({},activeLessons);newActive[x._id].tagWeights=tagWeights,setActiveLessons(newActive)}}))),react.createElement(Form_default().Group,{className:"mb-2",as:Row_default()},react.createElement(Col.default,{sm:6}),react.createElement(Col.default,{sm:3},react.createElement(Form_default().Check,{"aria-label":t("visible-to-student"),type:"checkbox",label:react.createElement(helpful_label.Z,{name:t("visible-to-student"),description:t("visible-to-student-tooltip"),placement:"top",as:"span"}),defaultChecked:activeLessons[x._id].visibleToStudent,onChange:event=>{const newActive=edit_lesson_metrics_spreadValues({},activeLessons);newActive[x._id].visibleToStudent=event.target.checked,setActiveLessons(newActive)}})),react.createElement(Col.default,{sm:3},react.createElement(Form_default().Check,{"aria-label":t("auto-compute"),type:"checkbox",label:react.createElement(helpful_label.Z,{name:t("auto-compute"),description:t("auto-compute-tooltip"),placement:"top",as:"span"}),defaultChecked:activeLessons[x._id].autoCompute,onChange:event=>{const newActive=edit_lesson_metrics_spreadValues({},activeLessons);newActive[x._id].autoCompute=event.target.checked,setActiveLessons(newActive)}})))))}),hasUnsavedChanges=currentHash!==analyzedHash.current,noLessonsSelected=Object.values(selectedLessons).every(x=>!x),saveBar=chosenName&&react.createElement(react.Fragment,null,react.createElement(Button_default(),{variant:hasUnsavedChanges?"warning":"secondary",disabled:!hasUnsavedChanges,onClick:()=>{analysisRef.current&&incorporateAnalysis(analysisRef.current)},className:"me-2 ms-auto w-25"},t("discard-unsaved-changes")),react.createElement(Button_default(),{variant:"success",className:"me-2",disabled:!hasUnsavedChanges||!sharedRef||!sharedRule||isNewMetric&&noLessonsSelected,onClick:noLessonsSelected?()=>setShowDeleteModal(!0):handleSave},t("common:save")),react.createElement(Button_default(),{variant:"info",disabled:hasUnsavedChanges||isNewMetric&&!hasSaved,onClick:()=>{setShowComputeModal(!0)}},t("common:compute")));return react.createElement(react.Fragment,null,react.createElement(Card_default(),{className:"pb-3"},react.createElement(Card_default().Body,null,react.createElement("p",null,t("lesson-metrics-description")),react.createElement("div",{className:"d-flex w-100 mb-2"},react.createElement("span",null,react.createElement(InputGroup_default(),{className:"mb-2"},react.createElement(InputGroup_default().Text,null,t("metric-name")),react.createElement(react_select_cjs.default,{name:"metric-name",placeholder:t("metric-name-placeholder"),onChange:value=>{value?setChosenName(value.value):(setChosenName(null),setSharedRule(null),setSharedRef(null))},onCreateOption:inputValue=>{console.log("Creating new lesson metric: ",inputValue),setChosenName(inputValue),setIsNewMetric(!0)},value:chosenName?{value:chosenName,label:chosenName}:null,isClearable:!0,isDisabled:name||currentHash&&currentHash!==analyzedHash.current,options:availableMetrics.current}))),saveBar),chosenName?react.createElement(react.Fragment,null,sharedInputs,react.createElement(Form_default().Check,{type:"switch",id:"all-lessons-switch",label:react.createElement("h3",null,"All Lessons"),onChange:event=>{const newSelectedLessons={};lessons.forEach(lesson2=>{newSelectedLessons[lesson2._id]=event.target.checked}),setSelectedLessons(newSelectedLessons)},checked:Object.values(selectedLessons).every(x=>x)}),react.createElement("div",{style:{maxHeight:"75vh",minHeight:"50vh",border:"solid 1px darkgray",overflowY:"auto",padding:4,overflowX:"hidden"}},lessonInputs)):null,react.createElement("div",{className:"d-flex w-100 mt-2",style:{height:46}},saveBar))),showComputeModal&&react.createElement(compute_modal.Z,{metric:namespace2.lessons.reduce((acc,lesson2)=>(selectedLessons[lesson2._id]&&acc.push(edit_lesson_metrics_spreadValues(edit_lesson_metrics_spreadValues(edit_lesson_metrics_spreadValues({},activeLessons[lesson2._id]),hasSharedRef?{ref:sharedRef}:{}),hasSharedRule?{rule:[sharedRule.name,...sharedRuleParameters]}:{})),acc),[]),show:showComputeModal,onHide:()=>setShowComputeModal(!1),cohorts:namespace2.cohorts,tags,entity:lessons.filter(x=>selectedLessons[x._id]),level:"lesson",onCompute:()=>setShowComputeModal(!1),computeCompletions}),showDeleteModal&&react.createElement(confirm_modal.Z,{title:t("delete-lesson-metric"),message:react.createElement("span",null,t("delete-lesson-metric-confirm",{name:chosenName})),close:()=>setShowDeleteModal(!1),show:showDeleteModal,onConfirm:()=>{handleSave(),setShowDeleteModal(!1)}}))}EditLessonMetrics.propTypes={allRules:prop_types_default().object.isRequired,componentsByLesson:prop_types_default().object,computeCompletions:prop_types_default().func.isRequired,lessonRefs:prop_types_default().arrayOf(prop_types_default().string).isRequired,lessons:prop_types_default().array.isRequired,name:prop_types_default().string,namespace:prop_types_default().object.isRequired,onSave:prop_types_default().func.isRequired,preferredLesson:prop_types_default().object,saveLessonMetrics:prop_types_default().func.isRequired,tags:prop_types_default().arrayOf(prop_types_default().string)},EditLessonMetrics.defaultProps={name:null,componentsByLesson:{},preferredLesson:null,tags:[]};var edit_lesson_metrics=EditLessonMetrics,check_url_path=__webpack_require__(48297),browser=__webpack_require__(11227),browser_default=__webpack_require__.n(browser),FormCheck=__webpack_require__(3692),FormCheck_default=__webpack_require__.n(FormCheck),react_dates=__webpack_require__(76141),moment=__webpack_require__(30381),moment_default=__webpack_require__.n(moment),is_email_address_lib=__webpack_require__(11738),is_email_address_lib_default=__webpack_require__.n(is_email_address_lib),_datepicker=__webpack_require__(71990),edit_cohort_modal_defProp=Object.defineProperty,edit_cohort_modal_defNormalProp=(obj,key,value)=>key in obj?edit_cohort_modal_defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__publicField=(obj,key,value)=>(edit_cohort_modal_defNormalProp(obj,typeof key!="symbol"?key+"":key,value),value);const debug=browser_default()("isle-dashboard:edit-cohort");function validateInputs({emails,title}){let invalid=!1;return emails.forEach(owner=>{is_email_address_lib_default()(owner)||(invalid=!0)}),invalid?!1:title.length>=4}class EditCohortModal extends react.Component{constructor(props){super(props),__publicField(this,"handleInputChange",event=>{const target=event.target,name=target.name;let value=target.value;this.setState({[name]:value},()=>{this.setState({disabled:!validateInputs({emails:this.state.members,title:this.state.title})})})}),__publicField(this,"handleUpdate",()=>{const updatedCohort={_id:this.props._id,emailFilter:this.state.emailFilter,startDate:this.state.startDate.startOf("day").toDate(),endDate:this.state.endDate.endOf("day").toDate(),members:this.state.members.join(","),title:this.state.title,private:this.state.private};this.props.onUpdate(updatedCohort),this.props.onHide()}),__publicField(this,"handleDelete",()=>{this.props.onDelete(this.props._id),this.closeDeleteModal(),this.props.onHide()}),__publicField(this,"closeDeleteModal",()=>{this.setState({showDeleteModal:!1})}),__publicField(this,"handleStudentChange",newValue=>{debug("Handle change of cohort members...");const members=is_array_lib_default()(newValue)?newValue.map(x=>x.value):[];this.setState({members,disabled:!validateInputs({emails:members,title:this.state.title})})}),this.state={disabled:!1,startDate:moment_default()(props.startDate),endDate:moment_default()(props.endDate),title:props.title,members:props.members.map(user=>user.email),showDeleteModal:!1,private:props.private,emailFilter:props.emailFilter}}render(){const{t}=this.props,content=react.createElement(Form_default(),{style:{padding:"10px"}},react.createElement(Row_default(),null,react.createElement(Col.default,{md:6},react.createElement(OverlayTrigger_default(),{placement:"right",overlay:react.createElement(Tooltip_default(),{id:"titleTooltip"},t("cohort-title-tooltip"))},react.createElement(FormGroup_default(),null,react.createElement(FormLabel_default(),null,t("common:title")),react.createElement(FormControl_default(),{name:"title",type:"text",value:this.state.title,onChange:this.handleInputChange})))),react.createElement(Col.default,{md:6},react.createElement(FormGroup_default(),null,react.createElement(FormLabel_default(),null,t("cohort-period")),react.createElement("br",null),react.createElement(react_dates.DateRangePicker,{startDateId:"panel_start_date_input",endDateId:"panel_end_date_input",startDate:this.state.startDate,endDate:this.state.endDate,onDatesChange:({startDate,endDate})=>this.setState({startDate,endDate}),focusedInput:this.state.focusedInput,onFocusChange:focusedInput=>this.setState({focusedInput})})))),react.createElement("hr",null),react.createElement(Row_default(),null,react.createElement(OverlayTrigger_default(),{placement:"right",overlay:react.createElement(Tooltip_default(),{id:"enrolledTooltip"},t("enrolled-tooltip"))},react.createElement(FormGroup_default(),{className:"cohort-modal-enrolled-group"},react.createElement(FormLabel_default(),null,t("enrolled-students")),react.createElement(text_select.Z,{placeholder:t("enter-emails"),defaultValue:this.state.members,onChange:this.handleStudentChange,styles:{control:()=>({width:"100%"})}})))),react.createElement("hr",null),react.createElement(Row_default(),null,react.createElement(OverlayTrigger_default(),{placement:"left",overlay:react.createElement(Tooltip_default(),{id:"preventTooltip"},t("prevent-tooltip"))},react.createElement(FormCheck_default(),{checked:this.state.private,onChange:event=>{this.setState({private:!this.state.private})},type:"checkbox",label:t("prevent-label")}))),react.createElement("hr",null),react.createElement(Row_default(),null,react.createElement(OverlayTrigger_default(),{placement:"right",overlay:react.createElement(Tooltip_default(),{id:"filterTooltip"},t("filter-tooltip"))},react.createElement(FormGroup_default(),null,react.createElement(FormLabel_default(),null,t("email-filter")),react.createElement(FormControl_default(),{style:{width:"25vw"},name:"emailFilter",type:"text",value:this.state.emailFilter,placeholder:t("filter-placeholder"),onChange:this.handleInputChange})))));return react.createElement(react.Fragment,null,react.createElement(Modal_default(),{size:"lg",show:this.props.show,onHide:this.props.onHide},react.createElement(Modal_default().Header,{closeButton:!0},react.createElement(Modal_default().Title,{as:"h3"},t("edit-cohort",{title:this.props.title}))),react.createElement(Modal_default().Body,null,content),react.createElement(Modal_default().Footer,null,react.createElement(ButtonGroup_default(),null,react.createElement(Button_default(),{onClick:()=>{this.setState({showDeleteModal:!0})},variant:"danger"},t("common:delete")),react.createElement(Button_default(),{onClick:this.props.onHide},t("common:cancel")),react.createElement(Button_default(),{variant:"success",disabled:this.state.disabled,onClick:this.handleUpdate},t("common:save"))))),react.createElement(confirm_modal.Z,{show:this.state.showDeleteModal,close:this.closeDeleteModal,message:t("delete-cohort"),title:`${t("delete")}?`,onConfirm:this.handleDelete}))}}EditCohortModal.propTypes={_id:prop_types_default().string.isRequired,emailFilter:prop_types_default().string.isRequired,endDate:prop_types_default().string,members:prop_types_default().array.isRequired,onDelete:prop_types_default().func,onHide:prop_types_default().func.isRequired,onUpdate:prop_types_default().func,private:prop_types_default().bool.isRequired,show:prop_types_default().bool.isRequired,startDate:prop_types_default().string.isRequired,t:prop_types_default().func.isRequired,title:prop_types_default().string.isRequired},EditCohortModal.defaultProps={endDate:null,onUpdate(){},onDelete(){}};var edit_cohort_modal=EditCohortModal;function create_cohort_modal_validateInputs(emails,title){let invalid=!1;return emails.forEach(owner=>{is_email_address_lib_default()(owner)||(invalid=!0)}),invalid?!1:title.length>=4}const CreateCohortModal=({close,onCreate,show,t})=>{const[title,setTitle]=(0,react.useState)(""),[emailFilter,setEmailFilter]=(0,react.useState)(""),[dates,setDates]=(0,react.useState)({start:moment_default()().startOf("day"),end:moment_default()().add(3,"months").endOf("day")}),[isPrivate,setIsPrivate]=(0,react.useState)(!1),[students,setStudents]=(0,react.useState)([]),[focusedInput,setFocusedInput]=(0,react.useState)(null),handleClose=()=>{close()},handleCreate=()=>{const cohort2={emailFilter,title,startDate:dates.start.startOf("day").toDate(),endDate:dates.end.endOf("day").toDate(),private:isPrivate,students:students.join(",")};onCreate(cohort2)},disabled=!create_cohort_modal_validateInputs(students,title),body=react.createElement(Form_default(),{style:{paddingLeft:20,paddingRight:20}},react.createElement(Row_default(),null,react.createElement(Col.default,{md:6},react.createElement(OverlayTrigger_default(),{placement:"right",overlay:react.createElement(Tooltip_default(),{id:"titleTooltip"},t("cohort-title-tooltip"))},react.createElement(FormGroup_default(),null,react.createElement(FormLabel_default(),null,t("common:title")),react.createElement(FormControl_default(),{name:"title",type:"text",placeholder:t("cohort-title-placeholder"),onChange:event=>setTitle(event.target.value)})))),react.createElement(Col.default,{md:6},react.createElement(FormGroup_default(),null,react.createElement(FormLabel_default(),null,t("cohort-period")),react.createElement(react_dates.DateRangePicker,{startDateId:"start_date_input",endDateId:"end_date_input",startDate:dates.start,endDate:dates.end,onDatesChange:({startDate,endDate})=>{setDates({start:startDate,end:endDate})},focusedInput,onFocusChange:setFocusedInput})))),react.createElement("hr",null),react.createElement(Row_default(),null,react.createElement(OverlayTrigger_default(),{placement:"right",overlay:react.createElement(Tooltip_default(),{id:"enrolledTooltip"},t("enrolled-tooltip"))},react.createElement(FormGroup_default(),{className:"cohort-modal-enrolled-group"},react.createElement(FormLabel_default(),null,t("enrolled-students")),react.createElement(text_select.Z,{placeholder:t("enter-emails"),onChange:newValue=>{const newStudents=is_array_lib_default()(newValue)?newValue.map(x=>x.value):[];setStudents(newStudents)},defaultValue:students,isClearable:!0,styles:{control:()=>({width:"100%"})}})))),react.createElement("hr",null),react.createElement(Row_default(),null,react.createElement(OverlayTrigger_default(),{placement:"left",overlay:react.createElement(Tooltip_default(),{id:"preventTooltip"},t("prevent-tooltip"))},react.createElement(FormCheck_default(),{checked:isPrivate,onChange:()=>{setIsPrivate(!isPrivate)},type:"checkbox",label:t("prevent-label")}))),react.createElement("hr",null),react.createElement(Row_default(),null,react.createElement(OverlayTrigger_default(),{placement:"right",overlay:react.createElement(Tooltip_default(),{id:"filterTooltip"},t("filter-tooltip"))},react.createElement(FormGroup_default(),null,react.createElement(FormLabel_default(),null,t("email-filter")),react.createElement(FormControl_default(),{style:{width:"25vw"},name:"emailFilter",type:"text",placeholder:t("filter-placeholder"),onChange:event=>setEmailFilter(event.target.value)})))));return react.createElement(Modal_default(),{size:"lg",show,onHide:handleClose},react.createElement(Modal_default().Header,{closeButton:!0},react.createElement(Modal_default().Title,{as:"h3"},t("create-new-cohort"))),react.createElement(Modal_default().Body,null,body),react.createElement(Modal_default().Footer,null,react.createElement(Button_default(),{onClick:handleClose},t("common:cancel")),react.createElement(Button_default(),{variant:"success",disabled,onClick:handleCreate},t("common:create"))))};CreateCohortModal.propTypes={close:prop_types_default().func,onCreate:prop_types_default().func,show:prop_types_default().bool,t:prop_types_default().func.isRequired},CreateCohortModal.defaultProps={close(){},onCreate(){},show:!1};var create_cohort_modal=CreateCohortModal,__async=(__this,__arguments,generator)=>new Promise((resolve,reject)=>{var fulfilled=value=>{try{step(generator.next(value))}catch(e){reject(e)}},rejected=value=>{try{step(generator.throw(value))}catch(e){reject(e)}},step=x=>x.done?resolve(x.value):Promise.resolve(x.value).then(fulfilled,rejected);step((generator=generator.apply(__this,__arguments)).next())});const ImportCourseModal=({namespaces,show,close,targetNamespace,copyNamespaceLessons,t})=>{const[selectedCourse,setSelectedCourse]=(0,react.useState)(null),handleSelection=obj=>{setSelectedCourse(obj.value)},handleImport=()=>__async(void 0,null,function*(){(yield copyNamespaceLessons({source:selectedCourse.title,target:targetNamespace.title}))instanceof Error||close()}),options=namespaces.map(x=>({label:x.title,value:x}));return react.createElement(Modal_default(),{size:"lg",show,onHide:close},react.createElement(Modal_default().Header,{closeButton:!0},react.createElement(Modal_default().Title,{as:"h3"},t("import-course"))),react.createElement(Modal_default().Body,null,react.createElement("p",null,t("import-course-description")),react.createElement(Form_default().Group,{controlId:"form-course-select"},react.createElement(Form_default().Label,null,t("select-namespace")),react.createElement(react_select_cjs_prod.ZP,{options,onChange:handleSelection}))),react.createElement(Modal_default().Footer,null,react.createElement(Button_default(),{onClick:close},t("common:cancel")),react.createElement(Button_default(),{variant:"success",disabled:!selectedCourse,onClick:handleImport},t("common:import"))))};ImportCourseModal.propTypes={close:prop_types_default().func.isRequired,copyNamespaceLessons:prop_types_default().func.isRequired,namespaces:prop_types_default().array,show:prop_types_default().bool,t:prop_types_default().func.isRequired,targetNamespace:prop_types_default().object.isRequired},ImportCourseModal.defaultProps={namespaces:[],show:!1};var import_course_modal=ImportCourseModal,edit_namespace_defProp=Object.defineProperty,edit_namespace_defProps=Object.defineProperties,edit_namespace_getOwnPropDescs=Object.getOwnPropertyDescriptors,edit_namespace_getOwnPropSymbols=Object.getOwnPropertySymbols,edit_namespace_hasOwnProp=Object.prototype.hasOwnProperty,edit_namespace_propIsEnum=Object.prototype.propertyIsEnumerable,edit_namespace_defNormalProp=(obj,key,value)=>key in obj?edit_namespace_defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,edit_namespace_spreadValues=(a,b)=>{for(var prop in b||(b={}))edit_namespace_hasOwnProp.call(b,prop)&&edit_namespace_defNormalProp(a,prop,b[prop]);if(edit_namespace_getOwnPropSymbols)for(var prop of edit_namespace_getOwnPropSymbols(b))edit_namespace_propIsEnum.call(b,prop)&&edit_namespace_defNormalProp(a,prop,b[prop]);return a},edit_namespace_spreadProps=(a,b)=>edit_namespace_defProps(a,edit_namespace_getOwnPropDescs(b)),edit_namespace_publicField=(obj,key,value)=>(edit_namespace_defNormalProp(obj,typeof key!="symbol"?key+"":key,value),value);class EditNamespace extends react.Component{constructor(props){super(props),edit_namespace_publicField(this,"handleInputChange",event=>{const target=event.target,name=target.name;let value=target.value;this.setState({[name]:value})}),edit_namespace_publicField(this,"handleUpdate",()=>{this.props.updateCurrentNamespace({_id:this.props.namespace._id,description:this.state.description,title:this.state.title,tag:this.state.tag,enableTicketing:this.state.enableTicketing,owners:this.state.owners})}),edit_namespace_publicField(this,"handleDelete",()=>{this.props.deleteCurrentNamespace(this.props.namespace._id)}),edit_namespace_publicField(this,"close",()=>{this.setState({showModal:!1})}),edit_namespace_publicField(this,"closeDeleteModal",()=>{this.setState({showDeleteModal:!1})}),edit_namespace_publicField(this,"closeCreateCohortModal",()=>{this.setState({showCreateCohortModal:!1})}),edit_namespace_publicField(this,"closeImportModal",()=>{this.setState({showImportModal:!1})}),edit_namespace_publicField(this,"createCohort",cohort2=>{cohort2.namespaceID=this.props.namespace._id,this.props.createCohort(cohort2,this.props.namespace._id),this.closeCreateCohortModal()}),edit_namespace_publicField(this,"deleteCohort",cohortID=>{this.props.deleteCohort(cohortID,this.props.namespace._id)}),edit_namespace_publicField(this,"updateCohort",cohort2=>{this.props.updateCohort(cohort2,this.props.namespace._id)}),edit_namespace_publicField(this,"handleOwnerChange",newValue=>{if(!newValue)return this.setState({owners:[]});const owners2=newValue.map(x=>trim_lib_default()(x.value));this.setState({owners:owners2})}),edit_namespace_publicField(this,"closeEditCohortModal",()=>{this.setState({selectedCohort:null,showEditCohortModal:!1})}),edit_namespace_publicField(this,"cohortModalFactory",idx=>()=>{this.setState({selectedCohort:this.props.cohorts[idx],showEditCohortModal:!0})});let{title,description,owners,enableTicketing,tag}=this.props.namespace;is_array_lib_default()(owners)&&(owners=owners.map(owner=>owner.email)),this.state={title,description,owners,enableTicketing,showDeleteModal:!1,showImportModal:!1,showCreateCohortModal:!1,showEditCohortModal:!1,selectedCohort:null,tag,lessonRefs:[]}}componentDidMount(){axios_default().post(`${server.ZP}/completion_refs`,{target:"lesson",entities:this.props.namespace.lessons.map(x=>x._id)}).then(response=>{this.setState({lessonRefs:response.data})}).catch(err=>{console.log("Error fetching completion refs:",err)})}renderModals(){const{t}=this.props;return react.createElement(react.Fragment,null,react.createElement(message_modal,{show:this.state.showModal,close:this.close,message:this.state.message,successful:this.state.successful,title:t("update-course")}),react.createElement(confirm_modal.Z,{show:this.state.showDeleteModal,close:this.closeDeleteModal,message:t("delete-course"),title:`${t("delete")}?`,onConfirm:this.handleDelete}),this.state.showCreateCohortModal?react.createElement(create_cohort_modal,{show:this.state.showCreateCohortModal,close:this.closeCreateCohortModal,onCreate:this.createCohort,t:this.props.t}):null,this.state.showImportModal?react.createElement(import_course_modal,{show:this.state.showImportModal,close:this.closeImportModal,namespaces:this.props.user.ownedNamespaces,targetNamespace:this.props.namespace,copyNamespaceLessons:this.props.copyNamespaceLessons,t:this.props.t}):null,this.state.showEditCohortModal?react.createElement(edit_cohort_modal,edit_namespace_spreadProps(edit_namespace_spreadValues({show:this.state.showEditCohortModal},this.state.selectedCohort),{onDelete:this.deleteCohort,onHide:this.closeEditCohortModal,onUpdate:this.updateCohort,t:this.props.t})):null)}renderCohortList(){const{t}=this.props;return react.createElement(ListGroup_default(),null,this.props.cohorts.map((cohort2,idx)=>react.createElement(ListGroupItem_default(),{variant:"light",eventKey:idx,key:idx,style:{backgroundColor:"white"}},react.createElement("label",null,cohort2.title),react.createElement("span",{style:{marginLeft:5,color:"black"}},"(",t("no-students"),":"),react.createElement(Badge_default(),{bg:"primary"},cohort2.members.length),react.createElement("span",{style:{color:"black"}},")"),react.createElement(Button_default(),{size:"sm",onClick:this.cohortModalFactory(idx),style:{float:"right"}},t("common:edit")))))}render(){const{t}=this.props;if(!this.props.namespace._id)return react.createElement(Container_default(),{className:"edit-namespace-container"},react.createElement(Alert_default(),{variant:"danger"},t("common:no-course-selected")));const validTitle=(0,create_namespace.uq)(this.state.title),invalidTitleChars=(0,check_url_path.Z)(this.state.title),validDescription=(0,create_namespace.O5)(this.state.description),validOwners=(0,create_namespace.OT)(this.state.owners);return react.createElement(Container_default(),{className:"edit-namespace-container"},react.createElement(Row_default(),null,react.createElement(Col.default,{sm:9},react.createElement(Card_default(),null,react.createElement(Tabs_default(),{defaultActiveKey:"manage-cohorts"},react.createElement(Tab_default(),{eventKey:"manage-cohorts",title:react.createElement("h3",null,t("manage-cohorts")),style:{padding:12}},this.renderCohortList(),react.createElement(Button_default(),{size:"small",variant:"success",style:{marginTop:10,background:"#3c763d"},onClick:()=>{this.setState({showCreateCohortModal:!0})}},t("create-cohort"))),react.createElement(Tab_default(),{eventKey:"assessments",title:react.createElement("h3",null,t("common:assessments"))},react.createElement(Tabs_default(),{variant:"pills",defaultActiveKey:"namespace-completion-metrics"},react.createElement(Tab_default(),{eventKey:"namespace-completion-metrics",title:t("common:course-wide")},react.createElement(visible_completions,{entity:this.props.namespace,level:"namespace",cohorts:this.props.cohorts,lessonRefs:this.state.lessonRefs})),react.createElement(Tab_default(),{eventKey:"lesson-completion-metrics",title:t("lessons")},react.createElement(edit_lesson_metrics,{lessonRefs:this.state.lessonRefs,lessons:this.props.namespace.lessons,namespace:this.props.namespace,onSave:()=>{},saveLessonMetrics:this.props.saveLessonMetrics,componentsByLesson:this.props.namespace.componentsByLesson,computeCompletions:this.props.computeCompletions,tags:this.props.namespace.tags,allRules:this.props.settings.completionRules})))),react.createElement(Tab_default(),{eventKey:"edit-course",title:react.createElement("h3",null,t("edit-course")),style:{padding:12}},react.createElement(Form_default(),{style:{padding:"20px"},className:"d-grid gap-3"},react.createElement(OverlayTrigger_default(),{placement:"right",overlay:react.createElement(Tooltip_default(),{id:"ownerTooltip"},t("owner-tooltip"))},react.createElement(FormGroup_default(),null,react.createElement(FormLabel_default(),{htmlFor:"owners-text-select"},t("common:owners")),react.createElement(text_select.Z,{id:"owners-text-select",placeholder:t("enter-emails"),onChange:this.handleOwnerChange,defaultValue:this.state.owners,isInvalid:!(0,create_namespace.OT)(this.state.owners)}),react.createElement(FormControl_default().Feedback,{type:"invalid"},t("invalid-owners")))),react.createElement(OverlayTrigger_default(),{placement:"right",overlay:react.createElement(Tooltip_default(),{id:"courseTooltip"},t("accessible-at"),react.createElement("code",null,server.ZP+"/<course>/<lesson>"))},react.createElement(FormGroup_default(),{controlId:"form-course"},react.createElement(FormLabel_default(),null,t("course-identifier")),react.createElement(FormControl_default(),{name:"title",type:"text",value:this.state.title,onChange:this.handleInputChange,isInvalid:!validTitle}),react.createElement(FormControl_default().Feedback,{type:"invalid"},invalidTitleChars?"Course identifier contains invalid character(s): "+invalidTitleChars[0]:"Course identifier must be at least three characters long and should not contain any spaces."))),react.createElement(OverlayTrigger_default(),{placement:"right",overlay:react.createElement(Tooltip_default(),{id:"titleTooltip"},t("title-tooltip"))},react.createElement(FormGroup_default(),{controlId:"form-description"},react.createElement(FormLabel_default(),null,t("title-description")),react.createElement(FormControl_default(),{name:"description",type:"text",value:this.state.description,onChange:this.handleInputChange,isInvalid:!validDescription}),react.createElement(FormControl_default().Feedback,{type:"invalid"},t("invalid-description")))),react.createElement(Form_default().Check,{"aria-label":t("enable-ticketing"),type:"checkbox",label:t("enable-ticketing"),defaultChecked:this.state.enableTicketing,onChange:event=>{this.setState({enableTicketing:event.target.checked})}}),react.createElement(OverlayTrigger_default(),{placement:"right",overlay:react.createElement(Tooltip_default(),{id:"tagTooltip"},t("tag-tooltip"))},react.createElement(FormGroup_default(),{controlId:"form-tag"},react.createElement(FormLabel_default(),null,t("tag-description")),react.createElement(FormControl_default(),{name:"tag",type:"text",value:this.state.tag,onChange:this.handleInputChange})))),react.createElement(Button_default(),{type:"submit",disabled:!validOwners||!validTitle||!validDescription,onClick:this.handleUpdate},t("common:update")),this.renderModals()),react.createElement(Tab_default(),{eventKey:"permissions",title:react.createElement("h3",null,t("common:permissions")),disabled:!0})))),react.createElement(Col.default,{sm:3},react.createElement(Card_default(),null,react.createElement(Card_default().Body,null,react.createElement(ButtonGroup_default(),{vertical:!0},react.createElement(Button_default(),{onClick:()=>{this.setState({showImportModal:!0})},variant:"outline-danger"},t("import-existing-course")),react.createElement(Button_default(),{onClick:()=>{this.setState({showDeleteModal:!0})},variant:"outline-danger"},t("delete-namespace"))))))))}}EditNamespace.propTypes={addNotification:prop_types_default().func.isRequired,cohorts:prop_types_default().array,computeCompletions:prop_types_default().func.isRequired,copyNamespaceLessons:prop_types_default().func.isRequired,createCohort:prop_types_default().func.isRequired,deleteCohort:prop_types_default().func.isRequired,deleteCurrentNamespace:prop_types_default().func.isRequired,namespace:prop_types_default().object.isRequired,saveLessonMetrics:prop_types_default().func.isRequired,settings:prop_types_default().object.isRequired,t:prop_types_default().func.isRequired,updateCohort:prop_types_default().func.isRequired,updateCurrentNamespace:prop_types_default().func.isRequired,user:prop_types_default().object.isRequired},EditNamespace.defaultProps={cohorts:[]};var edit_namespace=(0,commonjs.Zh)(["namespace","common"])(EditNamespace),cohort=__webpack_require__(72371),namespace=__webpack_require__(23218),lesson=__webpack_require__(36189);function visible_edit_namespace_mapStateToProps(state){return{user:state.user,namespace:state.namespace,cohorts:state.namespace.cohorts,settings:state.settings}}function visible_edit_namespace_mapDispatchToProps(dispatch){return{addNotification:(0,notification.pP)(dispatch),createCohort:(0,cohort.CA)(dispatch),deleteCohort:(0,cohort.p6)(dispatch),updateCohort:(0,cohort.nm)(dispatch),deleteCurrentNamespace:(0,namespace.kC)(dispatch),updateCurrentNamespace:(0,namespace.J3)(dispatch),copyNamespaceLessons:(0,lesson.Ao)(dispatch),computeCompletions:(0,actions_completions.sA)(dispatch),saveLessonMetrics:(0,actions_completions.Uw)(dispatch)}}var visible_edit_namespace=(0,lib.connect)(visible_edit_namespace_mapStateToProps,visible_edit_namespace_mapDispatchToProps)(edit_namespace)}}]);

//# sourceMappingURL=1421.e7ffd233.chunk.js.map