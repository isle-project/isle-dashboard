{"version":3,"sources":["../node_modules/@isle-project/components/models/multiple-linear-regression/main.js","../node_modules/ml-regression-multivariate-linear/lib/index.js"],"names":["x","y","intercept","quantitative","data"],"mappings":"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","file":"static/js/MultipleLinearRegression.10a7858c.chunk.js","sourcesContent":["// MODULES //\n\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { withTranslation } from 'react-i18next';\nimport MLR from 'ml-regression-multivariate-linear';\nimport Alert from 'react-bootstrap/Alert';\nimport Button from 'react-bootstrap/Button';\nimport pow from '@stdlib/math/base/special/pow';\nimport round from '@stdlib/math/base/special/round';\nimport fCDF from '@stdlib/stats/base/dists/f/cdf';\nimport contains from '@stdlib/assert/contains';\nimport isArray from '@stdlib/assert/is-array';\nimport abs from '@stdlib/math/base/special/abs';\nimport tCDF from '@stdlib/stats/base/dists/t/cdf';\nimport Table from '@isle-project/components/table';\nimport Tooltip from '@isle-project/components/tooltip';\nimport Plotly from '@isle-project/components/plotly';\nimport Histogram from '@isle-project/components/plots/histogram';\nimport { generateQQPlotConfig } from '@isle-project/components/plots/qqplot';\nimport subtract from '@isle-project/utils/subtract';\nimport mean from '@isle-project/utils/statistic/mean';\nimport extractCategoriesFromValues from '@isle-project/utils/extract-categories-from-values';\nimport { withPropCheck } from '@isle-project/utils/prop-check';\nimport { Factor } from '@isle-project/utils/factor-variable';\nimport isNonMissingNumber from '@isle-project/utils/is-non-missing-number';\nimport isMissing from '@isle-project/utils/is-missing';\n\n\n// VARIABLES //\n\nlet COUNTER = 0;\nconst TSTAT = 't';\nconst DF = 'df';\nconst R2 = 'R²:';\n\n\n// FUNCTIONS //\n\nfunction designMatrix( x, y, data, quantitative, intercept ) {\n\tif ( !isArray( x ) ) {\n\t\tx = [ x ];\n\t}\n\tconst matrix = [];\n\tconst predictors = [];\n\tconst hash = {};\n\tconst nobs = data[ x[ 0 ] ].length;\n\tfor ( let j = 0; j < x.length; j++ ) {\n\t\tconst values = data[ x[ j ] ];\n\t\tif ( contains( quantitative, x[ j ] ) ) {\n\t\t\tpredictors.push( x[ j ] );\n\t\t} else {\n\t\t\tconst categories = extractCategoriesFromValues( values, x[ j ] );\n\t\t\tfor ( let k = intercept ? 1 : 0; k < categories.length; k++ ) {\n\t\t\t\tpredictors.push( `${x[ j ]}_${categories[ k ]}` );\n\t\t\t}\n\t\t\thash[ x[ j ] ] = categories;\n\t\t}\n\t}\n\tfor ( let i = 0; i < nobs; i++ ) {\n\t\tconst row = [];\n\t\tfor ( let j = 0; j < x.length; j++ ) {\n\t\t\tconst values = data[ x[ j ] ];\n\t\t\tif ( contains( quantitative, x[ j ] ) ) {\n\t\t\t\trow.push( values[ i ] );\n\t\t\t} else {\n\t\t\t\tconst categories = hash[ x[ j ] ];\n\t\t\t\tconst val = values[ i ];\n\t\t\t\tfor ( let k = intercept ? 1 : 0; k < categories.length; k++ ) {\n\t\t\t\t\trow.push( ( val === categories[ k ] ) ? 1 : 0 );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tmatrix.push( row );\n\t}\n\tconst yvalues = data[ y ].map( x => [ x ]);\n\treturn { matrix, predictors, yvalues, nobs };\n}\n\nfunction designMatrixMissing( x, y, data, quantitative, intercept ) {\n\tif ( !isArray( x ) ) {\n\t\tx = [ x ];\n\t}\n\tconst matrix = [];\n\tconst predictors = [];\n\tconst hash = {};\n\tconst yvalues = [];\n\tfor ( let j = 0; j < x.length; j++ ) {\n\t\tconst values = data[ x[ j ] ];\n\t\tif ( contains( quantitative, x[ j ] ) ) {\n\t\t\tpredictors.push( x[ j ] );\n\t\t} else {\n\t\t\tconst categories = extractCategoriesFromValues( values, x[ j ] );\n\t\t\tfor ( let k = intercept ? 1 : 0; k < categories.length; k++ ) {\n\t\t\t\tpredictors.push( `${x[ j ]}_${categories[ k ]}` );\n\t\t\t}\n\t\t\thash[ x[ j ] ] = categories;\n\t\t}\n\t}\n\tfor ( let i = 0; i < data[ x[ 0 ] ].length; i++ ) {\n\t\tconst row = [];\n\t\tlet missing = false;\n\t\tfor ( let j = 0; j < x.length; j++ ) {\n\t\t\tconst values = data[ x[ j ] ];\n\t\t\tif ( contains( quantitative, x[ j ] ) ) {\n\t\t\t\tif ( isNonMissingNumber( values[ i ] ) ) {\n\t\t\t\t\trow.push( values[ i ] );\n\t\t\t\t} else {\n\t\t\t\t\tmissing = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst val = values[ i ];\n\t\t\t\tif ( isMissing( val ) ) {\n\t\t\t\t\tmissing = true;\n\t\t\t\t\tbreak;\n\t\t\t\t} else {\n\t\t\t\t\tconst categories = hash[ x[ j ] ];\n\t\t\t\t\tfor ( let k = intercept ? 1 : 0; k < categories.length; k++ ) {\n\t\t\t\t\t\trow.push( ( val === categories[ k ] ) ? 1 : 0 );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tconst yval = data[ y ][ i ];\n\t\tif ( !missing && isNonMissingNumber( yval ) ) {\n\t\t\tmatrix.push( row );\n\t\t\tyvalues.push( [ yval ] );\n\t\t}\n\t}\n\tconst nobs = yvalues.length;\n\treturn { matrix, predictors, yvalues, nobs };\n}\n\nconst summaryTable = ( y, x, nobs, result, t ) => {\n\tconst cdf = tCDF.factory( nobs - x.length - 1 );\n\treturn (\n\t\t<Table bordered size=\"sm\">\n\t\t\t<thead>\n\t\t\t\t<tr>\n\t\t\t\t\t<th>{t('predictor')}</th>\n\t\t\t\t\t<th>{t('coefficient')}</th>\n\t\t\t\t\t<th>{t('std-error')}</th>\n\t\t\t\t\t<th>{TSTAT}</th>\n\t\t\t\t\t<th>{t('p-value')}</th>\n\t\t\t\t</tr>\n\t\t\t</thead>\n\t\t\t<tbody>\n\t\t\t\t{ result.intercept ? <tr>\n\t\t\t\t\t<th>{t('intercept')}</th>\n\t\t\t\t\t<td>{result.weights[ x.length ][ 0 ].toFixed( 6 )}</td>\n\t\t\t\t\t<td>{result.stdErrors[ x.length ].toFixed( 4 )}</td>\n\t\t\t\t\t<td>{result.tStats[ x.length ].toFixed( 4 )}</td>\n\t\t\t\t\t<td>{2.0 * (1.0-cdf( abs( result.tStats[ x.length ] ) ) ).toFixed( 4 )}</td>\n\t\t\t\t</tr> : null }\n\t\t\t\t{x.map( ( name, idx ) => {\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<tr key={idx} >\n\t\t\t\t\t\t\t<th>{name}</th>\n\t\t\t\t\t\t\t<td>{result.weights[ idx ][ 0 ].toFixed( 6 )}</td>\n\t\t\t\t\t\t\t<td>{result.stdErrors[ idx ].toFixed( 4 )}</td>\n\t\t\t\t\t\t\t<td>{result.tStats[ idx ].toFixed( 4 )}</td>\n\t\t\t\t\t\t\t<td>{2.0 * (1.0-cdf( abs( result.tStats[ idx ] ) ) ).toFixed( 4 )}</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t);\n\t\t\t\t})}\n\t\t\t</tbody>\n\t\t</Table>\n\t);\n};\n\nconst fitModel = ({ x, y, intercept, omitMissing, data, quantitative }) => {\n\tconst out = {};\n\ttry {\n\t\tconst dMatrix = omitMissing ? designMatrixMissing : designMatrix;\n\t\tconst { matrix, predictors, yvalues, nobs } = dMatrix( x, y, data, quantitative, intercept );\n\t\tout.result = new MLR( matrix, yvalues, {\n\t\t\tintercept\n\t\t});\n\t\tconst yhat = out.result.predict( matrix ).map( v => v[ 0 ] );\n\t\tout.yhat = yhat;\n\t\tconst avgFitted = mean( yhat );\n\t\tlet mss = 0;\n\t\tfor ( let i = 0; i < yhat.length; i++ ) {\n\t\t\tmss += pow( yhat[ i ] - avgFitted, 2 );\n\t\t}\n\t\tconst resid = subtract( yvalues, yhat );\n\t\tlet rss = 0;\n\t\tfor ( let i = 0; i < resid.length; i++ ) {\n\t\t\trss += pow( resid[ i ], 2 );\n\t\t}\n\t\tconst p = predictors.length;\n\t\tout.resid = resid;\n\t\tout.rSquared = mss / ( mss + rss );\n\t\tout.adjRSquared = 1 - ( 1 - out.rSquared ) * ( nobs - 1 ) / ( nobs - p - 1 );\n\t\tout.fScore = ( mss / p ) / ( rss / ( nobs - p - 1 ) );\n\t\tout.p = p;\n\t\tout.nobs = nobs;\n\t\tout.predictors = predictors;\n\t\treturn out;\n\t} catch ( _ ) {\n\t\treturn out;\n\t}\n};\n\n\n// MAIN //\n\n/**\n* Multiple linear regression.\n*\n* @property {Object} data - object of value arrays\n* @property {string} y - outcome variable\n* @property {Array<string>} x - one or more predictor variables\n* @property {(string|Factor|Array<(string|Factor)>)} quantitative - array of variables in `data` that are `quantitative`\n* @property {boolean} omitMissing - controls whether to omit missing values\n* @property {boolean} intercept - controls whether to fit a model with an intercept term\n* @property {Function} onDiagnostics - callback invoked with diagnostic plots\n* @property {Function} onPredict - callback invoked with a predict function to make predictions for new data\n*/\nclass MultipleLinearRegression extends Component {\n\tconstructor( props ) {\n\t\tsuper( props );\n\n\t\tCOUNTER += 1;\n\t\tconst { x, y, intercept, omitMissing, data, quantitative } = props;\n\t\tthis.state = {\n\t\t\t...fitModel({ x, y, intercept, omitMissing, data, quantitative }),\n\t\t\t...props\n\t\t};\n\t}\n\n\tstatic getDerivedStateFromProps( nextProps, prevState ) {\n\t\tif (\n\t\t\tnextProps.data !== prevState.data ||\n\t\t\tnextProps.quantitative !== prevState.quantitative ||\n\t\t\tnextProps.x !== prevState.x ||\n\t\t\tnextProps.y !== prevState.y ||\n\t\t\tnextProps.omitMissing !== prevState.omitMissing ||\n\t\t\tnextProps.intercept !== prevState.intercept\n\t\t) {\n\t\t\tconst { x, y, intercept, omitMissing, data, quantitative } = nextProps;\n\t\t\tconst newState = {\n\t\t\t\t...fitModel({ x, y, intercept, omitMissing, data, quantitative }),\n\t\t\t\t...nextProps\n\t\t\t};\n\t\t\treturn newState;\n\t\t}\n\t\treturn null;\n\t}\n\n\thandleDiagnostics = () => {\n\t\tconst { x, y, intercept, t } = this.props;\n\t\tconst qqPlot = <Plotly\n\t\t\tdraggable\n\t\t\teditable fit\n\t\t\t{...generateQQPlotConfig( this.state.resid, 'residuals' )}\n\t\t\tmeta={{ type: 'qqplot of regression residuals', x, y, intercept }}\n\t\t/>;\n\t\tconst hist = <Histogram\n\t\t\tdata={{ 'Residuals': this.state.resid }}\n\t\t\tvariable=\"Residuals\"\n\t\t\ttitle={t('plotly:histogram-title', { x: 'Residuals' })}\n\t\t/>;\n\t\tconst residualPlot = <Plotly\n\t\t\tdraggable editable fit\n\t\t\tdata={[\n\t\t\t\t{\n\t\t\t\t\tx: this.state.yhat,\n\t\t\t\t\ty: this.state.resid,\n\t\t\t\t\tmode: 'markers',\n\t\t\t\t\ttype: this.state.yhat.length > 2000 ? 'scattergl' : 'scatter'\n\t\t\t\t}\n\t\t\t]}\n\t\t\tlayout={{\n\t\t\t\txaxis: {\n\t\t\t\t\ttitle: t('fitted-values')\n\t\t\t\t},\n\t\t\t\tyaxis: {\n\t\t\t\t\ttitle: t('residuals')\n\t\t\t\t},\n\t\t\t\ttitle: t('residuals-vs-fitted')\n\t\t\t}}\n\t\t\tmeta={{ type: 'regression residuals vs. fitted', x, y, intercept }}\n\t\t/>;\n\t\tthis.props.onDiagnostics([ qqPlot, hist, residualPlot ]);\n\t};\n\n\thandlePredict = () => {\n\t\tconst { quantitative, intercept } = this.props;\n\t\tconst predict = ( data ) => {\n\t\t\tconst { x, y } = this.props;\n\t\t\tconst { matrix } = designMatrix( x, y, data, quantitative, intercept );\n\t\t\tconst fitted = this.state.result.predict( matrix ).map( v => v[ 0 ] );\n\t\t\tconst residuals = subtract( data[ y ], fitted );\n\t\t\treturn { fitted, residuals };\n\t\t};\n\t\tthis.props.onPredict( predict, COUNTER );\n\t};\n\n\trender() {\n\t\tconst { y, predictors, nobs, result, adjRSquared, p, fScore, rSquared } = this.state;\n\t\tconst { t } = this.props;\n\t\tif ( !result ) {\n\t\t\treturn <Alert variant=\"danger\">{this.props.t('missing-attributes')}</Alert>;\n\t\t}\n\t\treturn (\n\t\t\t<div style={{ overflowX: 'auto', width: '100%' }}>\n\t\t\t\t<span className=\"title\" >{t('multiple-regression-title', { y, counter: COUNTER })}</span>\n\t\t\t\t{summaryTable( y, predictors, nobs, result, t )}\n\t\t\t\t<p>{t('residual-standard-error')}: {round( result.stdError )}</p>\n\t\t\t\t<p>{R2} {rSquared.toFixed( 6 )}, {t('adjusted')} {R2} {adjRSquared.toFixed( 6 )}</p>\n\t\t\t\t<p>{t('f-statistic')}: {fScore.toFixed( 3 )} (${DF}: {nobs-p-1}, {p}), {t('p-value')}: {(1.0 - fCDF( fScore, p, nobs-p-1 )).toFixed( 6 )}</p>\n\t\t\t\t{ this.props.onPredict ? <Tooltip placement=\"top\" tooltip={t('use-model-to-predict-tooltip')} >\n\t\t\t\t\t<Button variant=\"secondary\" size=\"sm\" onClick={this.handlePredict}>{t('use-model-to-predict')}</Button>\n\t\t\t\t</Tooltip> : null }\n\t\t\t\t{ this.props.onDiagnostics ? <Button variant=\"secondary\" size=\"sm\" style={{ marginLeft: 6 }} onClick={this.handleDiagnostics} >\n\t\t\t\t\t{t('model-diagnostics')}\n\t\t\t\t</Button> : null }\n\t\t\t</div>\n\t\t);\n\t}\n}\n\n\n// PROPERTIES //\n\nMultipleLinearRegression.defaultProps = {\n\tomitMissing: false,\n\tintercept: true,\n\tonDiagnostics: null,\n\tonPredict: null\n};\n\nMultipleLinearRegression.propTypes = {\n\tdata: PropTypes.object.isRequired,\n\ty: PropTypes.string.isRequired,\n\tx: PropTypes.oneOfType([\n\t\tPropTypes.arrayOf( PropTypes.oneOfType([ PropTypes.string, PropTypes.instanceOf( Factor ) ]) ),\n\t\tPropTypes.string,\n\t\tPropTypes.instanceOf( Factor )\n\t]).isRequired,\n\tquantitative: PropTypes.arrayOf( PropTypes.string ).isRequired,\n\tomitMissing: PropTypes.bool,\n\tintercept: PropTypes.bool,\n\tonDiagnostics: PropTypes.func,\n\tonPredict: PropTypes.func\n};\n\n\n// EXPORTS //\n\nexport default withTranslation( [ 'models', 'plotly' ] )( withPropCheck( MultipleLinearRegression ) );\n","'use strict';\n\nvar mlMatrix = require('ml-matrix');\n\nclass MultivariateLinearRegression {\n  constructor(x, y, options = {}) {\n    const { intercept = true, statistics = true } = options;\n    this.statistics = statistics;\n    if (x === true) {\n      this.weights = y.weights;\n      this.inputs = y.inputs;\n      this.outputs = y.outputs;\n      this.intercept = y.intercept;\n    } else {\n      x = new mlMatrix.Matrix(x);\n      y = new mlMatrix.Matrix(y);\n      if (intercept) {\n        x.addColumn(new Array(x.rows).fill(1));\n      }\n      let xt = x.transpose();\n      const xx = xt.mmul(x);\n      const xy = xt.mmul(y);\n      const invxx = new mlMatrix.SVD(xx).inverse();\n      const beta = xy.transpose().mmul(invxx).transpose();\n      this.weights = beta.to2DArray();\n      this.inputs = x.columns;\n      this.outputs = y.columns;\n      if (intercept) this.inputs--;\n      this.intercept = intercept;\n      if (statistics) {\n        /*\n         * Let's add some basic statistics about the beta's to be able to interpret them.\n         * source: http://dept.stat.lsa.umich.edu/~kshedden/Courses/Stat401/Notes/401-multreg.pdf\n         * validated against Excel Regression AddIn\n         * test: \"datamining statistics test\"\n         */\n        const fittedValues = x.mmul(beta);\n        const residuals = y.clone().addM(fittedValues.neg());\n        const variance =\n          residuals\n            .to2DArray()\n            .map((ri) => Math.pow(ri[0], 2))\n            .reduce((a, b) => a + b) /\n          (y.rows - x.columns);\n        this.stdError = Math.sqrt(variance);\n        this.stdErrorMatrix = mlMatrix.pseudoInverse(xx).mul(variance);\n        this.stdErrors = this.stdErrorMatrix\n          .diagonal()\n          .map((d) => Math.sqrt(d));\n        this.tStats = this.weights.map((d, i) =>\n          this.stdErrors[i] === 0 ? 0 : d[0] / this.stdErrors[i],\n        );\n      }\n    }\n  }\n\n  predict(x) {\n    if (Array.isArray(x)) {\n      if (typeof x[0] === 'number') {\n        return this._predict(x);\n      } else if (Array.isArray(x[0])) {\n        const y = new Array(x.length);\n        for (let i = 0; i < x.length; i++) {\n          y[i] = this._predict(x[i]);\n        }\n        return y;\n      }\n    } else if (mlMatrix.Matrix.isMatrix(x)) {\n      const y = new mlMatrix.Matrix(x.rows, this.outputs);\n      for (let i = 0; i < x.rows; i++) {\n        y.setRow(i, this._predict(x.getRow(i)));\n      }\n      return y;\n    }\n    throw new TypeError('x must be a matrix or array of numbers');\n  }\n\n  _predict(x) {\n    const result = new Array(this.outputs);\n    if (this.intercept) {\n      for (let i = 0; i < this.outputs; i++) {\n        result[i] = this.weights[this.inputs][i];\n      }\n    } else {\n      result.fill(0);\n    }\n    for (let i = 0; i < this.inputs; i++) {\n      for (let j = 0; j < this.outputs; j++) {\n        result[j] += this.weights[i][j] * x[i];\n      }\n    }\n    return result;\n  }\n\n  score() {\n    throw new Error('score method is not implemented yet');\n  }\n\n  toJSON() {\n    return {\n      name: 'multivariateLinearRegression',\n      weights: this.weights,\n      inputs: this.inputs,\n      outputs: this.outputs,\n      intercept: this.intercept,\n      summary: this.statistics\n        ? {\n            regressionStatistics: {\n              standardError: this.stdError,\n              observations: this.outputs,\n            },\n            variables: this.weights.map((d, i) => {\n              return {\n                label:\n                  i === this.weights.length - 1\n                    ? 'Intercept'\n                    : `X Variable ${i + 1}`,\n                coefficients: d,\n                standardError: this.stdErrors[i],\n                tStat: this.tStats[i],\n              };\n            }),\n          }\n        : undefined,\n    };\n  }\n\n  static load(model) {\n    if (model.name !== 'multivariateLinearRegression') {\n      throw new Error('not a MLR model');\n    }\n    return new MultivariateLinearRegression(true, model);\n  }\n}\n\nmodule.exports = MultivariateLinearRegression;\n"],"sourceRoot":""}