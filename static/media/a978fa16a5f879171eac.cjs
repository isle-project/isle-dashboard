"use strict";function _get(){return typeof Reflect!="undefined"&&Reflect.get?_get=Reflect.get:_get=function(target,property,receiver){var base=_superPropBase(target,property);if(!!base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(arguments.length<3?target:receiver):desc.value}},_get.apply(this,arguments)}function _superPropBase(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&(object=_getPrototypeOf(object),object!==null););return object}function _inherits(subClass,superClass){if(typeof superClass!="function"&&superClass!==null)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&_setPrototypeOf(subClass,superClass)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call=="function"))return call;if(call!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function _wrapNativeSuper(Class){var _cache=typeof Map=="function"?new Map:void 0;return _wrapNativeSuper=function(Class2){if(Class2===null||!_isNativeFunction(Class2))return Class2;if(typeof Class2!="function")throw new TypeError("Super expression must either be null or a function");if(typeof _cache!="undefined"){if(_cache.has(Class2))return _cache.get(Class2);_cache.set(Class2,Wrapper)}function Wrapper(){return _construct(Class2,arguments,_getPrototypeOf(this).constructor)}return Wrapper.prototype=Object.create(Class2.prototype,{constructor:{value:Wrapper,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(Wrapper,Class2)},_wrapNativeSuper(Class)}function _construct(Parent,args,Class){return _isNativeReflectConstruct()?_construct=Reflect.construct:_construct=function(Parent2,args2,Class2){var a=[null];a.push.apply(a,args2);var Constructor=Function.bind.apply(Parent2,a),instance=new Constructor;return Class2&&_setPrototypeOf(instance,Class2.prototype),instance},_construct.apply(null,arguments)}function _isNativeReflectConstruct(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function _isNativeFunction(fn){return Function.toString.call(fn).indexOf("[native code]")!==-1}function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf||function(o2,p2){return o2.__proto__=p2,o2},_setPrototypeOf(o,p)}function _getPrototypeOf(o){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o2){return o2.__proto__||Object.getPrototypeOf(o2)},_getPrototypeOf(o)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}function _typeof(obj){return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(obj2){return typeof obj2}:function(obj2){return obj2&&typeof Symbol=="function"&&obj2.constructor===Symbol&&obj2!==Symbol.prototype?"symbol":typeof obj2},_typeof(obj)}Object.defineProperty(exports,"__esModule",{value:!0});var OrderedMap=require("orderedmap");function _interopDefaultLegacy(e){return e&&_typeof(e)==="object"&&"default"in e?e:{default:e}}var OrderedMap__default=_interopDefaultLegacy(OrderedMap);function _findDiffStart(a,b,pos){for(var i=0;;i++){if(i==a.childCount||i==b.childCount)return a.childCount==b.childCount?null:pos;var childA=a.child(i),childB=b.child(i);if(childA==childB){pos+=childA.nodeSize;continue}if(!childA.sameMarkup(childB))return pos;if(childA.isText&&childA.text!=childB.text){for(var j=0;childA.text[j]==childB.text[j];j++)pos++;return pos}if(childA.content.size||childB.content.size){var inner=_findDiffStart(childA.content,childB.content,pos+1);if(inner!=null)return inner}pos+=childA.nodeSize}}function _findDiffEnd(a,b,posA,posB){for(var iA=a.childCount,iB=b.childCount;;){if(iA==0||iB==0)return iA==iB?null:{a:posA,b:posB};var childA=a.child(--iA),childB=b.child(--iB),size=childA.nodeSize;if(childA==childB){posA-=size,posB-=size;continue}if(!childA.sameMarkup(childB))return{a:posA,b:posB};if(childA.isText&&childA.text!=childB.text){for(var same=0,minSize=Math.min(childA.text.length,childB.text.length);same<minSize&&childA.text[childA.text.length-same-1]==childB.text[childB.text.length-same-1];)same++,posA--,posB--;return{a:posA,b:posB}}if(childA.content.size||childB.content.size){var inner=_findDiffEnd(childA.content,childB.content,posA-1,posB-1);if(inner)return inner}posA-=size,posB-=size}}var Fragment=function(){function Fragment2(content,size){if(_classCallCheck(this,Fragment2),this.content=content,this.size=size||0,size==null)for(var i=0;i<content.length;i++)this.size+=content[i].nodeSize}return _createClass(Fragment2,[{key:"nodesBetween",value:function(from,to,f){for(var nodeStart=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,parent=arguments.length>4?arguments[4]:void 0,i=0,pos=0;pos<to;i++){var child=this.content[i],end=pos+child.nodeSize;if(end>from&&f(child,nodeStart+pos,parent||null,i)!==!1&&child.content.size){var start=pos+1;child.nodesBetween(Math.max(0,from-start),Math.min(child.content.size,to-start),f,nodeStart+start)}pos=end}}},{key:"descendants",value:function(f){this.nodesBetween(0,this.size,f)}},{key:"textBetween",value:function(from,to,blockSeparator,leafText){var text="",separated=!0;return this.nodesBetween(from,to,function(node,pos){node.isText?(text+=node.text.slice(Math.max(from,pos)-pos,to-pos),separated=!blockSeparator):node.isLeaf?(leafText?text+=typeof leafText=="function"?leafText(node):leafText:node.type.spec.leafText&&(text+=node.type.spec.leafText(node)),separated=!blockSeparator):!separated&&node.isBlock&&(text+=blockSeparator,separated=!0)},0),text}},{key:"append",value:function(other){if(!other.size)return this;if(!this.size)return other;var last=this.lastChild,first=other.firstChild,content=this.content.slice(),i=0;for(last.isText&&last.sameMarkup(first)&&(content[content.length-1]=last.withText(last.text+first.text),i=1);i<other.content.length;i++)content.push(other.content[i]);return new Fragment2(content,this.size+other.size)}},{key:"cut",value:function(from){var to=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.size;if(from==0&&to==this.size)return this;var result=[],size=0;if(to>from)for(var i=0,pos=0;pos<to;i++){var child=this.content[i],end=pos+child.nodeSize;end>from&&((pos<from||end>to)&&(child.isText?child=child.cut(Math.max(0,from-pos),Math.min(child.text.length,to-pos)):child=child.cut(Math.max(0,from-pos-1),Math.min(child.content.size,to-pos-1))),result.push(child),size+=child.nodeSize),pos=end}return new Fragment2(result,size)}},{key:"cutByIndex",value:function(from,to){return from==to?Fragment2.empty:from==0&&to==this.content.length?this:new Fragment2(this.content.slice(from,to))}},{key:"replaceChild",value:function(index,node){var current=this.content[index];if(current==node)return this;var copy2=this.content.slice(),size=this.size+node.nodeSize-current.nodeSize;return copy2[index]=node,new Fragment2(copy2,size)}},{key:"addToStart",value:function(node){return new Fragment2([node].concat(this.content),this.size+node.nodeSize)}},{key:"addToEnd",value:function(node){return new Fragment2(this.content.concat(node),this.size+node.nodeSize)}},{key:"eq",value:function(other){if(this.content.length!=other.content.length)return!1;for(var i=0;i<this.content.length;i++)if(!this.content[i].eq(other.content[i]))return!1;return!0}},{key:"firstChild",get:function(){return this.content.length?this.content[0]:null}},{key:"lastChild",get:function(){return this.content.length?this.content[this.content.length-1]:null}},{key:"childCount",get:function(){return this.content.length}},{key:"child",value:function(index){var found2=this.content[index];if(!found2)throw new RangeError("Index "+index+" out of range for "+this);return found2}},{key:"maybeChild",value:function(index){return this.content[index]||null}},{key:"forEach",value:function(f){for(var i=0,p=0;i<this.content.length;i++){var child=this.content[i];f(child,p,i),p+=child.nodeSize}}},{key:"findDiffStart",value:function(other){var pos=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return _findDiffStart(this,other,pos)}},{key:"findDiffEnd",value:function(other){var pos=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.size,otherPos=arguments.length>2&&arguments[2]!==void 0?arguments[2]:other.size;return _findDiffEnd(this,other,pos,otherPos)}},{key:"findIndex",value:function(pos){var round=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1;if(pos==0)return retIndex(0,pos);if(pos==this.size)return retIndex(this.content.length,pos);if(pos>this.size||pos<0)throw new RangeError("Position ".concat(pos," outside of fragment (").concat(this,")"));for(var i=0,curPos=0;;i++){var cur=this.child(i),end=curPos+cur.nodeSize;if(end>=pos)return end==pos||round>0?retIndex(i+1,end):retIndex(i,curPos);curPos=end}}},{key:"toString",value:function(){return"<"+this.toStringInner()+">"}},{key:"toStringInner",value:function(){return this.content.join(", ")}},{key:"toJSON",value:function(){return this.content.length?this.content.map(function(n){return n.toJSON()}):null}}],[{key:"fromJSON",value:function(schema,value){if(!value)return Fragment2.empty;if(!Array.isArray(value))throw new RangeError("Invalid input for Fragment.fromJSON");return new Fragment2(value.map(schema.nodeFromJSON))}},{key:"fromArray",value:function(array){if(!array.length)return Fragment2.empty;for(var joined,size=0,i=0;i<array.length;i++){var node=array[i];size+=node.nodeSize,i&&node.isText&&array[i-1].sameMarkup(node)?(joined||(joined=array.slice(0,i)),joined[joined.length-1]=node.withText(joined[joined.length-1].text+node.text)):joined&&joined.push(node)}return new Fragment2(joined||array,size)}},{key:"from",value:function(nodes){if(!nodes)return Fragment2.empty;if(nodes instanceof Fragment2)return nodes;if(Array.isArray(nodes))return this.fromArray(nodes);if(nodes.attrs)return new Fragment2([nodes],nodes.nodeSize);throw new RangeError("Can not convert "+nodes+" to a Fragment"+(nodes.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}]),Fragment2}();Fragment.empty=new Fragment([],0);var found={index:0,offset:0};function retIndex(index,offset){return found.index=index,found.offset=offset,found}function compareDeep(a,b){if(a===b)return!0;if(!(a&&_typeof(a)=="object")||!(b&&_typeof(b)=="object"))return!1;var array=Array.isArray(a);if(Array.isArray(b)!=array)return!1;if(array){if(a.length!=b.length)return!1;for(var i=0;i<a.length;i++)if(!compareDeep(a[i],b[i]))return!1}else{for(var p in a)if(!(p in b)||!compareDeep(a[p],b[p]))return!1;for(var _p in b)if(!(_p in a))return!1}return!0}var Mark=function(){function Mark2(type,attrs){_classCallCheck(this,Mark2),this.type=type,this.attrs=attrs}return _createClass(Mark2,[{key:"addToSet",value:function(set){for(var copy2,placed=!1,i=0;i<set.length;i++){var other=set[i];if(this.eq(other))return set;if(this.type.excludes(other.type))copy2||(copy2=set.slice(0,i));else{if(other.type.excludes(this.type))return set;!placed&&other.type.rank>this.type.rank&&(copy2||(copy2=set.slice(0,i)),copy2.push(this),placed=!0),copy2&&copy2.push(other)}}return copy2||(copy2=set.slice()),placed||copy2.push(this),copy2}},{key:"removeFromSet",value:function(set){for(var i=0;i<set.length;i++)if(this.eq(set[i]))return set.slice(0,i).concat(set.slice(i+1));return set}},{key:"isInSet",value:function(set){for(var i=0;i<set.length;i++)if(this.eq(set[i]))return!0;return!1}},{key:"eq",value:function(other){return this==other||this.type==other.type&&compareDeep(this.attrs,other.attrs)}},{key:"toJSON",value:function(){var obj={type:this.type.name};for(var _ in this.attrs){obj.attrs=this.attrs;break}return obj}}],[{key:"fromJSON",value:function(schema,json){if(!json)throw new RangeError("Invalid input for Mark.fromJSON");var type=schema.marks[json.type];if(!type)throw new RangeError("There is no mark type ".concat(json.type," in this schema"));return type.create(json.attrs)}},{key:"sameSet",value:function(a,b){if(a==b)return!0;if(a.length!=b.length)return!1;for(var i=0;i<a.length;i++)if(!a[i].eq(b[i]))return!1;return!0}},{key:"setFrom",value:function(marks){if(!marks||Array.isArray(marks)&&marks.length==0)return Mark2.none;if(marks instanceof Mark2)return[marks];var copy2=marks.slice();return copy2.sort(function(a,b){return a.type.rank-b.type.rank}),copy2}}]),Mark2}();Mark.none=[];var ReplaceError=function(_Error){_inherits(ReplaceError2,_Error);var _super=_createSuper(ReplaceError2);function ReplaceError2(){return _classCallCheck(this,ReplaceError2),_super.apply(this,arguments)}return _createClass(ReplaceError2)}(_wrapNativeSuper(Error)),Slice=function(){function Slice2(content,openStart,openEnd){_classCallCheck(this,Slice2),this.content=content,this.openStart=openStart,this.openEnd=openEnd}return _createClass(Slice2,[{key:"size",get:function(){return this.content.size-this.openStart-this.openEnd}},{key:"insertAt",value:function(pos,fragment){var content=insertInto(this.content,pos+this.openStart,fragment);return content&&new Slice2(content,this.openStart,this.openEnd)}},{key:"removeBetween",value:function(from,to){return new Slice2(removeRange(this.content,from+this.openStart,to+this.openStart),this.openStart,this.openEnd)}},{key:"eq",value:function(other){return this.content.eq(other.content)&&this.openStart==other.openStart&&this.openEnd==other.openEnd}},{key:"toString",value:function(){return this.content+"("+this.openStart+","+this.openEnd+")"}},{key:"toJSON",value:function(){if(!this.content.size)return null;var json={content:this.content.toJSON()};return this.openStart>0&&(json.openStart=this.openStart),this.openEnd>0&&(json.openEnd=this.openEnd),json}}],[{key:"fromJSON",value:function(schema,json){if(!json)return Slice2.empty;var openStart=json.openStart||0,openEnd=json.openEnd||0;if(typeof openStart!="number"||typeof openEnd!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new Slice2(Fragment.fromJSON(schema,json.content),openStart,openEnd)}},{key:"maxOpen",value:function(fragment){for(var openIsolating=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,openStart=0,openEnd=0,n=fragment.firstChild;n&&!n.isLeaf&&(openIsolating||!n.type.spec.isolating);n=n.firstChild)openStart++;for(var _n=fragment.lastChild;_n&&!_n.isLeaf&&(openIsolating||!_n.type.spec.isolating);_n=_n.lastChild)openEnd++;return new Slice2(fragment,openStart,openEnd)}}]),Slice2}();Slice.empty=new Slice(Fragment.empty,0,0);function removeRange(content,from,to){var _content$findIndex=content.findIndex(from),index=_content$findIndex.index,offset=_content$findIndex.offset,child=content.maybeChild(index),_content$findIndex2=content.findIndex(to),indexTo=_content$findIndex2.index,offsetTo=_content$findIndex2.offset;if(offset==from||child.isText){if(offsetTo!=to&&!content.child(indexTo).isText)throw new RangeError("Removing non-flat range");return content.cut(0,from).append(content.cut(to))}if(index!=indexTo)throw new RangeError("Removing non-flat range");return content.replaceChild(index,child.copy(removeRange(child.content,from-offset-1,to-offset-1)))}function insertInto(content,dist,insert,parent){var _content$findIndex3=content.findIndex(dist),index=_content$findIndex3.index,offset=_content$findIndex3.offset,child=content.maybeChild(index);if(offset==dist||child.isText)return parent&&!parent.canReplace(index,index,insert)?null:content.cut(0,dist).append(insert).append(content.cut(dist));var inner=insertInto(child.content,dist-offset-1,insert);return inner&&content.replaceChild(index,child.copy(inner))}function _replace($from,$to,slice){if(slice.openStart>$from.depth)throw new ReplaceError("Inserted content deeper than insertion position");if($from.depth-slice.openStart!=$to.depth-slice.openEnd)throw new ReplaceError("Inconsistent open depths");return replaceOuter($from,$to,slice,0)}function replaceOuter($from,$to,slice,depth){var index=$from.index(depth),node=$from.node(depth);if(index==$to.index(depth)&&depth<$from.depth-slice.openStart){var inner=replaceOuter($from,$to,slice,depth+1);return node.copy(node.content.replaceChild(index,inner))}else if(slice.content.size)if(!slice.openStart&&!slice.openEnd&&$from.depth==depth&&$to.depth==depth){var parent=$from.parent,content=parent.content;return close(parent,content.cut(0,$from.parentOffset).append(slice.content).append(content.cut($to.parentOffset)))}else{var _prepareSliceForRepla=prepareSliceForReplace(slice,$from),start=_prepareSliceForRepla.start,end=_prepareSliceForRepla.end;return close(node,replaceThreeWay($from,start,end,$to,depth))}else return close(node,replaceTwoWay($from,$to,depth))}function checkJoin(main,sub){if(!sub.type.compatibleContent(main.type))throw new ReplaceError("Cannot join "+sub.type.name+" onto "+main.type.name)}function joinable($before,$after,depth){var node=$before.node(depth);return checkJoin(node,$after.node(depth)),node}function addNode(child,target){var last=target.length-1;last>=0&&child.isText&&child.sameMarkup(target[last])?target[last]=child.withText(target[last].text+child.text):target.push(child)}function addRange($start,$end,depth,target){var node=($end||$start).node(depth),startIndex=0,endIndex=$end?$end.index(depth):node.childCount;$start&&(startIndex=$start.index(depth),$start.depth>depth?startIndex++:$start.textOffset&&(addNode($start.nodeAfter,target),startIndex++));for(var i=startIndex;i<endIndex;i++)addNode(node.child(i),target);$end&&$end.depth==depth&&$end.textOffset&&addNode($end.nodeBefore,target)}function close(node,content){if(!node.type.validContent(content))throw new ReplaceError("Invalid content for node "+node.type.name);return node.copy(content)}function replaceThreeWay($from,$start,$end,$to,depth){var openStart=$from.depth>depth&&joinable($from,$start,depth+1),openEnd=$to.depth>depth&&joinable($end,$to,depth+1),content=[];return addRange(null,$from,depth,content),openStart&&openEnd&&$start.index(depth)==$end.index(depth)?(checkJoin(openStart,openEnd),addNode(close(openStart,replaceThreeWay($from,$start,$end,$to,depth+1)),content)):(openStart&&addNode(close(openStart,replaceTwoWay($from,$start,depth+1)),content),addRange($start,$end,depth,content),openEnd&&addNode(close(openEnd,replaceTwoWay($end,$to,depth+1)),content)),addRange($to,null,depth,content),new Fragment(content)}function replaceTwoWay($from,$to,depth){var content=[];if(addRange(null,$from,depth,content),$from.depth>depth){var type=joinable($from,$to,depth+1);addNode(close(type,replaceTwoWay($from,$to,depth+1)),content)}return addRange($to,null,depth,content),new Fragment(content)}function prepareSliceForReplace(slice,$along){for(var extra=$along.depth-slice.openStart,parent=$along.node(extra),node=parent.copy(slice.content),i=extra-1;i>=0;i--)node=$along.node(i).copy(Fragment.from(node));return{start:node.resolveNoCache(slice.openStart+extra),end:node.resolveNoCache(node.content.size-slice.openEnd-extra)}}var ResolvedPos=function(){function ResolvedPos2(pos,path,parentOffset){_classCallCheck(this,ResolvedPos2),this.pos=pos,this.path=path,this.parentOffset=parentOffset,this.depth=path.length/3-1}return _createClass(ResolvedPos2,[{key:"resolveDepth",value:function(val){return val==null?this.depth:val<0?this.depth+val:val}},{key:"parent",get:function(){return this.node(this.depth)}},{key:"doc",get:function(){return this.node(0)}},{key:"node",value:function(depth){return this.path[this.resolveDepth(depth)*3]}},{key:"index",value:function(depth){return this.path[this.resolveDepth(depth)*3+1]}},{key:"indexAfter",value:function(depth){return depth=this.resolveDepth(depth),this.index(depth)+(depth==this.depth&&!this.textOffset?0:1)}},{key:"start",value:function(depth){return depth=this.resolveDepth(depth),depth==0?0:this.path[depth*3-1]+1}},{key:"end",value:function(depth){return depth=this.resolveDepth(depth),this.start(depth)+this.node(depth).content.size}},{key:"before",value:function(depth){if(depth=this.resolveDepth(depth),!depth)throw new RangeError("There is no position before the top-level node");return depth==this.depth+1?this.pos:this.path[depth*3-1]}},{key:"after",value:function(depth){if(depth=this.resolveDepth(depth),!depth)throw new RangeError("There is no position after the top-level node");return depth==this.depth+1?this.pos:this.path[depth*3-1]+this.path[depth*3].nodeSize}},{key:"textOffset",get:function(){return this.pos-this.path[this.path.length-1]}},{key:"nodeAfter",get:function(){var parent=this.parent,index=this.index(this.depth);if(index==parent.childCount)return null;var dOff=this.pos-this.path[this.path.length-1],child=parent.child(index);return dOff?parent.child(index).cut(dOff):child}},{key:"nodeBefore",get:function(){var index=this.index(this.depth),dOff=this.pos-this.path[this.path.length-1];return dOff?this.parent.child(index).cut(0,dOff):index==0?null:this.parent.child(index-1)}},{key:"posAtIndex",value:function(index,depth){depth=this.resolveDepth(depth);for(var node=this.path[depth*3],pos=depth==0?0:this.path[depth*3-1]+1,i=0;i<index;i++)pos+=node.child(i).nodeSize;return pos}},{key:"marks",value:function(){var parent=this.parent,index=this.index();if(parent.content.size==0)return Mark.none;if(this.textOffset)return parent.child(index).marks;var main=parent.maybeChild(index-1),other=parent.maybeChild(index);if(!main){var tmp=main;main=other,other=tmp}for(var marks2=main.marks,i=0;i<marks2.length;i++)marks2[i].type.spec.inclusive===!1&&(!other||!marks2[i].isInSet(other.marks))&&(marks2=marks2[i--].removeFromSet(marks2));return marks2}},{key:"marksAcross",value:function($end){var after=this.parent.maybeChild(this.index());if(!after||!after.isInline)return null;for(var marks=after.marks,next=$end.parent.maybeChild($end.index()),i=0;i<marks.length;i++)marks[i].type.spec.inclusive===!1&&(!next||!marks[i].isInSet(next.marks))&&(marks=marks[i--].removeFromSet(marks));return marks}},{key:"sharedDepth",value:function(pos){for(var depth=this.depth;depth>0;depth--)if(this.start(depth)<=pos&&this.end(depth)>=pos)return depth;return 0}},{key:"blockRange",value:function(){var other=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this,pred=arguments.length>1?arguments[1]:void 0;if(other.pos<this.pos)return other.blockRange(this);for(var d=this.depth-(this.parent.inlineContent||this.pos==other.pos?1:0);d>=0;d--)if(other.pos<=this.end(d)&&(!pred||pred(this.node(d))))return new NodeRange(this,other,d);return null}},{key:"sameParent",value:function(other){return this.pos-this.parentOffset==other.pos-other.parentOffset}},{key:"max",value:function(other){return other.pos>this.pos?other:this}},{key:"min",value:function(other){return other.pos<this.pos?other:this}},{key:"toString",value:function(){for(var str="",i=1;i<=this.depth;i++)str+=(str?"/":"")+this.node(i).type.name+"_"+this.index(i-1);return str+":"+this.parentOffset}}],[{key:"resolve",value:function(doc2,pos){if(!(pos>=0&&pos<=doc2.content.size))throw new RangeError("Position "+pos+" out of range");for(var path=[],start=0,parentOffset=pos,node=doc2;;){var _node$content$findInd=node.content.findIndex(parentOffset),index=_node$content$findInd.index,offset=_node$content$findInd.offset,rem=parentOffset-offset;if(path.push(node,index,start+offset),!rem||(node=node.child(index),node.isText))break;parentOffset=rem-1,start+=offset+1}return new ResolvedPos2(pos,path,parentOffset)}},{key:"resolveCached",value:function(doc2,pos){for(var i=0;i<resolveCache.length;i++){var cached=resolveCache[i];if(cached.pos==pos&&cached.doc==doc2)return cached}var result=resolveCache[resolveCachePos]=ResolvedPos2.resolve(doc2,pos);return resolveCachePos=(resolveCachePos+1)%resolveCacheSize,result}}]),ResolvedPos2}(),resolveCache=[],resolveCachePos=0,resolveCacheSize=12,NodeRange=function(){function NodeRange2($from,$to,depth){_classCallCheck(this,NodeRange2),this.$from=$from,this.$to=$to,this.depth=depth}return _createClass(NodeRange2,[{key:"start",get:function(){return this.$from.before(this.depth+1)}},{key:"end",get:function(){return this.$to.after(this.depth+1)}},{key:"parent",get:function(){return this.$from.node(this.depth)}},{key:"startIndex",get:function(){return this.$from.index(this.depth)}},{key:"endIndex",get:function(){return this.$to.indexAfter(this.depth)}}]),NodeRange2}(),emptyAttrs=Object.create(null),Node=function(){function Node2(type,attrs,content){var marks=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Mark.none;_classCallCheck(this,Node2),this.type=type,this.attrs=attrs,this.marks=marks,this.content=content||Fragment.empty}return _createClass(Node2,[{key:"nodeSize",get:function(){return this.isLeaf?1:2+this.content.size}},{key:"childCount",get:function(){return this.content.childCount}},{key:"child",value:function(index){return this.content.child(index)}},{key:"maybeChild",value:function(index){return this.content.maybeChild(index)}},{key:"forEach",value:function(f){this.content.forEach(f)}},{key:"nodesBetween",value:function(from,to,f){var startPos=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;this.content.nodesBetween(from,to,f,startPos,this)}},{key:"descendants",value:function(f){this.nodesBetween(0,this.content.size,f)}},{key:"textContent",get:function(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}},{key:"textBetween",value:function(from,to,blockSeparator,leafText){return this.content.textBetween(from,to,blockSeparator,leafText)}},{key:"firstChild",get:function(){return this.content.firstChild}},{key:"lastChild",get:function(){return this.content.lastChild}},{key:"eq",value:function(other){return this==other||this.sameMarkup(other)&&this.content.eq(other.content)}},{key:"sameMarkup",value:function(other){return this.hasMarkup(other.type,other.attrs,other.marks)}},{key:"hasMarkup",value:function(type,attrs,marks){return this.type==type&&compareDeep(this.attrs,attrs||type.defaultAttrs||emptyAttrs)&&Mark.sameSet(this.marks,marks||Mark.none)}},{key:"copy",value:function(){var content=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return content==this.content?this:new Node2(this.type,this.attrs,content,this.marks)}},{key:"mark",value:function(marks){return marks==this.marks?this:new Node2(this.type,this.attrs,this.content,marks)}},{key:"cut",value:function(from){var to=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.content.size;return from==0&&to==this.content.size?this:this.copy(this.content.cut(from,to))}},{key:"slice",value:function(from){var to=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.content.size,includeParents=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(from==to)return Slice.empty;var $from=this.resolve(from),$to=this.resolve(to),depth=includeParents?0:$from.sharedDepth(to),start=$from.start(depth),node=$from.node(depth),content=node.content.cut($from.pos-start,$to.pos-start);return new Slice(content,$from.depth-depth,$to.depth-depth)}},{key:"replace",value:function(from,to,slice){return _replace(this.resolve(from),this.resolve(to),slice)}},{key:"nodeAt",value:function(pos){for(var node=this;;){var _node$content$findInd2=node.content.findIndex(pos),index=_node$content$findInd2.index,offset=_node$content$findInd2.offset;if(node=node.maybeChild(index),!node)return null;if(offset==pos||node.isText)return node;pos-=offset+1}}},{key:"childAfter",value:function(pos){var _this$content$findInd=this.content.findIndex(pos),index=_this$content$findInd.index,offset=_this$content$findInd.offset;return{node:this.content.maybeChild(index),index,offset}}},{key:"childBefore",value:function(pos){if(pos==0)return{node:null,index:0,offset:0};var _this$content$findInd2=this.content.findIndex(pos),index=_this$content$findInd2.index,offset=_this$content$findInd2.offset;if(offset<pos)return{node:this.content.child(index),index,offset};var node=this.content.child(index-1);return{node,index:index-1,offset:offset-node.nodeSize}}},{key:"resolve",value:function(pos){return ResolvedPos.resolveCached(this,pos)}},{key:"resolveNoCache",value:function(pos){return ResolvedPos.resolve(this,pos)}},{key:"rangeHasMark",value:function(from,to,type){var found2=!1;return to>from&&this.nodesBetween(from,to,function(node){return type.isInSet(node.marks)&&(found2=!0),!found2}),found2}},{key:"isBlock",get:function(){return this.type.isBlock}},{key:"isTextblock",get:function(){return this.type.isTextblock}},{key:"inlineContent",get:function(){return this.type.inlineContent}},{key:"isInline",get:function(){return this.type.isInline}},{key:"isText",get:function(){return this.type.isText}},{key:"isLeaf",get:function(){return this.type.isLeaf}},{key:"isAtom",get:function(){return this.type.isAtom}},{key:"toString",value:function(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);var name=this.type.name;return this.content.size&&(name+="("+this.content.toStringInner()+")"),wrapMarks(this.marks,name)}},{key:"contentMatchAt",value:function(index){var match=this.type.contentMatch.matchFragment(this.content,0,index);if(!match)throw new Error("Called contentMatchAt on a node with invalid content");return match}},{key:"canReplace",value:function(from,to){var replacement=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Fragment.empty,start=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,end=arguments.length>4&&arguments[4]!==void 0?arguments[4]:replacement.childCount,one=this.contentMatchAt(from).matchFragment(replacement,start,end),two=one&&one.matchFragment(this.content,to);if(!two||!two.validEnd)return!1;for(var i=start;i<end;i++)if(!this.type.allowsMarks(replacement.child(i).marks))return!1;return!0}},{key:"canReplaceWith",value:function(from,to,type,marks){if(marks&&!this.type.allowsMarks(marks))return!1;var start=this.contentMatchAt(from).matchType(type),end=start&&start.matchFragment(this.content,to);return end?end.validEnd:!1}},{key:"canAppend",value:function(other){return other.content.size?this.canReplace(this.childCount,this.childCount,other.content):this.type.compatibleContent(other.type)}},{key:"check",value:function(){if(!this.type.validContent(this.content))throw new RangeError("Invalid content for node ".concat(this.type.name,": ").concat(this.content.toString().slice(0,50)));for(var copy2=Mark.none,i=0;i<this.marks.length;i++)copy2=this.marks[i].addToSet(copy2);if(!Mark.sameSet(copy2,this.marks))throw new RangeError("Invalid collection of marks for node ".concat(this.type.name,": ").concat(this.marks.map(function(m){return m.type.name})));this.content.forEach(function(node){return node.check()})}},{key:"toJSON",value:function(){var obj={type:this.type.name};for(var _ in this.attrs){obj.attrs=this.attrs;break}return this.content.size&&(obj.content=this.content.toJSON()),this.marks.length&&(obj.marks=this.marks.map(function(n){return n.toJSON()})),obj}}],[{key:"fromJSON",value:function(schema,json){if(!json)throw new RangeError("Invalid input for Node.fromJSON");var marks=null;if(json.marks){if(!Array.isArray(json.marks))throw new RangeError("Invalid mark data for Node.fromJSON");marks=json.marks.map(schema.markFromJSON)}if(json.type=="text"){if(typeof json.text!="string")throw new RangeError("Invalid text node in JSON");return schema.text(json.text,marks)}var content=Fragment.fromJSON(schema,json.content);return schema.nodeType(json.type).create(json.attrs,content,marks)}}]),Node2}();Node.prototype.text=void 0;var TextNode=function(_Node){_inherits(TextNode2,_Node);var _super2=_createSuper(TextNode2);function TextNode2(type,attrs,content,marks){var _this;if(_classCallCheck(this,TextNode2),_this=_super2.call(this,type,attrs,null,marks),!content)throw new RangeError("Empty text nodes are not allowed");return _this.text=content,_this}return _createClass(TextNode2,[{key:"toString",value:function(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):wrapMarks(this.marks,JSON.stringify(this.text))}},{key:"textContent",get:function(){return this.text}},{key:"textBetween",value:function(from,to){return this.text.slice(from,to)}},{key:"nodeSize",get:function(){return this.text.length}},{key:"mark",value:function(marks){return marks==this.marks?this:new TextNode2(this.type,this.attrs,this.text,marks)}},{key:"withText",value:function(text){return text==this.text?this:new TextNode2(this.type,this.attrs,text,this.marks)}},{key:"cut",value:function(){var from=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,to=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.text.length;return from==0&&to==this.text.length?this:this.withText(this.text.slice(from,to))}},{key:"eq",value:function(other){return this.sameMarkup(other)&&this.text==other.text}},{key:"toJSON",value:function(){var base=_get(_getPrototypeOf(TextNode2.prototype),"toJSON",this).call(this);return base.text=this.text,base}}]),TextNode2}(Node);function wrapMarks(marks,str){for(var i=marks.length-1;i>=0;i--)str=marks[i].type.name+"("+str+")";return str}var ContentMatch=function(){function ContentMatch2(validEnd){_classCallCheck(this,ContentMatch2),this.validEnd=validEnd,this.next=[],this.wrapCache=[]}return _createClass(ContentMatch2,[{key:"matchType",value:function(type){for(var i=0;i<this.next.length;i++)if(this.next[i].type==type)return this.next[i].next;return null}},{key:"matchFragment",value:function(frag){for(var start=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,end=arguments.length>2&&arguments[2]!==void 0?arguments[2]:frag.childCount,cur=this,i=start;cur&&i<end;i++)cur=cur.matchType(frag.child(i).type);return cur}},{key:"inlineContent",get:function(){return this.next.length&&this.next[0].type.isInline}},{key:"defaultType",get:function(){for(var i=0;i<this.next.length;i++){var type=this.next[i].type;if(!(type.isText||type.hasRequiredAttrs()))return type}return null}},{key:"compatible",value:function(other){for(var i=0;i<this.next.length;i++)for(var j=0;j<other.next.length;j++)if(this.next[i].type==other.next[j].type)return!0;return!1}},{key:"fillBefore",value:function(after){var toEnd=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,startIndex=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,seen=[this];function search(match,types){var finished=match.matchFragment(after,startIndex);if(finished&&(!toEnd||finished.validEnd))return Fragment.from(types.map(function(tp){return tp.createAndFill()}));for(var i=0;i<match.next.length;i++){var _match$next$i=match.next[i],type=_match$next$i.type,next=_match$next$i.next;if(!(type.isText||type.hasRequiredAttrs())&&seen.indexOf(next)==-1){seen.push(next);var _found=search(next,types.concat(type));if(_found)return _found}}return null}return search(this,[])}},{key:"findWrapping",value:function(target){for(var i=0;i<this.wrapCache.length;i+=2)if(this.wrapCache[i]==target)return this.wrapCache[i+1];var computed=this.computeWrapping(target);return this.wrapCache.push(target,computed),computed}},{key:"computeWrapping",value:function(target){for(var seen=Object.create(null),active=[{match:this,type:null,via:null}];active.length;){var current=active.shift(),match=current.match;if(match.matchType(target)){for(var result=[],obj=current;obj.type;obj=obj.via)result.push(obj.type);return result.reverse()}for(var i=0;i<match.next.length;i++){var _match$next$i2=match.next[i],type=_match$next$i2.type,next=_match$next$i2.next;!type.isLeaf&&!type.hasRequiredAttrs()&&!(type.name in seen)&&(!current.type||next.validEnd)&&(active.push({match:type.contentMatch,type,via:current}),seen[type.name]=!0)}}return null}},{key:"edgeCount",get:function(){return this.next.length}},{key:"edge",value:function(n){if(n>=this.next.length)throw new RangeError("There's no ".concat(n,"th edge in this content match"));return this.next[n]}},{key:"toString",value:function(){var seen=[];function scan(m){seen.push(m);for(var i=0;i<m.next.length;i++)seen.indexOf(m.next[i].next)==-1&&scan(m.next[i].next)}return scan(this),seen.map(function(m,i){for(var out=i+(m.validEnd?"*":" ")+" ",_i=0;_i<m.next.length;_i++)out+=(_i?", ":"")+m.next[_i].type.name+"->"+seen.indexOf(m.next[_i].next);return out}).join(`
`)}}],[{key:"parse",value:function(string,nodeTypes){var stream=new TokenStream(string,nodeTypes);if(stream.next==null)return ContentMatch2.empty;var expr=parseExpr(stream);stream.next&&stream.err("Unexpected trailing text");var match=dfa(nfa(expr));return checkForDeadEnds(match,stream),match}}]),ContentMatch2}();ContentMatch.empty=new ContentMatch(!0);var TokenStream=function(){function TokenStream2(string,nodeTypes){_classCallCheck(this,TokenStream2),this.string=string,this.nodeTypes=nodeTypes,this.inline=null,this.pos=0,this.tokens=string.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}return _createClass(TokenStream2,[{key:"next",get:function(){return this.tokens[this.pos]}},{key:"eat",value:function(tok){return this.next==tok&&(this.pos++||!0)}},{key:"err",value:function(str){throw new SyntaxError(str+" (in content expression '"+this.string+"')")}}]),TokenStream2}();function parseExpr(stream){var exprs=[];do exprs.push(parseExprSeq(stream));while(stream.eat("|"));return exprs.length==1?exprs[0]:{type:"choice",exprs}}function parseExprSeq(stream){var exprs=[];do exprs.push(parseExprSubscript(stream));while(stream.next&&stream.next!=")"&&stream.next!="|");return exprs.length==1?exprs[0]:{type:"seq",exprs}}function parseExprSubscript(stream){for(var expr=parseExprAtom(stream);;)if(stream.eat("+"))expr={type:"plus",expr};else if(stream.eat("*"))expr={type:"star",expr};else if(stream.eat("?"))expr={type:"opt",expr};else if(stream.eat("{"))expr=parseExprRange(stream,expr);else break;return expr}function parseNum(stream){/\D/.test(stream.next)&&stream.err("Expected number, got '"+stream.next+"'");var result=Number(stream.next);return stream.pos++,result}function parseExprRange(stream,expr){var min=parseNum(stream),max=min;return stream.eat(",")&&(stream.next!="}"?max=parseNum(stream):max=-1),stream.eat("}")||stream.err("Unclosed braced range"),{type:"range",min,max,expr}}function resolveName(stream,name){var types=stream.nodeTypes,type=types[name];if(type)return[type];var result=[];for(var typeName in types){var _type=types[typeName];_type.groups.indexOf(name)>-1&&result.push(_type)}return result.length==0&&stream.err("No node type or group '"+name+"' found"),result}function parseExprAtom(stream){if(stream.eat("(")){var expr=parseExpr(stream);return stream.eat(")")||stream.err("Missing closing paren"),expr}else if(/\W/.test(stream.next))stream.err("Unexpected token '"+stream.next+"'");else{var exprs=resolveName(stream,stream.next).map(function(type){return stream.inline==null?stream.inline=type.isInline:stream.inline!=type.isInline&&stream.err("Mixing inline and block content"),{type:"name",value:type}});return stream.pos++,exprs.length==1?exprs[0]:{type:"choice",exprs}}}function nfa(expr){var nfa2=[[]];return connect(compile(expr,0),node()),nfa2;function node(){return nfa2.push([])-1}function edge(from,to,term){var edge2={term,to};return nfa2[from].push(edge2),edge2}function connect(edges,to){edges.forEach(function(edge2){return edge2.to=to})}function compile(expr2,from){if(expr2.type=="choice")return expr2.exprs.reduce(function(out,expr3){return out.concat(compile(expr3,from))},[]);if(expr2.type=="seq")for(var i=0;;i++){var next=compile(expr2.exprs[i],from);if(i==expr2.exprs.length-1)return next;connect(next,from=node())}else if(expr2.type=="star"){var loop=node();return edge(from,loop),connect(compile(expr2.expr,loop),loop),[edge(loop)]}else if(expr2.type=="plus"){var _loop=node();return connect(compile(expr2.expr,from),_loop),connect(compile(expr2.expr,_loop),_loop),[edge(_loop)]}else{if(expr2.type=="opt")return[edge(from)].concat(compile(expr2.expr,from));if(expr2.type=="range"){for(var cur=from,_i2=0;_i2<expr2.min;_i2++){var _next=node();connect(compile(expr2.expr,cur),_next),cur=_next}if(expr2.max==-1)connect(compile(expr2.expr,cur),cur);else for(var _i3=expr2.min;_i3<expr2.max;_i3++){var _next2=node();edge(cur,_next2),connect(compile(expr2.expr,cur),_next2),cur=_next2}return[edge(cur)]}else{if(expr2.type=="name")return[edge(from,void 0,expr2.value)];throw new Error("Unknown expr type")}}}}function cmp(a,b){return b-a}function nullFrom(nfa2,node){var result=[];return scan(node),result.sort(cmp);function scan(node2){var edges=nfa2[node2];if(edges.length==1&&!edges[0].term)return scan(edges[0].to);result.push(node2);for(var i=0;i<edges.length;i++){var _edges$i=edges[i],term=_edges$i.term,to=_edges$i.to;!term&&result.indexOf(to)==-1&&scan(to)}}}function dfa(nfa2){var labeled=Object.create(null);return explore(nullFrom(nfa2,0));function explore(states){var out=[];states.forEach(function(node){nfa2[node].forEach(function(_ref){var term=_ref.term,to=_ref.to;if(!!term){for(var set,i2=0;i2<out.length;i2++)out[i2][0]==term&&(set=out[i2][1]);nullFrom(nfa2,to).forEach(function(node2){set||out.push([term,set=[]]),set.indexOf(node2)==-1&&set.push(node2)})}})});for(var state=labeled[states.join(",")]=new ContentMatch(states.indexOf(nfa2.length-1)>-1),i=0;i<out.length;i++){var _states=out[i][1].sort(cmp);state.next.push({type:out[i][0],next:labeled[_states.join(",")]||explore(_states)})}return state}}function checkForDeadEnds(match,stream){for(var i=0,work=[match];i<work.length;i++){for(var state=work[i],dead=!state.validEnd,nodes=[],j=0;j<state.next.length;j++){var _state$next$j=state.next[j],type=_state$next$j.type,next=_state$next$j.next;nodes.push(type.name),dead&&!(type.isText||type.hasRequiredAttrs())&&(dead=!1),work.indexOf(next)==-1&&work.push(next)}dead&&stream.err("Only non-generatable nodes ("+nodes.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function defaultAttrs(attrs){var defaults=Object.create(null);for(var attrName in attrs){var attr=attrs[attrName];if(!attr.hasDefault)return null;defaults[attrName]=attr.default}return defaults}function _computeAttrs(attrs,value){var built=Object.create(null);for(var name in attrs){var given=value&&value[name];if(given===void 0){var attr=attrs[name];if(attr.hasDefault)given=attr.default;else throw new RangeError("No value supplied for attribute "+name)}built[name]=given}return built}function initAttrs(attrs){var result=Object.create(null);if(attrs)for(var name in attrs)result[name]=new Attribute(attrs[name]);return result}var NodeType=function(){function NodeType2(name,schema,spec){_classCallCheck(this,NodeType2),this.name=name,this.schema=schema,this.spec=spec,this.markSet=null,this.groups=spec.group?spec.group.split(" "):[],this.attrs=initAttrs(spec.attrs),this.defaultAttrs=defaultAttrs(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(spec.inline||name=="text"),this.isText=name=="text"}return _createClass(NodeType2,[{key:"isInline",get:function(){return!this.isBlock}},{key:"isTextblock",get:function(){return this.isBlock&&this.inlineContent}},{key:"isLeaf",get:function(){return this.contentMatch==ContentMatch.empty}},{key:"isAtom",get:function(){return this.isLeaf||!!this.spec.atom}},{key:"whitespace",get:function(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}},{key:"hasRequiredAttrs",value:function(){for(var n in this.attrs)if(this.attrs[n].isRequired)return!0;return!1}},{key:"compatibleContent",value:function(other){return this==other||this.contentMatch.compatible(other.contentMatch)}},{key:"computeAttrs",value:function(attrs){return!attrs&&this.defaultAttrs?this.defaultAttrs:_computeAttrs(this.attrs,attrs)}},{key:"create",value:function(){var attrs=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,content=arguments.length>1?arguments[1]:void 0,marks=arguments.length>2?arguments[2]:void 0;if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Node(this,this.computeAttrs(attrs),Fragment.from(content),Mark.setFrom(marks))}},{key:"createChecked",value:function(){var attrs=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,content=arguments.length>1?arguments[1]:void 0,marks=arguments.length>2?arguments[2]:void 0;if(content=Fragment.from(content),!this.validContent(content))throw new RangeError("Invalid content for node "+this.name);return new Node(this,this.computeAttrs(attrs),content,Mark.setFrom(marks))}},{key:"createAndFill",value:function(){var attrs=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,content=arguments.length>1?arguments[1]:void 0,marks=arguments.length>2?arguments[2]:void 0;if(attrs=this.computeAttrs(attrs),content=Fragment.from(content),content.size){var before=this.contentMatch.fillBefore(content);if(!before)return null;content=before.append(content)}var matched=this.contentMatch.matchFragment(content),after=matched&&matched.fillBefore(Fragment.empty,!0);return after?new Node(this,attrs,content.append(after),Mark.setFrom(marks)):null}},{key:"validContent",value:function(content){var result=this.contentMatch.matchFragment(content);if(!result||!result.validEnd)return!1;for(var i=0;i<content.childCount;i++)if(!this.allowsMarks(content.child(i).marks))return!1;return!0}},{key:"allowsMarkType",value:function(markType){return this.markSet==null||this.markSet.indexOf(markType)>-1}},{key:"allowsMarks",value:function(marks){if(this.markSet==null)return!0;for(var i=0;i<marks.length;i++)if(!this.allowsMarkType(marks[i].type))return!1;return!0}},{key:"allowedMarks",value:function(marks){if(this.markSet==null)return marks;for(var copy2,i=0;i<marks.length;i++)this.allowsMarkType(marks[i].type)?copy2&&copy2.push(marks[i]):copy2||(copy2=marks.slice(0,i));return copy2?copy2.length?copy2:Mark.none:marks}}],[{key:"compile",value:function(nodes,schema){var result=Object.create(null);nodes.forEach(function(name,spec){return result[name]=new NodeType2(name,schema,spec)});var topType=schema.spec.topNode||"doc";if(!result[topType])throw new RangeError("Schema is missing its top node type ('"+topType+"')");if(!result.text)throw new RangeError("Every schema needs a 'text' type");for(var _ in result.text.attrs)throw new RangeError("The text node type should not have attributes");return result}}]),NodeType2}(),Attribute=function(){function Attribute2(options){_classCallCheck(this,Attribute2),this.hasDefault=Object.prototype.hasOwnProperty.call(options,"default"),this.default=options.default}return _createClass(Attribute2,[{key:"isRequired",get:function(){return!this.hasDefault}}]),Attribute2}(),MarkType=function(){function MarkType2(name,rank,schema,spec){_classCallCheck(this,MarkType2),this.name=name,this.rank=rank,this.schema=schema,this.spec=spec,this.attrs=initAttrs(spec.attrs),this.excluded=null;var defaults=defaultAttrs(this.attrs);this.instance=defaults?new Mark(this,defaults):null}return _createClass(MarkType2,[{key:"create",value:function(){var attrs=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return!attrs&&this.instance?this.instance:new Mark(this,_computeAttrs(this.attrs,attrs))}},{key:"removeFromSet",value:function(set){for(var i=0;i<set.length;i++)set[i].type==this&&(set=set.slice(0,i).concat(set.slice(i+1)),i--);return set}},{key:"isInSet",value:function(set){for(var i=0;i<set.length;i++)if(set[i].type==this)return set[i]}},{key:"excludes",value:function(other){return this.excluded.indexOf(other)>-1}}],[{key:"compile",value:function(marks,schema){var result=Object.create(null),rank=0;return marks.forEach(function(name,spec){return result[name]=new MarkType2(name,rank++,schema,spec)}),result}}]),MarkType2}(),Schema=function(){function Schema2(spec){_classCallCheck(this,Schema2),this.cached=Object.create(null),this.spec={nodes:OrderedMap__default.default.from(spec.nodes),marks:OrderedMap__default.default.from(spec.marks||{}),topNode:spec.topNode},this.nodes=NodeType.compile(this.spec.nodes,this),this.marks=MarkType.compile(this.spec.marks,this);var contentExprCache=Object.create(null);for(var prop in this.nodes){if(prop in this.marks)throw new RangeError(prop+" can not be both a node and a mark");var type=this.nodes[prop],contentExpr=type.spec.content||"",markExpr=type.spec.marks;type.contentMatch=contentExprCache[contentExpr]||(contentExprCache[contentExpr]=ContentMatch.parse(contentExpr,this.nodes)),type.inlineContent=type.contentMatch.inlineContent,type.markSet=markExpr=="_"?null:markExpr?gatherMarks(this,markExpr.split(" ")):markExpr==""||!type.inlineContent?[]:null}for(var _prop in this.marks){var _type2=this.marks[_prop],excl=_type2.spec.excludes;_type2.excluded=excl==null?[_type2]:excl==""?[]:gatherMarks(this,excl.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}return _createClass(Schema2,[{key:"node",value:function(type){var attrs=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,content=arguments.length>2?arguments[2]:void 0,marks=arguments.length>3?arguments[3]:void 0;if(typeof type=="string")type=this.nodeType(type);else if(type instanceof NodeType){if(type.schema!=this)throw new RangeError("Node type from different schema used ("+type.name+")")}else throw new RangeError("Invalid node type: "+type);return type.createChecked(attrs,content,marks)}},{key:"text",value:function(_text,marks){var type=this.nodes.text;return new TextNode(type,type.defaultAttrs,_text,Mark.setFrom(marks))}},{key:"mark",value:function(type,attrs){return typeof type=="string"&&(type=this.marks[type]),type.create(attrs)}},{key:"nodeFromJSON",value:function(json){return Node.fromJSON(this,json)}},{key:"markFromJSON",value:function(json){return Mark.fromJSON(this,json)}},{key:"nodeType",value:function(name){var found2=this.nodes[name];if(!found2)throw new RangeError("Unknown node type: "+name);return found2}}]),Schema2}();function gatherMarks(schema,marks){for(var found2=[],i=0;i<marks.length;i++){var name=marks[i],mark=schema.marks[name],ok=mark;if(mark)found2.push(mark);else for(var prop in schema.marks){var _mark=schema.marks[prop];(name=="_"||_mark.spec.group&&_mark.spec.group.split(" ").indexOf(name)>-1)&&found2.push(ok=_mark)}if(!ok)throw new SyntaxError("Unknown mark type: '"+marks[i]+"'")}return found2}var DOMParser=function(){function DOMParser2(schema,rules){var _this2=this;_classCallCheck(this,DOMParser2),this.schema=schema,this.rules=rules,this.tags=[],this.styles=[],rules.forEach(function(rule){rule.tag?_this2.tags.push(rule):rule.style&&_this2.styles.push(rule)}),this.normalizeLists=!this.tags.some(function(r){if(!/^(ul|ol)\b/.test(r.tag)||!r.node)return!1;var node=schema.nodes[r.node];return node.contentMatch.matchType(node)})}return _createClass(DOMParser2,[{key:"parse",value:function(dom){var options=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},context=new ParseContext(this,options,!1);return context.addAll(dom,options.from,options.to),context.finish()}},{key:"parseSlice",value:function(dom){var options=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},context=new ParseContext(this,options,!0);return context.addAll(dom,options.from,options.to),Slice.maxOpen(context.finish())}},{key:"matchTag",value:function(dom,context,after){for(var i=after?this.tags.indexOf(after)+1:0;i<this.tags.length;i++){var rule=this.tags[i];if(matches(dom,rule.tag)&&(rule.namespace===void 0||dom.namespaceURI==rule.namespace)&&(!rule.context||context.matchesContext(rule.context))){if(rule.getAttrs){var result=rule.getAttrs(dom);if(result===!1)continue;rule.attrs=result||void 0}return rule}}}},{key:"matchStyle",value:function(prop,value,context,after){for(var i=after?this.styles.indexOf(after)+1:0;i<this.styles.length;i++){var rule=this.styles[i],style=rule.style;if(!(style.indexOf(prop)!=0||rule.context&&!context.matchesContext(rule.context)||style.length>prop.length&&(style.charCodeAt(prop.length)!=61||style.slice(prop.length+1)!=value))){if(rule.getAttrs){var result=rule.getAttrs(value);if(result===!1)continue;rule.attrs=result||void 0}return rule}}}}],[{key:"schemaRules",value:function(schema){var result=[];function insert(rule){for(var priority=rule.priority==null?50:rule.priority,i=0;i<result.length;i++){var next=result[i],nextPriority=next.priority==null?50:next.priority;if(nextPriority<priority)break}result.splice(i,0,rule)}var _loop2=function(name2){var rules=schema.marks[name2].spec.parseDOM;rules&&rules.forEach(function(rule){insert(rule=copy(rule)),rule.mark=name2})};for(var name in schema.marks)_loop2(name);var _loop3=function(_name2){var rules=schema.nodes[_name2].spec.parseDOM;rules&&rules.forEach(function(rule){insert(rule=copy(rule)),rule.node=_name2})};for(var _name in schema.nodes)_loop3(_name);return result}},{key:"fromSchema",value:function(schema){return schema.cached.domParser||(schema.cached.domParser=new DOMParser2(schema,DOMParser2.schemaRules(schema)))}}]),DOMParser2}(),blockTags={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},ignoreTags={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},listTags={ol:!0,ul:!0},OPT_PRESERVE_WS=1,OPT_PRESERVE_WS_FULL=2,OPT_OPEN_LEFT=4;function wsOptionsFor(type,preserveWhitespace,base){return preserveWhitespace!=null?(preserveWhitespace?OPT_PRESERVE_WS:0)|(preserveWhitespace==="full"?OPT_PRESERVE_WS_FULL:0):type&&type.whitespace=="pre"?OPT_PRESERVE_WS|OPT_PRESERVE_WS_FULL:base&~OPT_OPEN_LEFT}var NodeContext=function(){function NodeContext2(type,attrs,marks,pendingMarks,solid,match,options){_classCallCheck(this,NodeContext2),this.type=type,this.attrs=attrs,this.marks=marks,this.pendingMarks=pendingMarks,this.solid=solid,this.options=options,this.content=[],this.activeMarks=Mark.none,this.stashMarks=[],this.match=match||(options&OPT_OPEN_LEFT?null:type.contentMatch)}return _createClass(NodeContext2,[{key:"findWrapping",value:function(node){if(!this.match){if(!this.type)return[];var fill=this.type.contentMatch.fillBefore(Fragment.from(node));if(fill)this.match=this.type.contentMatch.matchFragment(fill);else{var start=this.type.contentMatch,wrap;return(wrap=start.findWrapping(node.type))?(this.match=start,wrap):null}}return this.match.findWrapping(node.type)}},{key:"finish",value:function(openEnd){if(!(this.options&OPT_PRESERVE_WS)){var last=this.content[this.content.length-1],m;if(last&&last.isText&&(m=/[ \t\r\n\u000c]+$/.exec(last.text))){var text=last;last.text.length==m[0].length?this.content.pop():this.content[this.content.length-1]=text.withText(text.text.slice(0,text.text.length-m[0].length))}}var content=Fragment.from(this.content);return!openEnd&&this.match&&(content=content.append(this.match.fillBefore(Fragment.empty,!0))),this.type?this.type.create(this.attrs,content,this.marks):content}},{key:"popFromStashMark",value:function(mark){for(var i=this.stashMarks.length-1;i>=0;i--)if(mark.eq(this.stashMarks[i]))return this.stashMarks.splice(i,1)[0]}},{key:"applyPending",value:function(nextType){for(var i=0,pending=this.pendingMarks;i<pending.length;i++){var mark=pending[i];(this.type?this.type.allowsMarkType(mark.type):markMayApply(mark.type,nextType))&&!mark.isInSet(this.activeMarks)&&(this.activeMarks=mark.addToSet(this.activeMarks),this.pendingMarks=mark.removeFromSet(this.pendingMarks))}}},{key:"inlineContext",value:function(node){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:node.parentNode&&!blockTags.hasOwnProperty(node.parentNode.nodeName.toLowerCase())}}]),NodeContext2}(),ParseContext=function(){function ParseContext2(parser,options,isOpen){_classCallCheck(this,ParseContext2),this.parser=parser,this.options=options,this.isOpen=isOpen,this.open=0;var topNode=options.topNode,topContext,topOptions=wsOptionsFor(null,options.preserveWhitespace,0)|(isOpen?OPT_OPEN_LEFT:0);topNode?topContext=new NodeContext(topNode.type,topNode.attrs,Mark.none,Mark.none,!0,options.topMatch||topNode.type.contentMatch,topOptions):isOpen?topContext=new NodeContext(null,null,Mark.none,Mark.none,!0,null,topOptions):topContext=new NodeContext(parser.schema.topNodeType,null,Mark.none,Mark.none,!0,null,topOptions),this.nodes=[topContext],this.find=options.findPositions,this.needsBlock=!1}return _createClass(ParseContext2,[{key:"top",get:function(){return this.nodes[this.open]}},{key:"addDOM",value:function(dom){if(dom.nodeType==3)this.addTextNode(dom);else if(dom.nodeType==1){var style=dom.getAttribute("style"),marks=style?this.readStyles(parseStyles(style)):null,top=this.top;if(marks!=null)for(var i=0;i<marks.length;i++)this.addPendingMark(marks[i]);if(this.addElement(dom),marks!=null)for(var _i4=0;_i4<marks.length;_i4++)this.removePendingMark(marks[_i4],top)}}},{key:"addTextNode",value:function(dom){var value=dom.nodeValue,top=this.top;if(top.options&OPT_PRESERVE_WS_FULL||top.inlineContext(dom)||/[^ \t\r\n\u000c]/.test(value)){if(top.options&OPT_PRESERVE_WS)top.options&OPT_PRESERVE_WS_FULL?value=value.replace(/\r\n?/g,`
`):value=value.replace(/\r?\n|\r/g," ");else if(value=value.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(value)&&this.open==this.nodes.length-1){var nodeBefore=top.content[top.content.length-1],domNodeBefore=dom.previousSibling;(!nodeBefore||domNodeBefore&&domNodeBefore.nodeName=="BR"||nodeBefore.isText&&/[ \t\r\n\u000c]$/.test(nodeBefore.text))&&(value=value.slice(1))}value&&this.insertNode(this.parser.schema.text(value)),this.findInText(dom)}else this.findInside(dom)}},{key:"addElement",value:function(dom,matchAfter){var name=dom.nodeName.toLowerCase(),ruleID;listTags.hasOwnProperty(name)&&this.parser.normalizeLists&&normalizeList(dom);var rule=this.options.ruleFromNode&&this.options.ruleFromNode(dom)||(ruleID=this.parser.matchTag(dom,this,matchAfter));if(rule?rule.ignore:ignoreTags.hasOwnProperty(name))this.findInside(dom),this.ignoreFallback(dom);else if(!rule||rule.skip||rule.closeParent){rule&&rule.closeParent?this.open=Math.max(0,this.open-1):rule&&rule.skip.nodeType&&(dom=rule.skip);var sync,top=this.top,oldNeedsBlock=this.needsBlock;if(blockTags.hasOwnProperty(name))sync=!0,top.type||(this.needsBlock=!0);else if(!dom.firstChild){this.leafFallback(dom);return}this.addAll(dom),sync&&this.sync(top),this.needsBlock=oldNeedsBlock}else this.addElementByRule(dom,rule,rule.consuming===!1?ruleID:void 0)}},{key:"leafFallback",value:function(dom){dom.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(dom.ownerDocument.createTextNode(`
`))}},{key:"ignoreFallback",value:function(dom){dom.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"))}},{key:"readStyles",value:function(styles){var marks=Mark.none;style:for(var i=0;i<styles.length;i+=2)for(var after=void 0;;){var rule=this.parser.matchStyle(styles[i],styles[i+1],this,after);if(!rule)continue style;if(rule.ignore)return null;if(marks=this.parser.schema.marks[rule.mark].create(rule.attrs).addToSet(marks),rule.consuming===!1)after=rule;else break}return marks}},{key:"addElementByRule",value:function(dom,rule,continueAfter){var _this3=this,sync,nodeType,mark;if(rule.node)nodeType=this.parser.schema.nodes[rule.node],nodeType.isLeaf?this.insertNode(nodeType.create(rule.attrs))||this.leafFallback(dom):sync=this.enter(nodeType,rule.attrs||null,rule.preserveWhitespace);else{var markType=this.parser.schema.marks[rule.mark];mark=markType.create(rule.attrs),this.addPendingMark(mark)}var startIn=this.top;if(nodeType&&nodeType.isLeaf)this.findInside(dom);else if(continueAfter)this.addElement(dom,continueAfter);else if(rule.getContent)this.findInside(dom),rule.getContent(dom,this.parser.schema).forEach(function(node){return _this3.insertNode(node)});else{var contentDOM=dom;typeof rule.contentElement=="string"?contentDOM=dom.querySelector(rule.contentElement):typeof rule.contentElement=="function"?contentDOM=rule.contentElement(dom):rule.contentElement&&(contentDOM=rule.contentElement),this.findAround(dom,contentDOM,!0),this.addAll(contentDOM)}sync&&this.sync(startIn)&&this.open--,mark&&this.removePendingMark(mark,startIn)}},{key:"addAll",value:function(parent,startIndex,endIndex){for(var index=startIndex||0,dom=startIndex?parent.childNodes[startIndex]:parent.firstChild,end=endIndex==null?null:parent.childNodes[endIndex];dom!=end;dom=dom.nextSibling,++index)this.findAtPoint(parent,index),this.addDOM(dom);this.findAtPoint(parent,index)}},{key:"findPlace",value:function(node){for(var route,sync,depth=this.open;depth>=0;depth--){var cx=this.nodes[depth],_found2=cx.findWrapping(node);if(_found2&&(!route||route.length>_found2.length)&&(route=_found2,sync=cx,!_found2.length)||cx.solid)break}if(!route)return!1;this.sync(sync);for(var i=0;i<route.length;i++)this.enterInner(route[i],null,!1);return!0}},{key:"insertNode",value:function(node){if(node.isInline&&this.needsBlock&&!this.top.type){var block=this.textblockFromContext();block&&this.enterInner(block)}if(this.findPlace(node)){this.closeExtra();var top=this.top;top.applyPending(node.type),top.match&&(top.match=top.match.matchType(node.type));for(var marks=top.activeMarks,i=0;i<node.marks.length;i++)(!top.type||top.type.allowsMarkType(node.marks[i].type))&&(marks=node.marks[i].addToSet(marks));return top.content.push(node.mark(marks)),!0}return!1}},{key:"enter",value:function(type,attrs,preserveWS){var ok=this.findPlace(type.create(attrs));return ok&&this.enterInner(type,attrs,!0,preserveWS),ok}},{key:"enterInner",value:function(type){var attrs=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,solid=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,preserveWS=arguments.length>3?arguments[3]:void 0;this.closeExtra();var top=this.top;top.applyPending(type),top.match=top.match&&top.match.matchType(type);var options=wsOptionsFor(type,preserveWS,top.options);top.options&OPT_OPEN_LEFT&&top.content.length==0&&(options|=OPT_OPEN_LEFT),this.nodes.push(new NodeContext(type,attrs,top.activeMarks,top.pendingMarks,solid,null,options)),this.open++}},{key:"closeExtra",value:function(){var openEnd=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,i=this.nodes.length-1;if(i>this.open){for(;i>this.open;i--)this.nodes[i-1].content.push(this.nodes[i].finish(openEnd));this.nodes.length=this.open+1}}},{key:"finish",value:function(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)}},{key:"sync",value:function(to){for(var i=this.open;i>=0;i--)if(this.nodes[i]==to)return this.open=i,!0;return!1}},{key:"currentPos",get:function(){this.closeExtra();for(var pos=0,i=this.open;i>=0;i--){for(var content=this.nodes[i].content,j=content.length-1;j>=0;j--)pos+=content[j].nodeSize;i&&pos++}return pos}},{key:"findAtPoint",value:function(parent,offset){if(this.find)for(var i=0;i<this.find.length;i++)this.find[i].node==parent&&this.find[i].offset==offset&&(this.find[i].pos=this.currentPos)}},{key:"findInside",value:function(parent){if(this.find)for(var i=0;i<this.find.length;i++)this.find[i].pos==null&&parent.nodeType==1&&parent.contains(this.find[i].node)&&(this.find[i].pos=this.currentPos)}},{key:"findAround",value:function(parent,content,before){if(parent!=content&&this.find){for(var i=0;i<this.find.length;i++)if(this.find[i].pos==null&&parent.nodeType==1&&parent.contains(this.find[i].node)){var pos=content.compareDocumentPosition(this.find[i].node);pos&(before?2:4)&&(this.find[i].pos=this.currentPos)}}}},{key:"findInText",value:function(textNode){if(this.find)for(var i=0;i<this.find.length;i++)this.find[i].node==textNode&&(this.find[i].pos=this.currentPos-(textNode.nodeValue.length-this.find[i].offset))}},{key:"matchesContext",value:function(context){var _this4=this;if(context.indexOf("|")>-1)return context.split(/\s*\|\s*/).some(this.matchesContext,this);var parts=context.split("/"),option=this.options.context,useRoot=!this.isOpen&&(!option||option.parent.type==this.nodes[0].type),minDepth=-(option?option.depth+1:0)+(useRoot?0:1),match=function match2(i,depth){for(;i>=0;i--){var part=parts[i];if(part==""){if(i==parts.length-1||i==0)continue;for(;depth>=minDepth;depth--)if(match2(i-1,depth))return!0;return!1}else{var next=depth>0||depth==0&&useRoot?_this4.nodes[depth].type:option&&depth>=minDepth?option.node(depth-minDepth).type:null;if(!next||next.name!=part&&next.groups.indexOf(part)==-1)return!1;depth--}}return!0};return match(parts.length-1,this.open)}},{key:"textblockFromContext",value:function(){var $context=this.options.context;if($context)for(var d=$context.depth;d>=0;d--){var deflt=$context.node(d).contentMatchAt($context.indexAfter(d)).defaultType;if(deflt&&deflt.isTextblock&&deflt.defaultAttrs)return deflt}for(var name in this.parser.schema.nodes){var type=this.parser.schema.nodes[name];if(type.isTextblock&&type.defaultAttrs)return type}}},{key:"addPendingMark",value:function(mark){var found2=findSameMarkInSet(mark,this.top.pendingMarks);found2&&this.top.stashMarks.push(found2),this.top.pendingMarks=mark.addToSet(this.top.pendingMarks)}},{key:"removePendingMark",value:function(mark,upto){for(var depth=this.open;depth>=0;depth--){var level=this.nodes[depth],_found3=level.pendingMarks.lastIndexOf(mark);if(_found3>-1)level.pendingMarks=mark.removeFromSet(level.pendingMarks);else{level.activeMarks=mark.removeFromSet(level.activeMarks);var stashMark=level.popFromStashMark(mark);stashMark&&level.type&&level.type.allowsMarkType(stashMark.type)&&(level.activeMarks=stashMark.addToSet(level.activeMarks))}if(level==upto)break}}}]),ParseContext2}();function normalizeList(dom){for(var child=dom.firstChild,prevItem=null;child;child=child.nextSibling){var name=child.nodeType==1?child.nodeName.toLowerCase():null;name&&listTags.hasOwnProperty(name)&&prevItem?(prevItem.appendChild(child),child=prevItem):name=="li"?prevItem=child:name&&(prevItem=null)}}function matches(dom,selector){return(dom.matches||dom.msMatchesSelector||dom.webkitMatchesSelector||dom.mozMatchesSelector).call(dom,selector)}function parseStyles(style){for(var re=/\s*([\w-]+)\s*:\s*([^;]+)/g,m,result=[];m=re.exec(style);)result.push(m[1],m[2].trim());return result}function copy(obj){var copy2={};for(var prop in obj)copy2[prop]=obj[prop];return copy2}function markMayApply(markType,nodeType){var nodes=nodeType.schema.nodes,_loop4=function(name2){var parent=nodes[name2];if(!parent.allowsMarkType(markType))return"continue";var seen=[],scan=function scan2(match){seen.push(match);for(var i=0;i<match.edgeCount;i++){var _match$edge=match.edge(i),type=_match$edge.type,next=_match$edge.next;if(type==nodeType||seen.indexOf(next)<0&&scan2(next))return!0}};if(scan(parent.contentMatch))return{v:!0}};for(var name in nodes){var _ret=_loop4(name);if(_ret!=="continue"&&_typeof(_ret)==="object")return _ret.v}}function findSameMarkInSet(mark,set){for(var i=0;i<set.length;i++)if(mark.eq(set[i]))return set[i]}var DOMSerializer=function(){function DOMSerializer2(nodes,marks){_classCallCheck(this,DOMSerializer2),this.nodes=nodes,this.marks=marks}return _createClass(DOMSerializer2,[{key:"serializeFragment",value:function(fragment){var _this5=this,options=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},target=arguments.length>2?arguments[2]:void 0;target||(target=doc(options).createDocumentFragment());var top=target,active=[];return fragment.forEach(function(node){if(active.length||node.marks.length){for(var keep=0,rendered=0;keep<active.length&&rendered<node.marks.length;){var next=node.marks[rendered];if(!_this5.marks[next.type.name]){rendered++;continue}if(!next.eq(active[keep][0])||next.type.spec.spanning===!1)break;keep++,rendered++}for(;keep<active.length;)top=active.pop()[1];for(;rendered<node.marks.length;){var add=node.marks[rendered++],markDOM=_this5.serializeMark(add,node.isInline,options);markDOM&&(active.push([add,top]),top.appendChild(markDOM.dom),top=markDOM.contentDOM||markDOM.dom)}}top.appendChild(_this5.serializeNodeInner(node,options))}),target}},{key:"serializeNodeInner",value:function(node,options){var _DOMSerializer$render=DOMSerializer2.renderSpec(doc(options),this.nodes[node.type.name](node)),dom=_DOMSerializer$render.dom,contentDOM=_DOMSerializer$render.contentDOM;if(contentDOM){if(node.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(node.content,options,contentDOM)}return dom}},{key:"serializeNode",value:function(node){for(var options=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},dom=this.serializeNodeInner(node,options),i=node.marks.length-1;i>=0;i--){var wrap=this.serializeMark(node.marks[i],node.isInline,options);wrap&&((wrap.contentDOM||wrap.dom).appendChild(dom),dom=wrap.dom)}return dom}},{key:"serializeMark",value:function(mark,inline){var options=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},toDOM=this.marks[mark.type.name];return toDOM&&DOMSerializer2.renderSpec(doc(options),toDOM(mark,inline))}}],[{key:"renderSpec",value:function(doc2,structure){var xmlNS=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(typeof structure=="string")return{dom:doc2.createTextNode(structure)};if(structure.nodeType!=null)return{dom:structure};if(structure.dom&&structure.dom.nodeType!=null)return structure;var tagName=structure[0],space=tagName.indexOf(" ");space>0&&(xmlNS=tagName.slice(0,space),tagName=tagName.slice(space+1));var contentDOM,dom=xmlNS?doc2.createElementNS(xmlNS,tagName):doc2.createElement(tagName),attrs=structure[1],start=1;if(attrs&&_typeof(attrs)=="object"&&attrs.nodeType==null&&!Array.isArray(attrs)){start=2;for(var name in attrs)if(attrs[name]!=null){var _space=name.indexOf(" ");_space>0?dom.setAttributeNS(name.slice(0,_space),name.slice(_space+1),attrs[name]):dom.setAttribute(name,attrs[name])}}for(var i=start;i<structure.length;i++){var child=structure[i];if(child===0){if(i<structure.length-1||i>start)throw new RangeError("Content hole must be the only child of its parent node");return{dom,contentDOM:dom}}else{var _DOMSerializer$render2=DOMSerializer2.renderSpec(doc2,child,xmlNS),inner=_DOMSerializer$render2.dom,innerContent=_DOMSerializer$render2.contentDOM;if(dom.appendChild(inner),innerContent){if(contentDOM)throw new RangeError("Multiple content holes");contentDOM=innerContent}}}return{dom,contentDOM}}},{key:"fromSchema",value:function(schema){return schema.cached.domSerializer||(schema.cached.domSerializer=new DOMSerializer2(this.nodesFromSchema(schema),this.marksFromSchema(schema)))}},{key:"nodesFromSchema",value:function(schema){var result=gatherToDOM(schema.nodes);return result.text||(result.text=function(node){return node.text}),result}},{key:"marksFromSchema",value:function(schema){return gatherToDOM(schema.marks)}}]),DOMSerializer2}();function gatherToDOM(obj){var result={};for(var name in obj){var toDOM=obj[name].spec.toDOM;toDOM&&(result[name]=toDOM)}return result}function doc(options){return options.document||window.document}exports.ContentMatch=ContentMatch,exports.DOMParser=DOMParser,exports.DOMSerializer=DOMSerializer,exports.Fragment=Fragment,exports.Mark=Mark,exports.MarkType=MarkType,exports.Node=Node,exports.NodeRange=NodeRange,exports.NodeType=NodeType,exports.ReplaceError=ReplaceError,exports.ResolvedPos=ResolvedPos,exports.Schema=Schema,exports.Slice=Slice;

//# sourceMappingURL=a978fa16a5f879171eac.cjs.map