"use strict";function _typeof(obj){return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(obj2){return typeof obj2}:function(obj2){return obj2&&typeof Symbol=="function"&&obj2.constructor===Symbol&&obj2!==Symbol.prototype?"symbol":typeof obj2},_typeof(obj)}function _get(){return typeof Reflect!="undefined"&&Reflect.get?_get=Reflect.get:_get=function(target,property,receiver){var base=_superPropBase(target,property);if(!!base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(arguments.length<3?target:receiver):desc.value}},_get.apply(this,arguments)}function _superPropBase(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&(object=_getPrototypeOf(object),object!==null););return object}function _inherits(subClass,superClass){if(typeof superClass!="function"&&superClass!==null)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf||function(o2,p2){return o2.__proto__=p2,o2},_setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call=="function"))return call;if(call!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function _isNativeReflectConstruct(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function _getPrototypeOf(o){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o2){return o2.__proto__||Object.getPrototypeOf(o2)},_getPrototypeOf(o)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}Object.defineProperty(exports,"__esModule",{value:!0});var prosemirrorModel=require("prosemirror-model"),prosemirrorTransform=require("prosemirror-transform"),classesById=Object.create(null),Selection=function(){function Selection2($anchor,$head,ranges){_classCallCheck(this,Selection2),this.$anchor=$anchor,this.$head=$head,this.ranges=ranges||[new SelectionRange($anchor.min($head),$anchor.max($head))]}return _createClass(Selection2,[{key:"anchor",get:function(){return this.$anchor.pos}},{key:"head",get:function(){return this.$head.pos}},{key:"from",get:function(){return this.$from.pos}},{key:"to",get:function(){return this.$to.pos}},{key:"$from",get:function(){return this.ranges[0].$from}},{key:"$to",get:function(){return this.ranges[0].$to}},{key:"empty",get:function(){for(var ranges=this.ranges,i=0;i<ranges.length;i++)if(ranges[i].$from.pos!=ranges[i].$to.pos)return!1;return!0}},{key:"content",value:function(){return this.$from.doc.slice(this.from,this.to,!0)}},{key:"replace",value:function(tr){for(var content=arguments.length>1&&arguments[1]!==void 0?arguments[1]:prosemirrorModel.Slice.empty,lastNode=content.content.lastChild,lastParent=null,i=0;i<content.openEnd;i++)lastParent=lastNode,lastNode=lastNode.lastChild;for(var mapFrom=tr.steps.length,ranges=this.ranges,_i=0;_i<ranges.length;_i++){var _ranges$_i=ranges[_i],$from=_ranges$_i.$from,$to=_ranges$_i.$to,mapping=tr.mapping.slice(mapFrom);tr.replaceRange(mapping.map($from.pos),mapping.map($to.pos),_i?prosemirrorModel.Slice.empty:content),_i==0&&selectionToInsertionEnd(tr,mapFrom,(lastNode?lastNode.isInline:lastParent&&lastParent.isTextblock)?-1:1)}}},{key:"replaceWith",value:function(tr,node){for(var mapFrom=tr.steps.length,ranges=this.ranges,i=0;i<ranges.length;i++){var _ranges$i=ranges[i],$from=_ranges$i.$from,$to=_ranges$i.$to,mapping=tr.mapping.slice(mapFrom),from=mapping.map($from.pos),to=mapping.map($to.pos);i?tr.deleteRange(from,to):(tr.replaceRangeWith(from,to,node),selectionToInsertionEnd(tr,mapFrom,node.isInline?-1:1))}}},{key:"getBookmark",value:function(){return TextSelection.between(this.$anchor,this.$head).getBookmark()}}],[{key:"findFrom",value:function($pos,dir){var textOnly=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,inner=$pos.parent.inlineContent?new TextSelection($pos):findSelectionIn($pos.node(0),$pos.parent,$pos.pos,$pos.index(),dir,textOnly);if(inner)return inner;for(var depth=$pos.depth-1;depth>=0;depth--){var found=dir<0?findSelectionIn($pos.node(0),$pos.node(depth),$pos.before(depth+1),$pos.index(depth),dir,textOnly):findSelectionIn($pos.node(0),$pos.node(depth),$pos.after(depth+1),$pos.index(depth)+1,dir,textOnly);if(found)return found}return null}},{key:"near",value:function($pos){var bias=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this.findFrom($pos,bias)||this.findFrom($pos,-bias)||new AllSelection($pos.node(0))}},{key:"atStart",value:function(doc){return findSelectionIn(doc,doc,0,0,1)||new AllSelection(doc)}},{key:"atEnd",value:function(doc){return findSelectionIn(doc,doc,doc.content.size,doc.childCount,-1)||new AllSelection(doc)}},{key:"fromJSON",value:function(doc,json){if(!json||!json.type)throw new RangeError("Invalid input for Selection.fromJSON");var cls=classesById[json.type];if(!cls)throw new RangeError("No selection type ".concat(json.type," defined"));return cls.fromJSON(doc,json)}},{key:"jsonID",value:function(id,selectionClass){if(id in classesById)throw new RangeError("Duplicate use of selection JSON ID "+id);return classesById[id]=selectionClass,selectionClass.prototype.jsonID=id,selectionClass}}]),Selection2}();Selection.prototype.visible=!0;var SelectionRange=_createClass(function SelectionRange2($from,$to){_classCallCheck(this,SelectionRange2),this.$from=$from,this.$to=$to}),warnedAboutTextSelection=!1;function checkTextSelection($pos){!warnedAboutTextSelection&&!$pos.parent.inlineContent&&(warnedAboutTextSelection=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+$pos.parent.type.name+")"))}var TextSelection=function(_Selection){_inherits(TextSelection2,_Selection);var _super=_createSuper(TextSelection2);function TextSelection2($anchor){var $head=arguments.length>1&&arguments[1]!==void 0?arguments[1]:$anchor;return _classCallCheck(this,TextSelection2),checkTextSelection($anchor),checkTextSelection($head),_super.call(this,$anchor,$head)}return _createClass(TextSelection2,[{key:"$cursor",get:function(){return this.$anchor.pos==this.$head.pos?this.$head:null}},{key:"map",value:function(doc,mapping){var $head=doc.resolve(mapping.map(this.head));if(!$head.parent.inlineContent)return Selection.near($head);var $anchor=doc.resolve(mapping.map(this.anchor));return new TextSelection2($anchor.parent.inlineContent?$anchor:$head,$head)}},{key:"replace",value:function(tr){var content=arguments.length>1&&arguments[1]!==void 0?arguments[1]:prosemirrorModel.Slice.empty;if(_get(_getPrototypeOf(TextSelection2.prototype),"replace",this).call(this,tr,content),content==prosemirrorModel.Slice.empty){var marks=this.$from.marksAcross(this.$to);marks&&tr.ensureMarks(marks)}}},{key:"eq",value:function(other){return other instanceof TextSelection2&&other.anchor==this.anchor&&other.head==this.head}},{key:"getBookmark",value:function(){return new TextBookmark(this.anchor,this.head)}},{key:"toJSON",value:function(){return{type:"text",anchor:this.anchor,head:this.head}}}],[{key:"fromJSON",value:function(doc,json){if(typeof json.anchor!="number"||typeof json.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new TextSelection2(doc.resolve(json.anchor),doc.resolve(json.head))}},{key:"create",value:function(doc,anchor){var head=arguments.length>2&&arguments[2]!==void 0?arguments[2]:anchor,$anchor=doc.resolve(anchor);return new this($anchor,head==anchor?$anchor:doc.resolve(head))}},{key:"between",value:function($anchor,$head,bias){var dPos=$anchor.pos-$head.pos;if((!bias||dPos)&&(bias=dPos>=0?1:-1),!$head.parent.inlineContent){var found=Selection.findFrom($head,bias,!0)||Selection.findFrom($head,-bias,!0);if(found)$head=found.$head;else return Selection.near($head,bias)}return $anchor.parent.inlineContent||(dPos==0?$anchor=$head:($anchor=(Selection.findFrom($anchor,-bias,!0)||Selection.findFrom($anchor,bias,!0)).$anchor,$anchor.pos<$head.pos!=dPos<0&&($anchor=$head))),new TextSelection2($anchor,$head)}}]),TextSelection2}(Selection);Selection.jsonID("text",TextSelection);var TextBookmark=function(){function TextBookmark2(anchor,head){_classCallCheck(this,TextBookmark2),this.anchor=anchor,this.head=head}return _createClass(TextBookmark2,[{key:"map",value:function(mapping){return new TextBookmark2(mapping.map(this.anchor),mapping.map(this.head))}},{key:"resolve",value:function(doc){return TextSelection.between(doc.resolve(this.anchor),doc.resolve(this.head))}}]),TextBookmark2}(),NodeSelection=function(_Selection2){_inherits(NodeSelection2,_Selection2);var _super2=_createSuper(NodeSelection2);function NodeSelection2($pos){var _this;_classCallCheck(this,NodeSelection2);var node=$pos.nodeAfter,$end=$pos.node(0).resolve($pos.pos+node.nodeSize);return _this=_super2.call(this,$pos,$end),_this.node=node,_this}return _createClass(NodeSelection2,[{key:"map",value:function(doc,mapping){var _mapping$mapResult=mapping.mapResult(this.anchor),deleted=_mapping$mapResult.deleted,pos=_mapping$mapResult.pos,$pos=doc.resolve(pos);return deleted?Selection.near($pos):new NodeSelection2($pos)}},{key:"content",value:function(){return new prosemirrorModel.Slice(prosemirrorModel.Fragment.from(this.node),0,0)}},{key:"eq",value:function(other){return other instanceof NodeSelection2&&other.anchor==this.anchor}},{key:"toJSON",value:function(){return{type:"node",anchor:this.anchor}}},{key:"getBookmark",value:function(){return new NodeBookmark(this.anchor)}}],[{key:"fromJSON",value:function(doc,json){if(typeof json.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new NodeSelection2(doc.resolve(json.anchor))}},{key:"create",value:function(doc,from){return new NodeSelection2(doc.resolve(from))}},{key:"isSelectable",value:function(node){return!node.isText&&node.type.spec.selectable!==!1}}]),NodeSelection2}(Selection);NodeSelection.prototype.visible=!1,Selection.jsonID("node",NodeSelection);var NodeBookmark=function(){function NodeBookmark2(anchor){_classCallCheck(this,NodeBookmark2),this.anchor=anchor}return _createClass(NodeBookmark2,[{key:"map",value:function(mapping){var _mapping$mapResult2=mapping.mapResult(this.anchor),deleted=_mapping$mapResult2.deleted,pos=_mapping$mapResult2.pos;return deleted?new TextBookmark(pos,pos):new NodeBookmark2(pos)}},{key:"resolve",value:function(doc){var $pos=doc.resolve(this.anchor),node=$pos.nodeAfter;return node&&NodeSelection.isSelectable(node)?new NodeSelection($pos):Selection.near($pos)}}]),NodeBookmark2}(),AllSelection=function(_Selection3){_inherits(AllSelection2,_Selection3);var _super3=_createSuper(AllSelection2);function AllSelection2(doc){return _classCallCheck(this,AllSelection2),_super3.call(this,doc.resolve(0),doc.resolve(doc.content.size))}return _createClass(AllSelection2,[{key:"replace",value:function(tr){var content=arguments.length>1&&arguments[1]!==void 0?arguments[1]:prosemirrorModel.Slice.empty;if(content==prosemirrorModel.Slice.empty){tr.delete(0,tr.doc.content.size);var sel=Selection.atStart(tr.doc);sel.eq(tr.selection)||tr.setSelection(sel)}else _get(_getPrototypeOf(AllSelection2.prototype),"replace",this).call(this,tr,content)}},{key:"toJSON",value:function(){return{type:"all"}}},{key:"map",value:function(doc){return new AllSelection2(doc)}},{key:"eq",value:function(other){return other instanceof AllSelection2}},{key:"getBookmark",value:function(){return AllBookmark}}],[{key:"fromJSON",value:function(doc){return new AllSelection2(doc)}}]),AllSelection2}(Selection);Selection.jsonID("all",AllSelection);var AllBookmark={map:function(){return this},resolve:function(doc){return new AllSelection(doc)}};function findSelectionIn(doc,node,pos,index,dir){var text=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;if(node.inlineContent)return TextSelection.create(doc,pos);for(var i=index-(dir>0?0:1);dir>0?i<node.childCount:i>=0;i+=dir){var child=node.child(i);if(child.isAtom){if(!text&&NodeSelection.isSelectable(child))return NodeSelection.create(doc,pos-(dir<0?child.nodeSize:0))}else{var inner=findSelectionIn(doc,child,pos+dir,dir<0?child.childCount:0,dir,text);if(inner)return inner}pos+=child.nodeSize*dir}return null}function selectionToInsertionEnd(tr,startLen,bias){var last=tr.steps.length-1;if(!(last<startLen)){var step=tr.steps[last];if(step instanceof prosemirrorTransform.ReplaceStep||step instanceof prosemirrorTransform.ReplaceAroundStep){var map2=tr.mapping.maps[last],end;map2.forEach(function(_from,_to,_newFrom,newTo){end==null&&(end=newTo)}),tr.setSelection(Selection.near(tr.doc.resolve(end),bias))}}}var UPDATED_SEL=1,UPDATED_MARKS=2,UPDATED_SCROLL=4,Transaction=function(_prosemirrorTransform){_inherits(Transaction2,_prosemirrorTransform);var _super4=_createSuper(Transaction2);function Transaction2(state){var _this2;return _classCallCheck(this,Transaction2),_this2=_super4.call(this,state.doc),_this2.curSelectionFor=0,_this2.updated=0,_this2.meta=Object.create(null),_this2.time=Date.now(),_this2.curSelection=state.selection,_this2.storedMarks=state.storedMarks,_this2}return _createClass(Transaction2,[{key:"selection",get:function(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}},{key:"setSelection",value:function(selection){if(selection.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=selection,this.curSelectionFor=this.steps.length,this.updated=(this.updated|UPDATED_SEL)&~UPDATED_MARKS,this.storedMarks=null,this}},{key:"selectionSet",get:function(){return(this.updated&UPDATED_SEL)>0}},{key:"setStoredMarks",value:function(marks){return this.storedMarks=marks,this.updated|=UPDATED_MARKS,this}},{key:"ensureMarks",value:function(marks){return prosemirrorModel.Mark.sameSet(this.storedMarks||this.selection.$from.marks(),marks)||this.setStoredMarks(marks),this}},{key:"addStoredMark",value:function(mark){return this.ensureMarks(mark.addToSet(this.storedMarks||this.selection.$head.marks()))}},{key:"removeStoredMark",value:function(mark){return this.ensureMarks(mark.removeFromSet(this.storedMarks||this.selection.$head.marks()))}},{key:"storedMarksSet",get:function(){return(this.updated&UPDATED_MARKS)>0}},{key:"addStep",value:function(step,doc){_get(_getPrototypeOf(Transaction2.prototype),"addStep",this).call(this,step,doc),this.updated=this.updated&~UPDATED_MARKS,this.storedMarks=null}},{key:"setTime",value:function(time){return this.time=time,this}},{key:"replaceSelection",value:function(slice){return this.selection.replace(this,slice),this}},{key:"replaceSelectionWith",value:function(node){var inheritMarks=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,selection=this.selection;return inheritMarks&&(node=node.mark(this.storedMarks||(selection.empty?selection.$from.marks():selection.$from.marksAcross(selection.$to)||prosemirrorModel.Mark.none))),selection.replaceWith(this,node),this}},{key:"deleteSelection",value:function(){return this.selection.replace(this),this}},{key:"insertText",value:function(text,from,to){var schema=this.doc.type.schema;if(from==null)return text?this.replaceSelectionWith(schema.text(text),!0):this.deleteSelection();if(to==null&&(to=from),to=to==null?from:to,!text)return this.deleteRange(from,to);var marks=this.storedMarks;if(!marks){var $from=this.doc.resolve(from);marks=to==from?$from.marks():$from.marksAcross(this.doc.resolve(to))}return this.replaceRangeWith(from,to,schema.text(text,marks)),this.selection.empty||this.setSelection(Selection.near(this.selection.$to)),this}},{key:"setMeta",value:function(key,value){return this.meta[typeof key=="string"?key:key.key]=value,this}},{key:"getMeta",value:function(key){return this.meta[typeof key=="string"?key:key.key]}},{key:"isGeneric",get:function(){for(var _ in this.meta)return!1;return!0}},{key:"scrollIntoView",value:function(){return this.updated|=UPDATED_SCROLL,this}},{key:"scrolledIntoView",get:function(){return(this.updated&UPDATED_SCROLL)>0}}]),Transaction2}(prosemirrorTransform.Transform);function bind(f,self){return!self||!f?f:f.bind(self)}var FieldDesc=_createClass(function FieldDesc2(name,desc,self){_classCallCheck(this,FieldDesc2),this.name=name,this.init=bind(desc.init,self),this.apply=bind(desc.apply,self)}),baseFields=[new FieldDesc("doc",{init:function(config){return config.doc||config.schema.topNodeType.createAndFill()},apply:function(tr){return tr.doc}}),new FieldDesc("selection",{init:function(config,instance){return config.selection||Selection.atStart(instance.doc)},apply:function(tr){return tr.selection}}),new FieldDesc("storedMarks",{init:function(config){return config.storedMarks||null},apply:function(tr,_marks,_old,state){return state.selection.$cursor?tr.storedMarks:null}}),new FieldDesc("scrollToSelection",{init:function(){return 0},apply:function(tr,prev){return tr.scrolledIntoView?prev+1:prev}})],Configuration=_createClass(function Configuration2(schema,plugins){var _this3=this;_classCallCheck(this,Configuration2),this.schema=schema,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=baseFields.slice(),plugins&&plugins.forEach(function(plugin){if(_this3.pluginsByKey[plugin.key])throw new RangeError("Adding different instances of a keyed plugin ("+plugin.key+")");_this3.plugins.push(plugin),_this3.pluginsByKey[plugin.key]=plugin,plugin.spec.state&&_this3.fields.push(new FieldDesc(plugin.key,plugin.spec.state,plugin))})}),EditorState=function(){function EditorState2(config){_classCallCheck(this,EditorState2),this.config=config}return _createClass(EditorState2,[{key:"schema",get:function(){return this.config.schema}},{key:"plugins",get:function(){return this.config.plugins}},{key:"apply",value:function(tr){return this.applyTransaction(tr).state}},{key:"filterTransaction",value:function(tr){for(var ignore=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1,i=0;i<this.config.plugins.length;i++)if(i!=ignore){var plugin=this.config.plugins[i];if(plugin.spec.filterTransaction&&!plugin.spec.filterTransaction.call(plugin,tr,this))return!1}return!0}},{key:"applyTransaction",value:function(rootTr){if(!this.filterTransaction(rootTr))return{state:this,transactions:[]};for(var trs=[rootTr],newState=this.applyInner(rootTr),seen=null;;){for(var haveNew=!1,i=0;i<this.config.plugins.length;i++){var plugin=this.config.plugins[i];if(plugin.spec.appendTransaction){var n=seen?seen[i].n:0,oldState=seen?seen[i].state:this,tr=n<trs.length&&plugin.spec.appendTransaction.call(plugin,n?trs.slice(n):trs,oldState,newState);if(tr&&newState.filterTransaction(tr,i)){if(tr.setMeta("appendedTransaction",rootTr),!seen){seen=[];for(var j=0;j<this.config.plugins.length;j++)seen.push(j<i?{state:newState,n:trs.length}:{state:this,n:0})}trs.push(tr),newState=newState.applyInner(tr),haveNew=!0}seen&&(seen[i]={state:newState,n:trs.length})}}if(!haveNew)return{state:newState,transactions:trs}}}},{key:"applyInner",value:function(tr){if(!tr.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");for(var newInstance=new EditorState2(this.config),fields=this.config.fields,i=0;i<fields.length;i++){var field=fields[i];newInstance[field.name]=field.apply(tr,this[field.name],this,newInstance)}return newInstance}},{key:"tr",get:function(){return new Transaction(this)}},{key:"reconfigure",value:function(config){for(var $config=new Configuration(this.schema,config.plugins),fields=$config.fields,instance=new EditorState2($config),i=0;i<fields.length;i++){var name=fields[i].name;instance[name]=this.hasOwnProperty(name)?this[name]:fields[i].init(config,instance)}return instance}},{key:"toJSON",value:function(pluginFields){var result={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(result.storedMarks=this.storedMarks.map(function(m){return m.toJSON()})),pluginFields&&_typeof(pluginFields)=="object")for(var prop in pluginFields){if(prop=="doc"||prop=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");var plugin=pluginFields[prop],state=plugin.spec.state;state&&state.toJSON&&(result[prop]=state.toJSON.call(plugin,this[plugin.key]))}return result}}],[{key:"create",value:function(config){for(var $config=new Configuration(config.doc?config.doc.type.schema:config.schema,config.plugins),instance=new EditorState2($config),i=0;i<$config.fields.length;i++)instance[$config.fields[i].name]=$config.fields[i].init(config,instance);return instance}},{key:"fromJSON",value:function(config,json,pluginFields){if(!json)throw new RangeError("Invalid input for EditorState.fromJSON");if(!config.schema)throw new RangeError("Required config field 'schema' missing");var $config=new Configuration(config.schema,config.plugins),instance=new EditorState2($config);return $config.fields.forEach(function(field){if(field.name=="doc")instance.doc=prosemirrorModel.Node.fromJSON(config.schema,json.doc);else if(field.name=="selection")instance.selection=Selection.fromJSON(instance.doc,json.selection);else if(field.name=="storedMarks")json.storedMarks&&(instance.storedMarks=json.storedMarks.map(config.schema.markFromJSON));else{if(pluginFields)for(var prop in pluginFields){var plugin=pluginFields[prop],state=plugin.spec.state;if(plugin.key==field.name&&state&&state.fromJSON&&Object.prototype.hasOwnProperty.call(json,prop)){instance[field.name]=state.fromJSON.call(plugin,config,json[prop],instance);return}}instance[field.name]=field.init(config,instance)}}),instance}}]),EditorState2}();function bindProps(obj,self,target){for(var prop in obj){var val=obj[prop];val instanceof Function?val=val.bind(self):prop=="handleDOMEvents"&&(val=bindProps(val,self,{})),target[prop]=val}return target}var Plugin=function(){function Plugin2(spec){_classCallCheck(this,Plugin2),this.spec=spec,this.props={},spec.props&&bindProps(spec.props,this,this.props),this.key=spec.key?spec.key.key:createKey("plugin")}return _createClass(Plugin2,[{key:"getState",value:function(state){return state[this.key]}}]),Plugin2}(),keys=Object.create(null);function createKey(name){return name in keys?name+"$"+ ++keys[name]:(keys[name]=0,name+"$")}var PluginKey=function(){function PluginKey2(){var name=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"key";_classCallCheck(this,PluginKey2),this.key=createKey(name)}return _createClass(PluginKey2,[{key:"get",value:function(state){return state.config.pluginsByKey[this.key]}},{key:"getState",value:function(state){return state[this.key]}}]),PluginKey2}();exports.AllSelection=AllSelection,exports.EditorState=EditorState,exports.NodeSelection=NodeSelection,exports.Plugin=Plugin,exports.PluginKey=PluginKey,exports.Selection=Selection,exports.SelectionRange=SelectionRange,exports.TextSelection=TextSelection,exports.Transaction=Transaction;

//# sourceMappingURL=022f48f4c288596a8257.cjs.map