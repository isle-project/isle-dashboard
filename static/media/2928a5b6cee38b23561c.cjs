"use strict";function _typeof(obj){return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(obj2){return typeof obj2}:function(obj2){return obj2&&typeof Symbol=="function"&&obj2.constructor===Symbol&&obj2!==Symbol.prototype?"symbol":typeof obj2},_typeof(obj)}function _wrapNativeSuper(Class){var _cache=typeof Map=="function"?new Map:void 0;return _wrapNativeSuper=function(Class2){if(Class2===null||!_isNativeFunction(Class2))return Class2;if(typeof Class2!="function")throw new TypeError("Super expression must either be null or a function");if(typeof _cache!="undefined"){if(_cache.has(Class2))return _cache.get(Class2);_cache.set(Class2,Wrapper)}function Wrapper(){return _construct(Class2,arguments,_getPrototypeOf(this).constructor)}return Wrapper.prototype=Object.create(Class2.prototype,{constructor:{value:Wrapper,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(Wrapper,Class2)},_wrapNativeSuper(Class)}function _construct(Parent,args,Class){return _isNativeReflectConstruct()?_construct=Reflect.construct:_construct=function(Parent2,args2,Class2){var a=[null];a.push.apply(a,args2);var Constructor=Function.bind.apply(Parent2,a),instance=new Constructor;return Class2&&_setPrototypeOf(instance,Class2.prototype),instance},_construct.apply(null,arguments)}function _isNativeFunction(fn){return Function.toString.call(fn).indexOf("[native code]")!==-1}function _inherits(subClass,superClass){if(typeof superClass!="function"&&superClass!==null)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf||function(o2,p2){return o2.__proto__=p2,o2},_setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call=="function"))return call;if(call!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function _isNativeReflectConstruct(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function _getPrototypeOf(o){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o2){return o2.__proto__||Object.getPrototypeOf(o2)},_getPrototypeOf(o)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}Object.defineProperty(exports,"__esModule",{value:!0});var prosemirrorModel=require("prosemirror-model"),lower16=65535,factor16=Math.pow(2,16);function makeRecover(index,offset){return index+offset*factor16}function recoverIndex(value){return value&lower16}function recoverOffset(value){return(value-(value&lower16))/factor16}var DEL_BEFORE=1,DEL_AFTER=2,DEL_ACROSS=4,DEL_SIDE=8,MapResult=function(){function MapResult2(pos,delInfo,recover){_classCallCheck(this,MapResult2),this.pos=pos,this.delInfo=delInfo,this.recover=recover}return _createClass(MapResult2,[{key:"deleted",get:function(){return(this.delInfo&DEL_SIDE)>0}},{key:"deletedBefore",get:function(){return(this.delInfo&(DEL_BEFORE|DEL_ACROSS))>0}},{key:"deletedAfter",get:function(){return(this.delInfo&(DEL_AFTER|DEL_ACROSS))>0}},{key:"deletedAcross",get:function(){return(this.delInfo&DEL_ACROSS)>0}}]),MapResult2}(),StepMap=function(){function StepMap2(ranges){var inverted=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(_classCallCheck(this,StepMap2),this.ranges=ranges,this.inverted=inverted,!ranges.length&&StepMap2.empty)return StepMap2.empty}return _createClass(StepMap2,[{key:"recover",value:function(value){var diff=0,index=recoverIndex(value);if(!this.inverted)for(var i=0;i<index;i++)diff+=this.ranges[i*3+2]-this.ranges[i*3+1];return this.ranges[index*3]+diff+recoverOffset(value)}},{key:"mapResult",value:function(pos){var assoc=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._map(pos,assoc,!1)}},{key:"map",value:function(pos){var assoc=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._map(pos,assoc,!0)}},{key:"_map",value:function(pos,assoc,simple){for(var diff=0,oldIndex=this.inverted?2:1,newIndex=this.inverted?1:2,i=0;i<this.ranges.length;i+=3){var start=this.ranges[i]-(this.inverted?diff:0);if(start>pos)break;var oldSize=this.ranges[i+oldIndex],newSize=this.ranges[i+newIndex],end=start+oldSize;if(pos<=end){var side=oldSize?pos==start?-1:pos==end?1:assoc:assoc,result=start+diff+(side<0?0:newSize);if(simple)return result;var recover=pos==(assoc<0?start:end)?null:makeRecover(i/3,pos-start),del=pos==start?DEL_AFTER:pos==end?DEL_BEFORE:DEL_ACROSS;return(assoc<0?pos!=start:pos!=end)&&(del|=DEL_SIDE),new MapResult(result,del,recover)}diff+=newSize-oldSize}return simple?pos+diff:new MapResult(pos+diff,0,null)}},{key:"touches",value:function(pos,recover){for(var diff=0,index=recoverIndex(recover),oldIndex=this.inverted?2:1,newIndex=this.inverted?1:2,i=0;i<this.ranges.length;i+=3){var start=this.ranges[i]-(this.inverted?diff:0);if(start>pos)break;var oldSize=this.ranges[i+oldIndex],end=start+oldSize;if(pos<=end&&i==index*3)return!0;diff+=this.ranges[i+newIndex]-oldSize}return!1}},{key:"forEach",value:function(f){for(var oldIndex=this.inverted?2:1,newIndex=this.inverted?1:2,i=0,diff=0;i<this.ranges.length;i+=3){var start=this.ranges[i],oldStart=start-(this.inverted?diff:0),newStart=start+(this.inverted?0:diff),oldSize=this.ranges[i+oldIndex],newSize=this.ranges[i+newIndex];f(oldStart,oldStart+oldSize,newStart,newStart+newSize),diff+=newSize-oldSize}}},{key:"invert",value:function(){return new StepMap2(this.ranges,!this.inverted)}},{key:"toString",value:function(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}}],[{key:"offset",value:function(n){return n==0?StepMap2.empty:new StepMap2(n<0?[0,-n,0]:[0,0,n])}}]),StepMap2}();StepMap.empty=new StepMap([]);var Mapping=function(){function Mapping2(){var maps=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],mirror=arguments.length>1?arguments[1]:void 0,from=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,to=arguments.length>3&&arguments[3]!==void 0?arguments[3]:maps.length;_classCallCheck(this,Mapping2),this.maps=maps,this.mirror=mirror,this.from=from,this.to=to}return _createClass(Mapping2,[{key:"slice",value:function(){var from=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,to=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.maps.length;return new Mapping2(this.maps,this.mirror,from,to)}},{key:"copy",value:function(){return new Mapping2(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)}},{key:"appendMap",value:function(map,mirrors){this.to=this.maps.push(map),mirrors!=null&&this.setMirror(this.maps.length-1,mirrors)}},{key:"appendMapping",value:function(mapping){for(var i=0,startSize=this.maps.length;i<mapping.maps.length;i++){var mirr=mapping.getMirror(i);this.appendMap(mapping.maps[i],mirr!=null&&mirr<i?startSize+mirr:void 0)}}},{key:"getMirror",value:function(n){if(this.mirror){for(var i=0;i<this.mirror.length;i++)if(this.mirror[i]==n)return this.mirror[i+(i%2?-1:1)]}}},{key:"setMirror",value:function(n,m){this.mirror||(this.mirror=[]),this.mirror.push(n,m)}},{key:"appendMappingInverted",value:function(mapping){for(var i=mapping.maps.length-1,totalSize=this.maps.length+mapping.maps.length;i>=0;i--){var mirr=mapping.getMirror(i);this.appendMap(mapping.maps[i].invert(),mirr!=null&&mirr>i?totalSize-mirr-1:void 0)}}},{key:"invert",value:function(){var inverse=new Mapping2;return inverse.appendMappingInverted(this),inverse}},{key:"map",value:function(pos){var assoc=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;if(this.mirror)return this._map(pos,assoc,!0);for(var i=this.from;i<this.to;i++)pos=this.maps[i].map(pos,assoc);return pos}},{key:"mapResult",value:function(pos){var assoc=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._map(pos,assoc,!1)}},{key:"_map",value:function(pos,assoc,simple){for(var delInfo=0,i=this.from;i<this.to;i++){var map=this.maps[i],result=map.mapResult(pos,assoc);if(result.recover!=null){var corr=this.getMirror(i);if(corr!=null&&corr>i&&corr<this.to){i=corr,pos=this.maps[corr].recover(result.recover);continue}}delInfo|=result.delInfo,pos=result.pos}return simple?pos:new MapResult(pos,delInfo,null)}}]),Mapping2}(),stepsByID=Object.create(null),Step=function(){function Step2(){_classCallCheck(this,Step2)}return _createClass(Step2,[{key:"getMap",value:function(){return StepMap.empty}},{key:"merge",value:function(other){return null}}],[{key:"fromJSON",value:function(schema,json){if(!json||!json.stepType)throw new RangeError("Invalid input for Step.fromJSON");var type=stepsByID[json.stepType];if(!type)throw new RangeError("No step type ".concat(json.stepType," defined"));return type.fromJSON(schema,json)}},{key:"jsonID",value:function(id,stepClass){if(id in stepsByID)throw new RangeError("Duplicate use of step JSON ID "+id);return stepsByID[id]=stepClass,stepClass.prototype.jsonID=id,stepClass}}]),Step2}(),StepResult=function(){function StepResult2(doc,failed){_classCallCheck(this,StepResult2),this.doc=doc,this.failed=failed}return _createClass(StepResult2,null,[{key:"ok",value:function(doc){return new StepResult2(doc,null)}},{key:"fail",value:function(message){return new StepResult2(null,message)}},{key:"fromReplace",value:function(doc,from,to,slice){try{return StepResult2.ok(doc.replace(from,to,slice))}catch(e){if(e instanceof prosemirrorModel.ReplaceError)return StepResult2.fail(e.message);throw e}}}]),StepResult2}();function mapFragment(fragment,f,parent){for(var mapped=[],i=0;i<fragment.childCount;i++){var child=fragment.child(i);child.content.size&&(child=child.copy(mapFragment(child.content,f,child))),child.isInline&&(child=f(child,parent,i)),mapped.push(child)}return prosemirrorModel.Fragment.fromArray(mapped)}var AddMarkStep=function(_Step){_inherits(AddMarkStep2,_Step);var _super=_createSuper(AddMarkStep2);function AddMarkStep2(from,to,mark){var _this;return _classCallCheck(this,AddMarkStep2),_this=_super.call(this),_this.from=from,_this.to=to,_this.mark=mark,_this}return _createClass(AddMarkStep2,[{key:"apply",value:function(doc){var _this2=this,oldSlice=doc.slice(this.from,this.to),$from=doc.resolve(this.from),parent=$from.node($from.sharedDepth(this.to)),slice=new prosemirrorModel.Slice(mapFragment(oldSlice.content,function(node,parent2){return!node.isAtom||!parent2.type.allowsMarkType(_this2.mark.type)?node:node.mark(_this2.mark.addToSet(node.marks))},parent),oldSlice.openStart,oldSlice.openEnd);return StepResult.fromReplace(doc,this.from,this.to,slice)}},{key:"invert",value:function(){return new RemoveMarkStep(this.from,this.to,this.mark)}},{key:"map",value:function(mapping){var from=mapping.mapResult(this.from,1),to=mapping.mapResult(this.to,-1);return from.deleted&&to.deleted||from.pos>=to.pos?null:new AddMarkStep2(from.pos,to.pos,this.mark)}},{key:"merge",value:function(other){return other instanceof AddMarkStep2&&other.mark.eq(this.mark)&&this.from<=other.to&&this.to>=other.from?new AddMarkStep2(Math.min(this.from,other.from),Math.max(this.to,other.to),this.mark):null}},{key:"toJSON",value:function(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}}],[{key:"fromJSON",value:function(schema,json){if(typeof json.from!="number"||typeof json.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new AddMarkStep2(json.from,json.to,schema.markFromJSON(json.mark))}}]),AddMarkStep2}(Step);Step.jsonID("addMark",AddMarkStep);var RemoveMarkStep=function(_Step2){_inherits(RemoveMarkStep2,_Step2);var _super2=_createSuper(RemoveMarkStep2);function RemoveMarkStep2(from,to,mark){var _this3;return _classCallCheck(this,RemoveMarkStep2),_this3=_super2.call(this),_this3.from=from,_this3.to=to,_this3.mark=mark,_this3}return _createClass(RemoveMarkStep2,[{key:"apply",value:function(doc){var _this4=this,oldSlice=doc.slice(this.from,this.to),slice=new prosemirrorModel.Slice(mapFragment(oldSlice.content,function(node){return node.mark(_this4.mark.removeFromSet(node.marks))},doc),oldSlice.openStart,oldSlice.openEnd);return StepResult.fromReplace(doc,this.from,this.to,slice)}},{key:"invert",value:function(){return new AddMarkStep(this.from,this.to,this.mark)}},{key:"map",value:function(mapping){var from=mapping.mapResult(this.from,1),to=mapping.mapResult(this.to,-1);return from.deleted&&to.deleted||from.pos>=to.pos?null:new RemoveMarkStep2(from.pos,to.pos,this.mark)}},{key:"merge",value:function(other){return other instanceof RemoveMarkStep2&&other.mark.eq(this.mark)&&this.from<=other.to&&this.to>=other.from?new RemoveMarkStep2(Math.min(this.from,other.from),Math.max(this.to,other.to),this.mark):null}},{key:"toJSON",value:function(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}}],[{key:"fromJSON",value:function(schema,json){if(typeof json.from!="number"||typeof json.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new RemoveMarkStep2(json.from,json.to,schema.markFromJSON(json.mark))}}]),RemoveMarkStep2}(Step);Step.jsonID("removeMark",RemoveMarkStep);var ReplaceStep=function(_Step3){_inherits(ReplaceStep2,_Step3);var _super3=_createSuper(ReplaceStep2);function ReplaceStep2(from,to,slice){var _this5,structure=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return _classCallCheck(this,ReplaceStep2),_this5=_super3.call(this),_this5.from=from,_this5.to=to,_this5.slice=slice,_this5.structure=structure,_this5}return _createClass(ReplaceStep2,[{key:"apply",value:function(doc){return this.structure&&contentBetween(doc,this.from,this.to)?StepResult.fail("Structure replace would overwrite content"):StepResult.fromReplace(doc,this.from,this.to,this.slice)}},{key:"getMap",value:function(){return new StepMap([this.from,this.to-this.from,this.slice.size])}},{key:"invert",value:function(doc){return new ReplaceStep2(this.from,this.from+this.slice.size,doc.slice(this.from,this.to))}},{key:"map",value:function(mapping){var from=mapping.mapResult(this.from,1),to=mapping.mapResult(this.to,-1);return from.deletedAcross&&to.deletedAcross?null:new ReplaceStep2(from.pos,Math.max(from.pos,to.pos),this.slice)}},{key:"merge",value:function(other){if(!(other instanceof ReplaceStep2)||other.structure||this.structure)return null;if(this.from+this.slice.size==other.from&&!this.slice.openEnd&&!other.slice.openStart){var slice=this.slice.size+other.slice.size==0?prosemirrorModel.Slice.empty:new prosemirrorModel.Slice(this.slice.content.append(other.slice.content),this.slice.openStart,other.slice.openEnd);return new ReplaceStep2(this.from,this.to+(other.to-other.from),slice,this.structure)}else if(other.to==this.from&&!this.slice.openStart&&!other.slice.openEnd){var _slice=this.slice.size+other.slice.size==0?prosemirrorModel.Slice.empty:new prosemirrorModel.Slice(other.slice.content.append(this.slice.content),other.slice.openStart,this.slice.openEnd);return new ReplaceStep2(other.from,this.to,_slice,this.structure)}else return null}},{key:"toJSON",value:function(){var json={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(json.slice=this.slice.toJSON()),this.structure&&(json.structure=!0),json}}],[{key:"fromJSON",value:function(schema,json){if(typeof json.from!="number"||typeof json.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new ReplaceStep2(json.from,json.to,prosemirrorModel.Slice.fromJSON(schema,json.slice),!!json.structure)}}]),ReplaceStep2}(Step);Step.jsonID("replace",ReplaceStep);var ReplaceAroundStep=function(_Step4){_inherits(ReplaceAroundStep2,_Step4);var _super4=_createSuper(ReplaceAroundStep2);function ReplaceAroundStep2(from,to,gapFrom,gapTo,slice,insert){var _this6,structure=arguments.length>6&&arguments[6]!==void 0?arguments[6]:!1;return _classCallCheck(this,ReplaceAroundStep2),_this6=_super4.call(this),_this6.from=from,_this6.to=to,_this6.gapFrom=gapFrom,_this6.gapTo=gapTo,_this6.slice=slice,_this6.insert=insert,_this6.structure=structure,_this6}return _createClass(ReplaceAroundStep2,[{key:"apply",value:function(doc){if(this.structure&&(contentBetween(doc,this.from,this.gapFrom)||contentBetween(doc,this.gapTo,this.to)))return StepResult.fail("Structure gap-replace would overwrite content");var gap=doc.slice(this.gapFrom,this.gapTo);if(gap.openStart||gap.openEnd)return StepResult.fail("Gap is not a flat range");var inserted=this.slice.insertAt(this.insert,gap.content);return inserted?StepResult.fromReplace(doc,this.from,this.to,inserted):StepResult.fail("Content does not fit in gap")}},{key:"getMap",value:function(){return new StepMap([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}},{key:"invert",value:function(doc){var gap=this.gapTo-this.gapFrom;return new ReplaceAroundStep2(this.from,this.from+this.slice.size+gap,this.from+this.insert,this.from+this.insert+gap,doc.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}},{key:"map",value:function(mapping){var from=mapping.mapResult(this.from,1),to=mapping.mapResult(this.to,-1),gapFrom=mapping.map(this.gapFrom,-1),gapTo=mapping.map(this.gapTo,1);return from.deletedAcross&&to.deletedAcross||gapFrom<from.pos||gapTo>to.pos?null:new ReplaceAroundStep2(from.pos,to.pos,gapFrom,gapTo,this.slice,this.insert,this.structure)}},{key:"toJSON",value:function(){var json={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(json.slice=this.slice.toJSON()),this.structure&&(json.structure=!0),json}}],[{key:"fromJSON",value:function(schema,json){if(typeof json.from!="number"||typeof json.to!="number"||typeof json.gapFrom!="number"||typeof json.gapTo!="number"||typeof json.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new ReplaceAroundStep2(json.from,json.to,json.gapFrom,json.gapTo,prosemirrorModel.Slice.fromJSON(schema,json.slice),json.insert,!!json.structure)}}]),ReplaceAroundStep2}(Step);Step.jsonID("replaceAround",ReplaceAroundStep);function contentBetween(doc,from,to){for(var $from=doc.resolve(from),dist=to-from,depth=$from.depth;dist>0&&depth>0&&$from.indexAfter(depth)==$from.node(depth).childCount;)depth--,dist--;if(dist>0)for(var next=$from.node(depth).maybeChild($from.indexAfter(depth));dist>0;){if(!next||next.isLeaf)return!0;next=next.firstChild,dist--}return!1}function _addMark(tr,from,to,mark){var removed=[],added=[],removing,adding;tr.doc.nodesBetween(from,to,function(node,pos,parent){if(!!node.isInline){var marks=node.marks;if(!mark.isInSet(marks)&&parent.type.allowsMarkType(mark.type)){for(var start=Math.max(pos,from),end=Math.min(pos+node.nodeSize,to),newSet=mark.addToSet(marks),i=0;i<marks.length;i++)marks[i].isInSet(newSet)||(removing&&removing.to==start&&removing.mark.eq(marks[i])?removing.to=end:removed.push(removing=new RemoveMarkStep(start,end,marks[i])));adding&&adding.to==start?adding.to=end:added.push(adding=new AddMarkStep(start,end,mark))}}}),removed.forEach(function(s){return tr.step(s)}),added.forEach(function(s){return tr.step(s)})}function _removeMark(tr,from,to,mark){var matched=[],step=0;tr.doc.nodesBetween(from,to,function(node,pos){if(!!node.isInline){step++;var toRemove=null;if(mark instanceof prosemirrorModel.MarkType)for(var set=node.marks,found;found=mark.isInSet(set);)(toRemove||(toRemove=[])).push(found),set=found.removeFromSet(set);else mark?mark.isInSet(node.marks)&&(toRemove=[mark]):toRemove=node.marks;if(toRemove&&toRemove.length)for(var end=Math.min(pos+node.nodeSize,to),i=0;i<toRemove.length;i++){for(var style=toRemove[i],_found=void 0,j=0;j<matched.length;j++){var m=matched[j];m.step==step-1&&style.eq(matched[j].style)&&(_found=m)}_found?(_found.to=end,_found.step=step):matched.push({style,from:Math.max(pos,from),to:end,step})}}}),matched.forEach(function(m){return tr.step(new RemoveMarkStep(m.from,m.to,m.style))})}function _clearIncompatible(tr,pos,parentType){for(var match=arguments.length>3&&arguments[3]!==void 0?arguments[3]:parentType.contentMatch,node=tr.doc.nodeAt(pos),delSteps=[],cur=pos+1,i=0;i<node.childCount;i++){var child=node.child(i),end=cur+child.nodeSize,allowed=match.matchType(child.type);if(!allowed)delSteps.push(new ReplaceStep(cur,end,prosemirrorModel.Slice.empty));else{match=allowed;for(var j=0;j<child.marks.length;j++)parentType.allowsMarkType(child.marks[j].type)||tr.step(new RemoveMarkStep(cur,end,child.marks[j]))}cur=end}if(!match.validEnd){var fill=match.fillBefore(prosemirrorModel.Fragment.empty,!0);tr.replace(cur,cur,new prosemirrorModel.Slice(fill,0,0))}for(var _i=delSteps.length-1;_i>=0;_i--)tr.step(delSteps[_i])}function canCut(node,start,end){return(start==0||node.canReplace(start,node.childCount))&&(end==node.childCount||node.canReplace(0,end))}function liftTarget(range){for(var parent=range.parent,content=parent.content.cutByIndex(range.startIndex,range.endIndex),depth=range.depth;;--depth){var node=range.$from.node(depth),index=range.$from.index(depth),endIndex=range.$to.indexAfter(depth);if(depth<range.depth&&node.canReplace(index,endIndex,content))return depth;if(depth==0||node.type.spec.isolating||!canCut(node,index,endIndex))break}return null}function _lift(tr,range,target){for(var $from=range.$from,$to=range.$to,depth=range.depth,gapStart=$from.before(depth+1),gapEnd=$to.after(depth+1),start=gapStart,end=gapEnd,before=prosemirrorModel.Fragment.empty,openStart=0,d=depth,splitting=!1;d>target;d--)splitting||$from.index(d)>0?(splitting=!0,before=prosemirrorModel.Fragment.from($from.node(d).copy(before)),openStart++):start--;for(var after=prosemirrorModel.Fragment.empty,openEnd=0,_d=depth,_splitting=!1;_d>target;_d--)_splitting||$to.after(_d+1)<$to.end(_d)?(_splitting=!0,after=prosemirrorModel.Fragment.from($to.node(_d).copy(after)),openEnd++):end++;tr.step(new ReplaceAroundStep(start,end,gapStart,gapEnd,new prosemirrorModel.Slice(before.append(after),openStart,openEnd),before.size-openStart,!0))}function findWrapping(range,nodeType){var attrs=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,innerRange=arguments.length>3&&arguments[3]!==void 0?arguments[3]:range,around=findWrappingOutside(range,nodeType),inner=around&&findWrappingInside(innerRange,nodeType);return inner?around.map(withAttrs).concat({type:nodeType,attrs}).concat(inner.map(withAttrs)):null}function withAttrs(type){return{type,attrs:null}}function findWrappingOutside(range,type){var parent=range.parent,startIndex=range.startIndex,endIndex=range.endIndex,around=parent.contentMatchAt(startIndex).findWrapping(type);if(!around)return null;var outer=around.length?around[0]:type;return parent.canReplaceWith(startIndex,endIndex,outer)?around:null}function findWrappingInside(range,type){var parent=range.parent,startIndex=range.startIndex,endIndex=range.endIndex,inner=parent.child(startIndex),inside=type.contentMatch.findWrapping(inner.type);if(!inside)return null;for(var lastType=inside.length?inside[inside.length-1]:type,innerMatch=lastType.contentMatch,i=startIndex;innerMatch&&i<endIndex;i++)innerMatch=innerMatch.matchType(parent.child(i).type);return!innerMatch||!innerMatch.validEnd?null:inside}function _wrap2(tr,range,wrappers){for(var content=prosemirrorModel.Fragment.empty,i=wrappers.length-1;i>=0;i--){if(content.size){var match=wrappers[i].type.contentMatch.matchFragment(content);if(!match||!match.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}content=prosemirrorModel.Fragment.from(wrappers[i].type.create(wrappers[i].attrs,content))}var start=range.start,end=range.end;tr.step(new ReplaceAroundStep(start,end,start,end,new prosemirrorModel.Slice(content,0,0),wrappers.length,!0))}function _setBlockType(tr,from,to,type,attrs){if(!type.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");var mapFrom=tr.steps.length;tr.doc.nodesBetween(from,to,function(node,pos){if(node.isTextblock&&!node.hasMarkup(type,attrs)&&canChangeType(tr.doc,tr.mapping.slice(mapFrom).map(pos),type)){tr.clearIncompatible(tr.mapping.slice(mapFrom).map(pos,1),type);var mapping=tr.mapping.slice(mapFrom),startM=mapping.map(pos,1),endM=mapping.map(pos+node.nodeSize,1);return tr.step(new ReplaceAroundStep(startM,endM,startM+1,endM-1,new prosemirrorModel.Slice(prosemirrorModel.Fragment.from(type.create(attrs,null,node.marks)),0,0),1,!0)),!1}})}function canChangeType(doc,pos,type){var $pos=doc.resolve(pos),index=$pos.index();return $pos.parent.canReplaceWith(index,index+1,type)}function _setNodeMarkup(tr,pos,type,attrs,marks){var node=tr.doc.nodeAt(pos);if(!node)throw new RangeError("No node at given position");type||(type=node.type);var newNode=type.create(attrs,null,marks||node.marks);if(node.isLeaf)return tr.replaceWith(pos,pos+node.nodeSize,newNode);if(!type.validContent(node.content))throw new RangeError("Invalid content for node type "+type.name);tr.step(new ReplaceAroundStep(pos,pos+node.nodeSize,pos+1,pos+node.nodeSize-1,new prosemirrorModel.Slice(prosemirrorModel.Fragment.from(newNode),0,0),1,!0))}function canSplit(doc,pos){var depth=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,typesAfter=arguments.length>3?arguments[3]:void 0,$pos=doc.resolve(pos),base=$pos.depth-depth,innerType=typesAfter&&typesAfter[typesAfter.length-1]||$pos.parent;if(base<0||$pos.parent.type.spec.isolating||!$pos.parent.canReplace($pos.index(),$pos.parent.childCount)||!innerType.type.validContent($pos.parent.content.cutByIndex($pos.index(),$pos.parent.childCount)))return!1;for(var d=$pos.depth-1,i=depth-2;d>base;d--,i--){var node=$pos.node(d),_index=$pos.index(d);if(node.type.spec.isolating)return!1;var rest=node.content.cutByIndex(_index,node.childCount),after=typesAfter&&typesAfter[i]||node;if(after!=node&&(rest=rest.replaceChild(0,after.type.create(after.attrs))),!node.canReplace(_index+1,node.childCount)||!after.type.validContent(rest))return!1}var index=$pos.indexAfter(base),baseType=typesAfter&&typesAfter[0];return $pos.node(base).canReplaceWith(index,index,baseType?baseType.type:$pos.node(base+1).type)}function _split(tr,pos){for(var depth=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,typesAfter=arguments.length>3?arguments[3]:void 0,$pos=tr.doc.resolve(pos),before=prosemirrorModel.Fragment.empty,after=prosemirrorModel.Fragment.empty,d=$pos.depth,e=$pos.depth-depth,i=depth-1;d>e;d--,i--){before=prosemirrorModel.Fragment.from($pos.node(d).copy(before));var typeAfter=typesAfter&&typesAfter[i];after=prosemirrorModel.Fragment.from(typeAfter?typeAfter.type.create(typeAfter.attrs,after):$pos.node(d).copy(after))}tr.step(new ReplaceStep(pos,pos,new prosemirrorModel.Slice(before.append(after),depth,depth),!0))}function canJoin(doc,pos){var $pos=doc.resolve(pos),index=$pos.index();return joinable($pos.nodeBefore,$pos.nodeAfter)&&$pos.parent.canReplace(index,index+1)}function joinable(a,b){return!!(a&&b&&!a.isLeaf&&a.canAppend(b))}function joinPoint(doc,pos){for(var dir=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1,$pos=doc.resolve(pos),d=$pos.depth;;d--){var before=void 0,after=void 0,index=$pos.index(d);if(d==$pos.depth?(before=$pos.nodeBefore,after=$pos.nodeAfter):dir>0?(before=$pos.node(d+1),index++,after=$pos.node(d).maybeChild(index)):(before=$pos.node(d).maybeChild(index-1),after=$pos.node(d+1)),before&&!before.isTextblock&&joinable(before,after)&&$pos.node(d).canReplace(index,index+1))return pos;if(d==0)break;pos=dir<0?$pos.before(d):$pos.after(d)}}function _join(tr,pos,depth){var step=new ReplaceStep(pos-depth,pos+depth,prosemirrorModel.Slice.empty,!0);tr.step(step)}function insertPoint(doc,pos,nodeType){var $pos=doc.resolve(pos);if($pos.parent.canReplaceWith($pos.index(),$pos.index(),nodeType))return pos;if($pos.parentOffset==0)for(var d=$pos.depth-1;d>=0;d--){var index=$pos.index(d);if($pos.node(d).canReplaceWith(index,index,nodeType))return $pos.before(d+1);if(index>0)return null}if($pos.parentOffset==$pos.parent.content.size)for(var _d2=$pos.depth-1;_d2>=0;_d2--){var _index2=$pos.indexAfter(_d2);if($pos.node(_d2).canReplaceWith(_index2,_index2,nodeType))return $pos.after(_d2+1);if(_index2<$pos.node(_d2).childCount)return null}return null}function dropPoint(doc,pos,slice){var $pos=doc.resolve(pos);if(!slice.content.size)return pos;for(var content=slice.content,i=0;i<slice.openStart;i++)content=content.firstChild.content;for(var pass=1;pass<=(slice.openStart==0&&slice.size?2:1);pass++)for(var d=$pos.depth;d>=0;d--){var bias=d==$pos.depth?0:$pos.pos<=($pos.start(d+1)+$pos.end(d+1))/2?-1:1,insertPos=$pos.index(d)+(bias>0?1:0),parent=$pos.node(d),fits=!1;if(pass==1)fits=parent.canReplace(insertPos,insertPos,content);else{var wrapping=parent.contentMatchAt(insertPos).findWrapping(content.firstChild.type);fits=wrapping&&parent.canReplaceWith(insertPos,insertPos,wrapping[0])}if(fits)return bias==0?$pos.pos:bias<0?$pos.before(d+1):$pos.after(d+1)}return null}function replaceStep(doc,from){var to=arguments.length>2&&arguments[2]!==void 0?arguments[2]:from,slice=arguments.length>3&&arguments[3]!==void 0?arguments[3]:prosemirrorModel.Slice.empty;if(from==to&&!slice.size)return null;var $from=doc.resolve(from),$to=doc.resolve(to);return fitsTrivially($from,$to,slice)?new ReplaceStep(from,to,slice):new Fitter($from,$to,slice).fit()}function fitsTrivially($from,$to,slice){return!slice.openStart&&!slice.openEnd&&$from.start()==$to.start()&&$from.parent.canReplace($from.index(),$to.index(),slice.content)}var Fitter=function(){function Fitter2($from,$to,unplaced){_classCallCheck(this,Fitter2),this.$from=$from,this.$to=$to,this.unplaced=unplaced,this.frontier=[],this.placed=prosemirrorModel.Fragment.empty;for(var i=0;i<=$from.depth;i++){var node=$from.node(i);this.frontier.push({type:node.type,match:node.contentMatchAt($from.indexAfter(i))})}for(var _i2=$from.depth;_i2>0;_i2--)this.placed=prosemirrorModel.Fragment.from($from.node(_i2).copy(this.placed))}return _createClass(Fitter2,[{key:"depth",get:function(){return this.frontier.length-1}},{key:"fit",value:function(){for(;this.unplaced.size;){var fit2=this.findFittable();fit2?this.placeNodes(fit2):this.openMore()||this.dropNode()}var moveInline=this.mustMoveInline(),placedSize=this.placed.size-this.depth-this.$from.depth,$from=this.$from,$to=this.close(moveInline<0?this.$to:$from.doc.resolve(moveInline));if(!$to)return null;for(var content=this.placed,openStart=$from.depth,openEnd=$to.depth;openStart&&openEnd&&content.childCount==1;)content=content.firstChild.content,openStart--,openEnd--;var slice=new prosemirrorModel.Slice(content,openStart,openEnd);return moveInline>-1?new ReplaceAroundStep($from.pos,moveInline,this.$to.pos,this.$to.end(),slice,placedSize):slice.size||$from.pos!=this.$to.pos?new ReplaceStep($from.pos,$to.pos,slice):null}},{key:"findFittable",value:function(){for(var pass=1;pass<=2;pass++)for(var sliceDepth=this.unplaced.openStart;sliceDepth>=0;sliceDepth--){var fragment=void 0,parent=null;sliceDepth?(parent=contentAt(this.unplaced.content,sliceDepth-1).firstChild,fragment=parent.content):fragment=this.unplaced.content;for(var first=fragment.firstChild,frontierDepth=this.depth;frontierDepth>=0;frontierDepth--){var _this$frontier$fronti=this.frontier[frontierDepth],type=_this$frontier$fronti.type,match=_this$frontier$fronti.match,_wrap=void 0,inject=null;if(pass==1&&(first?match.matchType(first.type)||(inject=match.fillBefore(prosemirrorModel.Fragment.from(first),!1)):parent&&type.compatibleContent(parent.type)))return{sliceDepth,frontierDepth,parent,inject};if(pass==2&&first&&(_wrap=match.findWrapping(first.type)))return{sliceDepth,frontierDepth,parent,wrap:_wrap};if(parent&&match.matchType(parent.type))break}}}},{key:"openMore",value:function(){var _this$unplaced=this.unplaced,content=_this$unplaced.content,openStart=_this$unplaced.openStart,openEnd=_this$unplaced.openEnd,inner=contentAt(content,openStart);return!inner.childCount||inner.firstChild.isLeaf?!1:(this.unplaced=new prosemirrorModel.Slice(content,openStart+1,Math.max(openEnd,inner.size+openStart>=content.size-openEnd?openStart+1:0)),!0)}},{key:"dropNode",value:function(){var _this$unplaced2=this.unplaced,content=_this$unplaced2.content,openStart=_this$unplaced2.openStart,openEnd=_this$unplaced2.openEnd,inner=contentAt(content,openStart);if(inner.childCount<=1&&openStart>0){var openAtEnd=content.size-openStart<=openStart+inner.size;this.unplaced=new prosemirrorModel.Slice(dropFromFragment(content,openStart-1,1),openStart-1,openAtEnd?openStart-1:openEnd)}else this.unplaced=new prosemirrorModel.Slice(dropFromFragment(content,openStart,1),openStart,openEnd)}},{key:"placeNodes",value:function(_ref){for(var sliceDepth=_ref.sliceDepth,frontierDepth=_ref.frontierDepth,parent=_ref.parent,inject=_ref.inject,wrap=_ref.wrap;this.depth>frontierDepth;)this.closeFrontierNode();if(wrap)for(var i=0;i<wrap.length;i++)this.openFrontierNode(wrap[i]);var slice=this.unplaced,fragment=parent?parent.content:slice.content,openStart=slice.openStart-sliceDepth,taken=0,add=[],_this$frontier$fronti2=this.frontier[frontierDepth],match=_this$frontier$fronti2.match,type=_this$frontier$fronti2.type;if(inject){for(var i=0;i<inject.childCount;i++)add.push(inject.child(i));match=match.matchFragment(inject)}for(var openEndCount=fragment.size+sliceDepth-(slice.content.size-slice.openEnd);taken<fragment.childCount;){var next=fragment.child(taken),matches=match.matchType(next.type);if(!matches)break;taken++,(taken>1||openStart==0||next.content.size)&&(match=matches,add.push(closeNodeStart(next.mark(type.allowedMarks(next.marks)),taken==1?openStart:0,taken==fragment.childCount?openEndCount:-1)))}var toEnd=taken==fragment.childCount;toEnd||(openEndCount=-1),this.placed=addToFragment(this.placed,frontierDepth,prosemirrorModel.Fragment.from(add)),this.frontier[frontierDepth].match=match,toEnd&&openEndCount<0&&parent&&parent.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(var _i3=0,cur=fragment;_i3<openEndCount;_i3++){var node=cur.lastChild;this.frontier.push({type:node.type,match:node.contentMatchAt(node.childCount)}),cur=node.content}this.unplaced=toEnd?sliceDepth==0?prosemirrorModel.Slice.empty:new prosemirrorModel.Slice(dropFromFragment(slice.content,sliceDepth-1,1),sliceDepth-1,openEndCount<0?slice.openEnd:sliceDepth-1):new prosemirrorModel.Slice(dropFromFragment(slice.content,sliceDepth,taken),slice.openStart,slice.openEnd)}},{key:"mustMoveInline",value:function(){if(!this.$to.parent.isTextblock)return-1;var top=this.frontier[this.depth],level;if(!top.type.isTextblock||!contentAfterFits(this.$to,this.$to.depth,top.type,top.match,!1)||this.$to.depth==this.depth&&(level=this.findCloseLevel(this.$to))&&level.depth==this.depth)return-1;for(var depth=this.$to.depth,after=this.$to.after(depth);depth>1&&after==this.$to.end(--depth);)++after;return after}},{key:"findCloseLevel",value:function($to){scan:for(var i=Math.min(this.depth,$to.depth);i>=0;i--){var _this$frontier$i=this.frontier[i],match=_this$frontier$i.match,type=_this$frontier$i.type,dropInner=i<$to.depth&&$to.end(i+1)==$to.pos+($to.depth-(i+1)),fit=contentAfterFits($to,i,type,match,dropInner);if(!!fit){for(var d=i-1;d>=0;d--){var _this$frontier$d=this.frontier[d],_match=_this$frontier$d.match,_type=_this$frontier$d.type,matches=contentAfterFits($to,d,_type,_match,!0);if(!matches||matches.childCount)continue scan}return{depth:i,fit,move:dropInner?$to.doc.resolve($to.after(i+1)):$to}}}}},{key:"close",value:function($to){var close2=this.findCloseLevel($to);if(!close2)return null;for(;this.depth>close2.depth;)this.closeFrontierNode();close2.fit.childCount&&(this.placed=addToFragment(this.placed,close2.depth,close2.fit)),$to=close2.move;for(var d=close2.depth+1;d<=$to.depth;d++){var node=$to.node(d),add=node.type.contentMatch.fillBefore(node.content,!0,$to.index(d));this.openFrontierNode(node.type,node.attrs,add)}return $to}},{key:"openFrontierNode",value:function(type){var attrs=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,content=arguments.length>2?arguments[2]:void 0,top=this.frontier[this.depth];top.match=top.match.matchType(type),this.placed=addToFragment(this.placed,this.depth,prosemirrorModel.Fragment.from(type.create(attrs,content))),this.frontier.push({type,match:type.contentMatch})}},{key:"closeFrontierNode",value:function(){var open=this.frontier.pop(),add=open.match.fillBefore(prosemirrorModel.Fragment.empty,!0);add.childCount&&(this.placed=addToFragment(this.placed,this.frontier.length,add))}}]),Fitter2}();function dropFromFragment(fragment,depth,count){return depth==0?fragment.cutByIndex(count,fragment.childCount):fragment.replaceChild(0,fragment.firstChild.copy(dropFromFragment(fragment.firstChild.content,depth-1,count)))}function addToFragment(fragment,depth,content){return depth==0?fragment.append(content):fragment.replaceChild(fragment.childCount-1,fragment.lastChild.copy(addToFragment(fragment.lastChild.content,depth-1,content)))}function contentAt(fragment,depth){for(var i=0;i<depth;i++)fragment=fragment.firstChild.content;return fragment}function closeNodeStart(node,openStart,openEnd){if(openStart<=0)return node;var frag=node.content;return openStart>1&&(frag=frag.replaceChild(0,closeNodeStart(frag.firstChild,openStart-1,frag.childCount==1?openEnd-1:0))),openStart>0&&(frag=node.type.contentMatch.fillBefore(frag).append(frag),openEnd<=0&&(frag=frag.append(node.type.contentMatch.matchFragment(frag).fillBefore(prosemirrorModel.Fragment.empty,!0)))),node.copy(frag)}function contentAfterFits($to,depth,type,match,open){var node=$to.node(depth),index=open?$to.indexAfter(depth):$to.index(depth);if(index==node.childCount&&!type.compatibleContent(node.type))return null;var fit=match.fillBefore(node.content,!0,index);return fit&&!invalidMarks(type,node.content,index)?fit:null}function invalidMarks(type,fragment,start){for(var i=start;i<fragment.childCount;i++)if(!type.allowsMarks(fragment.child(i).marks))return!0;return!1}function definesContent(type){return type.spec.defining||type.spec.definingForContent}function _replaceRange(tr,from,to,slice){if(!slice.size)return tr.deleteRange(from,to);var $from=tr.doc.resolve(from),$to=tr.doc.resolve(to);if(fitsTrivially($from,$to,slice))return tr.step(new ReplaceStep(from,to,slice));var targetDepths=coveredDepths($from,tr.doc.resolve(to));targetDepths[targetDepths.length-1]==0&&targetDepths.pop();var preferredTarget=-($from.depth+1);targetDepths.unshift(preferredTarget);for(var d=$from.depth,pos=$from.pos-1;d>0;d--,pos--){var spec=$from.node(d).type.spec;if(spec.defining||spec.definingAsContext||spec.isolating)break;targetDepths.indexOf(d)>-1?preferredTarget=d:$from.before(d)==pos&&targetDepths.splice(1,0,-d)}for(var preferredTargetIndex=targetDepths.indexOf(preferredTarget),leftNodes=[],preferredDepth=slice.openStart,content=slice.content,i=0;;i++){var node=content.firstChild;if(leftNodes.push(node),i==slice.openStart)break;content=node.content}for(var _d3=preferredDepth-1;_d3>=0;_d3--){var type=leftNodes[_d3].type,def=definesContent(type);if(def&&$from.node(preferredTargetIndex).type!=type)preferredDepth=_d3;else if(def||!type.isTextblock)break}for(var j=slice.openStart;j>=0;j--){var openDepth=(j+preferredDepth+1)%(slice.openStart+1),insert=leftNodes[openDepth];if(!!insert)for(var _i4=0;_i4<targetDepths.length;_i4++){var targetDepth=targetDepths[(_i4+preferredTargetIndex)%targetDepths.length],expand=!0;targetDepth<0&&(expand=!1,targetDepth=-targetDepth);var parent=$from.node(targetDepth-1),index=$from.index(targetDepth-1);if(parent.canReplaceWith(index,index,insert.type,insert.marks))return tr.replace($from.before(targetDepth),expand?$to.after(targetDepth):to,new prosemirrorModel.Slice(closeFragment(slice.content,0,slice.openStart,openDepth),openDepth,slice.openEnd))}}for(var startSteps=tr.steps.length,_i5=targetDepths.length-1;_i5>=0&&(tr.replace(from,to,slice),!(tr.steps.length>startSteps));_i5--){var depth=targetDepths[_i5];depth<0||(from=$from.before(depth),to=$to.after(depth))}}function closeFragment(fragment,depth,oldOpen,newOpen,parent){if(depth<oldOpen){var first=fragment.firstChild;fragment=fragment.replaceChild(0,first.copy(closeFragment(first.content,depth+1,oldOpen,newOpen,first)))}if(depth>newOpen){var match=parent.contentMatchAt(0),start=match.fillBefore(fragment).append(fragment);fragment=start.append(match.matchFragment(start).fillBefore(prosemirrorModel.Fragment.empty,!0))}return fragment}function _replaceRangeWith(tr,from,to,node){if(!node.isInline&&from==to&&tr.doc.resolve(from).parent.content.size){var point=insertPoint(tr.doc,from,node.type);point!=null&&(from=to=point)}tr.replaceRange(from,to,new prosemirrorModel.Slice(prosemirrorModel.Fragment.from(node),0,0))}function _deleteRange(tr,from,to){for(var $from=tr.doc.resolve(from),$to=tr.doc.resolve(to),covered=coveredDepths($from,$to),i=0;i<covered.length;i++){var depth=covered[i],last=i==covered.length-1;if(last&&depth==0||$from.node(depth).type.contentMatch.validEnd)return tr.delete($from.start(depth),$to.end(depth));if(depth>0&&(last||$from.node(depth-1).canReplace($from.index(depth-1),$to.indexAfter(depth-1))))return tr.delete($from.before(depth),$to.after(depth))}for(var d=1;d<=$from.depth&&d<=$to.depth;d++)if(from-$from.start(d)==$from.depth-d&&to>$from.end(d)&&$to.end(d)-to!=$to.depth-d)return tr.delete($from.before(d),to);tr.delete(from,to)}function coveredDepths($from,$to){for(var result=[],minDepth=Math.min($from.depth,$to.depth),d=minDepth;d>=0;d--){var start=$from.start(d);if(start<$from.pos-($from.depth-d)||$to.end(d)>$to.pos+($to.depth-d)||$from.node(d).type.spec.isolating||$to.node(d).type.spec.isolating)break;(start==$to.start(d)||d==$from.depth&&d==$to.depth&&$from.parent.inlineContent&&$to.parent.inlineContent&&d&&$to.start(d-1)==start-1)&&result.push(d)}return result}exports.TransformError=function(_Error){_inherits(_class,_Error);var _super5=_createSuper(_class);function _class(){return _classCallCheck(this,_class),_super5.apply(this,arguments)}return _createClass(_class)}(_wrapNativeSuper(Error)),exports.TransformError=function TransformError(message){var err=Error.call(this,message);return err.__proto__=TransformError.prototype,err},exports.TransformError.prototype=Object.create(Error.prototype),exports.TransformError.prototype.constructor=exports.TransformError,exports.TransformError.prototype.name="TransformError";var Transform=function(){function Transform2(doc){_classCallCheck(this,Transform2),this.doc=doc,this.steps=[],this.docs=[],this.mapping=new Mapping}return _createClass(Transform2,[{key:"before",get:function(){return this.docs.length?this.docs[0]:this.doc}},{key:"step",value:function(_step){var result=this.maybeStep(_step);if(result.failed)throw new exports.TransformError(result.failed);return this}},{key:"maybeStep",value:function(step){var result=step.apply(this.doc);return result.failed||this.addStep(step,result.doc),result}},{key:"docChanged",get:function(){return this.steps.length>0}},{key:"addStep",value:function(step,doc){this.docs.push(this.doc),this.steps.push(step),this.mapping.appendMap(step.getMap()),this.doc=doc}},{key:"replace",value:function(from){var to=arguments.length>1&&arguments[1]!==void 0?arguments[1]:from,slice=arguments.length>2&&arguments[2]!==void 0?arguments[2]:prosemirrorModel.Slice.empty,step=replaceStep(this.doc,from,to,slice);return step&&this.step(step),this}},{key:"replaceWith",value:function(from,to,content){return this.replace(from,to,new prosemirrorModel.Slice(prosemirrorModel.Fragment.from(content),0,0))}},{key:"delete",value:function(from,to){return this.replace(from,to,prosemirrorModel.Slice.empty)}},{key:"insert",value:function(pos,content){return this.replaceWith(pos,pos,content)}},{key:"replaceRange",value:function(from,to,slice){return _replaceRange(this,from,to,slice),this}},{key:"replaceRangeWith",value:function(from,to,node){return _replaceRangeWith(this,from,to,node),this}},{key:"deleteRange",value:function(from,to){return _deleteRange(this,from,to),this}},{key:"lift",value:function(range,target){return _lift(this,range,target),this}},{key:"join",value:function(pos){var depth=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return _join(this,pos,depth),this}},{key:"wrap",value:function(range,wrappers){return _wrap2(this,range,wrappers),this}},{key:"setBlockType",value:function(from){var to=arguments.length>1&&arguments[1]!==void 0?arguments[1]:from,type=arguments.length>2?arguments[2]:void 0,attrs=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;return _setBlockType(this,from,to,type,attrs),this}},{key:"setNodeMarkup",value:function(pos,type){var attrs=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,marks=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[];return _setNodeMarkup(this,pos,type,attrs,marks),this}},{key:"split",value:function(pos){var depth=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,typesAfter=arguments.length>2?arguments[2]:void 0;return _split(this,pos,depth,typesAfter),this}},{key:"addMark",value:function(from,to,mark){return _addMark(this,from,to,mark),this}},{key:"removeMark",value:function(from,to,mark){return _removeMark(this,from,to,mark),this}},{key:"clearIncompatible",value:function(pos,parentType,match){return _clearIncompatible(this,pos,parentType,match),this}}]),Transform2}();exports.AddMarkStep=AddMarkStep,exports.MapResult=MapResult,exports.Mapping=Mapping,exports.RemoveMarkStep=RemoveMarkStep,exports.ReplaceAroundStep=ReplaceAroundStep,exports.ReplaceStep=ReplaceStep,exports.Step=Step,exports.StepMap=StepMap,exports.StepResult=StepResult,exports.Transform=Transform,exports.canJoin=canJoin,exports.canSplit=canSplit,exports.dropPoint=dropPoint,exports.findWrapping=findWrapping,exports.insertPoint=insertPoint,exports.joinPoint=joinPoint,exports.liftTarget=liftTarget,exports.replaceStep=replaceStep;

//# sourceMappingURL=2928a5b6cee38b23561c.cjs.map